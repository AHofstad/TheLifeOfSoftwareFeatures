commit 38e92b522b8abc2a5b2c4050dd8d8231127d1aeb
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Jul 1 18:56:53 2023 -0500

    üìù mm/m => mm/min

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 5f03a5495e..3cb8b4a637 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -27,22 +27,22 @@
 
 #if HAS_MULTI_EXTRUDER
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
       float swap_length;            // M217 S
       float extra_prime;            // M217 E
       float extra_resume;           // M217 B
       int16_t prime_speed;          // M217 P
       int16_t wipe_retract;         // M217 G
-      int16_t retract_speed;        // M217 R (mm/m)
-      int16_t unretract_speed;      // M217 U (mm/m)
+      int16_t retract_speed;        // M217 R (mm/min)
+      int16_t unretract_speed;      // M217 U (mm/min)
       uint8_t fan_speed;            // M217 F
       uint8_t fan_time;             // M217 D
     #endif
     #if ENABLED(TOOLCHANGE_PARK)
       bool enable_park;             // M217 W
       xyz_pos_t change_point;       // M217 X Y I J K C H O
     #endif
     float z_raise;                  // M217 Z
   } toolchange_settings_t;
 

commit 161b99cb54f5d6d183877902581d3d77e8a1fa78
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Apr 14 01:08:51 2023 -0500

    üêõ Fix some bad feedrates (#25672)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index ff456485e2..5f03a5495e 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -27,22 +27,22 @@
 
 #if HAS_MULTI_EXTRUDER
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
       float swap_length;            // M217 S
       float extra_prime;            // M217 E
       float extra_resume;           // M217 B
       int16_t prime_speed;          // M217 P
       int16_t wipe_retract;         // M217 G
-      int16_t retract_speed;        // M217 R
-      int16_t unretract_speed;      // M217 U
+      int16_t retract_speed;        // M217 R (mm/m)
+      int16_t unretract_speed;      // M217 U (mm/m)
       uint8_t fan_speed;            // M217 F
       uint8_t fan_time;             // M217 D
     #endif
     #if ENABLED(TOOLCHANGE_PARK)
       bool enable_park;             // M217 W
       xyz_pos_t change_point;       // M217 X Y I J K C H O
     #endif
     float z_raise;                  // M217 Z
   } toolchange_settings_t;
 

commit 9e5c143b87e4fc97a875e56aa9ec7d411c36d923
Author: studiodyne <diabolomix@hotmail.fr>
Date:   Sun Aug 28 00:43:32 2022 +0200

    ‚ú® M217 G wipe retract length

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 864062f572..ff456485e2 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -26,20 +26,21 @@
 //#define DEBUG_TOOLCHANGE_MIGRATION_FEATURE
 
 #if HAS_MULTI_EXTRUDER
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
       float swap_length;            // M217 S
       float extra_prime;            // M217 E
       float extra_resume;           // M217 B
       int16_t prime_speed;          // M217 P
+      int16_t wipe_retract;         // M217 G
       int16_t retract_speed;        // M217 R
       int16_t unretract_speed;      // M217 U
       uint8_t fan_speed;            // M217 F
       uint8_t fan_time;             // M217 D
     #endif
     #if ENABLED(TOOLCHANGE_PARK)
       bool enable_park;             // M217 W
       xyz_pos_t change_point;       // M217 X Y I J K C H O
     #endif
     float z_raise;                  // M217 Z

commit 6ee34331b7a0e5ea82768f4df5f3956ce5322742
Author: Robert Brenckman <Robbery525@gmail.com>
Date:   Sun Apr 10 01:24:07 2022 -0400

    üêõ Fix Tool Change priming (#21142)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 409be1e969..864062f572 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -22,38 +22,44 @@
 #pragma once
 
 #include "../inc/MarlinConfig.h"
 
 //#define DEBUG_TOOLCHANGE_MIGRATION_FEATURE
 
 #if HAS_MULTI_EXTRUDER
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
-      float swap_length, extra_prime, extra_resume;
-      int16_t prime_speed, retract_speed, unretract_speed, fan, fan_speed, fan_time;
+      float swap_length;            // M217 S
+      float extra_prime;            // M217 E
+      float extra_resume;           // M217 B
+      int16_t prime_speed;          // M217 P
+      int16_t retract_speed;        // M217 R
+      int16_t unretract_speed;      // M217 U
+      uint8_t fan_speed;            // M217 F
+      uint8_t fan_time;             // M217 D
     #endif
     #if ENABLED(TOOLCHANGE_PARK)
-      bool enable_park;
-      xyz_pos_t change_point;
+      bool enable_park;             // M217 W
+      xyz_pos_t change_point;       // M217 X Y I J K C H O
     #endif
-    float z_raise;
+    float z_raise;                  // M217 Z
   } toolchange_settings_t;
 
   extern toolchange_settings_t toolchange_settings;
 
-  #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
-    void tool_change_prime();
+  #if ENABLED(TOOLCHANGE_FS_PRIME_FIRST_USED)
+    extern bool enable_first_prime; // M217 V
   #endif
 
-  #if ENABLED(TOOLCHANGE_FS_PRIME_FIRST_USED)
-    extern bool enable_first_prime;
+  #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
+    void tool_change_prime(); // Prime the currently selected extruder
   #endif
 
   #if ENABLED(TOOLCHANGE_FS_INIT_BEFORE_SWAP)
     extern Flags<EXTRUDERS> toolchange_extruder_ready;
   #endif
 
   #if ENABLED(TOOLCHANGE_MIGRATION_FEATURE)
     typedef struct {
       uint8_t target, last;
       bool automode, in_progress;

commit c4873a64ecd54dc0bbccb1eaeecd1b5ae2f6aef5
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Apr 3 16:14:02 2022 -0500

    üßë‚Äçüíª General and Axis-based bitfield flags (#23989)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 82ed0d6105..409be1e969 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -43,21 +43,21 @@
 
   #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
     void tool_change_prime();
   #endif
 
   #if ENABLED(TOOLCHANGE_FS_PRIME_FIRST_USED)
     extern bool enable_first_prime;
   #endif
 
   #if ENABLED(TOOLCHANGE_FS_INIT_BEFORE_SWAP)
-    extern bool toolchange_extruder_ready[EXTRUDERS];
+    extern Flags<EXTRUDERS> toolchange_extruder_ready;
   #endif
 
   #if ENABLED(TOOLCHANGE_MIGRATION_FEATURE)
     typedef struct {
       uint8_t target, last;
       bool automode, in_progress;
     } migration_settings_t;
     constexpr migration_settings_t migration_defaults = { 0, 0, false, false };
     extern migration_settings_t migration;
     bool extruder_migration();

commit e5b651f407fcb743e2d00c45b0d361fb98230efb
Author: DerAndere <26200979+DerAndere1@users.noreply.github.com>
Date:   Fri Apr 1 07:10:38 2022 +0200

    ‚ú® Support for up to 9 axes (linear, rotary) (#23112)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index bbdc0b6862..82ed0d6105 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -27,21 +27,21 @@
 
 #if HAS_MULTI_EXTRUDER
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
       float swap_length, extra_prime, extra_resume;
       int16_t prime_speed, retract_speed, unretract_speed, fan, fan_speed, fan_time;
     #endif
     #if ENABLED(TOOLCHANGE_PARK)
       bool enable_park;
-      xy_pos_t change_point;
+      xyz_pos_t change_point;
     #endif
     float z_raise;
   } toolchange_settings_t;
 
   extern toolchange_settings_t toolchange_settings;
 
   #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
     void tool_change_prime();
   #endif
 

commit 553487cc8ab348939c6033910c0aa11d230b2ad6
Author: MangaValk <patrickvalkmanga@hotmail.com>
Date:   Fri Apr 16 15:02:31 2021 +0200

    Tool sensors (#17239)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index b79ec676a0..bbdc0b6862 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -72,24 +72,23 @@
   #if SWITCHING_NOZZLE_TWO_SERVOS
     void lower_nozzle(const uint8_t e);
     void raise_nozzle(const uint8_t e);
   #else
     void move_nozzle_servo(const uint8_t angle_index);
   #endif
 #endif
 
 #if ENABLED(PARKING_EXTRUDER)
 
-  #define PE_MAGNET_ON_STATE TERN_(PARKING_EXTRUDER_SOLENOIDS_INVERT, !)PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
-
   void pe_solenoid_set_pin_state(const uint8_t extruder_num, const uint8_t state);
 
+  #define PE_MAGNET_ON_STATE TERN_(PARKING_EXTRUDER_SOLENOIDS_INVERT, !)PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   inline void pe_solenoid_magnet_on(const uint8_t extruder_num)  { pe_solenoid_set_pin_state(extruder_num,  PE_MAGNET_ON_STATE); }
   inline void pe_solenoid_magnet_off(const uint8_t extruder_num) { pe_solenoid_set_pin_state(extruder_num, !PE_MAGNET_ON_STATE); }
 
   void pe_solenoid_init();
 
   extern bool extruder_parked;
   inline void parking_extruder_set_parked(const bool parked) { extruder_parked = parked; }
   bool parking_extruder_unpark_after_homing(const uint8_t final_tool, bool homed_towards_final_tool);
 
 #elif ENABLED(MAGNETIC_PARKING_EXTRUDER)
@@ -108,15 +107,21 @@
   void mpe_settings_init();
 
 #endif
 
 #if ENABLED(ELECTROMAGNETIC_SWITCHING_TOOLHEAD)
   void est_init();
 #elif ENABLED(SWITCHING_TOOLHEAD)
   void swt_init();
 #endif
 
+#if ENABLED(TOOL_SENSOR)
+  uint8_t check_tool_sensor_stats(const uint8_t active_tool, const bool kill_on_error=false, const bool disable=false);
+#else
+  inline uint8_t check_tool_sensor_stats(const uint8_t, const bool=false, const bool=false) { return 0; }
+#endif
+
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, bool no_move=false);

commit c2b72c0e73a59c7b0915253c775eb6253032f0b0
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Apr 2 14:22:43 2021 -0500

    Remove extraneous 'extern' hints (#21516)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index a97b09fd89..b79ec676a0 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -35,21 +35,21 @@
     #if ENABLED(TOOLCHANGE_PARK)
       bool enable_park;
       xy_pos_t change_point;
     #endif
     float z_raise;
   } toolchange_settings_t;
 
   extern toolchange_settings_t toolchange_settings;
 
   #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
-    extern void tool_change_prime();
+    void tool_change_prime();
   #endif
 
   #if ENABLED(TOOLCHANGE_FS_PRIME_FIRST_USED)
     extern bool enable_first_prime;
   #endif
 
   #if ENABLED(TOOLCHANGE_FS_INIT_BEFORE_SWAP)
     extern bool toolchange_extruder_ready[EXTRUDERS];
   #endif
 

commit 2d2291d00eab6159de24eb7ff74001b1d6dd29e4
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Mar 24 05:40:28 2021 -0500

    More IntelliSense-friendly declarations

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 5361451c82..a97b09fd89 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -102,19 +102,21 @@
       float travel_distance,      // M951 D
             compensation_factor;  // M951 C
   } mpe_settings_t;
 
   extern mpe_settings_t mpe_settings;
 
   void mpe_settings_init();
 
 #endif
 
-TERN_(ELECTROMAGNETIC_SWITCHING_TOOLHEAD, void est_init());
-
-TERN_(SWITCHING_TOOLHEAD, void swt_init());
+#if ENABLED(ELECTROMAGNETIC_SWITCHING_TOOLHEAD)
+  void est_init();
+#elif ENABLED(SWITCHING_TOOLHEAD)
+  void swt_init();
+#endif
 
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, bool no_move=false);

commit 431f6bf3a53f8e20ef6b74e6714d14bb23f70cc7
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Mar 3 20:48:05 2021 -0600

    Parking Extruder solenoid fix/cleanup

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 4f88ca7432..5361451c82 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -14,22 +14,21 @@
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
  * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
-#include "../inc/MarlinConfigPre.h"
-#include "../core/types.h"
+#include "../inc/MarlinConfig.h"
 
 //#define DEBUG_TOOLCHANGE_MIGRATION_FEATURE
 
 #if HAS_MULTI_EXTRUDER
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
       float swap_length, extra_prime, extra_resume;
       int16_t prime_speed, retract_speed, unretract_speed, fan, fan_speed, fan_time;
     #endif
@@ -73,25 +72,21 @@
   #if SWITCHING_NOZZLE_TWO_SERVOS
     void lower_nozzle(const uint8_t e);
     void raise_nozzle(const uint8_t e);
   #else
     void move_nozzle_servo(const uint8_t angle_index);
   #endif
 #endif
 
 #if ENABLED(PARKING_EXTRUDER)
 
-  #if ENABLED(PARKING_EXTRUDER_SOLENOIDS_INVERT)
-    #define PE_MAGNET_ON_STATE !PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
-  #else
-    #define PE_MAGNET_ON_STATE PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
-  #endif
+  #define PE_MAGNET_ON_STATE TERN_(PARKING_EXTRUDER_SOLENOIDS_INVERT, !)PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
 
   void pe_solenoid_set_pin_state(const uint8_t extruder_num, const uint8_t state);
 
   inline void pe_solenoid_magnet_on(const uint8_t extruder_num)  { pe_solenoid_set_pin_state(extruder_num,  PE_MAGNET_ON_STATE); }
   inline void pe_solenoid_magnet_off(const uint8_t extruder_num) { pe_solenoid_set_pin_state(extruder_num, !PE_MAGNET_ON_STATE); }
 
   void pe_solenoid_init();
 
   extern bool extruder_parked;
   inline void parking_extruder_set_parked(const bool parked) { extruder_parked = parked; }

commit 3f90ecfd77b608908d9a945a79518842f6d4471e
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Jan 19 20:58:50 2021 -0600

    Move singlenozzle temp/fan (#20829)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 6b739604f0..4f88ca7432 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -107,27 +107,19 @@
       float travel_distance,      // M951 D
             compensation_factor;  // M951 C
   } mpe_settings_t;
 
   extern mpe_settings_t mpe_settings;
 
   void mpe_settings_init();
 
 #endif
 
-#if ENABLED(SINGLENOZZLE_STANDBY_TEMP)
-  extern uint16_t singlenozzle_temp[EXTRUDERS];
-#endif
-
-#if BOTH(HAS_FAN, SINGLENOZZLE_STANDBY_FAN)
-  extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
-#endif
-
 TERN_(ELECTROMAGNETIC_SWITCHING_TOOLHEAD, void est_init());
 
 TERN_(SWITCHING_TOOLHEAD, void swt_init());
 
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, bool no_move=false);

commit 2f17f2207a056bef5449869161fa56e50011da31
Author: zeleps <39417467+zeleps@users.noreply.github.com>
Date:   Tue Jan 5 07:48:42 2021 +0200

    Don't apply hotend_offset.z to Z soft endstops (#20675)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index d908b496ae..6b739604f0 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -86,22 +86,23 @@
     #define PE_MAGNET_ON_STATE PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   #endif
 
   void pe_solenoid_set_pin_state(const uint8_t extruder_num, const uint8_t state);
 
   inline void pe_solenoid_magnet_on(const uint8_t extruder_num)  { pe_solenoid_set_pin_state(extruder_num,  PE_MAGNET_ON_STATE); }
   inline void pe_solenoid_magnet_off(const uint8_t extruder_num) { pe_solenoid_set_pin_state(extruder_num, !PE_MAGNET_ON_STATE); }
 
   void pe_solenoid_init();
 
+  extern bool extruder_parked;
+  inline void parking_extruder_set_parked(const bool parked) { extruder_parked = parked; }
   bool parking_extruder_unpark_after_homing(const uint8_t final_tool, bool homed_towards_final_tool);
-  void parking_extruder_set_parked();
 
 #elif ENABLED(MAGNETIC_PARKING_EXTRUDER)
 
   typedef struct MPESettings {
       float parking_xpos[2],      // M951 L R
             grab_distance;        // M951 I
  feedRate_t slow_feedrate,        // M951 J
             fast_feedrate;        // M951 H
       float travel_distance,      // M951 D
             compensation_factor;  // M951 C

commit c0a3931595a18bf0cb7e1eb381483aeb520dd5a9
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Jan 4 23:09:35 2021 -0600

    Clarify solenoid active / magnet-on state

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index fc953ddf8a..d908b496ae 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -79,24 +79,24 @@
 #endif
 
 #if ENABLED(PARKING_EXTRUDER)
 
   #if ENABLED(PARKING_EXTRUDER_SOLENOIDS_INVERT)
     #define PE_MAGNET_ON_STATE !PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   #else
     #define PE_MAGNET_ON_STATE PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   #endif
 
-  void pe_set_solenoid(const uint8_t extruder_num, const uint8_t state);
+  void pe_solenoid_set_pin_state(const uint8_t extruder_num, const uint8_t state);
 
-  inline void pe_activate_solenoid(const uint8_t extruder_num) { pe_set_solenoid(extruder_num, PE_MAGNET_ON_STATE); }
-  inline void pe_deactivate_solenoid(const uint8_t extruder_num) { pe_set_solenoid(extruder_num, !PE_MAGNET_ON_STATE); }
+  inline void pe_solenoid_magnet_on(const uint8_t extruder_num)  { pe_solenoid_set_pin_state(extruder_num,  PE_MAGNET_ON_STATE); }
+  inline void pe_solenoid_magnet_off(const uint8_t extruder_num) { pe_solenoid_set_pin_state(extruder_num, !PE_MAGNET_ON_STATE); }
 
   void pe_solenoid_init();
 
   bool parking_extruder_unpark_after_homing(const uint8_t final_tool, bool homed_towards_final_tool);
   void parking_extruder_set_parked();
 
 #elif ENABLED(MAGNETIC_PARKING_EXTRUDER)
 
   typedef struct MPESettings {
       float parking_xpos[2],      // M951 L R

commit 815c636449e399651ee0751b63ed36f2d28415e0
Author: zeleps <39417467+zeleps@users.noreply.github.com>
Date:   Fri Jan 1 22:54:44 2021 +0200

    Fix PARKING_EXTRUDER homing with solenoid (#20473)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 0b22f8b6f1..fc953ddf8a 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -86,20 +86,23 @@
     #define PE_MAGNET_ON_STATE PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   #endif
 
   void pe_set_solenoid(const uint8_t extruder_num, const uint8_t state);
 
   inline void pe_activate_solenoid(const uint8_t extruder_num) { pe_set_solenoid(extruder_num, PE_MAGNET_ON_STATE); }
   inline void pe_deactivate_solenoid(const uint8_t extruder_num) { pe_set_solenoid(extruder_num, !PE_MAGNET_ON_STATE); }
 
   void pe_solenoid_init();
 
+  bool parking_extruder_unpark_after_homing(const uint8_t final_tool, bool homed_towards_final_tool);
+  void parking_extruder_set_parked();
+
 #elif ENABLED(MAGNETIC_PARKING_EXTRUDER)
 
   typedef struct MPESettings {
       float parking_xpos[2],      // M951 L R
             grab_distance;        // M951 I
  feedRate_t slow_feedrate,        // M951 J
             fast_feedrate;        // M951 H
       float travel_distance,      // M951 D
             compensation_factor;  // M951 C
   } mpe_settings_t;

commit 21ce39aa9b304d627e6f2f7eecde873c7edb7af9
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Mon Oct 19 04:24:57 2020 -0500

    Use PGM serial strings

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 38347191d3..0b22f8b6f1 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -17,20 +17,22 @@
  *
  * You should have received a copy of the GNU General Public License
  * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 #include "../inc/MarlinConfigPre.h"
 #include "../core/types.h"
 
+//#define DEBUG_TOOLCHANGE_MIGRATION_FEATURE
+
 #if HAS_MULTI_EXTRUDER
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
       float swap_length, extra_prime, extra_resume;
       int16_t prime_speed, retract_speed, unretract_speed, fan, fan_speed, fan_time;
     #endif
     #if ENABLED(TOOLCHANGE_PARK)
       bool enable_park;
       xy_pos_t change_point;

commit 76d8d1742c1d4a1efe0fd6c0645d3fc656bfd0b2
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Sep 20 18:29:08 2020 -0500

    Add multi-extruder condition

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index d0cb57841b..38347191d3 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -17,21 +17,21 @@
  *
  * You should have received a copy of the GNU General Public License
  * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 #include "../inc/MarlinConfigPre.h"
 #include "../core/types.h"
 
-#if EXTRUDERS > 1
+#if HAS_MULTI_EXTRUDER
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
       float swap_length, extra_prime, extra_resume;
       int16_t prime_speed, retract_speed, unretract_speed, fan, fan_speed, fan_time;
     #endif
     #if ENABLED(TOOLCHANGE_PARK)
       bool enable_park;
       xy_pos_t change_point;
     #endif

commit 42fbd527f3bcc317ae6851aca5a45bdbf979de55
Author: Diego von Deschwanden <68632259+Diegovd@users.noreply.github.com>
Date:   Thu Jul 23 05:20:14 2020 +0200

    Fix links to secure sites (#18745)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index d39d7bc783..d0cb57841b 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -9,21 +9,21 @@
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation, either version 3 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 #include "../inc/MarlinConfigPre.h"
 #include "../core/types.h"
 
 #if EXTRUDERS > 1
 
   typedef struct {

commit c1dcc56a0b5bc110289ac9c4aeefa8263c5174d4
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Sat Jun 27 22:57:01 2020 -0400

    Tool Change Migration fixes and debugging (#18448)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 4b004950ab..d39d7bc783 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -52,21 +52,21 @@
     extern bool toolchange_extruder_ready[EXTRUDERS];
   #endif
 
   #if ENABLED(TOOLCHANGE_MIGRATION_FEATURE)
     typedef struct {
       uint8_t target, last;
       bool automode, in_progress;
     } migration_settings_t;
     constexpr migration_settings_t migration_defaults = { 0, 0, false, false };
     extern migration_settings_t migration;
-    void extruder_migration();
+    bool extruder_migration();
   #endif
 #endif
 
 #if DO_SWITCH_EXTRUDER
   void move_extruder_servo(const uint8_t e);
 #endif
 
 #if ENABLED(SWITCHING_NOZZLE)
   #if SWITCHING_NOZZLE_TWO_SERVOS
     void lower_nozzle(const uint8_t e);

commit 89b17b54637200838e52ae39a9e4b23f3c2f8d35
Author: studiodyne <42887851+studiodyne@users.noreply.github.com>
Date:   Tue Apr 28 07:21:23 2020 +0200

    Followup fixes for singlenozzle, etc. (#17712)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 7e73bd7bb2..4b004950ab 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -101,25 +101,26 @@
       float travel_distance,      // M951 D
             compensation_factor;  // M951 C
   } mpe_settings_t;
 
   extern mpe_settings_t mpe_settings;
 
   void mpe_settings_init();
 
 #endif
 
-#if ENABLED(SINGLENOZZLE)
+#if ENABLED(SINGLENOZZLE_STANDBY_TEMP)
   extern uint16_t singlenozzle_temp[EXTRUDERS];
-  #if HAS_FAN
-    extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
-  #endif
+#endif
+
+#if BOTH(HAS_FAN, SINGLENOZZLE_STANDBY_FAN)
+  extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
 #endif
 
 TERN_(ELECTROMAGNETIC_SWITCHING_TOOLHEAD, void est_init());
 
 TERN_(SWITCHING_TOOLHEAD, void swt_init());
 
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */

commit 8b3c7dda755ebce5bd57a7ce52891a137ea12b35
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Apr 27 04:41:18 2020 -0500

    Add HAS_FAN and others

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 534a17e946..7e73bd7bb2 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -103,21 +103,21 @@
   } mpe_settings_t;
 
   extern mpe_settings_t mpe_settings;
 
   void mpe_settings_init();
 
 #endif
 
 #if ENABLED(SINGLENOZZLE)
   extern uint16_t singlenozzle_temp[EXTRUDERS];
-  #if FAN_COUNT > 0
+  #if HAS_FAN
     extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
   #endif
 #endif
 
 TERN_(ELECTROMAGNETIC_SWITCHING_TOOLHEAD, void est_init());
 
 TERN_(SWITCHING_TOOLHEAD, void swt_init());
 
 /**
  * Perform a tool-change, which may result in moving the

commit 2f6262c27b11598293839f6d46f3b340ee6a1f4c
Author: studiodyne <42887851+studiodyne@users.noreply.github.com>
Date:   Thu Apr 23 04:03:28 2020 +0200

    Automatic Tool Migration feature (#17248)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 0e915a0415..534a17e946 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -21,29 +21,53 @@
  */
 #pragma once
 
 #include "../inc/MarlinConfigPre.h"
 #include "../core/types.h"
 
 #if EXTRUDERS > 1
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
-      float swap_length, extra_prime;
-      int16_t prime_speed, retract_speed;
+      float swap_length, extra_prime, extra_resume;
+      int16_t prime_speed, retract_speed, unretract_speed, fan, fan_speed, fan_time;
+    #endif
+    #if ENABLED(TOOLCHANGE_PARK)
+      bool enable_park;
+      xy_pos_t change_point;
     #endif
-    TERN_(TOOLCHANGE_PARK, xy_pos_t change_point);
     float z_raise;
   } toolchange_settings_t;
 
   extern toolchange_settings_t toolchange_settings;
 
+  #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
+    extern void tool_change_prime();
+  #endif
+
+  #if ENABLED(TOOLCHANGE_FS_PRIME_FIRST_USED)
+    extern bool enable_first_prime;
+  #endif
+
+  #if ENABLED(TOOLCHANGE_FS_INIT_BEFORE_SWAP)
+    extern bool toolchange_extruder_ready[EXTRUDERS];
+  #endif
+
+  #if ENABLED(TOOLCHANGE_MIGRATION_FEATURE)
+    typedef struct {
+      uint8_t target, last;
+      bool automode, in_progress;
+    } migration_settings_t;
+    constexpr migration_settings_t migration_defaults = { 0, 0, false, false };
+    extern migration_settings_t migration;
+    void extruder_migration();
+  #endif
 #endif
 
 #if DO_SWITCH_EXTRUDER
   void move_extruder_servo(const uint8_t e);
 #endif
 
 #if ENABLED(SWITCHING_NOZZLE)
   #if SWITCHING_NOZZLE_TWO_SERVOS
     void lower_nozzle(const uint8_t e);
     void raise_nozzle(const uint8_t e);

commit 6d90d1e1f552dca5e21bc61b676b8e8ce731b280
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Apr 22 16:35:03 2020 -0500

    Apply TERN to compact code (#17619)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 17c173d052..0e915a0415 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -24,23 +24,21 @@
 #include "../inc/MarlinConfigPre.h"
 #include "../core/types.h"
 
 #if EXTRUDERS > 1
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
       float swap_length, extra_prime;
       int16_t prime_speed, retract_speed;
     #endif
-    #if ENABLED(TOOLCHANGE_PARK)
-      xy_pos_t change_point;
-    #endif
+    TERN_(TOOLCHANGE_PARK, xy_pos_t change_point);
     float z_raise;
   } toolchange_settings_t;
 
   extern toolchange_settings_t toolchange_settings;
 
 #endif
 
 #if DO_SWITCH_EXTRUDER
   void move_extruder_servo(const uint8_t e);
 #endif
@@ -86,23 +84,19 @@
 
 #endif
 
 #if ENABLED(SINGLENOZZLE)
   extern uint16_t singlenozzle_temp[EXTRUDERS];
   #if FAN_COUNT > 0
     extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
   #endif
 #endif
 
-#if ENABLED(ELECTROMAGNETIC_SWITCHING_TOOLHEAD)
-  void est_init();
-#endif
+TERN_(ELECTROMAGNETIC_SWITCHING_TOOLHEAD, void est_init());
 
-#if ENABLED(SWITCHING_TOOLHEAD)
-  void swt_init();
-#endif
+TERN_(SWITCHING_TOOLHEAD, void swt_init());
 
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, bool no_move=false);

commit 57f488738bd1cf3830910758e4332c39ce819b46
Author: MangaValk <patrickvalkmanga@hotmail.com>
Date:   Sun Mar 8 22:13:41 2020 +0100

    [ToolChanger] Lock the current tool at power-up (#17093)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 025d2997d1..17c173d052 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -90,15 +90,19 @@
   extern uint16_t singlenozzle_temp[EXTRUDERS];
   #if FAN_COUNT > 0
     extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
   #endif
 #endif
 
 #if ENABLED(ELECTROMAGNETIC_SWITCHING_TOOLHEAD)
   void est_init();
 #endif
 
+#if ENABLED(SWITCHING_TOOLHEAD)
+  void swt_init();
+#endif
+
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, bool no_move=false);

commit bfad23d3e2e590b257ebe4317d7b14cc2dd3435c
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Feb 3 08:00:57 2020 -0600

    (c) 2020

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 613cb1612c..025d2997d1 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -1,13 +1,13 @@
 /**
  * Marlin 3D Printer Firmware
- * Copyright (c) 2019 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
+ * Copyright (c) 2020 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
  *
  * Based on Sprinter and grbl.
  * Copyright (c) 2011 Camiel Gubbels / Erik van der Zalm
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation, either version 3 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,

commit 50e4545255605eb506c20eb107270038b0fe7bdb
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Sep 29 04:25:39 2019 -0500

    Add custom types for position (#15204)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 42b96e2c6a..613cb1612c 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -15,30 +15,31 @@
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 #include "../inc/MarlinConfigPre.h"
+#include "../core/types.h"
 
 #if EXTRUDERS > 1
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
       float swap_length, extra_prime;
       int16_t prime_speed, retract_speed;
     #endif
     #if ENABLED(TOOLCHANGE_PARK)
-      struct { float x, y; } change_point;
+      xy_pos_t change_point;
     #endif
     float z_raise;
   } toolchange_settings_t;
 
   extern toolchange_settings_t toolchange_settings;
 
 #endif
 
 #if DO_SWITCH_EXTRUDER
   void move_extruder_servo(const uint8_t e);

commit 455dabb18334c89878a75be62bccebd9f537574d
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Sep 26 01:28:09 2019 -0500

    Add a feedRate_t data type (#15349)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 754c720096..42b96e2c6a 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -64,26 +64,26 @@
   void pe_set_solenoid(const uint8_t extruder_num, const uint8_t state);
 
   inline void pe_activate_solenoid(const uint8_t extruder_num) { pe_set_solenoid(extruder_num, PE_MAGNET_ON_STATE); }
   inline void pe_deactivate_solenoid(const uint8_t extruder_num) { pe_set_solenoid(extruder_num, !PE_MAGNET_ON_STATE); }
 
   void pe_solenoid_init();
 
 #elif ENABLED(MAGNETIC_PARKING_EXTRUDER)
 
   typedef struct MPESettings {
-    float parking_xpos[2],      // M951 L R
-          grab_distance,        // M951 I
-          slow_feedrate,        // M951 J
-          fast_feedrate,        // M951 H
-          travel_distance,      // M951 D
-          compensation_factor;  // M951 C
+      float parking_xpos[2],      // M951 L R
+            grab_distance;        // M951 I
+ feedRate_t slow_feedrate,        // M951 J
+            fast_feedrate;        // M951 H
+      float travel_distance,      // M951 D
+            compensation_factor;  // M951 C
   } mpe_settings_t;
 
   extern mpe_settings_t mpe_settings;
 
   void mpe_settings_init();
 
 #endif
 
 #if ENABLED(SINGLENOZZLE)
   extern uint16_t singlenozzle_temp[EXTRUDERS];

commit ce02c6cee2bf17590d929d078d71cc37f67e00d1
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Sun Jul 14 12:40:58 2019 -0400

    Variable tool change purge (#14618)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 87be78b3a7..754c720096 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -20,21 +20,21 @@
  *
  */
 #pragma once
 
 #include "../inc/MarlinConfigPre.h"
 
 #if EXTRUDERS > 1
 
   typedef struct {
     #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
-      float swap_length;
+      float swap_length, extra_prime;
       int16_t prime_speed, retract_speed;
     #endif
     #if ENABLED(TOOLCHANGE_PARK)
       struct { float x, y; } change_point;
     #endif
     float z_raise;
   } toolchange_settings_t;
 
   extern toolchange_settings_t toolchange_settings;
 

commit 2f932a11b3bacb50c520fed0549551e2e363a41a
Author: Aliaksei Kvitsinski <aleksei.wm@gmail.com>
Date:   Mon Jul 1 13:55:23 2019 +0300

    Park heads with electromagnet (#14023)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 5d5503818c..87be78b3a7 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -85,15 +85,19 @@
 
 #endif
 
 #if ENABLED(SINGLENOZZLE)
   extern uint16_t singlenozzle_temp[EXTRUDERS];
   #if FAN_COUNT > 0
     extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
   #endif
 #endif
 
+#if ENABLED(ELECTROMAGNETIC_SWITCHING_TOOLHEAD)
+  void est_init();
+#endif
+
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, bool no_move=false);

commit 93cd66ac1146603e8a9911fceb3c63f4351f4d8e
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Jun 27 23:57:50 2019 -0500

    Tweaky change from (C) to (c)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 14d076ba43..5d5503818c 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -1,16 +1,16 @@
 /**
  * Marlin 3D Printer Firmware
- * Copyright (C) 2019 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
+ * Copyright (c) 2019 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
  *
  * Based on Sprinter and grbl.
- * Copyright (C) 2011 Camiel Gubbels / Erik van der Zalm
+ * Copyright (c) 2011 Camiel Gubbels / Erik van der Zalm
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation, either version 3 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.

commit aa0383a83b7bc45b86753ef9f5adb41da09c76df
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Sun Jun 23 21:00:48 2019 -0400

    Enhance IDEX toolchange auto-return w/ no park, full control (#14117)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 07f88dce88..14d076ba43 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -89,11 +89,11 @@
   extern uint16_t singlenozzle_temp[EXTRUDERS];
   #if FAN_COUNT > 0
     extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
   #endif
 #endif
 
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
-void tool_change(const uint8_t tmp_extruder, const float fr_mm_s=0.0, bool no_move=false);
+void tool_change(const uint8_t tmp_extruder, bool no_move=false);

commit 0feeef26048883640b37ebe3994730f31ef6e922
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Feb 12 15:06:53 2019 -0600

    Update copyright in headers

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 2458800c78..07f88dce88 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -1,13 +1,13 @@
 /**
  * Marlin 3D Printer Firmware
- * Copyright (C) 2016 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
+ * Copyright (C) 2019 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
  *
  * Based on Sprinter and grbl.
  * Copyright (C) 2011 Camiel Gubbels / Erik van der Zalm
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation, either version 3 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,

commit 524c6c10bf52b9956ca2f68eb3d3074e5cba0706
Author: Rolf Werum <39219447+Weruminger@users.noreply.github.com>
Date:   Wed Feb 6 13:30:53 2019 +0100

    MAGNETIC_PARKING_EXTRUDER (#12351)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 8e16fd6cb3..2458800c78 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -54,28 +54,43 @@
 #endif
 
 #if ENABLED(PARKING_EXTRUDER)
 
   #if ENABLED(PARKING_EXTRUDER_SOLENOIDS_INVERT)
     #define PE_MAGNET_ON_STATE !PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   #else
     #define PE_MAGNET_ON_STATE PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   #endif
 
-  void pe_set_magnet(const uint8_t extruder_num, const uint8_t state);
+  void pe_set_solenoid(const uint8_t extruder_num, const uint8_t state);
 
-  inline void pe_activate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, PE_MAGNET_ON_STATE); }
-  inline void pe_deactivate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, !PE_MAGNET_ON_STATE); }
+  inline void pe_activate_solenoid(const uint8_t extruder_num) { pe_set_solenoid(extruder_num, PE_MAGNET_ON_STATE); }
+  inline void pe_deactivate_solenoid(const uint8_t extruder_num) { pe_set_solenoid(extruder_num, !PE_MAGNET_ON_STATE); }
 
-  void pe_magnet_init();
+  void pe_solenoid_init();
 
-#endif // PARKING_EXTRUDER
+#elif ENABLED(MAGNETIC_PARKING_EXTRUDER)
+
+  typedef struct MPESettings {
+    float parking_xpos[2],      // M951 L R
+          grab_distance,        // M951 I
+          slow_feedrate,        // M951 J
+          fast_feedrate,        // M951 H
+          travel_distance,      // M951 D
+          compensation_factor;  // M951 C
+  } mpe_settings_t;
+
+  extern mpe_settings_t mpe_settings;
+
+  void mpe_settings_init();
+
+#endif
 
 #if ENABLED(SINGLENOZZLE)
   extern uint16_t singlenozzle_temp[EXTRUDERS];
   #if FAN_COUNT > 0
     extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
   #endif
 #endif
 
 /**
  * Perform a tool-change, which may result in moving the

commit 5cfc1cdacc52ca9e09e40872ab2918d0d88ef0f2
Author: Marcio Teixeira <marcio@alephobjects.com>
Date:   Sun Feb 3 23:19:56 2019 -0700

    Support SWITCHING_NOZZLE with 2 servos (#13054)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 39f6a4b52f..8e16fd6cb3 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -38,21 +38,26 @@
 
   extern toolchange_settings_t toolchange_settings;
 
 #endif
 
 #if DO_SWITCH_EXTRUDER
   void move_extruder_servo(const uint8_t e);
 #endif
 
 #if ENABLED(SWITCHING_NOZZLE)
-  void move_nozzle_servo(const uint8_t e);
+  #if SWITCHING_NOZZLE_TWO_SERVOS
+    void lower_nozzle(const uint8_t e);
+    void raise_nozzle(const uint8_t e);
+  #else
+    void move_nozzle_servo(const uint8_t angle_index);
+  #endif
 #endif
 
 #if ENABLED(PARKING_EXTRUDER)
 
   #if ENABLED(PARKING_EXTRUDER_SOLENOIDS_INVERT)
     #define PE_MAGNET_ON_STATE !PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   #else
     #define PE_MAGNET_ON_STATE PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   #endif
 

commit 6471a75a228d8d60416f7b405e888064e7e8c8da
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Tue Nov 6 22:52:20 2018 -0500

    Combine more tool-change variables (#12137)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 2212347786..39f6a4b52f 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -19,26 +19,26 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 #include "../inc/MarlinConfigPre.h"
 
 #if EXTRUDERS > 1
 
   typedef struct {
-    #if ENABLED(SINGLENOZZLE)
+    #if ENABLED(TOOLCHANGE_FILAMENT_SWAP)
       float swap_length;
       int16_t prime_speed, retract_speed;
-      #if ENABLED(SINGLENOZZLE_SWAP_PARK)
-        struct { float x, y; } change_point;
-      #endif
+    #endif
+    #if ENABLED(TOOLCHANGE_PARK)
+      struct { float x, y; } change_point;
     #endif
     float z_raise;
   } toolchange_settings_t;
 
   extern toolchange_settings_t toolchange_settings;
 
 #endif
 
 #if DO_SWITCH_EXTRUDER
   void move_extruder_servo(const uint8_t e);

commit d801f8596386d06db6a8696f18c966e27e1de14d
Author: Roman Moravƒç√≠k <roman.moravcik@gmail.com>
Date:   Sun Oct 21 09:56:31 2018 +0200

    Correct EEPROM read/write disparities. (#12169)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 8787d45687..2212347786 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -19,26 +19,28 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 #include "../inc/MarlinConfigPre.h"
 
 #if EXTRUDERS > 1
 
   typedef struct {
-    float swap_length;
-    int16_t prime_speed, retract_speed;
-    #if ENABLED(SINGLENOZZLE_SWAP_PARK)
-      struct { float x, y; } change_point;
+    #if ENABLED(SINGLENOZZLE)
+      float swap_length;
+      int16_t prime_speed, retract_speed;
+      #if ENABLED(SINGLENOZZLE_SWAP_PARK)
+        struct { float x, y; } change_point;
+      #endif
     #endif
-    float z_raise = TOOLCHANGE_ZRAISE;
+    float z_raise;
   } toolchange_settings_t;
 
   extern toolchange_settings_t toolchange_settings;
 
 #endif
 
 #if DO_SWITCH_EXTRUDER
   void move_extruder_servo(const uint8_t e);
 #endif
 

commit a768df83cb6811215ce8420aebdba1e63faf9f25
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Thu Oct 18 12:26:14 2018 -0400

    Remove stale variable (#12136)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index b823278041..8787d45687 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -63,17 +63,15 @@
 
 #endif // PARKING_EXTRUDER
 
 #if ENABLED(SINGLENOZZLE)
   extern uint16_t singlenozzle_temp[EXTRUDERS];
   #if FAN_COUNT > 0
     extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
   #endif
 #endif
 
-extern float z_raise;
-
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, const float fr_mm_s=0.0, bool no_move=false);

commit 3ec38727305862c881f268e2fc27f8188b5bc767
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Wed Oct 17 12:11:41 2018 -0400

    Single Z raise value for all tool-changing / parking (#12090)
    
    * Universal tool-change Z lift
    * Add TOOLCHANGE_ZRAISE to example configs
    * Park/unpark changes to example configs
    * Implement DEBUG_DXC_MODE

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index d3851f89a4..b823278041 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -16,20 +16,35 @@
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 #include "../inc/MarlinConfigPre.h"
 
+#if EXTRUDERS > 1
+
+  typedef struct {
+    float swap_length;
+    int16_t prime_speed, retract_speed;
+    #if ENABLED(SINGLENOZZLE_SWAP_PARK)
+      struct { float x, y; } change_point;
+    #endif
+    float z_raise = TOOLCHANGE_ZRAISE;
+  } toolchange_settings_t;
+
+  extern toolchange_settings_t toolchange_settings;
+
+#endif
+
 #if DO_SWITCH_EXTRUDER
   void move_extruder_servo(const uint8_t e);
 #endif
 
 #if ENABLED(SWITCHING_NOZZLE)
   void move_nozzle_servo(const uint8_t e);
 #endif
 
 #if ENABLED(PARKING_EXTRUDER)
 
@@ -42,30 +57,23 @@
   void pe_set_magnet(const uint8_t extruder_num, const uint8_t state);
 
   inline void pe_activate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, PE_MAGNET_ON_STATE); }
   inline void pe_deactivate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, !PE_MAGNET_ON_STATE); }
 
   void pe_magnet_init();
 
 #endif // PARKING_EXTRUDER
 
 #if ENABLED(SINGLENOZZLE)
-  typedef struct {
-    float swap_length;
-    int16_t prime_speed, retract_speed;
-    #if ENABLED(SINGLENOZZLE_SWAP_PARK)
-      struct { float x, y; } change_point;
-    #endif
-    float z_raise;
-  } singlenozzle_settings_t;
-  extern singlenozzle_settings_t sn_settings;
   extern uint16_t singlenozzle_temp[EXTRUDERS];
   #if FAN_COUNT > 0
     extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
   #endif
 #endif
 
+extern float z_raise;
+
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, const float fr_mm_s=0.0, bool no_move=false);

commit 951b25163e8b9e09212594b47c26434f23dc1a1e
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Oct 13 23:08:20 2018 -0500

    Extend M217 with configurable park/raise (#12076)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 39b8b0b683..d3851f89a4 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -45,20 +45,24 @@
   inline void pe_deactivate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, !PE_MAGNET_ON_STATE); }
 
   void pe_magnet_init();
 
 #endif // PARKING_EXTRUDER
 
 #if ENABLED(SINGLENOZZLE)
   typedef struct {
     float swap_length;
     int16_t prime_speed, retract_speed;
+    #if ENABLED(SINGLENOZZLE_SWAP_PARK)
+      struct { float x, y; } change_point;
+    #endif
+    float z_raise;
   } singlenozzle_settings_t;
   extern singlenozzle_settings_t sn_settings;
   extern uint16_t singlenozzle_temp[EXTRUDERS];
   #if FAN_COUNT > 0
     extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
   #endif
 #endif
 
 /**
  * Perform a tool-change, which may result in moving the

commit d556dc18650e2185791834d7fe70b4acf45254bc
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Oct 10 09:45:20 2018 -0500

    Fix and improve EEPROM storage (#12054)
    
    * Clean up Temperature PID
    * Improve EEPROM read/write/validate
    * Group `SINGLENOZZLE` saved settings
    * Group planner saved settings
    * Group filament change saved settings
    * Group skew saved settings
    * Group `FWRETRACT` saved settings

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 2edcf95c94..39b8b0b683 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -12,25 +12,23 @@
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
+#pragma once
 
-#ifndef TOOL_CHANGE_H
-#define TOOL_CHANGE_H
-
-#include "../inc/MarlinConfig.h"
+#include "../inc/MarlinConfigPre.h"
 
 #if DO_SWITCH_EXTRUDER
   void move_extruder_servo(const uint8_t e);
 #endif
 
 #if ENABLED(SWITCHING_NOZZLE)
   void move_nozzle_servo(const uint8_t e);
 #endif
 
 #if ENABLED(PARKING_EXTRUDER)
@@ -44,26 +42,26 @@
   void pe_set_magnet(const uint8_t extruder_num, const uint8_t state);
 
   inline void pe_activate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, PE_MAGNET_ON_STATE); }
   inline void pe_deactivate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, !PE_MAGNET_ON_STATE); }
 
   void pe_magnet_init();
 
 #endif // PARKING_EXTRUDER
 
 #if ENABLED(SINGLENOZZLE)
-  extern float singlenozzle_swap_length;
-  extern int16_t singlenozzle_prime_speed,
-                 singlenozzle_retract_speed;
+  typedef struct {
+    float swap_length;
+    int16_t prime_speed, retract_speed;
+  } singlenozzle_settings_t;
+  extern singlenozzle_settings_t sn_settings;
   extern uint16_t singlenozzle_temp[EXTRUDERS];
   #if FAN_COUNT > 0
     extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
   #endif
 #endif
 
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, const float fr_mm_s=0.0, bool no_move=false);
-
-#endif // TOOL_CHANGE_H

commit 74cd6cb4fc90e4c483e7a97a313c0257790f1375
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Sun Oct 7 18:06:14 2018 -0400

    Single nozzle filament change (#11994)

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index 53da00d178..2edcf95c94 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -43,17 +43,27 @@
 
   void pe_set_magnet(const uint8_t extruder_num, const uint8_t state);
 
   inline void pe_activate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, PE_MAGNET_ON_STATE); }
   inline void pe_deactivate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, !PE_MAGNET_ON_STATE); }
 
   void pe_magnet_init();
 
 #endif // PARKING_EXTRUDER
 
+#if ENABLED(SINGLENOZZLE)
+  extern float singlenozzle_swap_length;
+  extern int16_t singlenozzle_prime_speed,
+                 singlenozzle_retract_speed;
+  extern uint16_t singlenozzle_temp[EXTRUDERS];
+  #if FAN_COUNT > 0
+    extern uint8_t singlenozzle_fan_speed[EXTRUDERS];
+  #endif
+#endif
+
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, const float fr_mm_s=0.0, bool no_move=false);
 
 #endif // TOOL_CHANGE_H

commit 3c76bda2d8d1f198a9e6dcb94aca6e383c9d5392
Author: GMagician <GMagician@users.noreply.github.com>
Date:   Fri May 18 20:16:59 2018 +0200

    Fix switching extruder
    
    `DONT_SWITCH` got lost along the way. Replace it with `DO_SWITCH_EXTRUDER` and adjust the code.

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index a464085d44..53da00d178 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -18,21 +18,21 @@
  * You should have received a copy of the GNU General Public License
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 
 #ifndef TOOL_CHANGE_H
 #define TOOL_CHANGE_H
 
 #include "../inc/MarlinConfig.h"
 
-#if ENABLED(SWITCHING_EXTRUDER)
+#if DO_SWITCH_EXTRUDER
   void move_extruder_servo(const uint8_t e);
 #endif
 
 #if ENABLED(SWITCHING_NOZZLE)
   void move_nozzle_servo(const uint8_t e);
 #endif
 
 #if ENABLED(PARKING_EXTRUDER)
 
   #if ENABLED(PARKING_EXTRUDER_SOLENOIDS_INVERT)

commit 07cf75883f125d569cb2013594a7519074eb34e4
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Sep 18 01:05:44 2017 -0500

    Move T (tool change) to cpp

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
index cfd1c1605d..a464085d44 100644
--- a/Marlin/src/module/tool_change.h
+++ b/Marlin/src/module/tool_change.h
@@ -39,19 +39,21 @@
     #define PE_MAGNET_ON_STATE !PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   #else
     #define PE_MAGNET_ON_STATE PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
   #endif
 
   void pe_set_magnet(const uint8_t extruder_num, const uint8_t state);
 
   inline void pe_activate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, PE_MAGNET_ON_STATE); }
   inline void pe_deactivate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, !PE_MAGNET_ON_STATE); }
 
+  void pe_magnet_init();
+
 #endif // PARKING_EXTRUDER
 
 /**
  * Perform a tool-change, which may result in moving the
  * previous tool out of the way and the new tool into place.
  */
 void tool_change(const uint8_t tmp_extruder, const float fr_mm_s=0.0, bool no_move=false);
 
 #endif // TOOL_CHANGE_H

commit 4231faf7796ca8adb9ca861b014b65e79f67b376
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Sep 6 06:28:31 2017 -0500

    Initial split-up of G-code handlers by category

diff --git a/Marlin/src/module/tool_change.h b/Marlin/src/module/tool_change.h
new file mode 100644
index 0000000000..cfd1c1605d
--- /dev/null
+++ b/Marlin/src/module/tool_change.h
@@ -0,0 +1,57 @@
+/**
+ * Marlin 3D Printer Firmware
+ * Copyright (C) 2016 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
+ *
+ * Based on Sprinter and grbl.
+ * Copyright (C) 2011 Camiel Gubbels / Erik van der Zalm
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
+#ifndef TOOL_CHANGE_H
+#define TOOL_CHANGE_H
+
+#include "../inc/MarlinConfig.h"
+
+#if ENABLED(SWITCHING_EXTRUDER)
+  void move_extruder_servo(const uint8_t e);
+#endif
+
+#if ENABLED(SWITCHING_NOZZLE)
+  void move_nozzle_servo(const uint8_t e);
+#endif
+
+#if ENABLED(PARKING_EXTRUDER)
+
+  #if ENABLED(PARKING_EXTRUDER_SOLENOIDS_INVERT)
+    #define PE_MAGNET_ON_STATE !PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
+  #else
+    #define PE_MAGNET_ON_STATE PARKING_EXTRUDER_SOLENOIDS_PINS_ACTIVE
+  #endif
+
+  void pe_set_magnet(const uint8_t extruder_num, const uint8_t state);
+
+  inline void pe_activate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, PE_MAGNET_ON_STATE); }
+  inline void pe_deactivate_magnet(const uint8_t extruder_num) { pe_set_magnet(extruder_num, !PE_MAGNET_ON_STATE); }
+
+#endif // PARKING_EXTRUDER
+
+/**
+ * Perform a tool-change, which may result in moving the
+ * previous tool out of the way and the new tool into place.
+ */
+void tool_change(const uint8_t tmp_extruder, const float fr_mm_s=0.0, bool no_move=false);
+
+#endif // TOOL_CHANGE_H
