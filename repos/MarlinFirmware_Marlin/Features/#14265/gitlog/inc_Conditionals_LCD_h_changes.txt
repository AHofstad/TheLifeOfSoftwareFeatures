commit 3469cb9d24846494c6ea60c59e10d290bb1e7e8d
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Jul 11 16:27:52 2024 -0500

    üîß Fallback STRING_CONFIG_H_AUTHOR

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 4e5aa0bc0d..573cfb0d3c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -19,20 +19,24 @@
  * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
+#ifndef STRING_CONFIG_H_AUTHOR
+  #define STRING_CONFIG_H_AUTHOR "(anonymous)"
+#endif
+
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  * These defines must be simple constants for use in REPEAT, etc.

commit 44c268216858393243e0773ffc35bb926fb816c5
Author: Justin Nesselrotte <admin@jnesselr.org>
Date:   Tue Jul 9 16:00:14 2024 -0600

    ‚ú® RS485 support with G-code M485 (#25680)
    
    Co-authored-by: Stephen Hawes <sphawes@gmail.com>
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ab5fd9e55c..4e5aa0bc0d 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1662,20 +1662,23 @@
   #endif
 #elif defined(SERIAL_PORT)
   #define NUM_SERIAL 1
 #else
   #define NUM_SERIAL 0
   #undef BAUD_RATE_GCODE
 #endif
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1 || SERIAL_PORT_3 == -1
   #define HAS_USB_SERIAL 1
 #endif
+#ifdef RS485_SERIAL_PORT
+  #define HAS_RS485_SERIAL 1
+#endif
 #if SERIAL_PORT_2 == -2
   #define HAS_ETHERNET 1
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170

commit 4af5229cee2a2bb49ae53d76fbc145fc69d802c6
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Jul 5 20:08:07 2024 -0500

    üßë‚Äçüíª Conditional HAS_LED_POWEROFF_TIMEOUT

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f664e84691..ab5fd9e55c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1891,13 +1891,17 @@
   #define COORDINATE_OKAY(N,L,H) true
 #endif
 
 /**
  * LED Backlight INDEX END
  */
 #if defined(NEOPIXEL_BKGD_INDEX_FIRST) && !defined(NEOPIXEL_BKGD_INDEX_LAST)
   #define NEOPIXEL_BKGD_INDEX_LAST NEOPIXEL_BKGD_INDEX_FIRST
 #endif
 
+#if LED_POWEROFF_TIMEOUT > 0
+  #define HAS_LED_POWEROFF_TIMEOUT 1
+#endif
+
 #if ALL(SPI_FLASH, HAS_MEDIA, MARLIN_DEV_MODE)
   #define SPI_FLASH_BACKUP 1
 #endif

commit 1d1eb97567b997bb2d1b5b502891978f24201420
Author: ellensp <530024+ellensp@users.noreply.github.com>
Date:   Fri Jul 5 12:43:17 2024 +1200

    üö∏ Update Zonestar OLEDs to SPI (#27220)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7de6146f29..f664e84691 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -647,25 +647,25 @@
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
 
 #elif ENABLED(ZONESTAR_12864LCD)
   #define DOGLCD
   #define IS_RRD_SC 1
   #define IS_U8GLIB_ST7920 1
 
 #elif ENABLED(ZONESTAR_12864OLED)
   #define IS_RRD_SC 1
-  #define U8GLIB_SH1106
+  #define U8GLIB_SH1106_SPI
 
 #elif ENABLED(ZONESTAR_12864OLED_SSD1306)
   #define IS_RRD_SC 1
-  #define IS_U8GLIB_SSD1306
+  #define U8GLIB_SSD1306_SPI
 
 #elif ENABLED(RADDS_DISPLAY)
   #define IS_ULTIPANEL 1
   #define STD_ENCODER_PULSES_PER_STEP 2
 
 #elif ANY(miniVIKI, VIKI2, WYH_L12864, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, EMOTION_TECH_LCD)
 
   #define DOGLCD
   #define IS_DOGM_12864 1
   #define IS_ULTIPANEL 1
@@ -709,21 +709,21 @@
   #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC 1
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(SAV_3DGLCD)
 
-  #ifdef U8GLIB_SSD1306
+  #if ENABLED(U8GLIB_SSD1306)
     #define IS_U8GLIB_SSD1306 // Allow for U8GLIB_SSD1306 + SAV_3DGLCD
   #endif
   #define IS_NEWPANEL 1
 
 #elif ENABLED(FYSETC_242_OLED_12864)
 
   #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
   #ifndef NEOPIXEL_BRIGHTNESS
@@ -850,23 +850,26 @@
   #define PCA9632_NO_AUTO_INC
   #define PCA9632_GRN         0x00
   #define PCA9632_RED         0x02
   #define PCA9632_BUZZER
   #define PCA9632_BUZZER_DATA { 0x09, 0x02 }
 
   #define STD_ENCODER_PULSES_PER_STEP     1 // Overlord uses buttons
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 
-// 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
+// 128x64 I2C OLED LCDs (SSD1306 / SSD1309 / SH1106)
+// ...and 128x64 SPI OLED LCDs (SSD1306 / SH1106)
 #if ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
   #define HAS_U8GLIB_I2C_OLED 1
+#endif
+#if ANY(HAS_U8GLIB_I2C_OLED, U8GLIB_SSD1306_SPI, U8GLIB_SH1106_SPI)
   #define HAS_WIRED_LCD 1
   #define DOGLCD
 #endif
 
 /**
  * SPI Ultipanels
  */
 
 // Basic Ultipanel-like displays
 #if ANY(ULTIMAKERCONTROLLER, IS_RRD_SC, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)

commit 1f9fc665ec21f95666801aa4fccc4f4f71932018
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Jun 26 18:27:05 2024 -0500

    üö∏ MarlinUI:: clear_for_drawing

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 6b9ac4efe6..7de6146f29 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1092,20 +1092,23 @@
 #if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
   /**
    * HAS_DISPLAY indicates the display uses these MarlinUI methods...
    *  - update
    *  - abort_print
    *  - pause_print
    *  - resume_print
    *  - poweroff        (for PSU_CONTROL and HAS_MARLINUI_MENU)
    *
    *  ...and implements these MarlinUI methods:
+   *  - init_lcd
+   *  - clear_lcd
+   *  - clear_for_drawing
    *  - zoffset_overlay (if BABYSTEP_GFX_OVERLAY or MESH_EDIT_GFX_OVERLAY are supported)
    *  - draw_kill_screen
    *  - kill_screen
    *  - draw_status_message
    *    (calling advance_status_scroll, status_and_len for a scrolling status message)
    */
   #define HAS_DISPLAY 1
 #endif
 
 #if ANY(HAS_DISPLAY, DWIN_CREALITY_LCD)

commit c30904b6318c6b6df2ca46d15335ccf7dd641806
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Jun 8 14:51:03 2024 -0500

    üßë‚Äçüíª U8G_SPI_USE_MODE_3 for *_MINI_12864

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index efda2d493e..6b9ac4efe6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -808,20 +808,24 @@
 
   #define IS_RRD_SC 1   // RepRapDiscount LCD or Graphical LCD with rotary click encoder
 
 #elif ENABLED(K3D_242_OLED_CONTROLLER)
 
   #define IS_RRD_SC 1
   #define U8GLIB_SSD1309
 
 #endif
 
+#if ANY(FYSETC_MINI_12864, MKS_MINI_12864)
+  #define U8G_SPI_USE_MODE_3 1
+#endif
+
 // ST7920-based graphical displays
 #if ANY(IS_RRD_FG_SC, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
   #define IS_U8GLIB_ST7920 1
   #define IS_RRD_SC 1
 #endif
 
 // ST7565 / 64128N graphical displays
 #if ANY(MAKRPANEL, MINIPANEL)
   #define IS_ULTIPANEL 1

commit 1da947f54806437fdff84adfdc06f48d2e3d60a3
Author: narno2202 <130909513+narno2202@users.noreply.github.com>
Date:   Thu May 9 23:57:23 2024 +0200

    ‚ö°Ô∏è FT_MOTION : Core and other refinements (#26720)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>
    Co-authored-by: Ulendo Alex <alex@ulendo.io>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2a8c02f912..efda2d493e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1596,22 +1596,20 @@
   #define CORE_IS_XY 1
 #endif
 #if ANY(COREXZ, COREZX)
   #define CORE_IS_XZ 1
 #endif
 #if ANY(COREYZ, COREZY)
   #define CORE_IS_YZ 1
 #endif
 #if CORE_IS_XY || CORE_IS_XZ || CORE_IS_YZ
   #define IS_CORE 1
-#endif
-#if IS_CORE
   #if CORE_IS_XY
     #define CORE_AXIS_1 A_AXIS
     #define CORE_AXIS_2 B_AXIS
     #define NORMAL_AXIS Z_AXIS
   #elif CORE_IS_XZ
     #define CORE_AXIS_1 A_AXIS
     #define NORMAL_AXIS Y_AXIS
     #define CORE_AXIS_2 C_AXIS
   #elif CORE_IS_YZ
     #define NORMAL_AXIS X_AXIS

commit a3960dfa53394f9d105cbd23dc260ed81ff884f4
Author: David Buezas <dbuezas@users.noreply.github.com>
Date:   Thu May 9 23:20:57 2024 +0200

    üö∏ New encoder logic & debounce (#26723)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a3756217e6..2a8c02f912 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -886,24 +886,25 @@
   #endif
   #if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
     #define TFT_CLASSIC_UI
   #elif ANY(TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI)
     #define TFT_COLOR_UI
   #elif ANY(TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
     #define TFT_LVGL_UI
   #endif
 #endif
 
-// FSMC/SPI TFT Panels (LVGL)
+// FSMC/SPI TFT Panels (LVGL) with encoder click wheel
 #if ENABLED(TFT_LVGL_UI)
   #define HAS_TFT_LVGL_UI 1
   #define SERIAL_RUNTIME_HOOK 1
+  #define STD_ENCODER_PULSES_PER_STEP 4
 #endif
 
 // FSMC/SPI TFT Panels
 #if ENABLED(TFT_CLASSIC_UI)
   #define TFT_SCALED_DOGLCD 1
 #endif
 
 #if TFT_SCALED_DOGLCD
   #define DOGLCD
   #define IS_ULTIPANEL 1
@@ -969,20 +970,31 @@
 
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #endif
 
 #if ANY(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008) && DISABLED(NO_LCD_DETECT)
   #define DETECT_I2C_LCD_DEVICE 1
 #endif
 
+/**
+ * Ender-3 V2 DWIN with Encoder
+ */
+#if ANY(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
+  #define HAS_DWIN_E3V2_BASIC 1
+#endif
+#if ANY(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
+  #define HAS_DWIN_E3V2 1
+  #define STD_ENCODER_PULSES_PER_STEP 4
+#endif
+
 // Encoder behavior
 #ifndef STD_ENCODER_PULSES_PER_STEP
   #if ENABLED(TOUCH_SCREEN)
     #define STD_ENCODER_PULSES_PER_STEP 2
   #else
     #define STD_ENCODER_PULSES_PER_STEP 5
   #endif
 #endif
 #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
@@ -990,24 +1002,26 @@
 #ifndef ENCODER_PULSES_PER_STEP
   #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
 #endif
 #ifndef ENCODER_STEPS_PER_MENU_ITEM
   #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
 #endif
 #ifndef ENCODER_FEEDRATE_DEADZONE
   #define ENCODER_FEEDRATE_DEADZONE 6
 #endif
 
-// Shift register panels
-// ---------------------
-// 2 wire Non-latching LCD SR from:
-// https://github.com/fmalpartida/New-LiquidCrystal/wiki/schematics#user-content-ShiftRegister_connection
+/**
+ * Shift register panels
+ * ---------------------
+ * 2 wire Non-latching LCD SR from:
+ * https://github.com/fmalpartida/New-LiquidCrystal/wiki/schematics#user-content-ShiftRegister_connection
+ */
 #if ENABLED(FF_INTERFACEBOARD)
   #define SR_LCD_3W_NL    // Non latching 3 wire shift register
   #define IS_ULTIPANEL 1
 #elif ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define IS_ULTIPANEL 1
 #elif ENABLED(ULTIPANEL)
   #define IS_ULTIPANEL 1
 #endif
 
@@ -1033,25 +1047,20 @@
     #define HAS_DGUS_LCD_CLASSIC 1
   #endif
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT, TOUCH_UI_FTDI_EVE, DWIN_LCD_PROUI)
   #define IS_EXTUI 1 // Just for sanity check.
   #define EXTENSIBLE_UI
 #endif
 
-// Aliases for LCD features
-#if ANY(DWIN_CREALITY_LCD, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
-  #define HAS_DWIN_E3V2 1
-#endif
-
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
 #endif
 
 #if ENABLED(DWIN_LCD_PROUI)
   #define DO_LIST_BIN_FILES 1
   #define LCD_BRIGHTNESS_DEFAULT 127

commit 2bf56b00d4752daabb2afe048b2e07448cc25e78
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Sun Apr 7 10:49:36 2024 -0700

    üîß Improve BIQU BX pins, allow Z swap (#26871)
    
    * Add a swap Z & E1 option for BIQU BX
    
    Users can add #define BX_SWAP_ZM_E1M to their config instead of opening their printer up & swapping Z & E1 motor cables. Allows G34 to work correctly on early BX printers since both Z motor wires were installed without a standard procedure in place and wires could be swapped from the factory.
    
    * Add BOARD URL, DIAG pin info, update pin comments
    
    * Add WIFISUPPORT defines for documentation purposes
    
    WIFISUPPORT does not need to be enabled (read: shouldn't be enabled). Simply enable an available SERIAL_PORT*, set it to 4, and connect an ESP-01/ESP-01S flashed with luc-github's ESP3D firmware for basic WiFi functionality.
    
    * Sanity check TOUCH_SCREEN_CALIBRATION on GT911 TFTs (BIQU BX TFT70)
    
    Use a sanity check so it's clear which options are valid for TFT_TOUCH_DEVICE_GT911 / BIQU_BX_TFT70.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 92799b7cd4..a3756217e6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1845,24 +1845,20 @@
   #endif
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13)
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN)
   #if NONE(TFT_TOUCH_DEVICE_GT911, TFT_TOUCH_DEVICE_XPT2046)
     #define TFT_TOUCH_DEVICE_XPT2046          // ADS7843/XPT2046 ADC Touchscreen such as ILI9341 2.8
   #endif
-  #if ENABLED(TFT_TOUCH_DEVICE_GT911)         // GT911 Capacitive touch screen such as BIQU_BX_TFT70
-    #undef TOUCH_SCREEN_CALIBRATION
-    #undef TOUCH_CALIBRATION_AUTO_SAVE
-  #endif
   #if !HAS_GRAPHICAL_TFT
     #undef TOUCH_SCREEN
     #if ENABLED(TFT_CLASSIC_UI)
       #define HAS_TOUCH_BUTTONS 1
       #if ENABLED(TFT_TOUCH_DEVICE_GT911)
         #define HAS_CAP_TOUCH_BUTTONS 1
       #else
         #define HAS_RES_TOUCH_BUTTONS 1
       #endif
     #endif

commit 87e94f456348e944ba4487aed436c762dd718966
Author: Andrew <18502096+classicrocker883@users.noreply.github.com>
Date:   Mon Apr 1 16:05:11 2024 -0400

    üö∏ Update ProUI Plot graph - part 2 (#26563)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index af2ea772c3..92799b7cd4 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1028,43 +1028,41 @@
 
 // Aliases for LCD features
 #if !DGUS_UI_IS(NONE) || ENABLED(ANYCUBIC_LCD_VYPER)
   #define HAS_DGUS_LCD 1
   #if DGUS_UI_IS(ORIGIN, FYSETC, HIPRECY, MKS)
     #define HAS_DGUS_LCD_CLASSIC 1
   #endif
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
-#if ANY(HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT, TOUCH_UI_FTDI_EVE)
+#if ANY(HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT, TOUCH_UI_FTDI_EVE, DWIN_LCD_PROUI)
   #define IS_EXTUI 1 // Just for sanity check.
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
-#if ANY(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
-  #define HAS_DWIN_E3V2_BASIC 1
-#endif
-#if ANY(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
+#if ANY(DWIN_CREALITY_LCD, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
 #endif
 
 #if ENABLED(DWIN_LCD_PROUI)
   #define DO_LIST_BIN_FILES 1
   #define LCD_BRIGHTNESS_DEFAULT 127
+  #define STATUS_DO_CLEAR_EMPTY
 #endif
 
 // Serial Controllers require LCD_SERIAL_PORT
 #if ANY(IS_DWIN_MARLINUI, HAS_DWIN_E3V2, HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define LCD_IS_SERIAL_HOST 1
 #endif
 
 #if HAS_WIRED_LCD
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
@@ -1085,20 +1083,21 @@
    *  - abort_print
    *  - pause_print
    *  - resume_print
    *  - poweroff        (for PSU_CONTROL and HAS_MARLINUI_MENU)
    *
    *  ...and implements these MarlinUI methods:
    *  - zoffset_overlay (if BABYSTEP_GFX_OVERLAY or MESH_EDIT_GFX_OVERLAY are supported)
    *  - draw_kill_screen
    *  - kill_screen
    *  - draw_status_message
+   *    (calling advance_status_scroll, status_and_len for a scrolling status message)
    */
   #define HAS_DISPLAY 1
 #endif
 
 #if ANY(HAS_DISPLAY, DWIN_CREALITY_LCD)
   #define HAS_UI_UPDATE 1
 #endif
 
 #if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
   #define HAS_LCDPRINT 1

commit 1dee4d92c61b14458cd394d1f609f0dc80282092
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Feb 4 12:09:08 2024 -0600

    üîß TOUCH_IDLE_SLEEP_MINS => DISPLAY_SLEEP_MINUTES
    
    Follow up to #26517

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index bff742a5bc..af2ea772c3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1843,23 +1843,20 @@
     #define LCD_HEIGHT TERN(TOUCH_SCREEN, 9, 10)
   #else
     #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
   #endif
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13)
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN)
-  #if TOUCH_IDLE_SLEEP_MINS
-    #define HAS_TOUCH_SLEEP 1
-  #endif
   #if NONE(TFT_TOUCH_DEVICE_GT911, TFT_TOUCH_DEVICE_XPT2046)
     #define TFT_TOUCH_DEVICE_XPT2046          // ADS7843/XPT2046 ADC Touchscreen such as ILI9341 2.8
   #endif
   #if ENABLED(TFT_TOUCH_DEVICE_GT911)         // GT911 Capacitive touch screen such as BIQU_BX_TFT70
     #undef TOUCH_SCREEN_CALIBRATION
     #undef TOUCH_CALIBRATION_AUTO_SAVE
   #endif
   #if !HAS_GRAPHICAL_TFT
     #undef TOUCH_SCREEN
     #if ENABLED(TFT_CLASSIC_UI)

commit 5fea79fd07e5d874fbd217d8d9e8afceec60ef9e
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Jan 23 16:02:33 2024 -0600

    üîß Fix ROTATIONAL_AXIS_GANG
    
    Co-Authored-By: DerAndere <26200979+DerAndere1@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 64056d40f9..bff742a5bc 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -500,20 +500,24 @@
 #elif ENABLED(AXIS6_ROTATES)
   #define ROTATIONAL_AXES 3
 #elif ENABLED(AXIS5_ROTATES)
   #define ROTATIONAL_AXES 2
 #elif ENABLED(AXIS4_ROTATES)
   #define ROTATIONAL_AXES 1
 #else
   #define ROTATIONAL_AXES 0
 #endif
 
+#if ROTATIONAL_AXES
+  #define HAS_ROTATIONAL_AXES 1
+#endif
+
 /**
  * Number of Secondary Linear Axes (e.g., UVW)
  * All secondary axes for which AXIS*_ROTATES is not defined.
  * Excluding primary axes and excluding duplicate axes (X2, Y2, Z2, Z3, Z4)
  */
 #define SECONDARY_LINEAR_AXES (NUM_AXES - PRIMARY_LINEAR_AXES - ROTATIONAL_AXES)
 
 /**
  * Number of Logical Axes (e.g., XYZIJKUVWE)
  * All logical axes that can be commanded directly by G-code.

commit aa7d5714867df05348ca63ad113ea9cf7ccc3271
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Mon Jan 22 17:32:01 2024 -0600

    ‚ôªÔ∏è LCD pins migration precursor (#26719)
    
    Preliminary changes for #25650

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2c74200455..64056d40f9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -568,21 +568,21 @@
 
 /**
  * Conditionals for the configured LCD / Controller
  */
 
 // MKS_LCD12864A/B is a variant of MKS_MINI_12864
 #if ANY(MKS_LCD12864A, MKS_LCD12864B)
   #define MKS_MINI_12864
 #endif
 
-// MKS_MINI_12864_V3 , BTT_MINI_12864 and BEEZ_MINI_12864 have identical pinouts to FYSETC_MINI_12864_2_1
+// MKS_MINI_12864_V3 , BTT_MINI_12864 and BEEZ_MINI_12864 are nearly identical to FYSETC_MINI_12864_2_1
 #if ANY(MKS_MINI_12864_V3, BTT_MINI_12864, BEEZ_MINI_12864)
   #define FYSETC_MINI_12864_2_1
 #endif
 
 // Old settings are now conditional on DGUS_LCD_UI
 #if DGUS_UI_IS(ORIGIN)
   #define DGUS_LCD_UI_ORIGIN 1
 #elif DGUS_UI_IS(FYSETC)
   #define DGUS_LCD_UI_FYSETC 1
 #elif DGUS_UI_IS(HIPRECY)

commit 204de723f1c08f83e281f0629b60822b334097ed
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Sun Jan 21 04:01:25 2024 -0800

    ‚ú® BIQU MicroProbe (#26527)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 8d468212ac..2c74200455 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1162,21 +1162,21 @@
 #if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
   #define HAS_SERVO_ANGLES 1
 #endif
 #if !HAS_SERVO_ANGLES
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
  * Set flags for any form of bed probe
  */
-#if ANY(TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, HAS_Z_SERVO_PROBE, SOLENOID_PROBE, Z_PROBE_SLED, RACK_AND_PINION_PROBE, SENSORLESS_PROBING, MAGLEV4, MAG_MOUNTED_PROBE)
+#if ANY(TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, HAS_Z_SERVO_PROBE, SOLENOID_PROBE, Z_PROBE_SLED, RACK_AND_PINION_PROBE, SENSORLESS_PROBING, MAGLEV4, MAG_MOUNTED_PROBE, BIQU_MICROPROBE_V1, BIQU_MICROPROBE_V2)
   #define HAS_STOWABLE_PROBE 1
 #endif
 #if ANY(HAS_STOWABLE_PROBE, FIX_MOUNTED_PROBE, BD_SENSOR, NOZZLE_AS_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
 // Probing tool change
 #if !HAS_MULTI_EXTRUDER
   #undef PROBING_TOOL
 #endif

commit 7d751a20b1fc6ef920cbc56a68450302ac1eb973
Author: German Borisov <Borisov.German@gmail.com>
Date:   Fri Jan 19 22:17:36 2024 +0300

    ‚ú® Status Screen flow adjustment (#26627)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 729f450147..8d468212ac 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -965,20 +965,21 @@
 
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #endif
 
 #if ANY(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008) && DISABLED(NO_LCD_DETECT)
   #define DETECT_I2C_LCD_DEVICE 1
 #endif
 
+// Encoder behavior
 #ifndef STD_ENCODER_PULSES_PER_STEP
   #if ENABLED(TOUCH_SCREEN)
     #define STD_ENCODER_PULSES_PER_STEP 2
   #else
     #define STD_ENCODER_PULSES_PER_STEP 5
   #endif
 #endif
 #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 #endif

commit b2fd631d82b9b3e64226ceac6a132ec917aaee21
Author: Robherc <68039049+robherc@users.noreply.github.com>
Date:   Fri Jan 12 23:03:34 2024 -0500

    üîß Fix SD connection defaults (#26666)
    
    Co-authored-by: thisiskeithb <13375512+thisiskeithb@users.noreply.github.com>
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 58842209af..729f450147 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -777,20 +777,21 @@
   #define LCD_CONTRAST_MIN            127
   #define LCD_CONTRAST_MAX            255
   #define LCD_CONTRAST_DEFAULT        250
   #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define IS_RRD_FG_SC 1
+  #define NO_LCD_SDCARD
   #define LCD_ST7920_DELAY_1           125
   #define LCD_ST7920_DELAY_2           125
   #define LCD_ST7920_DELAY_3           125
 
 #elif ANY(ANET_FULL_GRAPHICS_LCD, CTC_A10S_A13)
 
   #define IS_RRD_FG_SC 1
   #define LCD_ST7920_DELAY_1           150
   #define LCD_ST7920_DELAY_2           150
   #define LCD_ST7920_DELAY_3           150
@@ -1677,20 +1678,21 @@
  *  - TFT_HEIGHT
  *  - TFT_INTERFACE_(SPI|FSMC)
  *  - TFT_COLOR
  *  - GRAPHICAL_TFT_UPSCALE
  */
 #if ANY(MKS_TS35_V2_0, BTT_TFT35_SPI_V1_0)                                    // ST7796
   #define TFT_DEFAULT_DRIVER ST7796
   #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_480x320
   #define TFT_INTERFACE_SPI
+  #define NO_LCD_SDCARD
 #elif ANY(LERDGE_TFT35, ANET_ET5_TFT35)                                       // ST7796
   #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ANY(ANET_ET4_TFT28, MKS_ROBIN_TFT24, MKS_ROBIN_TFT28, MKS_ROBIN_TFT32)  // ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
 #elif ANY(MKS_ROBIN_TFT35, TFT_TRONXY_X5SA, ANYCUBIC_TFT35)                   // ILI9488
   #define TFT_DRIVER ILI9488

commit 12d7995a18d3ce59c871e11c4940bbaeb9c352fc
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Jan 9 18:45:17 2024 -0600

    üé® Minor temp / UI refactor

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 752e3aef6b..58842209af 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1083,20 +1083,24 @@
    *
    *  ...and implements these MarlinUI methods:
    *  - zoffset_overlay (if BABYSTEP_GFX_OVERLAY or MESH_EDIT_GFX_OVERLAY are supported)
    *  - draw_kill_screen
    *  - kill_screen
    *  - draw_status_message
    */
   #define HAS_DISPLAY 1
 #endif
 
+#if ANY(HAS_DISPLAY, DWIN_CREALITY_LCD)
+  #define HAS_UI_UPDATE 1
+#endif
+
 #if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
   #define HAS_LCDPRINT 1
 #endif
 
 #if HAS_DISPLAY || HAS_LCDPRINT
   #define HAS_UTF8_UTILS 1
 #endif
 
 #if ANY(HAS_DISPLAY, HAS_DWIN_E3V2)
   #define HAS_STATUS_MESSAGE 1

commit a533e9e637cb3c7e1c86513bdce9a7802f921d44
Author: Vovodroid <vovodroid@users.noreply.github.com>
Date:   Tue Jan 9 23:42:08 2024 +0200

    ü©π Fix edit Z jerk step size (#26650)
    
    Followup to #25514
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e07d026cb9..752e3aef6b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -256,24 +256,27 @@
   #define NUM_AXES 3
 #elif defined(Y_DRIVER_TYPE)
   #define NUM_AXES 2
 #elif defined(X_DRIVER_TYPE)
   #define NUM_AXES 1
 #else
   #define NUM_AXES 0
 #endif
 #if NUM_AXES >= 1
   #define HAS_X_AXIS 1
+  #define HAS_A_AXIS 1
   #if NUM_AXES >= XY
     #define HAS_Y_AXIS 1
+    #define HAS_B_AXIS 1
     #if NUM_AXES >= XYZ
       #define HAS_Z_AXIS 1
+      #define HAS_C_AXIS 1
       #if NUM_AXES >= 4
         #define HAS_I_AXIS 1
         #if NUM_AXES >= 5
           #define HAS_J_AXIS 1
           #if NUM_AXES >= 6
             #define HAS_K_AXIS 1
             #if NUM_AXES >= 7
               #define HAS_U_AXIS 1
               #if NUM_AXES >= 8
                 #define HAS_V_AXIS 1

commit 52693f72afca243ace00a7a57365301f5f8c42c0
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Jan 4 13:01:45 2024 -0600

    üé® Clean up some checks & includes

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a81c8639cf..e07d026cb9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -75,47 +75,50 @@
 #if ANY(SWITCHING_EXTRUDER, MECHANICAL_SWITCHING_EXTRUDER)
   #define HAS_SWITCHING_EXTRUDER 1
 #endif
 #if ANY(SWITCHING_NOZZLE, MECHANICAL_SWITCHING_NOZZLE)
   #define HAS_SWITCHING_NOZZLE 1
 #endif
 
 /**
  *  Multi-Material-Unit supported models
  */
-#define PRUSA_MMU1             1
-#define PRUSA_MMU2             2
-#define PRUSA_MMU2S            3
-#define EXTENDABLE_EMU_MMU2   12
-#define EXTENDABLE_EMU_MMU2S  13
-
 #ifdef MMU_MODEL
   #define HAS_MMU 1
   #define SINGLENOZZLE
-  #if MMU_MODEL == PRUSA_MMU1
+
+  #define _PRUSA_MMU1             1
+  #define _PRUSA_MMU2             2
+  #define _PRUSA_MMU2S            3
+  #define _EXTENDABLE_EMU_MMU2   12
+  #define _EXTENDABLE_EMU_MMU2S  13
+  #define _MMU CAT(_,MMU_MODEL)
+
+  #if _MMU == _PRUSA_MMU1
     #define HAS_PRUSA_MMU1 1
-  #elif MMU_MODEL % 10 == PRUSA_MMU2
+  #elif _MMU % 10 == _PRUSA_MMU2
     #define HAS_PRUSA_MMU2 1
-  #elif MMU_MODEL % 10 == PRUSA_MMU2S
+  #elif _MMU % 10 == _PRUSA_MMU2S
     #define HAS_PRUSA_MMU2 1
     #define HAS_PRUSA_MMU2S 1
   #endif
-  #if MMU_MODEL >= EXTENDABLE_EMU_MMU2
+  #if _MMU == _EXTENDABLE_EMU_MMU2 || _MMU == _EXTENDABLE_EMU_MMU2S
     #define HAS_EXTENDABLE_MMU 1
   #endif
-#endif
 
-#undef PRUSA_MMU1
-#undef PRUSA_MMU2
-#undef PRUSA_MMU2S
-#undef EXTENDABLE_EMU_MMU2
-#undef EXTENDABLE_EMU_MMU2S
+  #undef _MMU
+  #undef _PRUSA_MMU1
+  #undef _PRUSA_MMU2
+  #undef _PRUSA_MMU2S
+  #undef _EXTENDABLE_EMU_MMU2
+  #undef _EXTENDABLE_EMU_MMU2S
+#endif
 
 #if ENABLED(E_DUAL_STEPPER_DRIVERS) // E0/E1 steppers act in tandem as E0
 
   #define E_STEPPERS      2
   #define E_MANUAL        1
 
 #elif HAS_SWITCHING_EXTRUDER        // One stepper for every two EXTRUDERS
 
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
@@ -125,20 +128,23 @@
     #define E_STEPPERS    1
   #endif
 
 #elif ENABLED(MIXING_EXTRUDER)      // Multiple feeds are mixed proportionally
 
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
   #if MIXING_STEPPERS == 2
     #define HAS_DUAL_MIXING 1
   #endif
+  #ifndef MIXING_VIRTUAL_TOOLS
+    #define MIXING_VIRTUAL_TOOLS 1
+  #endif
 
 #elif ENABLED(SWITCHING_TOOLHEAD)   // Toolchanger
 
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 
 #elif HAS_PRUSA_MMU2                // Pr≈Ø≈°a Multi-Material Unit v2
 
   #define E_STEPPERS      1
   #define E_MANUAL        1

commit 4a9e102c2ef96b75378195ad3b89cb1646ac4df4
Author: I3DBeeTech <129617321+I3DBeeTech@users.noreply.github.com>
Date:   Wed Jan 3 06:23:41 2024 +0530

    üì∫ I3DBEE TECH Beez Mini 12864 (#26596)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b501a556f8..a81c8639cf 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -559,22 +559,22 @@
 
 /**
  * Conditionals for the configured LCD / Controller
  */
 
 // MKS_LCD12864A/B is a variant of MKS_MINI_12864
 #if ANY(MKS_LCD12864A, MKS_LCD12864B)
   #define MKS_MINI_12864
 #endif
 
-// MKS_MINI_12864_V3 and BTT_MINI_12864 have identical pinouts to FYSETC_MINI_12864_2_1
-#if ANY(MKS_MINI_12864_V3, BTT_MINI_12864)
+// MKS_MINI_12864_V3 , BTT_MINI_12864 and BEEZ_MINI_12864 have identical pinouts to FYSETC_MINI_12864_2_1
+#if ANY(MKS_MINI_12864_V3, BTT_MINI_12864, BEEZ_MINI_12864)
   #define FYSETC_MINI_12864_2_1
 #endif
 
 // Old settings are now conditional on DGUS_LCD_UI
 #if DGUS_UI_IS(ORIGIN)
   #define DGUS_LCD_UI_ORIGIN 1
 #elif DGUS_UI_IS(FYSETC)
   #define DGUS_LCD_UI_FYSETC 1
 #elif DGUS_UI_IS(HIPRECY)
   #define DGUS_LCD_UI_HIPRECY 1

commit 5d1ede08aa8a045463d4d33333fd90abead2871e
Author: ellensp <530024+ellensp@users.noreply.github.com>
Date:   Sun Dec 31 22:54:26 2023 +1300

    ‚ú® CTC_A10S_A13 (#26514)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 37d56d4f1e..b501a556f8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -772,21 +772,21 @@
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define IS_RRD_FG_SC 1
   #define LCD_ST7920_DELAY_1           125
   #define LCD_ST7920_DELAY_2           125
   #define LCD_ST7920_DELAY_3           125
 
-#elif ANY(ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING)
+#elif ANY(ANET_FULL_GRAPHICS_LCD, CTC_A10S_A13)
 
   #define IS_RRD_FG_SC 1
   #define LCD_ST7920_DELAY_1           150
   #define LCD_ST7920_DELAY_2           150
   #define LCD_ST7920_DELAY_3           150
 
 #elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, BQ_LCD_SMART_CONTROLLER, K3D_FULL_GRAPHIC_SMART_CONTROLLER)
 
   #define IS_RRD_FG_SC 1
 

commit 75da3555ee0910f3d572f4b8176afecdc941524b
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Dec 14 10:03:11 2023 -0600

    üîß Update CLASSIC_JERK conditionals

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 955b8fd960..37d56d4f1e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1608,34 +1608,20 @@
   #define IS_CARTESIAN 1
   #if !IS_CORE
     #define IS_FULL_CARTESIAN 1
   #endif
 #endif
 
 #if DISABLED(DELTA)
   #undef DELTA_HOME_TO_SAFE_ZONE
 #endif
 
-// This flag indicates some kind of jerk storage is needed
-#if ANY(CLASSIC_JERK, IS_KINEMATIC)
-  #define HAS_CLASSIC_JERK 1
-#endif
-
-#if DISABLED(CLASSIC_JERK)
-  #define HAS_JUNCTION_DEVIATION 1
-#endif
-
-// E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
-#if HAS_EXTRUDERS && (ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE)))
-  #define HAS_CLASSIC_E_JERK 1
-#endif
-
 //
 // Serial Port Info
 //
 #ifdef SERIAL_PORT_2
   #define HAS_MULTI_SERIAL 1
   #ifdef SERIAL_PORT_3
     #define NUM_SERIAL 3
   #else
     #define NUM_SERIAL 2
   #endif

commit bd872a7a98528da6e1fab95382488ce703fe24c1
Author: Vovodroid <vovodroid@users.noreply.github.com>
Date:   Fri Nov 24 21:03:06 2023 +0200

    üîß Configurable FR/Flow edit ranges (#26446)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a252edfb4a..955b8fd960 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -19,1118 +19,1119 @@
  * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
-#if ENABLED(SDSUPPORT)
-  #define HAS_MEDIA 1
+/**
+ * Extruders have some combination of stepper motors and hotends
+ * so we separate these concepts into the defines:
+ *
+ *  EXTRUDERS    - Number of Selectable Tools
+ *  HOTENDS      - Number of hotends, whether connected or separate
+ *  E_STEPPERS   - Number of actual E stepper motors
+ *  E_MANUAL     - Number of E steppers for LCD move options
+ *
+ * These defines must be simple constants for use in REPEAT, etc.
+ */
+#if EXTRUDERS
+  #define HAS_EXTRUDERS 1
+  #if EXTRUDERS > 1
+    #define HAS_MULTI_EXTRUDER 1
+  #endif
+  #define E_AXIS_N(E) AxisEnum(E_AXIS + E_INDEX_N(E))
+#else
+  #undef EXTRUDERS
+  #define EXTRUDERS 0
+  #undef TEMP_SENSOR_0
+  #undef TEMP_SENSOR_1
+  #undef TEMP_SENSOR_2
+  #undef TEMP_SENSOR_3
+  #undef TEMP_SENSOR_4
+  #undef TEMP_SENSOR_5
+  #undef TEMP_SENSOR_6
+  #undef TEMP_SENSOR_7
+  #undef SINGLENOZZLE
+  #undef SWITCHING_EXTRUDER
+  #undef MECHANICAL_SWITCHING_EXTRUDER
+  #undef SWITCHING_NOZZLE
+  #undef MECHANICAL_SWITCHING_NOZZLE
+  #undef MIXING_EXTRUDER
+  #undef HOTEND_IDLE_TIMEOUT
+  #undef DISABLE_E
+  #undef PREVENT_LENGTHY_EXTRUDE
+  #undef FILAMENT_RUNOUT_SENSOR
+  #undef FILAMENT_RUNOUT_DISTANCE_MM
+  #undef DISABLE_OTHER_EXTRUDERS
 #endif
 
-// MKS_LCD12864A/B is a variant of MKS_MINI_12864
-#if ANY(MKS_LCD12864A, MKS_LCD12864B)
-  #define MKS_MINI_12864
-#endif
+#define E_OPTARG(N) OPTARG(HAS_MULTI_EXTRUDER, N)
+#define E_TERN_(N)  TERN_(HAS_MULTI_EXTRUDER, N)
+#define E_TERN0(N)  TERN0(HAS_MULTI_EXTRUDER, N)
 
-// MKS_MINI_12864_V3 and BTT_MINI_12864 have identical pinouts to FYSETC_MINI_12864_2_1
-#if ANY(MKS_MINI_12864_V3, BTT_MINI_12864)
-  #define FYSETC_MINI_12864_2_1
+#if ANY(SWITCHING_EXTRUDER, MECHANICAL_SWITCHING_EXTRUDER)
+  #define HAS_SWITCHING_EXTRUDER 1
 #endif
-
-// Old settings are now conditional on DGUS_LCD_UI
-#if DGUS_UI_IS(ORIGIN)
-  #define DGUS_LCD_UI_ORIGIN 1
-#elif DGUS_UI_IS(FYSETC)
-  #define DGUS_LCD_UI_FYSETC 1
-#elif DGUS_UI_IS(HIPRECY)
-  #define DGUS_LCD_UI_HIPRECY 1
-#elif DGUS_UI_IS(MKS)
-  #define DGUS_LCD_UI_MKS 1
-#elif DGUS_UI_IS(RELOADED)
-  #define DGUS_LCD_UI_RELOADED 1
-#elif DGUS_UI_IS(IA_CREALITY)
-  #define DGUS_LCD_UI_IA_CREALITY 1
-#elif DGUS_UI_IS(E3S1PRO)
-  #define DGUS_LCD_UI_E3S1PRO 1
+#if ANY(SWITCHING_NOZZLE, MECHANICAL_SWITCHING_NOZZLE)
+  #define HAS_SWITCHING_NOZZLE 1
 #endif
 
 /**
- * General Flags that may be set below by specific LCDs
- *
- *  DOGLCD                  : Run a Graphical LCD through U8GLib (with MarlinUI)
- *  IS_ULTIPANEL            : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
- *  HAS_WIRED_LCD           : Ultra LCD, not necessarily Ultipanel.
- *  IS_RRD_SC               : Common RRD Smart Controller digital interface pins
- *  IS_RRD_FG_SC            : Common RRD Full Graphical Smart Controller digital interface pins
- *  IS_U8GLIB_ST7920        : Most common DOGM display SPI interface, supporting a "lightweight" display mode.
- *  U8GLIB_SH1106           : SH1106 OLED with I2C interface via U8GLib
- *  IS_U8GLIB_SSD1306       : SSD1306 OLED with I2C interface via U8GLib (U8GLIB_SSD1306)
- *  U8GLIB_SSD1309          : SSD1309 OLED with I2C interface via U8GLib (HAS_U8GLIB_I2C_OLED, HAS_WIRED_LCD, DOGLCD)
- *  IS_U8GLIB_ST7565_64128N : ST7565 128x64 LCD with SPI interface via U8GLib
- *  IS_U8GLIB_LM6059_AF     : LM6059 with Hardware SPI via U8GLib
+ *  Multi-Material-Unit supported models
  */
-#if ANY(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
-
-  #define MINIPANEL
-
-#elif ENABLED(YHCB2004)
-
-  #define IS_ULTIPANEL 1
-
-#elif ENABLED(CARTESIO_UI)
-
-  #define DOGLCD
-  #define IS_ULTIPANEL 1
-
-#elif ANY(DWIN_MARLINUI_PORTRAIT, DWIN_MARLINUI_LANDSCAPE)
-
-  #define IS_DWIN_MARLINUI 1
-  #define IS_ULTIPANEL 1
-
-#elif ENABLED(ZONESTAR_LCD)
-
-  #define HAS_ADC_BUTTONS 1
-  #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
-  #define ADC_KEY_NUM 8
-  #define IS_ULTIPANEL 1
-
-  // This helps to implement HAS_ADC_BUTTONS menus
-  #define REVERSE_MENU_DIRECTION
-  #define STD_ENCODER_PULSES_PER_STEP 1
-  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
-  #define ENCODER_FEEDRATE_DEADZONE 2
-
-#elif ENABLED(ZONESTAR_12864LCD)
-  #define DOGLCD
-  #define IS_RRD_SC 1
-  #define IS_U8GLIB_ST7920 1
+#define PRUSA_MMU1             1
+#define PRUSA_MMU2             2
+#define PRUSA_MMU2S            3
+#define EXTENDABLE_EMU_MMU2   12
+#define EXTENDABLE_EMU_MMU2S  13
 
-#elif ENABLED(ZONESTAR_12864OLED)
-  #define IS_RRD_SC 1
-  #define U8GLIB_SH1106
+#ifdef MMU_MODEL
+  #define HAS_MMU 1
+  #define SINGLENOZZLE
+  #if MMU_MODEL == PRUSA_MMU1
+    #define HAS_PRUSA_MMU1 1
+  #elif MMU_MODEL % 10 == PRUSA_MMU2
+    #define HAS_PRUSA_MMU2 1
+  #elif MMU_MODEL % 10 == PRUSA_MMU2S
+    #define HAS_PRUSA_MMU2 1
+    #define HAS_PRUSA_MMU2S 1
+  #endif
+  #if MMU_MODEL >= EXTENDABLE_EMU_MMU2
+    #define HAS_EXTENDABLE_MMU 1
+  #endif
+#endif
 
-#elif ENABLED(ZONESTAR_12864OLED_SSD1306)
-  #define IS_RRD_SC 1
-  #define IS_U8GLIB_SSD1306
+#undef PRUSA_MMU1
+#undef PRUSA_MMU2
+#undef PRUSA_MMU2S
+#undef EXTENDABLE_EMU_MMU2
+#undef EXTENDABLE_EMU_MMU2S
 
-#elif ENABLED(RADDS_DISPLAY)
-  #define IS_ULTIPANEL 1
-  #define STD_ENCODER_PULSES_PER_STEP 2
+#if ENABLED(E_DUAL_STEPPER_DRIVERS) // E0/E1 steppers act in tandem as E0
 
-#elif ANY(miniVIKI, VIKI2, WYH_L12864, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, EMOTION_TECH_LCD)
+  #define E_STEPPERS      2
+  #define E_MANUAL        1
 
-  #define DOGLCD
-  #define IS_DOGM_12864 1
-  #define IS_ULTIPANEL 1
+#elif HAS_SWITCHING_EXTRUDER        // One stepper for every two EXTRUDERS
 
-  #if ENABLED(miniVIKI)
-    #define IS_U8GLIB_ST7565_64128N 1
-  #elif ENABLED(VIKI2)
-    #define IS_U8GLIB_ST7565_64128N 1
-  #elif ENABLED(WYH_L12864)
-    #define IS_U8GLIB_ST7565_64128N 1
-    #define ST7565_XOFFSET 0x04
-  #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
-    #define IS_U8GLIB_LM6059_AF 1
-  #elif ENABLED(AZSMZ_12864)
-    #define IS_U8GLIB_ST7565_64128N 1
-  #elif ENABLED(EMOTION_TECH_LCD)
-    #define IS_U8GLIB_ST7565_64128N 1
-    #define ST7565_VOLTAGE_DIVIDER_VALUE 0x07
+  #if EXTRUDERS > 4
+    #define E_STEPPERS    3
+  #elif EXTRUDERS > 2
+    #define E_STEPPERS    2
+  #else
+    #define E_STEPPERS    1
   #endif
 
-#elif ENABLED(OLED_PANEL_TINYBOY2)
-
-  #define IS_U8GLIB_SSD1306
-  #define IS_ULTIPANEL 1
-
-#elif ENABLED(RA_CONTROL_PANEL)
+#elif ENABLED(MIXING_EXTRUDER)      // Multiple feeds are mixed proportionally
 
-  #define LCD_I2C_TYPE_PCA8574
-  #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
-  #define IS_ULTIPANEL 1
+  #define E_STEPPERS      MIXING_STEPPERS
+  #define E_MANUAL        1
+  #if MIXING_STEPPERS == 2
+    #define HAS_DUAL_MIXING 1
+  #endif
 
-#elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
+#elif ENABLED(SWITCHING_TOOLHEAD)   // Toolchanger
 
-  #define DOGLCD
-  #define IS_U8GLIB_ST7920 1
-  #define IS_ULTIPANEL 1
-  #define ENCODER_PULSES_PER_STEP 2
+  #define E_STEPPERS      EXTRUDERS
+  #define E_MANUAL        EXTRUDERS
 
-#elif ENABLED(MKS_12864OLED)
+#elif HAS_PRUSA_MMU2                // Pr≈Ø≈°a Multi-Material Unit v2
 
-  #define IS_RRD_SC 1
-  #define U8GLIB_SH1106
+  #define E_STEPPERS      1
+  #define E_MANUAL        1
 
-#elif ENABLED(MKS_12864OLED_SSD1306)
+#endif
 
-  #define IS_RRD_SC 1
-  #define IS_U8GLIB_SSD1306
+// Default E steppers / manual motion is one per extruder
+#ifndef E_STEPPERS
+  #define E_STEPPERS EXTRUDERS
+#endif
+#ifndef E_MANUAL
+  #define E_MANUAL EXTRUDERS
+#endif
 
-#elif ENABLED(SAV_3DGLCD)
+// Number of hotends...
+#if ANY(SINGLENOZZLE, MIXING_EXTRUDER)                // Only one for singlenozzle or mixing extruder
+  #define HOTENDS 1
+#elif HAS_SWITCHING_EXTRUDER && !HAS_SWITCHING_NOZZLE // One for each pair of abstract "extruders"
+  #define HOTENDS E_STEPPERS
+#elif TEMP_SENSOR_0
+  #define HOTENDS EXTRUDERS                           // One per extruder if at least one heater exists
+#else
+  #define HOTENDS 0                                   // A machine with no hotends at all can still extrude
+#endif
 
-  #ifdef U8GLIB_SSD1306
-    #define IS_U8GLIB_SSD1306 // Allow for U8GLIB_SSD1306 + SAV_3DGLCD
+// At least one hotend...
+#if HOTENDS
+  #define HAS_HOTEND 1
+  #ifndef HOTEND_OVERSHOOT
+    #define HOTEND_OVERSHOOT 15
   #endif
-  #define IS_NEWPANEL 1
-
-#elif ENABLED(FYSETC_242_OLED_12864)
-
-  #define IS_RRD_SC 1
-  #define U8GLIB_SH1106
+#endif
 
-  #ifndef NEOPIXEL_BRIGHTNESS
-    #define NEOPIXEL_BRIGHTNESS 127
+// More than one hotend...
+#if HOTENDS > 1
+  #define HAS_MULTI_HOTEND 1
+  #define HAS_HOTEND_OFFSET 1
+  #ifndef HOTEND_OFFSET_X
+    #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
   #endif
+  #ifndef HOTEND_OFFSET_Y
+    #define HOTEND_OFFSET_Y { 0 } // Y offsets for each extruder
+  #endif
+  #ifndef HOTEND_OFFSET_Z
+    #define HOTEND_OFFSET_Z { 0 } // Z offsets for each extruder
+  #endif
+#else
+  #undef HOTEND_OFFSET_X
+  #undef HOTEND_OFFSET_Y
+  #undef HOTEND_OFFSET_Z
+#endif
 
-#elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1, FYSETC_GENERIC_12864_1_1)
-
-  #define FYSETC_MINI_12864
-  #define DOGLCD
-  #define IS_ULTIPANEL 1
-  #define LED_COLORS_REDUCE_GREEN
-
-  // Require LED backlighting enabled
-  #if ENABLED(FYSETC_MINI_12864_2_1)
-    #ifndef NEOPIXEL_BRIGHTNESS
-      #define NEOPIXEL_BRIGHTNESS 127
+// Clean up E-stepper-based settings...
+#if E_STEPPERS <= 7
+  #undef INVERT_E7_DIR
+  #undef E7_DRIVER_TYPE
+  #if E_STEPPERS <= 6
+    #undef INVERT_E6_DIR
+    #undef E6_DRIVER_TYPE
+    #if E_STEPPERS <= 5
+      #undef INVERT_E5_DIR
+      #undef E5_DRIVER_TYPE
+      #if E_STEPPERS <= 4
+        #undef INVERT_E4_DIR
+        #undef E4_DRIVER_TYPE
+        #if E_STEPPERS <= 3
+          #undef INVERT_E3_DIR
+          #undef E3_DRIVER_TYPE
+          #if E_STEPPERS <= 2
+            #undef INVERT_E2_DIR
+            #undef E2_DRIVER_TYPE
+            #if E_STEPPERS <= 1
+              #undef INVERT_E1_DIR
+              #undef E1_DRIVER_TYPE
+              #if E_STEPPERS == 0
+                #undef INVERT_E0_DIR
+                #undef E0_DRIVER_TYPE
+              #endif
+            #endif
+          #endif
+        #endif
+      #endif
     #endif
-    //#define NEOPIXEL_STARTUP_TEST
   #endif
+#endif
 
-#elif ENABLED(ULTI_CONTROLLER)
+/**
+ * Number of Linear Axes (e.g., XYZIJKUVW)
+ * All the logical axes except for the tool (E) axis
+ */
+#ifdef NUM_AXES
+  #undef NUM_AXES
+  #define NUM_AXES_WARNING 1
+#endif
 
-  #define IS_ULTIPANEL 1
-  #define U8GLIB_SSD1309
-  #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
-  #define STD_ENCODER_PULSES_PER_STEP 4
-  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
-  #ifndef PCA9632
-    #define PCA9632
+#ifdef W_DRIVER_TYPE
+  #define NUM_AXES 9
+#elif defined(V_DRIVER_TYPE)
+  #define NUM_AXES 8
+#elif defined(U_DRIVER_TYPE)
+  #define NUM_AXES 7
+#elif defined(K_DRIVER_TYPE)
+  #define NUM_AXES 6
+#elif defined(J_DRIVER_TYPE)
+  #define NUM_AXES 5
+#elif defined(I_DRIVER_TYPE)
+  #define NUM_AXES 4
+#elif defined(Z_DRIVER_TYPE)
+  #define NUM_AXES 3
+#elif defined(Y_DRIVER_TYPE)
+  #define NUM_AXES 2
+#elif defined(X_DRIVER_TYPE)
+  #define NUM_AXES 1
+#else
+  #define NUM_AXES 0
+#endif
+#if NUM_AXES >= 1
+  #define HAS_X_AXIS 1
+  #if NUM_AXES >= XY
+    #define HAS_Y_AXIS 1
+    #if NUM_AXES >= XYZ
+      #define HAS_Z_AXIS 1
+      #if NUM_AXES >= 4
+        #define HAS_I_AXIS 1
+        #if NUM_AXES >= 5
+          #define HAS_J_AXIS 1
+          #if NUM_AXES >= 6
+            #define HAS_K_AXIS 1
+            #if NUM_AXES >= 7
+              #define HAS_U_AXIS 1
+              #if NUM_AXES >= 8
+                #define HAS_V_AXIS 1
+                #if NUM_AXES >= 9
+                  #define HAS_W_AXIS 1
+                #endif
+              #endif
+            #endif
+          #endif
+        #endif
+      #endif
+    #endif
   #endif
+#endif
 
-#elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
-
-  #define IS_RRD_SC 1
-  #define LCD_WIDTH 16
-  #define LCD_HEIGHT 2
-
-#elif ANY(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
+#if !HAS_X_AXIS
+  #undef AVOID_OBSTACLES
+  #undef ENDSTOPPULLUP_XMIN
+  #undef ENDSTOPPULLUP_XMAX
+  #undef X_MIN_ENDSTOP_HIT_STATE
+  #undef X_MAX_ENDSTOP_HIT_STATE
+  #undef X2_DRIVER_TYPE
+  #undef X_ENABLE_ON
+  #undef DISABLE_X
+  #undef INVERT_X_DIR
+  #undef X_HOME_DIR
+  #undef X_MIN_POS
+  #undef X_MAX_POS
+  #undef MANUAL_X_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOPS
+  #undef MAX_SOFTWARE_ENDSTOPS
+#endif
 
-  #define IS_TFTGLCD_PANEL 1
-  #define IS_ULTIPANEL 1                    // Note that IS_ULTIPANEL leads to HAS_WIRED_LCD
+#if !HAS_Y_AXIS
+  #undef AVOID_OBSTACLES
+  #undef ENDSTOPPULLUP_YMIN
+  #undef ENDSTOPPULLUP_YMAX
+  #undef Y_MIN_ENDSTOP_HIT_STATE
+  #undef Y_MAX_ENDSTOP_HIT_STATE
+  #undef Y2_DRIVER_TYPE
+  #undef Y_ENABLE_ON
+  #undef DISABLE_Y
+  #undef INVERT_Y_DIR
+  #undef Y_HOME_DIR
+  #undef Y_MIN_POS
+  #undef Y_MAX_POS
+  #undef MANUAL_Y_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_Y
+  #undef MAX_SOFTWARE_ENDSTOP_Y
+#endif
 
-  #if HAS_MEDIA && DISABLED(LCD_PROGRESS_BAR)
-    #define LCD_PROGRESS_BAR
-  #endif
-  #if ENABLED(TFTGLCD_PANEL_I2C)
-    #define LCD_I2C_ADDRESS           0x33  // Must be 0x33 for STM32 main boards and equal to panel's I2C slave address
+#if HAS_Z_AXIS
+  #ifdef Z4_DRIVER_TYPE
+    #define NUM_Z_STEPPERS 4
+  #elif defined(Z3_DRIVER_TYPE)
+    #define NUM_Z_STEPPERS 3
+  #elif defined(Z2_DRIVER_TYPE)
+    #define NUM_Z_STEPPERS 2
+  #else
+    #define NUM_Z_STEPPERS 1
   #endif
-  #define LCD_USE_I2C_BUZZER                // Enable buzzer on LCD, used for both I2C and SPI buses (LiquidTWI2 not required)
-  #define STD_ENCODER_PULSES_PER_STEP 2
-  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
-  #define LCD_WIDTH                   20    // 20 or 24 chars in line
-  #define LCD_HEIGHT                  10    // Character lines
-  #define LCD_CONTRAST_MIN            127
-  #define LCD_CONTRAST_MAX            255
-  #define LCD_CONTRAST_DEFAULT        250
-  #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.
-                                      // At this time present conversion only for cyrillic - bg, ru and uk languages.
-                                      // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
-
-#elif ENABLED(CR10_STOCKDISPLAY)
-
-  #define IS_RRD_FG_SC 1
-  #define LCD_ST7920_DELAY_1           125
-  #define LCD_ST7920_DELAY_2           125
-  #define LCD_ST7920_DELAY_3           125
-
-#elif ANY(ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING)
-
-  #define IS_RRD_FG_SC 1
-  #define LCD_ST7920_DELAY_1           150
-  #define LCD_ST7920_DELAY_2           150
-  #define LCD_ST7920_DELAY_3           150
-
-#elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, BQ_LCD_SMART_CONTROLLER, K3D_FULL_GRAPHIC_SMART_CONTROLLER)
-
-  #define IS_RRD_FG_SC 1
-
-#elif ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
-
-  #define IS_RRD_SC 1   // RepRapDiscount LCD or Graphical LCD with rotary click encoder
+#else
+  #undef ENDSTOPPULLUP_ZMIN
+  #undef ENDSTOPPULLUP_ZMAX
+  #undef Z_MIN_ENDSTOP_HIT_STATE
+  #undef Z_MAX_ENDSTOP_HIT_STATE
+  #undef Z2_DRIVER_TYPE
+  #undef Z3_DRIVER_TYPE
+  #undef Z4_DRIVER_TYPE
+  #undef Z_ENABLE_ON
+  #undef DISABLE_Z
+  #undef INVERT_Z_DIR
+  #undef Z_HOME_DIR
+  #undef Z_MIN_POS
+  #undef Z_MAX_POS
+  #undef MANUAL_Z_HOME_POS
+  #undef Z_SAFE_HOMING
+  #undef MIN_SOFTWARE_ENDSTOP_Z
+  #undef MAX_SOFTWARE_ENDSTOP_Z
+#endif
 
-#elif ENABLED(K3D_242_OLED_CONTROLLER)
+#if !HAS_I_AXIS
+  #undef ENDSTOPPULLUP_IMIN
+  #undef ENDSTOPPULLUP_IMAX
+  #undef I_MIN_ENDSTOP_HIT_STATE
+  #undef I_MAX_ENDSTOP_HIT_STATE
+  #undef I_ENABLE_ON
+  #undef DISABLE_I
+  #undef INVERT_I_DIR
+  #undef I_HOME_DIR
+  #undef I_MIN_POS
+  #undef I_MAX_POS
+  #undef MANUAL_I_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_I
+  #undef MAX_SOFTWARE_ENDSTOP_I
+#endif
 
-  #define IS_RRD_SC 1
-  #define U8GLIB_SSD1309
+#if !HAS_J_AXIS
+  #undef ENDSTOPPULLUP_JMIN
+  #undef ENDSTOPPULLUP_JMAX
+  #undef J_MIN_ENDSTOP_HIT_STATE
+  #undef J_MAX_ENDSTOP_HIT_STATE
+  #undef J_ENABLE_ON
+  #undef DISABLE_J
+  #undef INVERT_J_DIR
+  #undef J_HOME_DIR
+  #undef J_MIN_POS
+  #undef J_MAX_POS
+  #undef MANUAL_J_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_J
+  #undef MAX_SOFTWARE_ENDSTOP_J
+#endif
 
+#if !HAS_K_AXIS
+  #undef ENDSTOPPULLUP_KMIN
+  #undef ENDSTOPPULLUP_KMAX
+  #undef K_MIN_ENDSTOP_HIT_STATE
+  #undef K_MAX_ENDSTOP_HIT_STATE
+  #undef K_ENABLE_ON
+  #undef DISABLE_K
+  #undef INVERT_K_DIR
+  #undef K_HOME_DIR
+  #undef K_MIN_POS
+  #undef K_MAX_POS
+  #undef MANUAL_K_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_K
+  #undef MAX_SOFTWARE_ENDSTOP_K
 #endif
 
-// ST7920-based graphical displays
-#if ANY(IS_RRD_FG_SC, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
-  #define DOGLCD
-  #define IS_U8GLIB_ST7920 1
-  #define IS_RRD_SC 1
+#if !HAS_U_AXIS
+  #undef ENDSTOPPULLUP_UMIN
+  #undef ENDSTOPPULLUP_UMAX
+  #undef U_MIN_ENDSTOP_HIT_STATE
+  #undef U_MAX_ENDSTOP_HIT_STATE
+  #undef U_ENABLE_ON
+  #undef DISABLE_U
+  #undef INVERT_U_DIR
+  #undef U_HOME_DIR
+  #undef U_MIN_POS
+  #undef U_MAX_POS
+  #undef MANUAL_U_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_U
+  #undef MAX_SOFTWARE_ENDSTOP_U
 #endif
 
-// ST7565 / 64128N graphical displays
-#if ANY(MAKRPANEL, MINIPANEL)
-  #define IS_ULTIPANEL 1
-  #define DOGLCD
-  #if ENABLED(MAKRPANEL)
-    #define IS_U8GLIB_ST7565_64128N 1
-  #endif
+#if !HAS_V_AXIS
+  #undef ENDSTOPPULLUP_VMIN
+  #undef ENDSTOPPULLUP_VMAX
+  #undef V_MIN_ENDSTOP_HIT_STATE
+  #undef V_MAX_ENDSTOP_HIT_STATE
+  #undef V_ENABLE_ON
+  #undef DISABLE_V
+  #undef INVERT_V_DIR
+  #undef V_HOME_DIR
+  #undef V_MIN_POS
+  #undef V_MAX_POS
+  #undef MANUAL_V_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_V
+  #undef MAX_SOFTWARE_ENDSTOP_V
 #endif
 
-#if ENABLED(IS_U8GLIB_SSD1306)
-  #define U8GLIB_SSD1306
+#if !HAS_W_AXIS
+  #undef ENDSTOPPULLUP_WMIN
+  #undef ENDSTOPPULLUP_WMAX
+  #undef W_MIN_ENDSTOP_HIT_STATE
+  #undef W_MAX_ENDSTOP_HIT_STATE
+  #undef W_ENABLE_ON
+  #undef DISABLE_W
+  #undef INVERT_W_DIR
+  #undef W_HOME_DIR
+  #undef W_MIN_POS
+  #undef W_MAX_POS
+  #undef MANUAL_W_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_W
+  #undef MAX_SOFTWARE_ENDSTOP_W
 #endif
 
-#if ENABLED(OVERLORD_OLED)
-  #define IS_ULTIPANEL 1
-  #define U8GLIB_SH1106
-  /**
-   * PCA9632 for buzzer and LEDs via i2c
-   * No auto-inc, red and green leds switched, buzzer
-   */
-  #define PCA9632
-  #define PCA9632_NO_AUTO_INC
-  #define PCA9632_GRN         0x00
-  #define PCA9632_RED         0x02
-  #define PCA9632_BUZZER
-  #define PCA9632_BUZZER_DATA { 0x09, 0x02 }
+#define _OR_HAS_DA(A) ENABLED(DISABLE_##A) ||
+#if MAP(_OR_HAS_DA, X, Y, Z, I, J, K, U, V, W) 0
+  #define HAS_DISABLE_MAIN_AXES 1
+#endif
+#if HAS_DISABLE_MAIN_AXES || ENABLED(DISABLE_E)
+  #define HAS_DISABLE_AXES 1
+#endif
+#undef _OR_HAS_DA
 
-  #define STD_ENCODER_PULSES_PER_STEP     1 // Overlord uses buttons
-  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+#ifdef X2_DRIVER_TYPE
+  #define HAS_X2_STEPPER 1
+#endif
+#ifdef Y2_DRIVER_TYPE
+  #define HAS_Y2_STEPPER 1
 #endif
 
-// 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
-#if ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
-  #define HAS_U8GLIB_I2C_OLED 1
-  #define HAS_WIRED_LCD 1
-  #define DOGLCD
+/**
+ * Number of Primary Linear Axes (e.g., XYZ)
+ * X, XY, or XYZ axes. Excluding duplicate axes (X2, Y2, Z2, Z3, Z4)
+ */
+#if NUM_AXES >= 3
+  #define PRIMARY_LINEAR_AXES 3
+#else
+  #define PRIMARY_LINEAR_AXES NUM_AXES
 #endif
 
 /**
- * SPI Ultipanels
+ * Number of Secondary Axes (e.g., IJKUVW)
+ * All linear/rotational axes between XYZ and E.
  */
+#define SECONDARY_AXES SUB3(NUM_AXES)
 
-// Basic Ultipanel-like displays
-#if ANY(ULTIMAKERCONTROLLER, IS_RRD_SC, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
-  #define IS_ULTIPANEL 1
+/**
+ * Number of Rotational Axes (e.g., IJK)
+ * All axes for which AXIS*_ROTATES is defined.
+ * For these axes, positions are specified in angular degrees.
+ */
+#if ENABLED(AXIS9_ROTATES)
+  #define ROTATIONAL_AXES 6
+#elif ENABLED(AXIS8_ROTATES)
+  #define ROTATIONAL_AXES 5
+#elif ENABLED(AXIS7_ROTATES)
+  #define ROTATIONAL_AXES 4
+#elif ENABLED(AXIS6_ROTATES)
+  #define ROTATIONAL_AXES 3
+#elif ENABLED(AXIS5_ROTATES)
+  #define ROTATIONAL_AXES 2
+#elif ENABLED(AXIS4_ROTATES)
+  #define ROTATIONAL_AXES 1
+#else
+  #define ROTATIONAL_AXES 0
 #endif
 
-// Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
-#if ENABLED(U8GLIB_SH1106_EINSTART)
-  #define DOGLCD
-  #define IS_ULTIPANEL 1
+/**
+ * Number of Secondary Linear Axes (e.g., UVW)
+ * All secondary axes for which AXIS*_ROTATES is not defined.
+ * Excluding primary axes and excluding duplicate axes (X2, Y2, Z2, Z3, Z4)
+ */
+#define SECONDARY_LINEAR_AXES (NUM_AXES - PRIMARY_LINEAR_AXES - ROTATIONAL_AXES)
+
+/**
+ * Number of Logical Axes (e.g., XYZIJKUVWE)
+ * All logical axes that can be commanded directly by G-code.
+ * Delta maps stepper-specific values to ABC steppers.
+ */
+#if HAS_EXTRUDERS
+  #define LOGICAL_AXES INCREMENT(NUM_AXES)
+#else
+  #define LOGICAL_AXES NUM_AXES
 #endif
 
-// TFT Legacy options masquerade as TFT_GENERIC
-#if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
-  #define IS_LEGACY_TFT 1
-  #define TFT_GENERIC
-  #if ANY(FSMC_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_LVGL_UI_FSMC)
-    #define TFT_INTERFACE_FSMC
-  #elif ANY(SPI_GRAPHICAL_TFT, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_SPI)
-    #define TFT_INTERFACE_SPI
-  #endif
-  #if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
-    #define TFT_CLASSIC_UI
-  #elif ANY(TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI)
-    #define TFT_COLOR_UI
-  #elif ANY(TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
-    #define TFT_LVGL_UI
-  #endif
+/**
+ * DISTINCT_E_FACTORS is set to give extruders (some) individual settings.
+ *
+ * DISTINCT_AXES is the number of distinct addressable axes (not steppers).
+ *  Includes all linear axes plus all distinguished extruders.
+ *  The default behavior is to treat all extruders as a single E axis
+ *  with shared motion and temperature settings.
+ *
+ * DISTINCT_E is the number of distinguished extruders. By default this
+ *  will be 1 which indicates all extruders share the same settings.
+ *
+ * E_INDEX_N(E) should be used to get the E index of any item that might be
+ *  distinguished.
+ */
+#if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
+  #define DISTINCT_AXES (NUM_AXES + E_STEPPERS)
+  #define DISTINCT_E E_STEPPERS
+  #define E_INDEX_N(E) (E)
+#else
+  #undef DISTINCT_E_FACTORS
+  #define DISTINCT_AXES LOGICAL_AXES
+  #define DISTINCT_E 1
+  #define E_INDEX_N(E) 0
 #endif
 
-// FSMC/SPI TFT Panels (LVGL)
-#if ENABLED(TFT_LVGL_UI)
-  #define HAS_TFT_LVGL_UI 1
-  #define SERIAL_RUNTIME_HOOK 1
+// Helper macros for extruder and hotend arrays
+#define _EXTRUDER_LOOP(E) for (int8_t E = 0; E < EXTRUDERS; E++)
+#define EXTRUDER_LOOP() _EXTRUDER_LOOP(e)
+#define _HOTEND_LOOP(H) for (int8_t H = 0; H < HOTENDS; H++)
+#define HOTEND_LOOP() _HOTEND_LOOP(e)
+
+#define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
+#define ARRAY_BY_EXTRUDERS1(v1) ARRAY_N_1(EXTRUDERS, v1)
+#define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
+#define ARRAY_BY_HOTENDS1(v1) ARRAY_N_1(HOTENDS, v1)
+
+// Support for SD Card and other file storage
+#if ENABLED(SDSUPPORT)
+  #define HAS_MEDIA 1
 #endif
 
-// FSMC/SPI TFT Panels
-#if ENABLED(TFT_CLASSIC_UI)
-  #define TFT_SCALED_DOGLCD 1
+/**
+ * Conditionals for the configured LCD / Controller
+ */
+
+// MKS_LCD12864A/B is a variant of MKS_MINI_12864
+#if ANY(MKS_LCD12864A, MKS_LCD12864B)
+  #define MKS_MINI_12864
 #endif
 
-#if TFT_SCALED_DOGLCD
-  #define DOGLCD
-  #define IS_ULTIPANEL 1
-  #define DELAYED_BACKLIGHT_INIT
-#elif HAS_TFT_LVGL_UI
-  #define DELAYED_BACKLIGHT_INIT
+// MKS_MINI_12864_V3 and BTT_MINI_12864 have identical pinouts to FYSETC_MINI_12864_2_1
+#if ANY(MKS_MINI_12864_V3, BTT_MINI_12864)
+  #define FYSETC_MINI_12864_2_1
 #endif
 
-// Color UI
-#if ENABLED(TFT_COLOR_UI)
-  #define HAS_GRAPHICAL_TFT 1
-  #define IS_ULTIPANEL 1
+// Old settings are now conditional on DGUS_LCD_UI
+#if DGUS_UI_IS(ORIGIN)
+  #define DGUS_LCD_UI_ORIGIN 1
+#elif DGUS_UI_IS(FYSETC)
+  #define DGUS_LCD_UI_FYSETC 1
+#elif DGUS_UI_IS(HIPRECY)
+  #define DGUS_LCD_UI_HIPRECY 1
+#elif DGUS_UI_IS(MKS)
+  #define DGUS_LCD_UI_MKS 1
+#elif DGUS_UI_IS(RELOADED)
+  #define DGUS_LCD_UI_RELOADED 1
+#elif DGUS_UI_IS(IA_CREALITY)
+  #define DGUS_LCD_UI_IA_CREALITY 1
+#elif DGUS_UI_IS(E3S1PRO)
+  #define DGUS_LCD_UI_E3S1PRO 1
 #endif
 
 /**
- * I2C Panels
+ * General Flags that may be set below by specific LCDs
+ *
+ *  DOGLCD                  : Run a Graphical LCD through U8GLib (with MarlinUI)
+ *  IS_ULTIPANEL            : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
+ *  HAS_WIRED_LCD           : Ultra LCD, not necessarily Ultipanel.
+ *  IS_RRD_SC               : Common RRD Smart Controller digital interface pins
+ *  IS_RRD_FG_SC            : Common RRD Full Graphical Smart Controller digital interface pins
+ *  IS_U8GLIB_ST7920        : Most common DOGM display SPI interface, supporting a "lightweight" display mode.
+ *  U8GLIB_SH1106           : SH1106 OLED with I2C interface via U8GLib
+ *  IS_U8GLIB_SSD1306       : SSD1306 OLED with I2C interface via U8GLib (U8GLIB_SSD1306)
+ *  U8GLIB_SSD1309          : SSD1309 OLED with I2C interface via U8GLib (HAS_U8GLIB_I2C_OLED, HAS_WIRED_LCD, DOGLCD)
+ *  IS_U8GLIB_ST7565_64128N : ST7565 128x64 LCD with SPI interface via U8GLib
+ *  IS_U8GLIB_LM6059_AF     : LM6059 with Hardware SPI via U8GLib
  */
+#if ANY(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
 
-#if ANY(IS_RRD_SC, IS_DOGM_12864, OLED_PANEL_TINYBOY2, LCD_I2C_PANELOLU2)
+  #define MINIPANEL
 
-  #define STD_ENCODER_PULSES_PER_STEP 4
-  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+#elif ENABLED(YHCB2004)
 
-  #if ENABLED(LCD_I2C_PANELOLU2)  // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
-    #define LCD_I2C_TYPE_MCP23017 // I2C Character-based 12864 display
-    #define LCD_I2C_ADDRESS 0x20  // I2C Address of the port expander
-    #define LCD_USE_I2C_BUZZER    // Enable buzzer on LCD (optional)
-    #define IS_ULTIPANEL 1
-  #endif
+  #define IS_ULTIPANEL 1
 
-#elif ANY(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
+#elif ENABLED(CARTESIO_UI)
 
-  #define LCD_I2C_TYPE_PCF8575    // I2C Character-based 12864 display
-  #define LCD_I2C_ADDRESS 0x27    // I2C Address of the port expander
+  #define DOGLCD
   #define IS_ULTIPANEL 1
 
-  #if ENABLED(LCD_SAINSMART_I2C_2004)
-    #define LCD_WIDTH 20
-    #define LCD_HEIGHT 4
-  #endif
-
-#elif ENABLED(LCD_I2C_VIKI)
+#elif ANY(DWIN_MARLINUI_PORTRAIT, DWIN_MARLINUI_LANDSCAPE)
 
-  /**
-   * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
-   *
-   * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
-   * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
-   * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
-   *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
-   */
-  #define LCD_I2C_TYPE_MCP23017
-  #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
-  #define LCD_USE_I2C_BUZZER   // Enable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
+  #define IS_DWIN_MARLINUI 1
   #define IS_ULTIPANEL 1
 
-  #define ENCODER_FEEDRATE_DEADZONE 4
+#elif ENABLED(ZONESTAR_LCD)
+
+  #define HAS_ADC_BUTTONS 1
+  #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
+  #define ADC_KEY_NUM 8
+  #define IS_ULTIPANEL 1
 
+  // This helps to implement HAS_ADC_BUTTONS menus
+  #define REVERSE_MENU_DIRECTION
   #define STD_ENCODER_PULSES_PER_STEP 1
-  #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+  #define ENCODER_FEEDRATE_DEADZONE 2
 
-#elif ENABLED(G3D_PANEL)
+#elif ENABLED(ZONESTAR_12864LCD)
+  #define DOGLCD
+  #define IS_RRD_SC 1
+  #define IS_U8GLIB_ST7920 1
+
+#elif ENABLED(ZONESTAR_12864OLED)
+  #define IS_RRD_SC 1
+  #define U8GLIB_SH1106
+
+#elif ENABLED(ZONESTAR_12864OLED_SSD1306)
+  #define IS_RRD_SC 1
+  #define IS_U8GLIB_SSD1306
 
+#elif ENABLED(RADDS_DISPLAY)
+  #define IS_ULTIPANEL 1
   #define STD_ENCODER_PULSES_PER_STEP 2
-  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
-#endif
+#elif ANY(miniVIKI, VIKI2, WYH_L12864, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, EMOTION_TECH_LCD)
 
-#if ANY(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008) && DISABLED(NO_LCD_DETECT)
-  #define DETECT_I2C_LCD_DEVICE 1
-#endif
+  #define DOGLCD
+  #define IS_DOGM_12864 1
+  #define IS_ULTIPANEL 1
 
-#ifndef STD_ENCODER_PULSES_PER_STEP
-  #if ENABLED(TOUCH_SCREEN)
-    #define STD_ENCODER_PULSES_PER_STEP 2
-  #else
-    #define STD_ENCODER_PULSES_PER_STEP 5
+  #if ENABLED(miniVIKI)
+    #define IS_U8GLIB_ST7565_64128N 1
+  #elif ENABLED(VIKI2)
+    #define IS_U8GLIB_ST7565_64128N 1
+  #elif ENABLED(WYH_L12864)
+    #define IS_U8GLIB_ST7565_64128N 1
+    #define ST7565_XOFFSET 0x04
+  #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
+    #define IS_U8GLIB_LM6059_AF 1
+  #elif ENABLED(AZSMZ_12864)
+    #define IS_U8GLIB_ST7565_64128N 1
+  #elif ENABLED(EMOTION_TECH_LCD)
+    #define IS_U8GLIB_ST7565_64128N 1
+    #define ST7565_VOLTAGE_DIVIDER_VALUE 0x07
   #endif
-#endif
-#ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
-  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
-#endif
-#ifndef ENCODER_PULSES_PER_STEP
-  #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
-#endif
-#ifndef ENCODER_STEPS_PER_MENU_ITEM
-  #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
-#endif
-#ifndef ENCODER_FEEDRATE_DEADZONE
-  #define ENCODER_FEEDRATE_DEADZONE 6
-#endif
 
-// Shift register panels
-// ---------------------
-// 2 wire Non-latching LCD SR from:
-// https://github.com/fmalpartida/New-LiquidCrystal/wiki/schematics#user-content-ShiftRegister_connection
-#if ENABLED(FF_INTERFACEBOARD)
-  #define SR_LCD_3W_NL    // Non latching 3 wire shift register
-  #define IS_ULTIPANEL 1
-#elif ENABLED(SAV_3DLCD)
-  #define SR_LCD_2W_NL    // Non latching 2 wire shift register
-  #define IS_ULTIPANEL 1
-#elif ENABLED(ULTIPANEL)
+#elif ENABLED(OLED_PANEL_TINYBOY2)
+
+  #define IS_U8GLIB_SSD1306
   #define IS_ULTIPANEL 1
-#endif
 
-#if ANY(IS_ULTIPANEL, ULTRA_LCD)
-  #define HAS_WIRED_LCD 1
-#endif
+#elif ENABLED(RA_CONTROL_PANEL)
 
-#if ANY(IS_ULTIPANEL, REPRAPWORLD_KEYPAD)
-  #define IS_NEWPANEL 1
-#endif
+  #define LCD_I2C_TYPE_PCA8574
+  #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
+  #define IS_ULTIPANEL 1
 
-#if ANY(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
-  #define IS_RRW_KEYPAD 1
-  #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
-    #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
-  #endif
-#endif
+#elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
-// Aliases for LCD features
-#if !DGUS_UI_IS(NONE) || ENABLED(ANYCUBIC_LCD_VYPER)
-  #define HAS_DGUS_LCD 1
-  #if DGUS_UI_IS(ORIGIN, FYSETC, HIPRECY, MKS)
-    #define HAS_DGUS_LCD_CLASSIC 1
-  #endif
-#endif
+  #define DOGLCD
+  #define IS_U8GLIB_ST7920 1
+  #define IS_ULTIPANEL 1
+  #define ENCODER_PULSES_PER_STEP 2
 
-// Extensible UI serial touch screens. (See src/lcd/extui)
-#if ANY(HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT, TOUCH_UI_FTDI_EVE)
-  #define IS_EXTUI 1 // Just for sanity check.
-  #define EXTENSIBLE_UI
-#endif
+#elif ENABLED(MKS_12864OLED)
 
-// Aliases for LCD features
-#if ANY(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
-  #define HAS_DWIN_E3V2_BASIC 1
-#endif
-#if ANY(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
-  #define HAS_DWIN_E3V2 1
-#endif
+  #define IS_RRD_SC 1
+  #define U8GLIB_SH1106
 
-// E3V2 extras
-#if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
-  #define SERIAL_CATCHALL 0
-  #define HAS_LCD_BRIGHTNESS 1
-  #define LCD_BRIGHTNESS_MAX 250
-#endif
+#elif ENABLED(MKS_12864OLED_SSD1306)
 
-#if ENABLED(DWIN_LCD_PROUI)
-  #define DO_LIST_BIN_FILES 1
-  #define LCD_BRIGHTNESS_DEFAULT 127
-#endif
+  #define IS_RRD_SC 1
+  #define IS_U8GLIB_SSD1306
 
-// Serial Controllers require LCD_SERIAL_PORT
-#if ANY(IS_DWIN_MARLINUI, HAS_DWIN_E3V2, HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
-  #define LCD_IS_SERIAL_HOST 1
-#endif
+#elif ENABLED(SAV_3DGLCD)
 
-#if HAS_WIRED_LCD
-  #if ENABLED(DOGLCD)
-    #define HAS_MARLINUI_U8GLIB 1
-  #elif IS_TFTGLCD_PANEL
-    // Neither DOGM nor HD44780. Fully customized interface.
-  #elif IS_DWIN_MARLINUI
-    // Since HAS_MARLINUI_U8GLIB refers to U8G displays
-    // the DWIN display can define its own flags
-  #elif !HAS_GRAPHICAL_TFT
-    #define HAS_MARLINUI_HD44780 1
+  #ifdef U8GLIB_SSD1306
+    #define IS_U8GLIB_SSD1306 // Allow for U8GLIB_SSD1306 + SAV_3DGLCD
   #endif
-#endif
+  #define IS_NEWPANEL 1
 
-#if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
-  /**
-   * HAS_DISPLAY indicates the display uses these MarlinUI methods...
-   *  - update
-   *  - abort_print
-   *  - pause_print
-   *  - resume_print
-   *  - poweroff        (for PSU_CONTROL and HAS_MARLINUI_MENU)
-   *
-   *  ...and implements these MarlinUI methods:
-   *  - zoffset_overlay (if BABYSTEP_GFX_OVERLAY or MESH_EDIT_GFX_OVERLAY are supported)
-   *  - draw_kill_screen
-   *  - kill_screen
-   *  - draw_status_message
-   */
-  #define HAS_DISPLAY 1
-#endif
+#elif ENABLED(FYSETC_242_OLED_12864)
 
-#if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
-  #define HAS_LCDPRINT 1
-#endif
+  #define IS_RRD_SC 1
+  #define U8GLIB_SH1106
 
-#if HAS_DISPLAY || HAS_LCDPRINT
-  #define HAS_UTF8_UTILS 1
-#endif
+  #ifndef NEOPIXEL_BRIGHTNESS
+    #define NEOPIXEL_BRIGHTNESS 127
+  #endif
 
-#if ANY(HAS_DISPLAY, HAS_DWIN_E3V2)
-  #define HAS_STATUS_MESSAGE 1
-#endif
+#elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1, FYSETC_GENERIC_12864_1_1)
 
-#if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
-  #define HAS_MARLINUI_MENU 1
-#endif
+  #define FYSETC_MINI_12864
+  #define DOGLCD
+  #define IS_ULTIPANEL 1
+  #define LED_COLORS_REDUCE_GREEN
+
+  // Require LED backlighting enabled
+  #if ENABLED(FYSETC_MINI_12864_2_1)
+    #ifndef NEOPIXEL_BRIGHTNESS
+      #define NEOPIXEL_BRIGHTNESS 127
+    #endif
+    //#define NEOPIXEL_STARTUP_TEST
+  #endif
 
-#if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
-  #define HAS_MANUAL_MOVE_MENU 1
-#endif
+#elif ENABLED(ULTI_CONTROLLER)
 
-#if HAS_MARLINUI_U8GLIB
-  #ifndef LCD_PIXEL_WIDTH
-    #define LCD_PIXEL_WIDTH 128
-  #endif
-  #ifndef LCD_PIXEL_HEIGHT
-    #define LCD_PIXEL_HEIGHT 64
+  #define IS_ULTIPANEL 1
+  #define U8GLIB_SSD1309
+  #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
+  #define STD_ENCODER_PULSES_PER_STEP 4
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+  #ifndef PCA9632
+    #define PCA9632
   #endif
-#endif
 
-/**
- *  Multi-Material-Unit supported models
- */
-#define PRUSA_MMU1             1
-#define PRUSA_MMU2             2
-#define PRUSA_MMU2S            3
-#define EXTENDABLE_EMU_MMU2   12
-#define EXTENDABLE_EMU_MMU2S  13
+#elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
-#ifdef MMU_MODEL
-  #define HAS_MMU 1
-  #if MMU_MODEL == PRUSA_MMU1
-    #define HAS_PRUSA_MMU1 1
-  #elif MMU_MODEL % 10 == PRUSA_MMU2
-    #define HAS_PRUSA_MMU2 1
-  #elif MMU_MODEL % 10 == PRUSA_MMU2S
-    #define HAS_PRUSA_MMU2 1
-    #define HAS_PRUSA_MMU2S 1
-  #endif
-  #if MMU_MODEL >= EXTENDABLE_EMU_MMU2
-    #define HAS_EXTENDABLE_MMU 1
-  #endif
-#endif
+  #define IS_RRD_SC 1
+  #define LCD_WIDTH 16
+  #define LCD_HEIGHT 2
 
-#undef PRUSA_MMU1
-#undef PRUSA_MMU2
-#undef PRUSA_MMU2S
-#undef EXTENDABLE_EMU_MMU2
-#undef EXTENDABLE_EMU_MMU2S
+#elif ANY(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
 
-/**
- * Extruders have some combination of stepper motors and hotends
- * so we separate these concepts into the defines:
- *
- *  EXTRUDERS    - Number of Selectable Tools
- *  HOTENDS      - Number of hotends, whether connected or separate
- *  E_STEPPERS   - Number of actual E stepper motors
- *  E_MANUAL     - Number of E steppers for LCD move options
- *
- * These defines must be simple constants for use in REPEAT, etc.
- */
-#if EXTRUDERS
-  #define HAS_EXTRUDERS 1
-  #if EXTRUDERS > 1
-    #define HAS_MULTI_EXTRUDER 1
+  #define IS_TFTGLCD_PANEL 1
+  #define IS_ULTIPANEL 1                    // Note that IS_ULTIPANEL leads to HAS_WIRED_LCD
+
+  #if HAS_MEDIA && DISABLED(LCD_PROGRESS_BAR)
+    #define LCD_PROGRESS_BAR
   #endif
-  #define E_AXIS_N(E) AxisEnum(E_AXIS + E_INDEX_N(E))
-#else
-  #undef EXTRUDERS
-  #define EXTRUDERS 0
-  #undef TEMP_SENSOR_0
-  #undef TEMP_SENSOR_1
-  #undef TEMP_SENSOR_2
-  #undef TEMP_SENSOR_3
-  #undef TEMP_SENSOR_4
-  #undef TEMP_SENSOR_5
-  #undef TEMP_SENSOR_6
-  #undef TEMP_SENSOR_7
-  #undef SINGLENOZZLE
-  #undef SWITCHING_EXTRUDER
-  #undef MECHANICAL_SWITCHING_EXTRUDER
-  #undef SWITCHING_NOZZLE
-  #undef MECHANICAL_SWITCHING_NOZZLE
-  #undef MIXING_EXTRUDER
-  #undef HOTEND_IDLE_TIMEOUT
-  #undef DISABLE_E
-  #undef PREVENT_LENGTHY_EXTRUDE
-  #undef FILAMENT_RUNOUT_SENSOR
-  #undef FILAMENT_RUNOUT_DISTANCE_MM
-  #undef DISABLE_OTHER_EXTRUDERS
-#endif
+  #if ENABLED(TFTGLCD_PANEL_I2C)
+    #define LCD_I2C_ADDRESS           0x33  // Must be 0x33 for STM32 main boards and equal to panel's I2C slave address
+  #endif
+  #define LCD_USE_I2C_BUZZER                // Enable buzzer on LCD, used for both I2C and SPI buses (LiquidTWI2 not required)
+  #define STD_ENCODER_PULSES_PER_STEP 2
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+  #define LCD_WIDTH                   20    // 20 or 24 chars in line
+  #define LCD_HEIGHT                  10    // Character lines
+  #define LCD_CONTRAST_MIN            127
+  #define LCD_CONTRAST_MAX            255
+  #define LCD_CONTRAST_DEFAULT        250
+  #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.
+                                      // At this time present conversion only for cyrillic - bg, ru and uk languages.
+                                      // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 
-#define E_OPTARG(N) OPTARG(HAS_MULTI_EXTRUDER, N)
-#define E_TERN_(N)  TERN_(HAS_MULTI_EXTRUDER, N)
-#define E_TERN0(N)  TERN0(HAS_MULTI_EXTRUDER, N)
+#elif ENABLED(CR10_STOCKDISPLAY)
 
-#if ANY(SWITCHING_EXTRUDER, MECHANICAL_SWITCHING_EXTRUDER)
-  #define HAS_SWITCHING_EXTRUDER 1
-#endif
-#if ANY(SWITCHING_NOZZLE, MECHANICAL_SWITCHING_NOZZLE)
-  #define HAS_SWITCHING_NOZZLE 1
-#endif
+  #define IS_RRD_FG_SC 1
+  #define LCD_ST7920_DELAY_1           125
+  #define LCD_ST7920_DELAY_2           125
+  #define LCD_ST7920_DELAY_3           125
 
-#if ENABLED(E_DUAL_STEPPER_DRIVERS) // E0/E1 steppers act in tandem as E0
+#elif ANY(ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING)
 
-  #define E_STEPPERS      2
-  #define E_MANUAL        1
+  #define IS_RRD_FG_SC 1
+  #define LCD_ST7920_DELAY_1           150
+  #define LCD_ST7920_DELAY_2           150
+  #define LCD_ST7920_DELAY_3           150
 
-#elif HAS_SWITCHING_EXTRUDER        // One stepper for every two EXTRUDERS
+#elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, BQ_LCD_SMART_CONTROLLER, K3D_FULL_GRAPHIC_SMART_CONTROLLER)
 
-  #if EXTRUDERS > 4
-    #define E_STEPPERS    3
-  #elif EXTRUDERS > 2
-    #define E_STEPPERS    2
-  #else
-    #define E_STEPPERS    1
-  #endif
+  #define IS_RRD_FG_SC 1
 
-#elif ENABLED(MIXING_EXTRUDER)      // Multiple feeds are mixed proportionally
+#elif ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
 
-  #define E_STEPPERS      MIXING_STEPPERS
-  #define E_MANUAL        1
-  #if MIXING_STEPPERS == 2
-    #define HAS_DUAL_MIXING 1
-  #endif
+  #define IS_RRD_SC 1   // RepRapDiscount LCD or Graphical LCD with rotary click encoder
 
-#elif ENABLED(SWITCHING_TOOLHEAD)   // Toolchanger
+#elif ENABLED(K3D_242_OLED_CONTROLLER)
 
-  #define E_STEPPERS      EXTRUDERS
-  #define E_MANUAL        EXTRUDERS
+  #define IS_RRD_SC 1
+  #define U8GLIB_SSD1309
 
-#elif HAS_PRUSA_MMU2                // Pr≈Ø≈°a Multi-Material Unit v2
+#endif
 
-  #define E_STEPPERS      1
-  #define E_MANUAL        1
+// ST7920-based graphical displays
+#if ANY(IS_RRD_FG_SC, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
+  #define DOGLCD
+  #define IS_U8GLIB_ST7920 1
+  #define IS_RRD_SC 1
+#endif
 
+// ST7565 / 64128N graphical displays
+#if ANY(MAKRPANEL, MINIPANEL)
+  #define IS_ULTIPANEL 1
+  #define DOGLCD
+  #if ENABLED(MAKRPANEL)
+    #define IS_U8GLIB_ST7565_64128N 1
+  #endif
 #endif
 
-// No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1 or just 1 E stepper exists
-#if HAS_SWITCHING_NOZZLE || HAS_PRUSA_MMU1 || E_STEPPERS < 2
-  #undef DISABLE_OTHER_EXTRUDERS
+#if ENABLED(IS_U8GLIB_SSD1306)
+  #define U8GLIB_SSD1306
 #endif
 
-// Pr≈Ø≈°a MMU1, MMU(S) 2.0 and EXTENDABLE_EMU_MMU2(S) force SINGLENOZZLE
-#if HAS_MMU
-  #define SINGLENOZZLE
+#if ENABLED(OVERLORD_OLED)
+  #define IS_ULTIPANEL 1
+  #define U8GLIB_SH1106
+  /**
+   * PCA9632 for buzzer and LEDs via i2c
+   * No auto-inc, red and green leds switched, buzzer
+   */
+  #define PCA9632
+  #define PCA9632_NO_AUTO_INC
+  #define PCA9632_GRN         0x00
+  #define PCA9632_RED         0x02
+  #define PCA9632_BUZZER
+  #define PCA9632_BUZZER_DATA { 0x09, 0x02 }
+
+  #define STD_ENCODER_PULSES_PER_STEP     1 // Overlord uses buttons
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 
-// Default E steppers / manual motion is one per extruder
-#ifndef E_STEPPERS
-  #define E_STEPPERS EXTRUDERS
+// 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
+#if ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
+  #define HAS_U8GLIB_I2C_OLED 1
+  #define HAS_WIRED_LCD 1
+  #define DOGLCD
 #endif
-#ifndef E_MANUAL
-  #define E_MANUAL EXTRUDERS
+
+/**
+ * SPI Ultipanels
+ */
+
+// Basic Ultipanel-like displays
+#if ANY(ULTIMAKERCONTROLLER, IS_RRD_SC, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
+  #define IS_ULTIPANEL 1
 #endif
 
-// Number of hotends...
-#if ANY(SINGLENOZZLE, MIXING_EXTRUDER)                // Only one for singlenozzle or mixing extruder
-  #define HOTENDS 1
-#elif HAS_SWITCHING_EXTRUDER && !HAS_SWITCHING_NOZZLE // One for each pair of abstract "extruders"
-  #define HOTENDS E_STEPPERS
-#elif TEMP_SENSOR_0
-  #define HOTENDS EXTRUDERS                           // One per extruder if at least one heater exists
-#else
-  #define HOTENDS 0                                   // A machine with no hotends at all can still extrude
+// Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
+#if ENABLED(U8GLIB_SH1106_EINSTART)
+  #define DOGLCD
+  #define IS_ULTIPANEL 1
 #endif
 
-// More than one hotend...
-#if HOTENDS > 1
-  #define HAS_MULTI_HOTEND 1
-  #define HAS_HOTEND_OFFSET 1
-  #ifndef HOTEND_OFFSET_X
-    #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
-  #endif
-  #ifndef HOTEND_OFFSET_Y
-    #define HOTEND_OFFSET_Y { 0 } // Y offsets for each extruder
+// TFT Legacy options masquerade as TFT_GENERIC
+#if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
+  #define IS_LEGACY_TFT 1
+  #define TFT_GENERIC
+  #if ANY(FSMC_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_LVGL_UI_FSMC)
+    #define TFT_INTERFACE_FSMC
+  #elif ANY(SPI_GRAPHICAL_TFT, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_SPI)
+    #define TFT_INTERFACE_SPI
   #endif
-  #ifndef HOTEND_OFFSET_Z
-    #define HOTEND_OFFSET_Z { 0 } // Z offsets for each extruder
+  #if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
+    #define TFT_CLASSIC_UI
+  #elif ANY(TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI)
+    #define TFT_COLOR_UI
+  #elif ANY(TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
+    #define TFT_LVGL_UI
   #endif
-#else
-  #undef HOTEND_OFFSET_X
-  #undef HOTEND_OFFSET_Y
-  #undef HOTEND_OFFSET_Z
 #endif
 
-// At least one hotend...
-#if HOTENDS
-  #define HAS_HOTEND 1
-  #ifndef HOTEND_OVERSHOOT
-    #define HOTEND_OVERSHOOT 15
-  #endif
+// FSMC/SPI TFT Panels (LVGL)
+#if ENABLED(TFT_LVGL_UI)
+  #define HAS_TFT_LVGL_UI 1
+  #define SERIAL_RUNTIME_HOOK 1
+#endif
+
+// FSMC/SPI TFT Panels
+#if ENABLED(TFT_CLASSIC_UI)
+  #define TFT_SCALED_DOGLCD 1
 #endif
 
-// Clean up E-stepper-based settings...
-#if E_STEPPERS <= 7
-  #undef INVERT_E7_DIR
-  #undef E7_DRIVER_TYPE
-  #if E_STEPPERS <= 6
-    #undef INVERT_E6_DIR
-    #undef E6_DRIVER_TYPE
-    #if E_STEPPERS <= 5
-      #undef INVERT_E5_DIR
-      #undef E5_DRIVER_TYPE
-      #if E_STEPPERS <= 4
-        #undef INVERT_E4_DIR
-        #undef E4_DRIVER_TYPE
-        #if E_STEPPERS <= 3
-          #undef INVERT_E3_DIR
-          #undef E3_DRIVER_TYPE
-          #if E_STEPPERS <= 2
-            #undef INVERT_E2_DIR
-            #undef E2_DRIVER_TYPE
-            #if E_STEPPERS <= 1
-              #undef INVERT_E1_DIR
-              #undef E1_DRIVER_TYPE
-              #if E_STEPPERS == 0
-                #undef INVERT_E0_DIR
-                #undef E0_DRIVER_TYPE
-              #endif
-            #endif
-          #endif
-        #endif
-      #endif
-    #endif
-  #endif
+#if TFT_SCALED_DOGLCD
+  #define DOGLCD
+  #define IS_ULTIPANEL 1
+  #define DELAYED_BACKLIGHT_INIT
+#elif HAS_TFT_LVGL_UI
+  #define DELAYED_BACKLIGHT_INIT
+#endif
+
+// Color UI
+#if ENABLED(TFT_COLOR_UI)
+  #define HAS_GRAPHICAL_TFT 1
+  #define IS_ULTIPANEL 1
 #endif
 
 /**
- * Number of Linear Axes (e.g., XYZIJKUVW)
- * All the logical axes except for the tool (E) axis
+ * I2C Panels
  */
-#ifdef NUM_AXES
-  #undef NUM_AXES
-  #define NUM_AXES_WARNING 1
-#endif
 
-#ifdef W_DRIVER_TYPE
-  #define NUM_AXES 9
-#elif defined(V_DRIVER_TYPE)
-  #define NUM_AXES 8
-#elif defined(U_DRIVER_TYPE)
-  #define NUM_AXES 7
-#elif defined(K_DRIVER_TYPE)
-  #define NUM_AXES 6
-#elif defined(J_DRIVER_TYPE)
-  #define NUM_AXES 5
-#elif defined(I_DRIVER_TYPE)
-  #define NUM_AXES 4
-#elif defined(Z_DRIVER_TYPE)
-  #define NUM_AXES 3
-#elif defined(Y_DRIVER_TYPE)
-  #define NUM_AXES 2
-#elif defined(X_DRIVER_TYPE)
-  #define NUM_AXES 1
-#else
-  #define NUM_AXES 0
-#endif
-#if NUM_AXES >= 1
-  #define HAS_X_AXIS 1
-  #if NUM_AXES >= XY
-    #define HAS_Y_AXIS 1
-    #if NUM_AXES >= XYZ
-      #define HAS_Z_AXIS 1
-      #if NUM_AXES >= 4
-        #define HAS_I_AXIS 1
-        #if NUM_AXES >= 5
-          #define HAS_J_AXIS 1
-          #if NUM_AXES >= 6
-            #define HAS_K_AXIS 1
-            #if NUM_AXES >= 7
-              #define HAS_U_AXIS 1
-              #if NUM_AXES >= 8
-                #define HAS_V_AXIS 1
-                #if NUM_AXES >= 9
-                  #define HAS_W_AXIS 1
-                #endif
-              #endif
-            #endif
-          #endif
-        #endif
-      #endif
-    #endif
+#if ANY(IS_RRD_SC, IS_DOGM_12864, OLED_PANEL_TINYBOY2, LCD_I2C_PANELOLU2)
+
+  #define STD_ENCODER_PULSES_PER_STEP 4
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+
+  #if ENABLED(LCD_I2C_PANELOLU2)  // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
+    #define LCD_I2C_TYPE_MCP23017 // I2C Character-based 12864 display
+    #define LCD_I2C_ADDRESS 0x20  // I2C Address of the port expander
+    #define LCD_USE_I2C_BUZZER    // Enable buzzer on LCD (optional)
+    #define IS_ULTIPANEL 1
   #endif
-#endif
 
-#if !HAS_X_AXIS
-  #undef AVOID_OBSTACLES
-  #undef ENDSTOPPULLUP_XMIN
-  #undef ENDSTOPPULLUP_XMAX
-  #undef X_MIN_ENDSTOP_HIT_STATE
-  #undef X_MAX_ENDSTOP_HIT_STATE
-  #undef X2_DRIVER_TYPE
-  #undef X_ENABLE_ON
-  #undef DISABLE_X
-  #undef INVERT_X_DIR
-  #undef X_HOME_DIR
-  #undef X_MIN_POS
-  #undef X_MAX_POS
-  #undef MANUAL_X_HOME_POS
-  #undef MIN_SOFTWARE_ENDSTOPS
-  #undef MAX_SOFTWARE_ENDSTOPS
+#elif ANY(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
+
+  #define LCD_I2C_TYPE_PCF8575    // I2C Character-based 12864 display
+  #define LCD_I2C_ADDRESS 0x27    // I2C Address of the port expander
+  #define IS_ULTIPANEL 1
+
+  #if ENABLED(LCD_SAINSMART_I2C_2004)
+    #define LCD_WIDTH 20
+    #define LCD_HEIGHT 4
+  #endif
+
+#elif ENABLED(LCD_I2C_VIKI)
+
+  /**
+   * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
+   *
+   * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
+   * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
+   * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
+   *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
+   */
+  #define LCD_I2C_TYPE_MCP23017
+  #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
+  #define LCD_USE_I2C_BUZZER   // Enable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
+  #define IS_ULTIPANEL 1
+
+  #define ENCODER_FEEDRATE_DEADZONE 4
+
+  #define STD_ENCODER_PULSES_PER_STEP 1
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
+
+#elif ENABLED(G3D_PANEL)
+
+  #define STD_ENCODER_PULSES_PER_STEP 2
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+
 #endif
 
-#if !HAS_Y_AXIS
-  #undef AVOID_OBSTACLES
-  #undef ENDSTOPPULLUP_YMIN
-  #undef ENDSTOPPULLUP_YMAX
-  #undef Y_MIN_ENDSTOP_HIT_STATE
-  #undef Y_MAX_ENDSTOP_HIT_STATE
-  #undef Y2_DRIVER_TYPE
-  #undef Y_ENABLE_ON
-  #undef DISABLE_Y
-  #undef INVERT_Y_DIR
-  #undef Y_HOME_DIR
-  #undef Y_MIN_POS
-  #undef Y_MAX_POS
-  #undef MANUAL_Y_HOME_POS
-  #undef MIN_SOFTWARE_ENDSTOP_Y
-  #undef MAX_SOFTWARE_ENDSTOP_Y
+#if ANY(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008) && DISABLED(NO_LCD_DETECT)
+  #define DETECT_I2C_LCD_DEVICE 1
 #endif
 
-#if HAS_Z_AXIS
-  #ifdef Z4_DRIVER_TYPE
-    #define NUM_Z_STEPPERS 4
-  #elif defined(Z3_DRIVER_TYPE)
-    #define NUM_Z_STEPPERS 3
-  #elif defined(Z2_DRIVER_TYPE)
-    #define NUM_Z_STEPPERS 2
+#ifndef STD_ENCODER_PULSES_PER_STEP
+  #if ENABLED(TOUCH_SCREEN)
+    #define STD_ENCODER_PULSES_PER_STEP 2
   #else
-    #define NUM_Z_STEPPERS 1
+    #define STD_ENCODER_PULSES_PER_STEP 5
   #endif
-#else
-  #undef ENDSTOPPULLUP_ZMIN
-  #undef ENDSTOPPULLUP_ZMAX
-  #undef Z_MIN_ENDSTOP_HIT_STATE
-  #undef Z_MAX_ENDSTOP_HIT_STATE
-  #undef Z2_DRIVER_TYPE
-  #undef Z3_DRIVER_TYPE
-  #undef Z4_DRIVER_TYPE
-  #undef Z_ENABLE_ON
-  #undef DISABLE_Z
-  #undef INVERT_Z_DIR
-  #undef Z_HOME_DIR
-  #undef Z_MIN_POS
-  #undef Z_MAX_POS
-  #undef MANUAL_Z_HOME_POS
-  #undef Z_SAFE_HOMING
-  #undef MIN_SOFTWARE_ENDSTOP_Z
-  #undef MAX_SOFTWARE_ENDSTOP_Z
+#endif
+#ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+#endif
+#ifndef ENCODER_PULSES_PER_STEP
+  #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
+#endif
+#ifndef ENCODER_STEPS_PER_MENU_ITEM
+  #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
+#endif
+#ifndef ENCODER_FEEDRATE_DEADZONE
+  #define ENCODER_FEEDRATE_DEADZONE 6
 #endif
 
-#if !HAS_I_AXIS
-  #undef ENDSTOPPULLUP_IMIN
-  #undef ENDSTOPPULLUP_IMAX
-  #undef I_MIN_ENDSTOP_HIT_STATE
-  #undef I_MAX_ENDSTOP_HIT_STATE
-  #undef I_ENABLE_ON
-  #undef DISABLE_I
-  #undef INVERT_I_DIR
-  #undef I_HOME_DIR
-  #undef I_MIN_POS
-  #undef I_MAX_POS
-  #undef MANUAL_I_HOME_POS
-  #undef MIN_SOFTWARE_ENDSTOP_I
-  #undef MAX_SOFTWARE_ENDSTOP_I
+// Shift register panels
+// ---------------------
+// 2 wire Non-latching LCD SR from:
+// https://github.com/fmalpartida/New-LiquidCrystal/wiki/schematics#user-content-ShiftRegister_connection
+#if ENABLED(FF_INTERFACEBOARD)
+  #define SR_LCD_3W_NL    // Non latching 3 wire shift register
+  #define IS_ULTIPANEL 1
+#elif ENABLED(SAV_3DLCD)
+  #define SR_LCD_2W_NL    // Non latching 2 wire shift register
+  #define IS_ULTIPANEL 1
+#elif ENABLED(ULTIPANEL)
+  #define IS_ULTIPANEL 1
 #endif
 
-#if !HAS_J_AXIS
-  #undef ENDSTOPPULLUP_JMIN
-  #undef ENDSTOPPULLUP_JMAX
-  #undef J_MIN_ENDSTOP_HIT_STATE
-  #undef J_MAX_ENDSTOP_HIT_STATE
-  #undef J_ENABLE_ON
-  #undef DISABLE_J
-  #undef INVERT_J_DIR
-  #undef J_HOME_DIR
-  #undef J_MIN_POS
-  #undef J_MAX_POS
-  #undef MANUAL_J_HOME_POS
-  #undef MIN_SOFTWARE_ENDSTOP_J
-  #undef MAX_SOFTWARE_ENDSTOP_J
+#if ANY(IS_ULTIPANEL, ULTRA_LCD)
+  #define HAS_WIRED_LCD 1
 #endif
 
-#if !HAS_K_AXIS
-  #undef ENDSTOPPULLUP_KMIN
-  #undef ENDSTOPPULLUP_KMAX
-  #undef K_MIN_ENDSTOP_HIT_STATE
-  #undef K_MAX_ENDSTOP_HIT_STATE
-  #undef K_ENABLE_ON
-  #undef DISABLE_K
-  #undef INVERT_K_DIR
-  #undef K_HOME_DIR
-  #undef K_MIN_POS
-  #undef K_MAX_POS
-  #undef MANUAL_K_HOME_POS
-  #undef MIN_SOFTWARE_ENDSTOP_K
-  #undef MAX_SOFTWARE_ENDSTOP_K
+#if ANY(IS_ULTIPANEL, REPRAPWORLD_KEYPAD)
+  #define IS_NEWPANEL 1
 #endif
 
-#if !HAS_U_AXIS
-  #undef ENDSTOPPULLUP_UMIN
-  #undef ENDSTOPPULLUP_UMAX
-  #undef U_MIN_ENDSTOP_HIT_STATE
-  #undef U_MAX_ENDSTOP_HIT_STATE
-  #undef U_ENABLE_ON
-  #undef DISABLE_U
-  #undef INVERT_U_DIR
-  #undef U_HOME_DIR
-  #undef U_MIN_POS
-  #undef U_MAX_POS
-  #undef MANUAL_U_HOME_POS
-  #undef MIN_SOFTWARE_ENDSTOP_U
-  #undef MAX_SOFTWARE_ENDSTOP_U
+#if ANY(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
+  #define IS_RRW_KEYPAD 1
+  #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
+    #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
+  #endif
 #endif
 
-#if !HAS_V_AXIS
-  #undef ENDSTOPPULLUP_VMIN
-  #undef ENDSTOPPULLUP_VMAX
-  #undef V_MIN_ENDSTOP_HIT_STATE
-  #undef V_MAX_ENDSTOP_HIT_STATE
-  #undef V_ENABLE_ON
-  #undef DISABLE_V
-  #undef INVERT_V_DIR
-  #undef V_HOME_DIR
-  #undef V_MIN_POS
-  #undef V_MAX_POS
-  #undef MANUAL_V_HOME_POS
-  #undef MIN_SOFTWARE_ENDSTOP_V
-  #undef MAX_SOFTWARE_ENDSTOP_V
+// Aliases for LCD features
+#if !DGUS_UI_IS(NONE) || ENABLED(ANYCUBIC_LCD_VYPER)
+  #define HAS_DGUS_LCD 1
+  #if DGUS_UI_IS(ORIGIN, FYSETC, HIPRECY, MKS)
+    #define HAS_DGUS_LCD_CLASSIC 1
+  #endif
 #endif
 
-#if !HAS_W_AXIS
-  #undef ENDSTOPPULLUP_WMIN
-  #undef ENDSTOPPULLUP_WMAX
-  #undef W_MIN_ENDSTOP_HIT_STATE
-  #undef W_MAX_ENDSTOP_HIT_STATE
-  #undef W_ENABLE_ON
-  #undef DISABLE_W
-  #undef INVERT_W_DIR
-  #undef W_HOME_DIR
-  #undef W_MIN_POS
-  #undef W_MAX_POS
-  #undef MANUAL_W_HOME_POS
-  #undef MIN_SOFTWARE_ENDSTOP_W
-  #undef MAX_SOFTWARE_ENDSTOP_W
+// Extensible UI serial touch screens. (See src/lcd/extui)
+#if ANY(HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT, TOUCH_UI_FTDI_EVE)
+  #define IS_EXTUI 1 // Just for sanity check.
+  #define EXTENSIBLE_UI
 #endif
 
-#define _OR_HAS_DA(A) ENABLED(DISABLE_##A) ||
-#if MAP(_OR_HAS_DA, X, Y, Z, I, J, K, U, V, W) 0
-  #define HAS_DISABLE_MAIN_AXES 1
+// Aliases for LCD features
+#if ANY(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
+  #define HAS_DWIN_E3V2_BASIC 1
 #endif
-#if HAS_DISABLE_MAIN_AXES || ENABLED(DISABLE_E)
-  #define HAS_DISABLE_AXES 1
+#if ANY(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
+  #define HAS_DWIN_E3V2 1
 #endif
-#undef _OR_HAS_DA
 
-#ifdef X2_DRIVER_TYPE
-  #define HAS_X2_STEPPER 1
+// E3V2 extras
+#if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
+  #define SERIAL_CATCHALL 0
+  #define HAS_LCD_BRIGHTNESS 1
+  #define LCD_BRIGHTNESS_MAX 250
 #endif
-#ifdef Y2_DRIVER_TYPE
-  #define HAS_Y2_STEPPER 1
+
+#if ENABLED(DWIN_LCD_PROUI)
+  #define DO_LIST_BIN_FILES 1
+  #define LCD_BRIGHTNESS_DEFAULT 127
 #endif
 
-/**
- * Number of Primary Linear Axes (e.g., XYZ)
- * X, XY, or XYZ axes. Excluding duplicate axes (X2, Y2, Z2, Z3, Z4)
- */
-#if NUM_AXES >= 3
-  #define PRIMARY_LINEAR_AXES 3
-#else
-  #define PRIMARY_LINEAR_AXES NUM_AXES
+// Serial Controllers require LCD_SERIAL_PORT
+#if ANY(IS_DWIN_MARLINUI, HAS_DWIN_E3V2, HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
+  #define LCD_IS_SERIAL_HOST 1
 #endif
 
-/**
- * Number of Secondary Axes (e.g., IJKUVW)
- * All linear/rotational axes between XYZ and E.
- */
-#define SECONDARY_AXES SUB3(NUM_AXES)
+#if HAS_WIRED_LCD
+  #if ENABLED(DOGLCD)
+    #define HAS_MARLINUI_U8GLIB 1
+  #elif IS_TFTGLCD_PANEL
+    // Neither DOGM nor HD44780. Fully customized interface.
+  #elif IS_DWIN_MARLINUI
+    // Since HAS_MARLINUI_U8GLIB refers to U8G displays
+    // the DWIN display can define its own flags
+  #elif !HAS_GRAPHICAL_TFT
+    #define HAS_MARLINUI_HD44780 1
+  #endif
+#endif
 
-/**
- * Number of Rotational Axes (e.g., IJK)
- * All axes for which AXIS*_ROTATES is defined.
- * For these axes, positions are specified in angular degrees.
- */
-#if ENABLED(AXIS9_ROTATES)
-  #define ROTATIONAL_AXES 6
-#elif ENABLED(AXIS8_ROTATES)
-  #define ROTATIONAL_AXES 5
-#elif ENABLED(AXIS7_ROTATES)
-  #define ROTATIONAL_AXES 4
-#elif ENABLED(AXIS6_ROTATES)
-  #define ROTATIONAL_AXES 3
-#elif ENABLED(AXIS5_ROTATES)
-  #define ROTATIONAL_AXES 2
-#elif ENABLED(AXIS4_ROTATES)
-  #define ROTATIONAL_AXES 1
-#else
-  #define ROTATIONAL_AXES 0
+#if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
+  /**
+   * HAS_DISPLAY indicates the display uses these MarlinUI methods...
+   *  - update
+   *  - abort_print
+   *  - pause_print
+   *  - resume_print
+   *  - poweroff        (for PSU_CONTROL and HAS_MARLINUI_MENU)
+   *
+   *  ...and implements these MarlinUI methods:
+   *  - zoffset_overlay (if BABYSTEP_GFX_OVERLAY or MESH_EDIT_GFX_OVERLAY are supported)
+   *  - draw_kill_screen
+   *  - kill_screen
+   *  - draw_status_message
+   */
+  #define HAS_DISPLAY 1
 #endif
 
-/**
- * Number of Secondary Linear Axes (e.g., UVW)
- * All secondary axes for which AXIS*_ROTATES is not defined.
- * Excluding primary axes and excluding duplicate axes (X2, Y2, Z2, Z3, Z4)
- */
-#define SECONDARY_LINEAR_AXES (NUM_AXES - PRIMARY_LINEAR_AXES - ROTATIONAL_AXES)
+#if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
+  #define HAS_LCDPRINT 1
+#endif
 
-/**
- * Number of Logical Axes (e.g., XYZIJKUVWE)
- * All logical axes that can be commanded directly by G-code.
- * Delta maps stepper-specific values to ABC steppers.
- */
-#if HAS_EXTRUDERS
-  #define LOGICAL_AXES INCREMENT(NUM_AXES)
-#else
-  #define LOGICAL_AXES NUM_AXES
+#if HAS_DISPLAY || HAS_LCDPRINT
+  #define HAS_UTF8_UTILS 1
 #endif
 
-/**
- * DISTINCT_E_FACTORS is set to give extruders (some) individual settings.
- *
- * DISTINCT_AXES is the number of distinct addressable axes (not steppers).
- *  Includes all linear axes plus all distinguished extruders.
- *  The default behavior is to treat all extruders as a single E axis
- *  with shared motion and temperature settings.
- *
- * DISTINCT_E is the number of distinguished extruders. By default this
- *  will be 1 which indicates all extruders share the same settings.
- *
- * E_INDEX_N(E) should be used to get the E index of any item that might be
- *  distinguished.
- */
-#if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
-  #define DISTINCT_AXES (NUM_AXES + E_STEPPERS)
-  #define DISTINCT_E E_STEPPERS
-  #define E_INDEX_N(E) (E)
-#else
-  #undef DISTINCT_E_FACTORS
-  #define DISTINCT_AXES LOGICAL_AXES
-  #define DISTINCT_E 1
-  #define E_INDEX_N(E) 0
+#if ANY(HAS_DISPLAY, HAS_DWIN_E3V2)
+  #define HAS_STATUS_MESSAGE 1
 #endif
 
-// Helper macros for extruder and hotend arrays
-#define _EXTRUDER_LOOP(E) for (int8_t E = 0; E < EXTRUDERS; E++)
-#define EXTRUDER_LOOP() _EXTRUDER_LOOP(e)
-#define _HOTEND_LOOP(H) for (int8_t H = 0; H < HOTENDS; H++)
-#define HOTEND_LOOP() _HOTEND_LOOP(e)
+#if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
+  #define HAS_MARLINUI_MENU 1
+#endif
 
-#define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
-#define ARRAY_BY_EXTRUDERS1(v1) ARRAY_N_1(EXTRUDERS, v1)
-#define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
-#define ARRAY_BY_HOTENDS1(v1) ARRAY_N_1(HOTENDS, v1)
+#if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
+  #define HAS_MANUAL_MOVE_MENU 1
+#endif
+
+#if HAS_MARLINUI_U8GLIB
+  #ifndef LCD_PIXEL_WIDTH
+    #define LCD_PIXEL_WIDTH 128
+  #endif
+  #ifndef LCD_PIXEL_HEIGHT
+    #define LCD_PIXEL_HEIGHT 64
+  #endif
+#endif
 
 /**
  * Disable unused SINGLENOZZLE sub-options
  */
 #if DISABLED(SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_TEMP
 #endif
 #if !ALL(HAS_FAN, SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_FAN
 #endif
 
+// No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1 or just 1 E stepper exists
+#if HAS_SWITCHING_NOZZLE || HAS_PRUSA_MMU1 || E_STEPPERS < 2
+  #undef DISABLE_OTHER_EXTRUDERS
+#endif
+
 // Switching extruder has its own servo?
 #if ENABLED(SWITCHING_EXTRUDER) && (!HAS_SWITCHING_NOZZLE || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
   #define DO_SWITCH_EXTRUDER 1
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH) && !defined(Z_PROBE_SERVO_NR)
@@ -1546,20 +1547,28 @@
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
   #define GRID_LOOP(A,B) for (uint8_t A = 0; A < GRID_MAX_POINTS_X; ++A) for (uint8_t B = 0; B < GRID_MAX_POINTS_Y; ++B)
 #endif
 
 // Slim menu optimizations
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
+// Flow and feedrate editing
+#if HAS_EXTRUDERS && ANY(HAS_MARLINUI_MENU, DWIN_CREALITY_LCD, DWIN_LCD_PROUI, MALYAN_LCD, TOUCH_SCREEN)
+  #define HAS_FLOW_EDIT 1
+#endif
+#if ANY(HAS_MARLINUI_MENU, ULTIPANEL_FEEDMULTIPLY, DWIN_CREALITY_LCD, DWIN_LCD_PROUI, MALYAN_LCD, TOUCH_SCREEN)
+  #define HAS_FEEDRATE_EDIT 1
+#endif
+
 /**
  * CoreXY, CoreXZ, and CoreYZ - and their reverse
  */
 #if ANY(COREXY, COREYX)
   #define CORE_IS_XY 1
 #endif
 #if ANY(COREXZ, COREZX)
   #define CORE_IS_XZ 1
 #endif
 #if ANY(COREYZ, COREZY)

commit 10782c770d683233bbe0d8399b080adc6f8e2ede
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Thu Nov 9 15:44:02 2023 -0800

    ü©π Probe XY Offset followup (#26397)
    
    Followup to #26267

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2706ca5070..a252edfb4a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1458,22 +1458,22 @@
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef USE_PROBE_FOR_Z_HOMING
   #undef Z_MIN_PROBE_REPEATABILITY_TEST
   #undef HOMING_Z_WITH_PROBE
   #undef Z_CLEARANCE_MULTI_PROBE
   #undef Z_PROBE_ERROR_TOLERANCE
   #undef MULTIPLE_PROBING
   #undef EXTRA_PROBING
-  #undef Z_PROBE_OFFSET_RANGE_MIN
-  #undef Z_PROBE_OFFSET_RANGE_MAX
+  #undef PROBE_OFFSET_ZMIN
+  #undef PROBE_OFFSET_ZMAX
   #undef PAUSE_BEFORE_DEPLOY_STOW
   #undef PAUSE_PROBE_DEPLOY_WHEN_TRIGGERED
   #undef PROBING_HEATERS_OFF
   #undef WAIT_FOR_BED_HEATER
   #undef WAIT_FOR_HOTEND
   #undef PROBING_STEPPERS_OFF
   #undef DELAY_BEFORE_PROBING
   #undef PREHEAT_BEFORE_PROBING
   #undef PROBING_NOZZLE_TEMP
   #undef PROBING_BED_TEMP

commit 6a35ab6557f8450845379c90724dc14b55be4b0c
Author: Marcio T <mlt4356-github@yahoo.com>
Date:   Sat Oct 14 22:54:54 2023 -0600

    ‚ú® Z_PROBE_ERROR_TOLERANCE (expose) (#26229)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 6d45a6c309..2706ca5070 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1438,52 +1438,58 @@
   #endif
   #if ANY(Z_PROBE_ALLEN_KEY, MAG_MOUNTED_PROBE)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #ifndef Z_CLEARANCE_BETWEEN_PROBES
     #define Z_CLEARANCE_BETWEEN_PROBES 5
   #endif
   #ifndef Z_CLEARANCE_MULTI_PROBE
     #define Z_CLEARANCE_MULTI_PROBE 5
   #endif
+  #ifndef Z_PROBE_ERROR_TOLERANCE
+    #define Z_PROBE_ERROR_TOLERANCE Z_CLEARANCE_MULTI_PROBE
+  #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef USE_PROBE_FOR_Z_HOMING
   #undef Z_MIN_PROBE_REPEATABILITY_TEST
   #undef HOMING_Z_WITH_PROBE
   #undef Z_CLEARANCE_MULTI_PROBE
+  #undef Z_PROBE_ERROR_TOLERANCE
   #undef MULTIPLE_PROBING
   #undef EXTRA_PROBING
-  #undef Z_CLEARANCE_DEPLOY_PROBE
   #undef Z_PROBE_OFFSET_RANGE_MIN
   #undef Z_PROBE_OFFSET_RANGE_MAX
   #undef PAUSE_BEFORE_DEPLOY_STOW
   #undef PAUSE_PROBE_DEPLOY_WHEN_TRIGGERED
   #undef PROBING_HEATERS_OFF
   #undef WAIT_FOR_BED_HEATER
   #undef WAIT_FOR_HOTEND
   #undef PROBING_STEPPERS_OFF
   #undef DELAY_BEFORE_PROBING
   #undef PREHEAT_BEFORE_PROBING
   #undef PROBING_NOZZLE_TEMP
   #undef PROBING_BED_TEMP
   #undef NOZZLE_TO_PROBE_OFFSET
 #endif
 
+#ifndef Z_CLEARANCE_DEPLOY_PROBE
+  #define Z_CLEARANCE_DEPLOY_PROBE 10
+#endif
 #ifndef Z_PROBE_LOW_POINT
   #define Z_PROBE_LOW_POINT -5
 #endif
 
 #if ENABLED(BELTPRINTER) && !defined(HOME_Y_BEFORE_X)
   #define HOME_Y_BEFORE_X
 #endif
 
 #if Z_HOME_TO_MAX && DISABLED(Z_SAFE_HOMING)
   #define HOME_Z_FIRST // If homing away from BED do Z first

commit d695e5f7bc409bc3d8ede798db5205c2c6a162f1
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Oct 12 12:56:44 2023 -0500

    üîß Misc. probe opts

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9693ed4c43..6d45a6c309 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1432,35 +1432,60 @@
   #endif
   #if Z_HOME_TO_MIN && (!NEED_Z_MIN_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if ANY(Z_PROBE_ALLEN_KEY, MAG_MOUNTED_PROBE)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
-  #ifndef Z_PROBE_LOW_POINT
-    #define Z_PROBE_LOW_POINT -5
+  #ifndef Z_CLEARANCE_BETWEEN_PROBES
+    #define Z_CLEARANCE_BETWEEN_PROBES 5
+  #endif
+  #ifndef Z_CLEARANCE_MULTI_PROBE
+    #define Z_CLEARANCE_MULTI_PROBE 5
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef USE_PROBE_FOR_Z_HOMING
   #undef Z_MIN_PROBE_REPEATABILITY_TEST
+  #undef HOMING_Z_WITH_PROBE
+  #undef Z_CLEARANCE_MULTI_PROBE
+  #undef MULTIPLE_PROBING
+  #undef EXTRA_PROBING
+  #undef Z_CLEARANCE_DEPLOY_PROBE
+  #undef Z_PROBE_OFFSET_RANGE_MIN
+  #undef Z_PROBE_OFFSET_RANGE_MAX
+  #undef PAUSE_BEFORE_DEPLOY_STOW
+  #undef PAUSE_PROBE_DEPLOY_WHEN_TRIGGERED
+  #undef PROBING_HEATERS_OFF
+  #undef WAIT_FOR_BED_HEATER
+  #undef WAIT_FOR_HOTEND
+  #undef PROBING_STEPPERS_OFF
+  #undef DELAY_BEFORE_PROBING
+  #undef PREHEAT_BEFORE_PROBING
+  #undef PROBING_NOZZLE_TEMP
+  #undef PROBING_BED_TEMP
+  #undef NOZZLE_TO_PROBE_OFFSET
+#endif
+
+#ifndef Z_PROBE_LOW_POINT
+  #define Z_PROBE_LOW_POINT -5
 #endif
 
 #if ENABLED(BELTPRINTER) && !defined(HOME_Y_BEFORE_X)
   #define HOME_Y_BEFORE_X
 #endif
 
 #if Z_HOME_TO_MAX && DISABLED(Z_SAFE_HOMING)
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 

commit b58d5dabf8939658334db3e0d98c03b1b934df7c
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Sun Oct 8 18:07:09 2023 -0700

    üîß BTT_MINI_12864_V1 => BTT_MINI_12864 (#26160)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2e51e3db6a..9693ed4c43 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -28,22 +28,22 @@
 
 #if ENABLED(SDSUPPORT)
   #define HAS_MEDIA 1
 #endif
 
 // MKS_LCD12864A/B is a variant of MKS_MINI_12864
 #if ANY(MKS_LCD12864A, MKS_LCD12864B)
   #define MKS_MINI_12864
 #endif
 
-// MKS_MINI_12864_V3 and BTT_MINI_12864_V1 are identical to FYSETC_MINI_12864_2_1
-#if ANY(MKS_MINI_12864_V3, BTT_MINI_12864_V1)
+// MKS_MINI_12864_V3 and BTT_MINI_12864 have identical pinouts to FYSETC_MINI_12864_2_1
+#if ANY(MKS_MINI_12864_V3, BTT_MINI_12864)
   #define FYSETC_MINI_12864_2_1
 #endif
 
 // Old settings are now conditional on DGUS_LCD_UI
 #if DGUS_UI_IS(ORIGIN)
   #define DGUS_LCD_UI_ORIGIN 1
 #elif DGUS_UI_IS(FYSETC)
   #define DGUS_LCD_UI_FYSETC 1
 #elif DGUS_UI_IS(HIPRECY)
   #define DGUS_LCD_UI_HIPRECY 1

commit be031e18509884c42051fba6849af06e089e383f
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Oct 3 14:57:07 2023 -0500

    üìù More ExtUI documentation

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b069e2d2b1..2e51e3db6a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -483,21 +483,21 @@
 // Aliases for LCD features
 #if !DGUS_UI_IS(NONE) || ENABLED(ANYCUBIC_LCD_VYPER)
   #define HAS_DGUS_LCD 1
   #if DGUS_UI_IS(ORIGIN, FYSETC, HIPRECY, MKS)
     #define HAS_DGUS_LCD_CLASSIC 1
   #endif
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT, TOUCH_UI_FTDI_EVE)
-  #define IS_EXTUI 1
+  #define IS_EXTUI 1 // Just for sanity check.
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if ANY(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
   #define HAS_DWIN_E3V2_BASIC 1
 #endif
 #if ANY(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif

commit bed26734a28175f7ef9669d5190bf7ebc6227223
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Aug 1 23:03:06 2023 -0500

    üîß More endstops refactoring (#25758)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 084a3d74e9..b069e2d2b1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1415,38 +1415,40 @@
     #define W_HOME_TO_MAX 1
   #elif W_HOME_DIR < 0
     #define W_HOME_TO_MIN 1
   #endif
 #endif
 
 /**
  * Conditionals based on the type of Bed Probe
  */
 #if HAS_BED_PROBE
-  #if DISABLED(NOZZLE_AS_PROBE)
-    #define HAS_PROBE_XY_OFFSET 1
-  #endif
   #if ALL(DELTA, SENSORLESS_PROBING)
     #define HAS_DELTA_SENSORLESS_PROBING 1
+  #else
+    #define HAS_REAL_BED_PROBE 1
   #endif
-  #if NONE(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN, HAS_DELTA_SENSORLESS_PROBING)
-    #define USE_Z_MIN_PROBE 1
+  #if HAS_REAL_BED_PROBE && NONE(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN, Z_SPI_SENSORLESS)
+    #define NEED_Z_MIN_PROBE_PIN 1
   #endif
-  #if Z_HOME_TO_MIN && (DISABLED(USE_Z_MIN_PROBE) || ENABLED(USE_PROBE_FOR_Z_HOMING))
+  #if Z_HOME_TO_MIN && (!NEED_Z_MIN_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
-  #ifndef Z_PROBE_LOW_POINT
-    #define Z_PROBE_LOW_POINT -5
+  #if DISABLED(NOZZLE_AS_PROBE)
+    #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if ANY(Z_PROBE_ALLEN_KEY, MAG_MOUNTED_PROBE)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
+  #ifndef Z_PROBE_LOW_POINT
+    #define Z_PROBE_LOW_POINT -5
+  #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN

commit a0e3dea8b879aba8e0d2d7e4dc6a6447b3fe76ad
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Jul 20 20:25:39 2023 -0500

    üö∏ ColorUI Touch Calibrate in CW order

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 01bc2805d9..084a3d74e9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1775,34 +1775,36 @@
 #if ANY(TFT_320x240, TFT_320x240_SPI)
   #define HAS_UI_320x240 1
 #elif ANY(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
 #elif ANY(TFT_480x272, TFT_480x272_SPI)
   #define HAS_UI_480x272 1
 #elif ANY(TFT_1024x600_LTDC, TFT_1024x600_SIM)
   #define HAS_UI_1024x600 1
 #endif
 
+// Number of text lines the screen can display (may depend on font used)
+// Touch screens leave space for extra buttons at the bottom
 #if ANY(HAS_UI_320x240, HAS_UI_480x272)
   #if ENABLED(TFT_COLOR_UI_PORTRAIT)
-    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 8, 9) // Fewer lines with touch buttons onscreen
+    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 8, 9)
   #else
-    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
+    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
   #endif
 #elif HAS_UI_480x320
   #if ENABLED(TFT_COLOR_UI_PORTRAIT)
-    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 9, 10) // Fewer lines with touch buttons onscreen
+    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 9, 10)
   #else
-    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
+    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
   #endif
 #elif HAS_UI_1024x600
-  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen
+  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13)
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN)
   #if TOUCH_IDLE_SLEEP_MINS
     #define HAS_TOUCH_SLEEP 1
   #endif
   #if NONE(TFT_TOUCH_DEVICE_GT911, TFT_TOUCH_DEVICE_XPT2046)
     #define TFT_TOUCH_DEVICE_XPT2046          // ADS7843/XPT2046 ADC Touchscreen such as ILI9341 2.8
   #endif

commit 244de2458ac6fd48f3031d0179ca1bcad6808583
Author: Alexander Gavrilenko <jmz52@users.noreply.github.com>
Date:   Mon Jul 17 10:53:36 2023 +0300

    üßë‚Äçüíª Improve TFT Color UI layout / theme (#26077)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b052021bb7..01bc2805d9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1774,26 +1774,33 @@
 
 #if ANY(TFT_320x240, TFT_320x240_SPI)
   #define HAS_UI_320x240 1
 #elif ANY(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
 #elif ANY(TFT_480x272, TFT_480x272_SPI)
   #define HAS_UI_480x272 1
 #elif ANY(TFT_1024x600_LTDC, TFT_1024x600_SIM)
   #define HAS_UI_1024x600 1
 #endif
-#if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
+
+#if ANY(HAS_UI_320x240, HAS_UI_480x272)
   #if ENABLED(TFT_COLOR_UI_PORTRAIT)
     #define LCD_HEIGHT TERN(TOUCH_SCREEN, 8, 9) // Fewer lines with touch buttons onscreen
   #else
     #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
   #endif
+#elif HAS_UI_480x320
+  #if ENABLED(TFT_COLOR_UI_PORTRAIT)
+    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 9, 10) // Fewer lines with touch buttons onscreen
+  #else
+    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
+  #endif
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN)
   #if TOUCH_IDLE_SLEEP_MINS
     #define HAS_TOUCH_SLEEP 1
   #endif
   #if NONE(TFT_TOUCH_DEVICE_GT911, TFT_TOUCH_DEVICE_XPT2046)

commit 929497d52762f87243d1b521d9703f75b7501aa4
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Tue Jul 4 14:07:56 2023 -0700

    üìù Update config URLs (#26049)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 341c9d0bc0..b052021bb7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -447,21 +447,21 @@
 #ifndef ENCODER_STEPS_PER_MENU_ITEM
   #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
 #endif
 #ifndef ENCODER_FEEDRATE_DEADZONE
   #define ENCODER_FEEDRATE_DEADZONE 6
 #endif
 
 // Shift register panels
 // ---------------------
 // 2 wire Non-latching LCD SR from:
-// https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
+// https://github.com/fmalpartida/New-LiquidCrystal/wiki/schematics#user-content-ShiftRegister_connection
 #if ENABLED(FF_INTERFACEBOARD)
   #define SR_LCD_3W_NL    // Non latching 3 wire shift register
   #define IS_ULTIPANEL 1
 #elif ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define IS_ULTIPANEL 1
 #elif ENABLED(ULTIPANEL)
   #define IS_ULTIPANEL 1
 #endif
 

commit 3ea87ad54c1e445a1c8cfef1489809edae5decb3
Author: Alexander Gavrilenko <jmz52@users.noreply.github.com>
Date:   Sun Jul 2 04:16:12 2023 +0300

    ‚ú® SPI TFT / Touchscreen for STM32H7 (#25784)
    
    Co-authored-by: thisiskeithb <13375512+thisiskeithb@users.noreply.github.com>
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index bfc5bfd0ff..341c9d0bc0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -526,20 +526,34 @@
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif IS_DWIN_MARLINUI
     // Since HAS_MARLINUI_U8GLIB refers to U8G displays
     // the DWIN display can define its own flags
   #elif !HAS_GRAPHICAL_TFT
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
 #if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
+  /**
+   * HAS_DISPLAY indicates the display uses these MarlinUI methods...
+   *  - update
+   *  - abort_print
+   *  - pause_print
+   *  - resume_print
+   *  - poweroff        (for PSU_CONTROL and HAS_MARLINUI_MENU)
+   *
+   *  ...and implements these MarlinUI methods:
+   *  - zoffset_overlay (if BABYSTEP_GFX_OVERLAY or MESH_EDIT_GFX_OVERLAY are supported)
+   *  - draw_kill_screen
+   *  - kill_screen
+   *  - draw_status_message
+   */
   #define HAS_DISPLAY 1
 #endif
 
 #if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
   #define HAS_LCDPRINT 1
 #endif
 
 #if HAS_DISPLAY || HAS_LCDPRINT
   #define HAS_UTF8_UTILS 1
 #endif

commit b77e2a5020714ad17fc12052093231ad4520ce14
Author: Christophe Huriaux <c.huriaux@gmail.com>
Date:   Sat Jul 1 06:06:08 2023 +0200

    ‚ú® Ender 3 S1 Pro/Plus stock touchscreen (#25905)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0ab42cb22f..bfc5bfd0ff 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -46,20 +46,22 @@
 #elif DGUS_UI_IS(FYSETC)
   #define DGUS_LCD_UI_FYSETC 1
 #elif DGUS_UI_IS(HIPRECY)
   #define DGUS_LCD_UI_HIPRECY 1
 #elif DGUS_UI_IS(MKS)
   #define DGUS_LCD_UI_MKS 1
 #elif DGUS_UI_IS(RELOADED)
   #define DGUS_LCD_UI_RELOADED 1
 #elif DGUS_UI_IS(IA_CREALITY)
   #define DGUS_LCD_UI_IA_CREALITY 1
+#elif DGUS_UI_IS(E3S1PRO)
+  #define DGUS_LCD_UI_E3S1PRO 1
 #endif
 
 /**
  * General Flags that may be set below by specific LCDs
  *
  *  DOGLCD                  : Run a Graphical LCD through U8GLib (with MarlinUI)
  *  IS_ULTIPANEL            : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
  *  HAS_WIRED_LCD           : Ultra LCD, not necessarily Ultipanel.
  *  IS_RRD_SC               : Common RRD Smart Controller digital interface pins
  *  IS_RRD_FG_SC            : Common RRD Full Graphical Smart Controller digital interface pins

commit 574dd34c49fde76e1e736b8a7e1ea579d724ff22
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Jun 27 13:19:36 2023 -0500

    ‚ôªÔ∏è String helper class (#24390)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b33720b2a5..0ab42cb22f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -535,21 +535,21 @@
 #endif
 
 #if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
   #define HAS_LCDPRINT 1
 #endif
 
 #if HAS_DISPLAY || HAS_LCDPRINT
   #define HAS_UTF8_UTILS 1
 #endif
 
-#if HAS_DISPLAY || HAS_DWIN_E3V2
+#if ANY(HAS_DISPLAY, HAS_DWIN_E3V2)
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_MARLINUI_MENU 1
 #endif
 
 #if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
   #define HAS_MANUAL_MOVE_MENU 1
 #endif

commit ac954b57f764cf958000314efc20b725c2b8e054
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Fri Jun 2 20:50:45 2023 -0700

    ü©π Endstop hit state followup (#25885)
    
    Followup to #25574

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f2b5016272..b33720b2a5 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -826,22 +826,22 @@
         #endif
       #endif
     #endif
   #endif
 #endif
 
 #if !HAS_X_AXIS
   #undef AVOID_OBSTACLES
   #undef ENDSTOPPULLUP_XMIN
   #undef ENDSTOPPULLUP_XMAX
-  #undef X_MIN_ENDSTOP_INVERTING
-  #undef X_MAX_ENDSTOP_INVERTING
+  #undef X_MIN_ENDSTOP_HIT_STATE
+  #undef X_MAX_ENDSTOP_HIT_STATE
   #undef X2_DRIVER_TYPE
   #undef X_ENABLE_ON
   #undef DISABLE_X
   #undef INVERT_X_DIR
   #undef X_HOME_DIR
   #undef X_MIN_POS
   #undef X_MAX_POS
   #undef MANUAL_X_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOPS
   #undef MAX_SOFTWARE_ENDSTOPS

commit 86c811660ebf0b3fcbae2f34273d4c9d0c22abc4
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Jun 2 14:30:34 2023 -0500

    üßë‚Äçüíª Remove LOOP macros (#25917)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e5cbc83459..f2b5016272 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1489,21 +1489,21 @@
 #endif
 #if !HAS_LEVELING || ANY(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
   #undef PROBE_MANUALLY
 #endif
 #if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
   #define PROBE_SELECTED 1
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
-  #define GRID_LOOP(A,B) LOOP_L_N(A, GRID_MAX_POINTS_X) LOOP_L_N(B, GRID_MAX_POINTS_Y)
+  #define GRID_LOOP(A,B) for (uint8_t A = 0; A < GRID_MAX_POINTS_X; ++A) for (uint8_t B = 0; B < GRID_MAX_POINTS_Y; ++B)
 #endif
 
 // Slim menu optimizations
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 /**
  * CoreXY, CoreXZ, and CoreYZ - and their reverse
  */

commit 2691167afe02fbbe74b0fdca2c28a49fac635741
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Jun 2 14:26:02 2023 -0500

    üßë‚Äçüíª Dump BOTH and EITHER macros (#25908)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5b64338662..e5cbc83459 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -24,26 +24,26 @@
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
 #if ENABLED(SDSUPPORT)
   #define HAS_MEDIA 1
 #endif
 
 // MKS_LCD12864A/B is a variant of MKS_MINI_12864
-#if EITHER(MKS_LCD12864A, MKS_LCD12864B)
+#if ANY(MKS_LCD12864A, MKS_LCD12864B)
   #define MKS_MINI_12864
 #endif
 
 // MKS_MINI_12864_V3 and BTT_MINI_12864_V1 are identical to FYSETC_MINI_12864_2_1
-#if EITHER(MKS_MINI_12864_V3, BTT_MINI_12864_V1)
+#if ANY(MKS_MINI_12864_V3, BTT_MINI_12864_V1)
   #define FYSETC_MINI_12864_2_1
 #endif
 
 // Old settings are now conditional on DGUS_LCD_UI
 #if DGUS_UI_IS(ORIGIN)
   #define DGUS_LCD_UI_ORIGIN 1
 #elif DGUS_UI_IS(FYSETC)
   #define DGUS_LCD_UI_FYSETC 1
 #elif DGUS_UI_IS(HIPRECY)
   #define DGUS_LCD_UI_HIPRECY 1
@@ -63,34 +63,34 @@
  *  HAS_WIRED_LCD           : Ultra LCD, not necessarily Ultipanel.
  *  IS_RRD_SC               : Common RRD Smart Controller digital interface pins
  *  IS_RRD_FG_SC            : Common RRD Full Graphical Smart Controller digital interface pins
  *  IS_U8GLIB_ST7920        : Most common DOGM display SPI interface, supporting a "lightweight" display mode.
  *  U8GLIB_SH1106           : SH1106 OLED with I2C interface via U8GLib
  *  IS_U8GLIB_SSD1306       : SSD1306 OLED with I2C interface via U8GLib (U8GLIB_SSD1306)
  *  U8GLIB_SSD1309          : SSD1309 OLED with I2C interface via U8GLib (HAS_U8GLIB_I2C_OLED, HAS_WIRED_LCD, DOGLCD)
  *  IS_U8GLIB_ST7565_64128N : ST7565 128x64 LCD with SPI interface via U8GLib
  *  IS_U8GLIB_LM6059_AF     : LM6059 with Hardware SPI via U8GLib
  */
-#if EITHER(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
+#if ANY(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
 
   #define MINIPANEL
 
 #elif ENABLED(YHCB2004)
 
   #define IS_ULTIPANEL 1
 
 #elif ENABLED(CARTESIO_UI)
 
   #define DOGLCD
   #define IS_ULTIPANEL 1
 
-#elif EITHER(DWIN_MARLINUI_PORTRAIT, DWIN_MARLINUI_LANDSCAPE)
+#elif ANY(DWIN_MARLINUI_PORTRAIT, DWIN_MARLINUI_LANDSCAPE)
 
   #define IS_DWIN_MARLINUI 1
   #define IS_ULTIPANEL 1
 
 #elif ENABLED(ZONESTAR_LCD)
 
   #define HAS_ADC_BUTTONS 1
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
   #define IS_ULTIPANEL 1
@@ -209,21 +209,21 @@
   #ifndef PCA9632
     #define PCA9632
   #endif
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
   #define IS_RRD_SC 1
   #define LCD_WIDTH 16
   #define LCD_HEIGHT 2
 
-#elif EITHER(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
+#elif ANY(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
 
   #define IS_TFTGLCD_PANEL 1
   #define IS_ULTIPANEL 1                    // Note that IS_ULTIPANEL leads to HAS_WIRED_LCD
 
   #if HAS_MEDIA && DISABLED(LCD_PROGRESS_BAR)
     #define LCD_PROGRESS_BAR
   #endif
   #if ENABLED(TFTGLCD_PANEL_I2C)
     #define LCD_I2C_ADDRESS           0x33  // Must be 0x33 for STM32 main boards and equal to panel's I2C slave address
   #endif
@@ -239,21 +239,21 @@
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define IS_RRD_FG_SC 1
   #define LCD_ST7920_DELAY_1           125
   #define LCD_ST7920_DELAY_2           125
   #define LCD_ST7920_DELAY_3           125
 
-#elif EITHER(ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING)
+#elif ANY(ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING)
 
   #define IS_RRD_FG_SC 1
   #define LCD_ST7920_DELAY_1           150
   #define LCD_ST7920_DELAY_2           150
   #define LCD_ST7920_DELAY_3           150
 
 #elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, BQ_LCD_SMART_CONTROLLER, K3D_FULL_GRAPHIC_SMART_CONTROLLER)
 
   #define IS_RRD_FG_SC 1
 
@@ -269,21 +269,21 @@
 #endif
 
 // ST7920-based graphical displays
 #if ANY(IS_RRD_FG_SC, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
   #define IS_U8GLIB_ST7920 1
   #define IS_RRD_SC 1
 #endif
 
 // ST7565 / 64128N graphical displays
-#if EITHER(MAKRPANEL, MINIPANEL)
+#if ANY(MAKRPANEL, MINIPANEL)
   #define IS_ULTIPANEL 1
   #define DOGLCD
   #if ENABLED(MAKRPANEL)
     #define IS_U8GLIB_ST7565_64128N 1
   #endif
 #endif
 
 #if ENABLED(IS_U8GLIB_SSD1306)
   #define U8GLIB_SSD1306
 #endif
@@ -330,25 +330,25 @@
 
 // TFT Legacy options masquerade as TFT_GENERIC
 #if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
   #define IS_LEGACY_TFT 1
   #define TFT_GENERIC
   #if ANY(FSMC_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_LVGL_UI_FSMC)
     #define TFT_INTERFACE_FSMC
   #elif ANY(SPI_GRAPHICAL_TFT, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_SPI)
     #define TFT_INTERFACE_SPI
   #endif
-  #if EITHER(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
+  #if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
     #define TFT_CLASSIC_UI
   #elif ANY(TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI)
     #define TFT_COLOR_UI
-  #elif EITHER(TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
+  #elif ANY(TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
     #define TFT_LVGL_UI
   #endif
 #endif
 
 // FSMC/SPI TFT Panels (LVGL)
 #if ENABLED(TFT_LVGL_UI)
   #define HAS_TFT_LVGL_UI 1
   #define SERIAL_RUNTIME_HOOK 1
 #endif
 
@@ -380,21 +380,21 @@
   #define STD_ENCODER_PULSES_PER_STEP 4
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
   #if ENABLED(LCD_I2C_PANELOLU2)  // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
     #define LCD_I2C_TYPE_MCP23017 // I2C Character-based 12864 display
     #define LCD_I2C_ADDRESS 0x20  // I2C Address of the port expander
     #define LCD_USE_I2C_BUZZER    // Enable buzzer on LCD (optional)
     #define IS_ULTIPANEL 1
   #endif
 
-#elif EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
+#elif ANY(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575    // I2C Character-based 12864 display
   #define LCD_I2C_ADDRESS 0x27    // I2C Address of the port expander
   #define IS_ULTIPANEL 1
 
   #if ENABLED(LCD_SAINSMART_I2C_2004)
     #define LCD_WIDTH 20
     #define LCD_HEIGHT 4
   #endif
 
@@ -418,21 +418,21 @@
   #define STD_ENCODER_PULSES_PER_STEP 1
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(G3D_PANEL)
 
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #endif
 
-#if EITHER(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008) && DISABLED(NO_LCD_DETECT)
+#if ANY(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008) && DISABLED(NO_LCD_DETECT)
   #define DETECT_I2C_LCD_DEVICE 1
 #endif
 
 #ifndef STD_ENCODER_PULSES_PER_STEP
   #if ENABLED(TOUCH_SCREEN)
     #define STD_ENCODER_PULSES_PER_STEP 2
   #else
     #define STD_ENCODER_PULSES_PER_STEP 5
   #endif
 #endif
@@ -456,29 +456,29 @@
 #if ENABLED(FF_INTERFACEBOARD)
   #define SR_LCD_3W_NL    // Non latching 3 wire shift register
   #define IS_ULTIPANEL 1
 #elif ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define IS_ULTIPANEL 1
 #elif ENABLED(ULTIPANEL)
   #define IS_ULTIPANEL 1
 #endif
 
-#if EITHER(IS_ULTIPANEL, ULTRA_LCD)
+#if ANY(IS_ULTIPANEL, ULTRA_LCD)
   #define HAS_WIRED_LCD 1
 #endif
 
-#if EITHER(IS_ULTIPANEL, REPRAPWORLD_KEYPAD)
+#if ANY(IS_ULTIPANEL, REPRAPWORLD_KEYPAD)
   #define IS_NEWPANEL 1
 #endif
 
-#if EITHER(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
+#if ANY(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
   #define IS_RRW_KEYPAD 1
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
 #if !DGUS_UI_IS(NONE) || ENABLED(ANYCUBIC_LCD_VYPER)
   #define HAS_DGUS_LCD 1
   #if DGUS_UI_IS(ORIGIN, FYSETC, HIPRECY, MKS)
@@ -486,24 +486,24 @@
   #endif
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT, TOUCH_UI_FTDI_EVE)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
-#if EITHER(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
+#if ANY(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
   #define HAS_DWIN_E3V2_BASIC 1
 #endif
-#if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
+#if ANY(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
 #endif
 
@@ -632,24 +632,24 @@
   #undef PREVENT_LENGTHY_EXTRUDE
   #undef FILAMENT_RUNOUT_SENSOR
   #undef FILAMENT_RUNOUT_DISTANCE_MM
   #undef DISABLE_OTHER_EXTRUDERS
 #endif
 
 #define E_OPTARG(N) OPTARG(HAS_MULTI_EXTRUDER, N)
 #define E_TERN_(N)  TERN_(HAS_MULTI_EXTRUDER, N)
 #define E_TERN0(N)  TERN0(HAS_MULTI_EXTRUDER, N)
 
-#if EITHER(SWITCHING_EXTRUDER, MECHANICAL_SWITCHING_EXTRUDER)
+#if ANY(SWITCHING_EXTRUDER, MECHANICAL_SWITCHING_EXTRUDER)
   #define HAS_SWITCHING_EXTRUDER 1
 #endif
-#if EITHER(SWITCHING_NOZZLE, MECHANICAL_SWITCHING_NOZZLE)
+#if ANY(SWITCHING_NOZZLE, MECHANICAL_SWITCHING_NOZZLE)
   #define HAS_SWITCHING_NOZZLE 1
 #endif
 
 #if ENABLED(E_DUAL_STEPPER_DRIVERS) // E0/E1 steppers act in tandem as E0
 
   #define E_STEPPERS      2
   #define E_MANUAL        1
 
 #elif HAS_SWITCHING_EXTRUDER        // One stepper for every two EXTRUDERS
 
@@ -693,28 +693,28 @@
 
 // Default E steppers / manual motion is one per extruder
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
 // Number of hotends...
-#if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)               // Only one for singlenozzle or mixing extruder
+#if ANY(SINGLENOZZLE, MIXING_EXTRUDER)                // Only one for singlenozzle or mixing extruder
   #define HOTENDS 1
-#elif HAS_SWITCHING_EXTRUDER && !HAS_SWITCHING_NOZZLE   // One for each pair of abstract "extruders"
+#elif HAS_SWITCHING_EXTRUDER && !HAS_SWITCHING_NOZZLE // One for each pair of abstract "extruders"
   #define HOTENDS E_STEPPERS
 #elif TEMP_SENSOR_0
-  #define HOTENDS EXTRUDERS                             // One per extruder if at least one heater exists
+  #define HOTENDS EXTRUDERS                           // One per extruder if at least one heater exists
 #else
-  #define HOTENDS 0                                     // A machine with no hotends at all can still extrude
+  #define HOTENDS 0                                   // A machine with no hotends at all can still extrude
 #endif
 
 // More than one hotend...
 #if HOTENDS > 1
   #define HAS_MULTI_HOTEND 1
   #define HAS_HOTEND_OFFSET 1
   #ifndef HOTEND_OFFSET_X
     #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
   #endif
   #ifndef HOTEND_OFFSET_Y
@@ -1097,21 +1097,21 @@
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_N_1(EXTRUDERS, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
 #define ARRAY_BY_HOTENDS1(v1) ARRAY_N_1(HOTENDS, v1)
 
 /**
  * Disable unused SINGLENOZZLE sub-options
  */
 #if DISABLED(SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_TEMP
 #endif
-#if !BOTH(HAS_FAN, SINGLENOZZLE)
+#if !ALL(HAS_FAN, SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_FAN
 #endif
 
 // Switching extruder has its own servo?
 #if ENABLED(SWITCHING_EXTRUDER) && (!HAS_SWITCHING_NOZZLE || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
   #define DO_SWITCH_EXTRUDER 1
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
@@ -1402,33 +1402,33 @@
   #endif
 #endif
 
 /**
  * Conditionals based on the type of Bed Probe
  */
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
-  #if BOTH(DELTA, SENSORLESS_PROBING)
+  #if ALL(DELTA, SENSORLESS_PROBING)
     #define HAS_DELTA_SENSORLESS_PROBING 1
   #endif
   #if NONE(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN, HAS_DELTA_SENSORLESS_PROBING)
     #define USE_Z_MIN_PROBE 1
   #endif
   #if Z_HOME_TO_MIN && (DISABLED(USE_Z_MIN_PROBE) || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
-  #if EITHER(Z_PROBE_ALLEN_KEY, MAG_MOUNTED_PROBE)
+  #if ANY(Z_PROBE_ALLEN_KEY, MAG_MOUNTED_PROBE)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
@@ -1444,104 +1444,104 @@
 
 #if Z_HOME_TO_MAX && DISABLED(Z_SAFE_HOMING)
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 
 /**
  * Conditionals based on the type of Bed Leveling
  */
 #if ENABLED(AUTO_BED_LEVELING_UBL)
   #undef LCD_BED_LEVELING
-  #if EITHER(DELTA, SEGMENT_LEVELED_MOVES)
+  #if ANY(DELTA, SEGMENT_LEVELED_MOVES)
     #define UBL_SEGMENTED 1
   #endif
 #endif
-#if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_3POINT)
+#if ANY(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_3POINT)
   #define ABL_PLANAR 1
 #endif
-#if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR)
+#if ANY(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR)
   #define ABL_USES_GRID 1
 #endif
 #if ANY(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_3POINT)
   #define HAS_ABL_NOT_UBL 1
 #endif
 #if ANY(AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_UBL, MESH_BED_LEVELING)
   #define HAS_MESH 1
 #endif
-#if EITHER(AUTO_BED_LEVELING_UBL, AUTO_BED_LEVELING_3POINT)
+#if ANY(AUTO_BED_LEVELING_UBL, AUTO_BED_LEVELING_3POINT)
   #define NEEDS_THREE_PROBE_POINTS 1
 #endif
-#if EITHER(HAS_ABL_NOT_UBL, AUTO_BED_LEVELING_UBL)
+#if ANY(HAS_ABL_NOT_UBL, AUTO_BED_LEVELING_UBL)
   #define HAS_ABL_OR_UBL 1
   #if DISABLED(PROBE_MANUALLY)
     #define HAS_AUTOLEVEL 1
   #endif
 #endif
-#if EITHER(HAS_ABL_OR_UBL, MESH_BED_LEVELING)
+#if ANY(HAS_ABL_OR_UBL, MESH_BED_LEVELING)
   #define HAS_LEVELING 1
   #if DISABLED(AUTO_BED_LEVELING_UBL)
     #define PLANNER_LEVELING 1
   #endif
 #endif
 #if !HAS_LEVELING
   #undef RESTORE_LEVELING_AFTER_G28
   #undef ENABLE_LEVELING_AFTER_G28
   #undef G29_RETRY_AND_RECOVER
 #endif
-#if !HAS_LEVELING || EITHER(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
+#if !HAS_LEVELING || ANY(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
   #undef PROBE_MANUALLY
 #endif
 #if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
   #define PROBE_SELECTED 1
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
   #define GRID_LOOP(A,B) LOOP_L_N(A, GRID_MAX_POINTS_X) LOOP_L_N(B, GRID_MAX_POINTS_Y)
 #endif
 
 // Slim menu optimizations
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 /**
  * CoreXY, CoreXZ, and CoreYZ - and their reverse
  */
-#if EITHER(COREXY, COREYX)
+#if ANY(COREXY, COREYX)
   #define CORE_IS_XY 1
 #endif
-#if EITHER(COREXZ, COREZX)
+#if ANY(COREXZ, COREZX)
   #define CORE_IS_XZ 1
 #endif
-#if EITHER(COREYZ, COREZY)
+#if ANY(COREYZ, COREZY)
   #define CORE_IS_YZ 1
 #endif
 #if CORE_IS_XY || CORE_IS_XZ || CORE_IS_YZ
   #define IS_CORE 1
 #endif
 #if IS_CORE
   #if CORE_IS_XY
     #define CORE_AXIS_1 A_AXIS
     #define CORE_AXIS_2 B_AXIS
     #define NORMAL_AXIS Z_AXIS
   #elif CORE_IS_XZ
     #define CORE_AXIS_1 A_AXIS
     #define NORMAL_AXIS Y_AXIS
     #define CORE_AXIS_2 C_AXIS
   #elif CORE_IS_YZ
     #define NORMAL_AXIS X_AXIS
     #define CORE_AXIS_1 B_AXIS
     #define CORE_AXIS_2 C_AXIS
   #endif
   #define CORESIGN(n) (ANY(COREYX, COREZX, COREZY) ? (-(n)) : (n))
-#elif EITHER(MARKFORGED_XY, MARKFORGED_YX)
+#elif ANY(MARKFORGED_XY, MARKFORGED_YX)
   // Markforged kinematics
   #define CORE_AXIS_1 A_AXIS
   #define CORE_AXIS_2 B_AXIS
   #define NORMAL_AXIS Z_AXIS
 #endif
 
 #if ANY(MORGAN_SCARA, MP_SCARA, AXEL_TPARA)
   #define IS_SCARA 1
   #define IS_KINEMATIC 1
 #elif ANY(DELTA, POLARGRAPH, POLAR)
@@ -1551,21 +1551,21 @@
   #if !IS_CORE
     #define IS_FULL_CARTESIAN 1
   #endif
 #endif
 
 #if DISABLED(DELTA)
   #undef DELTA_HOME_TO_SAFE_ZONE
 #endif
 
 // This flag indicates some kind of jerk storage is needed
-#if EITHER(CLASSIC_JERK, IS_KINEMATIC)
+#if ANY(CLASSIC_JERK, IS_KINEMATIC)
   #define HAS_CLASSIC_JERK 1
 #endif
 
 #if DISABLED(CLASSIC_JERK)
   #define HAS_JUNCTION_DEVIATION 1
 #endif
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
 #if HAS_EXTRUDERS && (ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE)))
   #define HAS_CLASSIC_E_JERK 1
@@ -1615,44 +1615,44 @@
  *
  * Configure parameters for TFT displays:
  *  - TFT_DEFAULT_ORIENTATION
  *  - TFT_DRIVER
  *  - TFT_WIDTH
  *  - TFT_HEIGHT
  *  - TFT_INTERFACE_(SPI|FSMC)
  *  - TFT_COLOR
  *  - GRAPHICAL_TFT_UPSCALE
  */
-#if EITHER(MKS_TS35_V2_0, BTT_TFT35_SPI_V1_0)                                 // ST7796
+#if ANY(MKS_TS35_V2_0, BTT_TFT35_SPI_V1_0)                                    // ST7796
   #define TFT_DEFAULT_DRIVER ST7796
   #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_480x320
   #define TFT_INTERFACE_SPI
-#elif EITHER(LERDGE_TFT35, ANET_ET5_TFT35)                                    // ST7796
+#elif ANY(LERDGE_TFT35, ANET_ET5_TFT35)                                       // ST7796
   #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ANY(ANET_ET4_TFT28, MKS_ROBIN_TFT24, MKS_ROBIN_TFT28, MKS_ROBIN_TFT32)  // ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
 #elif ANY(MKS_ROBIN_TFT35, TFT_TRONXY_X5SA, ANYCUBIC_TFT35)                   // ILI9488
   #define TFT_DRIVER ILI9488
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(MKS_ROBIN_TFT43)
   #define TFT_DRIVER SSD1963
   #define TFT_DEFAULT_ORIENTATION 0
   #define TFT_RES_480x272
   #define TFT_INTERFACE_FSMC
-#elif EITHER(MKS_ROBIN_TFT_V1_1R, LONGER_LK_TFT28)                            // ILI9328 or R61505
+#elif ANY(MKS_ROBIN_TFT_V1_1R, LONGER_LK_TFT28)                               // ILI9328 or R61505
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(BIQU_BX_TFT70)                                                  // RGB
   #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_1024x600
   #define TFT_INTERFACE_LTDC
   #if ENABLED(TOUCH_SCREEN)
     #define TFT_TOUCH_DEVICE_GT911
   #endif
@@ -1749,27 +1749,27 @@
     #endif
   #elif TFT_HEIGHT == 600
     #if ENABLED(TFT_INTERFACE_LTDC)
       #define TFT_1024x600_LTDC
     #else
       #define TFT_1024x600_SIM  // "Simulation" - for testing purposes only
     #endif
   #endif
 #endif
 
-#if EITHER(TFT_320x240, TFT_320x240_SPI)
+#if ANY(TFT_320x240, TFT_320x240_SPI)
   #define HAS_UI_320x240 1
-#elif EITHER(TFT_480x320, TFT_480x320_SPI)
+#elif ANY(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
-#elif EITHER(TFT_480x272, TFT_480x272_SPI)
+#elif ANY(TFT_480x272, TFT_480x272_SPI)
   #define HAS_UI_480x272 1
-#elif EITHER(TFT_1024x600_LTDC, TFT_1024x600_SIM)
+#elif ANY(TFT_1024x600_LTDC, TFT_1024x600_SIM)
   #define HAS_UI_1024x600 1
 #endif
 #if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
   #if ENABLED(TFT_COLOR_UI_PORTRAIT)
     #define LCD_HEIGHT TERN(TOUCH_SCREEN, 8, 9) // Fewer lines with touch buttons onscreen
   #else
     #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
   #endif
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen

commit 30c3daf03165c2df9966b69ce70ed5e5a75b1fdc
Author: Giuliano Zaro <3684609+GMagician@users.noreply.github.com>
Date:   Sat May 13 23:28:17 2023 +0200

    üîß No DISABLE_OTHER_EXTRUDERS if < 2 steppers (#25818)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7c67916765..5b64338662 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -674,22 +674,22 @@
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 
 #elif HAS_PRUSA_MMU2                // Pr≈Ø≈°a Multi-Material Unit v2
 
   #define E_STEPPERS      1
   #define E_MANUAL        1
 
 #endif
 
-// No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1
-#if HAS_SWITCHING_NOZZLE || HAS_PRUSA_MMU1
+// No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1 or just 1 E stepper exists
+#if HAS_SWITCHING_NOZZLE || HAS_PRUSA_MMU1 || E_STEPPERS < 2
   #undef DISABLE_OTHER_EXTRUDERS
 #endif
 
 // Pr≈Ø≈°a MMU1, MMU(S) 2.0 and EXTENDABLE_EMU_MMU2(S) force SINGLENOZZLE
 #if HAS_MMU
   #define SINGLENOZZLE
 #endif
 
 // Default E steppers / manual motion is one per extruder
 #ifndef E_STEPPERS

commit d52d26b4ef55ebb7ebc56ce5c712e4914f3aeb2a
Author: ellensp <530024+ellensp@users.noreply.github.com>
Date:   Wed May 10 08:37:34 2023 +1200

    üîß Update multi-stepper axis conditionals (#25798)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 01266354ce..7c67916765 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -796,47 +796,48 @@
   #define NUM_AXES 3
 #elif defined(Y_DRIVER_TYPE)
   #define NUM_AXES 2
 #elif defined(X_DRIVER_TYPE)
   #define NUM_AXES 1
 #else
   #define NUM_AXES 0
 #endif
 #if NUM_AXES >= 1
   #define HAS_X_AXIS 1
-#endif
-#if NUM_AXES >= XY
-  #define HAS_Y_AXIS 1
-#endif
-#if NUM_AXES >= XYZ
-  #define HAS_Z_AXIS 1
-#endif
-#if NUM_AXES >= 4
-  #define HAS_I_AXIS 1
-#endif
-#if NUM_AXES >= 5
-  #define HAS_J_AXIS 1
-#endif
-#if NUM_AXES >= 6
-  #define HAS_K_AXIS 1
-#endif
-#if NUM_AXES >= 7
-  #define HAS_U_AXIS 1
-#endif
-#if NUM_AXES >= 8
-  #define HAS_V_AXIS 1
-#endif
-#if NUM_AXES >= 9
-  #define HAS_W_AXIS 1
+  #if NUM_AXES >= XY
+    #define HAS_Y_AXIS 1
+    #if NUM_AXES >= XYZ
+      #define HAS_Z_AXIS 1
+      #if NUM_AXES >= 4
+        #define HAS_I_AXIS 1
+        #if NUM_AXES >= 5
+          #define HAS_J_AXIS 1
+          #if NUM_AXES >= 6
+            #define HAS_K_AXIS 1
+            #if NUM_AXES >= 7
+              #define HAS_U_AXIS 1
+              #if NUM_AXES >= 8
+                #define HAS_V_AXIS 1
+                #if NUM_AXES >= 9
+                  #define HAS_W_AXIS 1
+                #endif
+              #endif
+            #endif
+          #endif
+        #endif
+      #endif
+    #endif
+  #endif
 #endif
 
 #if !HAS_X_AXIS
+  #undef AVOID_OBSTACLES
   #undef ENDSTOPPULLUP_XMIN
   #undef ENDSTOPPULLUP_XMAX
   #undef X_MIN_ENDSTOP_INVERTING
   #undef X_MAX_ENDSTOP_INVERTING
   #undef X2_DRIVER_TYPE
   #undef X_ENABLE_ON
   #undef DISABLE_X
   #undef INVERT_X_DIR
   #undef X_HOME_DIR
   #undef X_MIN_POS
@@ -994,25 +995,23 @@
 #if MAP(_OR_HAS_DA, X, Y, Z, I, J, K, U, V, W) 0
   #define HAS_DISABLE_MAIN_AXES 1
 #endif
 #if HAS_DISABLE_MAIN_AXES || ENABLED(DISABLE_E)
   #define HAS_DISABLE_AXES 1
 #endif
 #undef _OR_HAS_DA
 
 #ifdef X2_DRIVER_TYPE
   #define HAS_X2_STEPPER 1
-  // Dual X Carriage isn't known yet. TODO: Consider moving it to Configuration.h.
 #endif
 #ifdef Y2_DRIVER_TYPE
   #define HAS_Y2_STEPPER 1
-  #define HAS_DUAL_Y_STEPPERS 1
 #endif
 
 /**
  * Number of Primary Linear Axes (e.g., XYZ)
  * X, XY, or XYZ axes. Excluding duplicate axes (X2, Y2, Z2, Z3, Z4)
  */
 #if NUM_AXES >= 3
   #define PRIMARY_LINEAR_AXES 3
 #else
   #define PRIMARY_LINEAR_AXES NUM_AXES

commit 1f9bfc5c7491d802d242623f8253b1f52c0917a3
Author: ellensp <530024+ellensp@users.noreply.github.com>
Date:   Wed May 10 06:59:25 2023 +1200

    üö∏ Optional X-Axis (#25418)
    
    Co-authored-by: alextrical <35117191+alextrical@users.noreply.github.com>
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 8114cb4261..01266354ce 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -789,24 +789,28 @@
 #elif defined(K_DRIVER_TYPE)
   #define NUM_AXES 6
 #elif defined(J_DRIVER_TYPE)
   #define NUM_AXES 5
 #elif defined(I_DRIVER_TYPE)
   #define NUM_AXES 4
 #elif defined(Z_DRIVER_TYPE)
   #define NUM_AXES 3
 #elif defined(Y_DRIVER_TYPE)
   #define NUM_AXES 2
-#else
+#elif defined(X_DRIVER_TYPE)
   #define NUM_AXES 1
+#else
+  #define NUM_AXES 0
+#endif
+#if NUM_AXES >= 1
+  #define HAS_X_AXIS 1
 #endif
-#define HAS_X_AXIS 1
 #if NUM_AXES >= XY
   #define HAS_Y_AXIS 1
 #endif
 #if NUM_AXES >= XYZ
   #define HAS_Z_AXIS 1
 #endif
 #if NUM_AXES >= 4
   #define HAS_I_AXIS 1
 #endif
 #if NUM_AXES >= 5
@@ -818,20 +822,37 @@
 #if NUM_AXES >= 7
   #define HAS_U_AXIS 1
 #endif
 #if NUM_AXES >= 8
   #define HAS_V_AXIS 1
 #endif
 #if NUM_AXES >= 9
   #define HAS_W_AXIS 1
 #endif
 
+#if !HAS_X_AXIS
+  #undef ENDSTOPPULLUP_XMIN
+  #undef ENDSTOPPULLUP_XMAX
+  #undef X_MIN_ENDSTOP_INVERTING
+  #undef X_MAX_ENDSTOP_INVERTING
+  #undef X2_DRIVER_TYPE
+  #undef X_ENABLE_ON
+  #undef DISABLE_X
+  #undef INVERT_X_DIR
+  #undef X_HOME_DIR
+  #undef X_MIN_POS
+  #undef X_MAX_POS
+  #undef MANUAL_X_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOPS
+  #undef MAX_SOFTWARE_ENDSTOPS
+#endif
+
 #if !HAS_Y_AXIS
   #undef AVOID_OBSTACLES
   #undef ENDSTOPPULLUP_YMIN
   #undef ENDSTOPPULLUP_YMAX
   #undef Y_MIN_ENDSTOP_HIT_STATE
   #undef Y_MAX_ENDSTOP_HIT_STATE
   #undef Y2_DRIVER_TYPE
   #undef Y_ENABLE_ON
   #undef DISABLE_Y
   #undef INVERT_Y_DIR
@@ -1311,24 +1332,26 @@
     #ifndef FIL_MOTION8_PULLUP
       #define FIL_MOTION8_PULLUP FIL_RUNOUT_PULLUP
     #endif
     #ifndef FIL_MOTION8_PULLDOWN
       #define FILMOTION8_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
 #endif // FILAMENT_SWITCH_AND_MOTION
 
 // Homing to Min or Max
-#if X_HOME_DIR > 0
-  #define X_HOME_TO_MAX 1
-#elif X_HOME_DIR < 0
-  #define X_HOME_TO_MIN 1
+#if HAS_X_AXIS
+  #if X_HOME_DIR > 0
+    #define X_HOME_TO_MAX 1
+  #elif X_HOME_DIR < 0
+    #define X_HOME_TO_MIN 1
+  #endif
 #endif
 #if HAS_Y_AXIS
   #if Y_HOME_DIR > 0
     #define Y_HOME_TO_MAX 1
   #elif Y_HOME_DIR < 0
     #define Y_HOME_TO_MIN 1
   #endif
 #endif
 #if HAS_Z_AXIS
   #if Z_HOME_DIR > 0

commit 85325f585ac4a9bb667423561540b5d58bdc3b6e
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri May 5 19:37:13 2023 -0500

    üßë‚Äçüíª Endstops preliminary work (#25780)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index bee4abf7a7..8114cb4261 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1384,23 +1384,23 @@
  * Conditionals based on the type of Bed Probe
  */
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if BOTH(DELTA, SENSORLESS_PROBING)
     #define HAS_DELTA_SENSORLESS_PROBING 1
   #endif
   #if NONE(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN, HAS_DELTA_SENSORLESS_PROBING)
-    #define USES_Z_MIN_PROBE_PIN 1
+    #define USE_Z_MIN_PROBE 1
   #endif
-  #if Z_HOME_TO_MIN && (DISABLED(USES_Z_MIN_PROBE_PIN) || ENABLED(USE_PROBE_FOR_Z_HOMING))
+  #if Z_HOME_TO_MIN && (DISABLED(USE_Z_MIN_PROBE) || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if EITHER(Z_PROBE_ALLEN_KEY, MAG_MOUNTED_PROBE)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0
@@ -1771,21 +1771,21 @@
       #define HAS_TOUCH_BUTTONS 1
       #if ENABLED(TFT_TOUCH_DEVICE_GT911)
         #define HAS_CAP_TOUCH_BUTTONS 1
       #else
         #define HAS_RES_TOUCH_BUTTONS 1
       #endif
     #endif
   #endif
 #endif
 
-#if X_HOME_DIR || (HAS_Y_AXIS && Y_HOME_DIR) || (HAS_Z_AXIS && Z_HOME_DIR) \
+#if  (HAS_X_AXIS && X_HOME_DIR) || (HAS_Y_AXIS && Y_HOME_DIR) || (HAS_Z_AXIS && Z_HOME_DIR) \
   || (HAS_I_AXIS && I_HOME_DIR) || (HAS_J_AXIS && J_HOME_DIR) || (HAS_K_AXIS && K_HOME_DIR) \
   || (HAS_U_AXIS && U_HOME_DIR) || (HAS_V_AXIS && V_HOME_DIR) || (HAS_W_AXIS && W_HOME_DIR)
   #define HAS_ENDSTOPS 1
   #define COORDINATE_OKAY(N,L,H) WITHIN(N,L,H)
 #else
   #define COORDINATE_OKAY(N,L,H) true
 #endif
 
 /**
  * LED Backlight INDEX END

commit 9cc16f87e225d4f9f4ca002b2c33a6fda3da5c25
Author: Dmitry Plastinin <Uncellon@yandex.ru>
Date:   Sat May 6 00:05:30 2023 +0300

    üö∏ TS35 portrait display (#25629)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 44072ef4a2..bee4abf7a7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1679,43 +1679,48 @@
   #else
     #define TFT_WIDTH  320
     #define TFT_HEIGHT 240
   #endif
   #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(TFT_RES_480x272)
   #define TFT_WIDTH  480
   #define TFT_HEIGHT 272
   #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(TFT_RES_480x320)
-  #define TFT_WIDTH  480
-  #define TFT_HEIGHT 320
+  #if ENABLED(TFT_COLOR_UI_PORTRAIT)
+    #define TFT_WIDTH  320
+    #define TFT_HEIGHT 480
+  #else
+    #define TFT_WIDTH  480
+    #define TFT_HEIGHT 320
+  #endif
   #define GRAPHICAL_TFT_UPSCALE 3
 #elif ENABLED(TFT_RES_1024x600)
   #define TFT_WIDTH  1024
   #define TFT_HEIGHT 600
   #if ENABLED(TOUCH_SCREEN)
     #define GRAPHICAL_TFT_UPSCALE 6
     #define TFT_PIXEL_OFFSET_X 120
   #else
     #define GRAPHICAL_TFT_UPSCALE 8
     #define TFT_PIXEL_OFFSET_X 0
   #endif
 #endif
 
 #if ENABLED(TFT_COLOR_UI)
   #if (TFT_WIDTH == 320 && TFT_HEIGHT == 240) || (TFT_WIDTH == 240 && TFT_HEIGHT == 320)
     #if ENABLED(TFT_INTERFACE_SPI)
       #define TFT_320x240_SPI
     #elif ENABLED(TFT_INTERFACE_FSMC)
       #define TFT_320x240
     #endif
-  #elif TFT_HEIGHT == 320
+  #elif TFT_HEIGHT == 320 || (TFT_HEIGHT == 480 && ENABLED(TFT_COLOR_UI_PORTRAIT))
     #if ENABLED(TFT_INTERFACE_SPI)
       #define TFT_480x320_SPI
     #elif ENABLED(TFT_INTERFACE_FSMC)
       #define TFT_480x320
     #endif
   #elif TFT_HEIGHT == 272
     #if ENABLED(TFT_INTERFACE_SPI)
       #define TFT_480x272_SPI
     #elif ENABLED(TFT_INTERFACE_FSMC)
       #define TFT_480x272

commit 7642bfbf8b997308e691034aa294a061c5fc5426
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Wed May 3 14:19:32 2023 -0700

    üêõ Fix TFT Touch Calibration overrides (#25579)
    
    ‚Ä¶and other misc. display-related updates
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c28a49c8df..44072ef4a2 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -321,38 +321,36 @@
 #if ANY(ULTIMAKERCONTROLLER, IS_RRD_SC, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
   #define IS_ULTIPANEL 1
 #endif
 
 // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
 #if ENABLED(U8GLIB_SH1106_EINSTART)
   #define DOGLCD
   #define IS_ULTIPANEL 1
 #endif
 
-// TFT Legacy Compatibility
+// TFT Legacy options masquerade as TFT_GENERIC
 #if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
   #define IS_LEGACY_TFT 1
   #define TFT_GENERIC
-#endif
-
-#if ANY(FSMC_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_LVGL_UI_FSMC)
-  #define TFT_INTERFACE_FSMC
-#elif ANY(SPI_GRAPHICAL_TFT, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_SPI)
-  #define TFT_INTERFACE_SPI
-#endif
-
-#if EITHER(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
-  #define TFT_CLASSIC_UI
-#elif ANY(TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI)
-  #define TFT_COLOR_UI
-#elif EITHER(TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
-  #define TFT_LVGL_UI
+  #if ANY(FSMC_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_LVGL_UI_FSMC)
+    #define TFT_INTERFACE_FSMC
+  #elif ANY(SPI_GRAPHICAL_TFT, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_SPI)
+    #define TFT_INTERFACE_SPI
+  #endif
+  #if EITHER(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
+    #define TFT_CLASSIC_UI
+  #elif ANY(TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI)
+    #define TFT_COLOR_UI
+  #elif EITHER(TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
+    #define TFT_LVGL_UI
+  #endif
 #endif
 
 // FSMC/SPI TFT Panels (LVGL)
 #if ENABLED(TFT_LVGL_UI)
   #define HAS_TFT_LVGL_UI 1
   #define SERIAL_RUNTIME_HOOK 1
 #endif
 
 // FSMC/SPI TFT Panels
 #if ENABLED(TFT_CLASSIC_UI)
@@ -1664,21 +1662,21 @@
 #elif ENABLED(TFT_INTERFACE_LTDC)
   #define HAS_LTDC_TFT 1
   #if TFT_SCALED_DOGLCD
     #define HAS_LTDC_GRAPHICAL_TFT 1
   #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_LTDC 1
   #endif
 #endif
 
 #if ANY(HAS_SPI_TFT, HAS_FSMC_TFT, HAS_LTDC_TFT)
-  #include "../lcd/tft_io/tft_orientation.h"
+  #include "../lcd/tft_io/tft_orientation.h" // for TFT_COLOR_UI_PORTRAIT
 #endif
 
 #if ENABLED(TFT_RES_320x240)
   #if ENABLED(TFT_COLOR_UI_PORTRAIT)
     #define TFT_WIDTH  240
     #define TFT_HEIGHT 320
   #else
     #define TFT_WIDTH  320
     #define TFT_HEIGHT 240
   #endif
@@ -1768,31 +1766,20 @@
       #define HAS_TOUCH_BUTTONS 1
       #if ENABLED(TFT_TOUCH_DEVICE_GT911)
         #define HAS_CAP_TOUCH_BUTTONS 1
       #else
         #define HAS_RES_TOUCH_BUTTONS 1
       #endif
     #endif
   #endif
 #endif
 
-// XPT2046_** Compatibility
-#if !(defined(TOUCH_CALIBRATION_X) || defined(TOUCH_CALIBRATION_Y) || defined(TOUCH_OFFSET_X) || defined(TOUCH_OFFSET_Y) || defined(TOUCH_ORIENTATION))
-  #if defined(XPT2046_X_CALIBRATION) && defined(XPT2046_Y_CALIBRATION) && defined(XPT2046_X_OFFSET) && defined(XPT2046_Y_OFFSET)
-    #define TOUCH_CALIBRATION_X  XPT2046_X_CALIBRATION
-    #define TOUCH_CALIBRATION_Y  XPT2046_Y_CALIBRATION
-    #define TOUCH_OFFSET_X       XPT2046_X_OFFSET
-    #define TOUCH_OFFSET_Y       XPT2046_Y_OFFSET
-    #define TOUCH_ORIENTATION    TOUCH_LANDSCAPE
-  #endif
-#endif
-
 #if X_HOME_DIR || (HAS_Y_AXIS && Y_HOME_DIR) || (HAS_Z_AXIS && Z_HOME_DIR) \
   || (HAS_I_AXIS && I_HOME_DIR) || (HAS_J_AXIS && J_HOME_DIR) || (HAS_K_AXIS && K_HOME_DIR) \
   || (HAS_U_AXIS && U_HOME_DIR) || (HAS_V_AXIS && V_HOME_DIR) || (HAS_W_AXIS && W_HOME_DIR)
   #define HAS_ENDSTOPS 1
   #define COORDINATE_OKAY(N,L,H) WITHIN(N,L,H)
 #else
   #define COORDINATE_OKAY(N,L,H) true
 #endif
 
 /**

commit 9a7d9e6995f4f66c4b48147ec7876d49d4b3ae77
Author: Martin Turski <turningtides@outlook.de>
Date:   Thu Apr 27 14:05:24 2023 +0200

    üßë‚Äçüíª Optimize PlatformIO source filtering (#25332)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f012bd9e36..c28a49c8df 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -533,20 +533,24 @@
 #endif
 
 #if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DISPLAY 1
 #endif
 
 #if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
   #define HAS_LCDPRINT 1
 #endif
 
+#if HAS_DISPLAY || HAS_LCDPRINT
+  #define HAS_UTF8_UTILS 1
+#endif
+
 #if HAS_DISPLAY || HAS_DWIN_E3V2
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_MARLINUI_MENU 1
 #endif
 
 #if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
   #define HAS_MANUAL_MOVE_MENU 1
@@ -1790,10 +1794,14 @@
 #else
   #define COORDINATE_OKAY(N,L,H) true
 #endif
 
 /**
  * LED Backlight INDEX END
  */
 #if defined(NEOPIXEL_BKGD_INDEX_FIRST) && !defined(NEOPIXEL_BKGD_INDEX_LAST)
   #define NEOPIXEL_BKGD_INDEX_LAST NEOPIXEL_BKGD_INDEX_FIRST
 #endif
+
+#if ALL(SPI_FLASH, HAS_MEDIA, MARLIN_DEV_MODE)
+  #define SPI_FLASH_BACKUP 1
+#endif

commit d1738e946abda285f9841ca4329d43b86f7e297f
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Mon Apr 24 21:40:08 2023 -0500

    üîß Fix LCD_SERIAL_PORT config

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b11ede3dc5..f012bd9e36 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -481,50 +481,49 @@
 #endif
 
 // Aliases for LCD features
 #if !DGUS_UI_IS(NONE) || ENABLED(ANYCUBIC_LCD_VYPER)
   #define HAS_DGUS_LCD 1
   #if DGUS_UI_IS(ORIGIN, FYSETC, HIPRECY, MKS)
     #define HAS_DGUS_LCD_CLASSIC 1
   #endif
 #endif
 
-// Serial Controllers require LCD_SERIAL_PORT
-#if ANY(HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
-  #define LCD_NEEDS_SERIAL_PORT 1
-#endif
-
 // Extensible UI serial touch screens. (See src/lcd/extui)
-#if EITHER(LCD_NEEDS_SERIAL_PORT, TOUCH_UI_FTDI_EVE)
+#if ANY(HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT, TOUCH_UI_FTDI_EVE)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
   #define HAS_DWIN_E3V2_BASIC 1
 #endif
 #if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
-#if ENABLED(DWIN_LCD_PROUI)
-  #define DO_LIST_BIN_FILES 1
-#endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
-  #if ENABLED(DWIN_LCD_PROUI)
-    #define LCD_BRIGHTNESS_DEFAULT 127
-  #endif
+#endif
+
+#if ENABLED(DWIN_LCD_PROUI)
+  #define DO_LIST_BIN_FILES 1
+  #define LCD_BRIGHTNESS_DEFAULT 127
+#endif
+
+// Serial Controllers require LCD_SERIAL_PORT
+#if ANY(IS_DWIN_MARLINUI, HAS_DWIN_E3V2, HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
+  #define LCD_IS_SERIAL_HOST 1
 #endif
 
 #if HAS_WIRED_LCD
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif IS_DWIN_MARLINUI
     // Since HAS_MARLINUI_U8GLIB refers to U8G displays
     // the DWIN display can define its own flags

commit 5664c02d077e028f84a24efd96c2eebe97ce8763
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Apr 22 22:43:09 2023 -0500

    üßë‚Äçüíª Generalize SDSUPPORT as HAS_MEDIA
    
    In preparation for single- and multi-volume refactoring.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 32a2eda7c7..b11ede3dc5 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -19,20 +19,24 @@
  * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
+#if ENABLED(SDSUPPORT)
+  #define HAS_MEDIA 1
+#endif
+
 // MKS_LCD12864A/B is a variant of MKS_MINI_12864
 #if EITHER(MKS_LCD12864A, MKS_LCD12864B)
   #define MKS_MINI_12864
 #endif
 
 // MKS_MINI_12864_V3 and BTT_MINI_12864_V1 are identical to FYSETC_MINI_12864_2_1
 #if EITHER(MKS_MINI_12864_V3, BTT_MINI_12864_V1)
   #define FYSETC_MINI_12864_2_1
 #endif
 
@@ -210,21 +214,21 @@
 
   #define IS_RRD_SC 1
   #define LCD_WIDTH 16
   #define LCD_HEIGHT 2
 
 #elif EITHER(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
 
   #define IS_TFTGLCD_PANEL 1
   #define IS_ULTIPANEL 1                    // Note that IS_ULTIPANEL leads to HAS_WIRED_LCD
 
-  #if ENABLED(SDSUPPORT) && DISABLED(LCD_PROGRESS_BAR)
+  #if HAS_MEDIA && DISABLED(LCD_PROGRESS_BAR)
     #define LCD_PROGRESS_BAR
   #endif
   #if ENABLED(TFTGLCD_PANEL_I2C)
     #define LCD_I2C_ADDRESS           0x33  // Must be 0x33 for STM32 main boards and equal to panel's I2C slave address
   #endif
   #define LCD_USE_I2C_BUZZER                // Enable buzzer on LCD, used for both I2C and SPI buses (LiquidTWI2 not required)
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #define LCD_WIDTH                   20    // 20 or 24 chars in line
   #define LCD_HEIGHT                  10    // Character lines

commit c8ed7950f40f9f454fc769b02d53f1086b17576c
Author: ellensp <530024+ellensp@users.noreply.github.com>
Date:   Sat Apr 22 21:09:17 2023 +1200

    üîß Permit extrude without hotend (#25709)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5cc1d07b09..32a2eda7c7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -617,22 +617,20 @@
   #undef TEMP_SENSOR_6
   #undef TEMP_SENSOR_7
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef MECHANICAL_SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MECHANICAL_SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef HOTEND_IDLE_TIMEOUT
   #undef DISABLE_E
-  #undef THERMAL_PROTECTION_HOTENDS
-  #undef PREVENT_COLD_EXTRUSION
   #undef PREVENT_LENGTHY_EXTRUDE
   #undef FILAMENT_RUNOUT_SENSOR
   #undef FILAMENT_RUNOUT_DISTANCE_MM
   #undef DISABLE_OTHER_EXTRUDERS
 #endif
 
 #define E_OPTARG(N) OPTARG(HAS_MULTI_EXTRUDER, N)
 #define E_TERN_(N)  TERN_(HAS_MULTI_EXTRUDER, N)
 #define E_TERN0(N)  TERN0(HAS_MULTI_EXTRUDER, N)
 
@@ -650,23 +648,20 @@
 
 #elif HAS_SWITCHING_EXTRUDER        // One stepper for every two EXTRUDERS
 
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
-  #if !HAS_SWITCHING_NOZZLE
-    #define HOTENDS       E_STEPPERS
-  #endif
 
 #elif ENABLED(MIXING_EXTRUDER)      // Multiple feeds are mixed proportionally
 
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
   #if MIXING_STEPPERS == 2
     #define HAS_DUAL_MIXING 1
   #endif
 
 #elif ENABLED(SWITCHING_TOOLHEAD)   // Toolchanger
@@ -684,37 +679,67 @@
 // No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1
 #if HAS_SWITCHING_NOZZLE || HAS_PRUSA_MMU1
   #undef DISABLE_OTHER_EXTRUDERS
 #endif
 
 // Pr≈Ø≈°a MMU1, MMU(S) 2.0 and EXTENDABLE_EMU_MMU2(S) force SINGLENOZZLE
 #if HAS_MMU
   #define SINGLENOZZLE
 #endif
 
-#if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
-  #undef HOTENDS
-  #define HOTENDS       1
-  #undef HOTEND_OFFSET_X
-  #undef HOTEND_OFFSET_Y
-#endif
-
-#ifndef HOTENDS
-  #define HOTENDS EXTRUDERS
-#endif
+// Default E steppers / manual motion is one per extruder
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
+// Number of hotends...
+#if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)               // Only one for singlenozzle or mixing extruder
+  #define HOTENDS 1
+#elif HAS_SWITCHING_EXTRUDER && !HAS_SWITCHING_NOZZLE   // One for each pair of abstract "extruders"
+  #define HOTENDS E_STEPPERS
+#elif TEMP_SENSOR_0
+  #define HOTENDS EXTRUDERS                             // One per extruder if at least one heater exists
+#else
+  #define HOTENDS 0                                     // A machine with no hotends at all can still extrude
+#endif
+
+// More than one hotend...
+#if HOTENDS > 1
+  #define HAS_MULTI_HOTEND 1
+  #define HAS_HOTEND_OFFSET 1
+  #ifndef HOTEND_OFFSET_X
+    #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
+  #endif
+  #ifndef HOTEND_OFFSET_Y
+    #define HOTEND_OFFSET_Y { 0 } // Y offsets for each extruder
+  #endif
+  #ifndef HOTEND_OFFSET_Z
+    #define HOTEND_OFFSET_Z { 0 } // Z offsets for each extruder
+  #endif
+#else
+  #undef HOTEND_OFFSET_X
+  #undef HOTEND_OFFSET_Y
+  #undef HOTEND_OFFSET_Z
+#endif
+
+// At least one hotend...
+#if HOTENDS
+  #define HAS_HOTEND 1
+  #ifndef HOTEND_OVERSHOOT
+    #define HOTEND_OVERSHOOT 15
+  #endif
+#endif
+
+// Clean up E-stepper-based settings...
 #if E_STEPPERS <= 7
   #undef INVERT_E7_DIR
   #undef E7_DRIVER_TYPE
   #if E_STEPPERS <= 6
     #undef INVERT_E6_DIR
     #undef E6_DRIVER_TYPE
     #if E_STEPPERS <= 5
       #undef INVERT_E5_DIR
       #undef E5_DRIVER_TYPE
       #if E_STEPPERS <= 4
@@ -1030,59 +1055,31 @@
   #define DISTINCT_AXES (NUM_AXES + E_STEPPERS)
   #define DISTINCT_E E_STEPPERS
   #define E_INDEX_N(E) (E)
 #else
   #undef DISTINCT_E_FACTORS
   #define DISTINCT_AXES LOGICAL_AXES
   #define DISTINCT_E 1
   #define E_INDEX_N(E) 0
 #endif
 
-#if HOTENDS
-  #define HAS_HOTEND 1
-  #ifndef HOTEND_OVERSHOOT
-    #define HOTEND_OVERSHOOT 15
-  #endif
-  #if HOTENDS > 1
-    #define HAS_MULTI_HOTEND 1
-    #define HAS_HOTEND_OFFSET 1
-  #endif
-#else
-  #undef PID_PARAMS_PER_HOTEND
-#endif
-
 // Helper macros for extruder and hotend arrays
 #define _EXTRUDER_LOOP(E) for (int8_t E = 0; E < EXTRUDERS; E++)
 #define EXTRUDER_LOOP() _EXTRUDER_LOOP(e)
 #define _HOTEND_LOOP(H) for (int8_t H = 0; H < HOTENDS; H++)
 #define HOTEND_LOOP() _HOTEND_LOOP(e)
 
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_N_1(EXTRUDERS, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
 #define ARRAY_BY_HOTENDS1(v1) ARRAY_N_1(HOTENDS, v1)
 
-/**
- * Default hotend offsets, if not defined
- */
-#if HAS_HOTEND_OFFSET
-  #ifndef HOTEND_OFFSET_X
-    #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
-  #endif
-  #ifndef HOTEND_OFFSET_Y
-    #define HOTEND_OFFSET_Y { 0 } // Y offsets for each extruder
-  #endif
-  #ifndef HOTEND_OFFSET_Z
-    #define HOTEND_OFFSET_Z { 0 } // Z offsets for each extruder
-  #endif
-#endif
-
 /**
  * Disable unused SINGLENOZZLE sub-options
  */
 #if DISABLED(SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_TEMP
 #endif
 #if !BOTH(HAS_FAN, SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_FAN
 #endif
 

commit 91cce2a7b39f1b64e37224fe6bef4ce00463fecf
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Wed Apr 19 19:42:05 2023 -0700

    ‚ú® Panowin Cutlass / Bardo (F1 / Trinus) (#25663)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 60bc653560..5cc1d07b09 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -477,22 +477,27 @@
 #endif
 
 // Aliases for LCD features
 #if !DGUS_UI_IS(NONE) || ENABLED(ANYCUBIC_LCD_VYPER)
   #define HAS_DGUS_LCD 1
   #if DGUS_UI_IS(ORIGIN, FYSETC, HIPRECY, MKS)
     #define HAS_DGUS_LCD_CLASSIC 1
   #endif
 #endif
 
+// Serial Controllers require LCD_SERIAL_PORT
+#if ANY(HAS_DGUS_LCD, MALYAN_LCD, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
+  #define LCD_NEEDS_SERIAL_PORT 1
+#endif
+
 // Extensible UI serial touch screens. (See src/lcd/extui)
-#if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, ANYCUBIC_LCD_VYPER, NEXTION_TFT)
+#if EITHER(LCD_NEEDS_SERIAL_PORT, TOUCH_UI_FTDI_EVE)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
   #define HAS_DWIN_E3V2_BASIC 1
 #endif
 #if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1

commit 61f22f34d32ca33d99233eb5b242e52c23aabb23
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Mar 26 17:24:40 2023 -0500

    üîß Clarify axis disable / timeout (#25571)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 403db47e42..60bc653560 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -617,21 +617,21 @@
   #undef SWITCHING_NOZZLE
   #undef MECHANICAL_SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef HOTEND_IDLE_TIMEOUT
   #undef DISABLE_E
   #undef THERMAL_PROTECTION_HOTENDS
   #undef PREVENT_COLD_EXTRUSION
   #undef PREVENT_LENGTHY_EXTRUDE
   #undef FILAMENT_RUNOUT_SENSOR
   #undef FILAMENT_RUNOUT_DISTANCE_MM
-  #undef DISABLE_INACTIVE_EXTRUDER
+  #undef DISABLE_OTHER_EXTRUDERS
 #endif
 
 #define E_OPTARG(N) OPTARG(HAS_MULTI_EXTRUDER, N)
 #define E_TERN_(N)  TERN_(HAS_MULTI_EXTRUDER, N)
 #define E_TERN0(N)  TERN0(HAS_MULTI_EXTRUDER, N)
 
 #if EITHER(SWITCHING_EXTRUDER, MECHANICAL_SWITCHING_EXTRUDER)
   #define HAS_SWITCHING_EXTRUDER 1
 #endif
 #if EITHER(SWITCHING_NOZZLE, MECHANICAL_SWITCHING_NOZZLE)
@@ -671,21 +671,21 @@
 
 #elif HAS_PRUSA_MMU2                // Pr≈Ø≈°a Multi-Material Unit v2
 
   #define E_STEPPERS      1
   #define E_MANUAL        1
 
 #endif
 
 // No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1
 #if HAS_SWITCHING_NOZZLE || HAS_PRUSA_MMU1
-  #undef DISABLE_INACTIVE_EXTRUDER
+  #undef DISABLE_OTHER_EXTRUDERS
 #endif
 
 // Pr≈Ø≈°a MMU1, MMU(S) 2.0 and EXTENDABLE_EMU_MMU2(S) force SINGLENOZZLE
 #if HAS_MMU
   #define SINGLENOZZLE
 #endif
 
 #if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
   #define HOTENDS       1
@@ -927,20 +927,29 @@
   #undef DISABLE_W
   #undef INVERT_W_DIR
   #undef W_HOME_DIR
   #undef W_MIN_POS
   #undef W_MAX_POS
   #undef MANUAL_W_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_W
   #undef MAX_SOFTWARE_ENDSTOP_W
 #endif
 
+#define _OR_HAS_DA(A) ENABLED(DISABLE_##A) ||
+#if MAP(_OR_HAS_DA, X, Y, Z, I, J, K, U, V, W) 0
+  #define HAS_DISABLE_MAIN_AXES 1
+#endif
+#if HAS_DISABLE_MAIN_AXES || ENABLED(DISABLE_E)
+  #define HAS_DISABLE_AXES 1
+#endif
+#undef _OR_HAS_DA
+
 #ifdef X2_DRIVER_TYPE
   #define HAS_X2_STEPPER 1
   // Dual X Carriage isn't known yet. TODO: Consider moving it to Configuration.h.
 #endif
 #ifdef Y2_DRIVER_TYPE
   #define HAS_Y2_STEPPER 1
   #define HAS_DUAL_Y_STEPPERS 1
 #endif
 
 /**

commit 0021a58943721a81b1ef23fa5e7366cfd80a3d28
Author: Bob Kuhn <bob.kuhn@att.net>
Date:   Sun Mar 26 04:07:25 2023 -0500

    ‚ú® AnyCubic Vyper / Vyper LCD (#25405)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3c821e5306..403db47e42 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -470,29 +470,29 @@
 #endif
 
 #if EITHER(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
   #define IS_RRW_KEYPAD 1
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
-#if !DGUS_UI_IS(NONE)
+#if !DGUS_UI_IS(NONE) || ENABLED(ANYCUBIC_LCD_VYPER)
   #define HAS_DGUS_LCD 1
   #if DGUS_UI_IS(ORIGIN, FYSETC, HIPRECY, MKS)
     #define HAS_DGUS_LCD_CLASSIC 1
   #endif
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
-#if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
+#if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, ANYCUBIC_LCD_VYPER, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
   #define HAS_DWIN_E3V2_BASIC 1
 #endif
 #if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1

commit ea5d7e2eee641122ddf56705f6c9060d84a20df3
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Mar 26 04:00:12 2023 -0500

    üîß Refactor endstop state config (#25574)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ecaeee86e7..3c821e5306 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -787,22 +787,22 @@
   #define HAS_V_AXIS 1
 #endif
 #if NUM_AXES >= 9
   #define HAS_W_AXIS 1
 #endif
 
 #if !HAS_Y_AXIS
   #undef AVOID_OBSTACLES
   #undef ENDSTOPPULLUP_YMIN
   #undef ENDSTOPPULLUP_YMAX
-  #undef Y_MIN_ENDSTOP_INVERTING
-  #undef Y_MAX_ENDSTOP_INVERTING
+  #undef Y_MIN_ENDSTOP_HIT_STATE
+  #undef Y_MAX_ENDSTOP_HIT_STATE
   #undef Y2_DRIVER_TYPE
   #undef Y_ENABLE_ON
   #undef DISABLE_Y
   #undef INVERT_Y_DIR
   #undef Y_HOME_DIR
   #undef Y_MIN_POS
   #undef Y_MAX_POS
   #undef MANUAL_Y_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_Y
   #undef MAX_SOFTWARE_ENDSTOP_Y
@@ -814,122 +814,122 @@
   #elif defined(Z3_DRIVER_TYPE)
     #define NUM_Z_STEPPERS 3
   #elif defined(Z2_DRIVER_TYPE)
     #define NUM_Z_STEPPERS 2
   #else
     #define NUM_Z_STEPPERS 1
   #endif
 #else
   #undef ENDSTOPPULLUP_ZMIN
   #undef ENDSTOPPULLUP_ZMAX
-  #undef Z_MIN_ENDSTOP_INVERTING
-  #undef Z_MAX_ENDSTOP_INVERTING
+  #undef Z_MIN_ENDSTOP_HIT_STATE
+  #undef Z_MAX_ENDSTOP_HIT_STATE
   #undef Z2_DRIVER_TYPE
   #undef Z3_DRIVER_TYPE
   #undef Z4_DRIVER_TYPE
   #undef Z_ENABLE_ON
   #undef DISABLE_Z
   #undef INVERT_Z_DIR
   #undef Z_HOME_DIR
   #undef Z_MIN_POS
   #undef Z_MAX_POS
   #undef MANUAL_Z_HOME_POS
   #undef Z_SAFE_HOMING
   #undef MIN_SOFTWARE_ENDSTOP_Z
   #undef MAX_SOFTWARE_ENDSTOP_Z
 #endif
 
 #if !HAS_I_AXIS
   #undef ENDSTOPPULLUP_IMIN
   #undef ENDSTOPPULLUP_IMAX
-  #undef I_MIN_ENDSTOP_INVERTING
-  #undef I_MAX_ENDSTOP_INVERTING
+  #undef I_MIN_ENDSTOP_HIT_STATE
+  #undef I_MAX_ENDSTOP_HIT_STATE
   #undef I_ENABLE_ON
   #undef DISABLE_I
   #undef INVERT_I_DIR
   #undef I_HOME_DIR
   #undef I_MIN_POS
   #undef I_MAX_POS
   #undef MANUAL_I_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_I
   #undef MAX_SOFTWARE_ENDSTOP_I
 #endif
 
 #if !HAS_J_AXIS
   #undef ENDSTOPPULLUP_JMIN
   #undef ENDSTOPPULLUP_JMAX
-  #undef J_MIN_ENDSTOP_INVERTING
-  #undef J_MAX_ENDSTOP_INVERTING
+  #undef J_MIN_ENDSTOP_HIT_STATE
+  #undef J_MAX_ENDSTOP_HIT_STATE
   #undef J_ENABLE_ON
   #undef DISABLE_J
   #undef INVERT_J_DIR
   #undef J_HOME_DIR
   #undef J_MIN_POS
   #undef J_MAX_POS
   #undef MANUAL_J_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_J
   #undef MAX_SOFTWARE_ENDSTOP_J
 #endif
 
 #if !HAS_K_AXIS
   #undef ENDSTOPPULLUP_KMIN
   #undef ENDSTOPPULLUP_KMAX
-  #undef K_MIN_ENDSTOP_INVERTING
-  #undef K_MAX_ENDSTOP_INVERTING
+  #undef K_MIN_ENDSTOP_HIT_STATE
+  #undef K_MAX_ENDSTOP_HIT_STATE
   #undef K_ENABLE_ON
   #undef DISABLE_K
   #undef INVERT_K_DIR
   #undef K_HOME_DIR
   #undef K_MIN_POS
   #undef K_MAX_POS
   #undef MANUAL_K_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_K
   #undef MAX_SOFTWARE_ENDSTOP_K
 #endif
 
 #if !HAS_U_AXIS
   #undef ENDSTOPPULLUP_UMIN
   #undef ENDSTOPPULLUP_UMAX
-  #undef U_MIN_ENDSTOP_INVERTING
-  #undef U_MAX_ENDSTOP_INVERTING
+  #undef U_MIN_ENDSTOP_HIT_STATE
+  #undef U_MAX_ENDSTOP_HIT_STATE
   #undef U_ENABLE_ON
   #undef DISABLE_U
   #undef INVERT_U_DIR
   #undef U_HOME_DIR
   #undef U_MIN_POS
   #undef U_MAX_POS
   #undef MANUAL_U_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_U
   #undef MAX_SOFTWARE_ENDSTOP_U
 #endif
 
 #if !HAS_V_AXIS
   #undef ENDSTOPPULLUP_VMIN
   #undef ENDSTOPPULLUP_VMAX
-  #undef V_MIN_ENDSTOP_INVERTING
-  #undef V_MAX_ENDSTOP_INVERTING
+  #undef V_MIN_ENDSTOP_HIT_STATE
+  #undef V_MAX_ENDSTOP_HIT_STATE
   #undef V_ENABLE_ON
   #undef DISABLE_V
   #undef INVERT_V_DIR
   #undef V_HOME_DIR
   #undef V_MIN_POS
   #undef V_MAX_POS
   #undef MANUAL_V_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_V
   #undef MAX_SOFTWARE_ENDSTOP_V
 #endif
 
 #if !HAS_W_AXIS
   #undef ENDSTOPPULLUP_WMIN
   #undef ENDSTOPPULLUP_WMAX
-  #undef W_MIN_ENDSTOP_INVERTING
-  #undef W_MAX_ENDSTOP_INVERTING
+  #undef W_MIN_ENDSTOP_HIT_STATE
+  #undef W_MAX_ENDSTOP_HIT_STATE
   #undef W_ENABLE_ON
   #undef DISABLE_W
   #undef INVERT_W_DIR
   #undef W_HOME_DIR
   #undef W_MIN_POS
   #undef W_MAX_POS
   #undef MANUAL_W_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_W
   #undef MAX_SOFTWARE_ENDSTOP_W
 #endif
@@ -1074,24 +1074,22 @@
 
 // Switching extruder has its own servo?
 #if ENABLED(SWITCHING_EXTRUDER) && (!HAS_SWITCHING_NOZZLE || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
   #define DO_SWITCH_EXTRUDER 1
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
-#if ENABLED(BLTOUCH)
-  #ifndef Z_PROBE_SERVO_NR
-    #define Z_PROBE_SERVO_NR 0
-  #endif
+#if ENABLED(BLTOUCH) && !defined(Z_PROBE_SERVO_NR)
+  #define Z_PROBE_SERVO_NR 0
 #endif
 
 /**
  * Set a flag for a servo probe (or BLTouch)
  */
 #ifdef Z_PROBE_SERVO_NR
   #define HAS_Z_SERVO_PROBE 1
 #endif
 #if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
   #define HAS_SERVO_ANGLES 1

commit 2ecd4cca1b694223802a53d5a7febaac4c4573b6
Author: BIGTREETECH <38851044+bigtreetech@users.noreply.github.com>
Date:   Wed Mar 22 15:46:03 2023 +0800

    ‚ú® FILAMENT_SWITCH_AND_MOTION (#25548)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 32712a86d6..ecaeee86e7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1205,20 +1205,111 @@
     #endif
     #ifndef FIL_RUNOUT8_PULLUP
       #define FIL_RUNOUT8_PULLUP FIL_RUNOUT_PULLUP
     #endif
     #ifndef FIL_RUNOUT8_PULLDOWN
       #define FIL_RUNOUT8_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
 #endif // FILAMENT_RUNOUT_SENSOR
 
+#if ENABLED(FILAMENT_SWITCH_AND_MOTION)
+  #if NUM_MOTION_SENSORS >= 1
+    #ifndef FIL_MOTION1_STATE
+      #define FIL_MOTION1_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_MOTION1_PULLUP
+      #define FIL_MOTION1_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_MOTION1_PULLDOWN
+      #define FIL_MOTION1_PULLDOWN FIL_RUNOUT_PULLDOWN
+    #endif
+  #endif
+  #if NUM_MOTION_SENSORS >= 2
+    #ifndef FIL_MOTION2_STATE
+      #define FIL_MOTION2_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_MOTION2_PULLUP
+      #define FIL_MOTION2_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_MOTION2_PULLDOWN
+      #define FIL_MOTION2_PULLDOWN FIL_RUNOUT_PULLDOWN
+    #endif
+  #endif
+  #if NUM_MOTION_SENSORS >= 3
+    #ifndef FIL_MOTION3_STATE
+      #define FIL_MOTION3_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_MOTION3_PULLUP
+      #define FIL_MOTION3_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_MOTION3_PULLDOWN
+      #define FIL_MOTION3_PULLDOWN FIL_RUNOUT_PULLDOWN
+    #endif
+  #endif
+  #if NUM_MOTION_SENSORS >= 4
+    #ifndef FIL_MOTION4_STATE
+      #define FIL_MOTION4_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_MOTION4_PULLUP
+      #define FIL_MOTION4_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_MOTION4_PULLDOWN
+      #define FIL_MOTION4_PULLDOWN FIL_RUNOUT_PULLDOWN
+    #endif
+  #endif
+  #if NUM_MOTION_SENSORS >= 5
+    #ifndef FIL_MOTION5_STATE
+      #define FIL_MOTION5_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_MOTION5_PULLUP
+      #define FIL_MOTION5_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_MOTION5_PULLDOWN
+      #define FIL_MOTION5_PULLDOWN FIL_RUNOUT_PULLDOWN
+    #endif
+  #endif
+  #if NUM_MOTION_SENSORS >= 6
+    #ifndef FIL_MOTION6_STATE
+      #define FIL_MOTION6_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_MOTION6_PULLUP
+      #define FIL_MOTION6_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_MOTION6_PULLDOWN
+      #define FIL_MOTION6_PULLDOWN FIL_RUNOUT_PULLDOWN
+    #endif
+  #endif
+  #if NUM_MOTION_SENSORS >= 7
+    #ifndef FIL_MOTION7_STATE
+      #define FIL_MOTION7_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_MOTION7_PULLUP
+      #define FIL_MOTION7_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_MOTION7_PULLDOWN
+      #define FIL_MOTION7_PULLDOWN FIL_RUNOUT_PULLDOWN
+    #endif
+  #endif
+  #if NUM_MOTION_SENSORS >= 8
+    #ifndef FIL_MOTION8_STATE
+      #define FIL_MOTION8_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_MOTION8_PULLUP
+      #define FIL_MOTION8_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_MOTION8_PULLDOWN
+      #define FILMOTION8_PULLDOWN FIL_RUNOUT_PULLDOWN
+    #endif
+  #endif
+#endif // FILAMENT_SWITCH_AND_MOTION
+
 // Homing to Min or Max
 #if X_HOME_DIR > 0
   #define X_HOME_TO_MAX 1
 #elif X_HOME_DIR < 0
   #define X_HOME_TO_MIN 1
 #endif
 #if HAS_Y_AXIS
   #if Y_HOME_DIR > 0
     #define Y_HOME_TO_MAX 1
   #elif Y_HOME_DIR < 0

commit 06cfd9c54af1537adf458a719b840cd501395278
Author: John Lagonikas <39417467+zeleps@users.noreply.github.com>
Date:   Wed Mar 22 02:15:51 2023 +0200

    ‚ú® PROBING_TOOL (#24411)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index dc9849399c..32712a86d6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1103,20 +1103,28 @@
 /**
  * Set flags for any form of bed probe
  */
 #if ANY(TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, HAS_Z_SERVO_PROBE, SOLENOID_PROBE, Z_PROBE_SLED, RACK_AND_PINION_PROBE, SENSORLESS_PROBING, MAGLEV4, MAG_MOUNTED_PROBE)
   #define HAS_STOWABLE_PROBE 1
 #endif
 #if ANY(HAS_STOWABLE_PROBE, FIX_MOUNTED_PROBE, BD_SENSOR, NOZZLE_AS_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
+// Probing tool change
+#if !HAS_MULTI_EXTRUDER
+  #undef PROBING_TOOL
+#endif
+#if HAS_BED_PROBE && defined(PROBING_TOOL)
+  #define DO_TOOLCHANGE_FOR_PROBING 1
+#endif
+
 /**
  * Fill in undefined Filament Sensor options
  */
 #if ENABLED(FILAMENT_RUNOUT_SENSOR)
   #if NUM_RUNOUT_SENSORS >= 1
     #ifndef FIL_RUNOUT1_STATE
       #define FIL_RUNOUT1_STATE FIL_RUNOUT_STATE
     #endif
     #ifndef FIL_RUNOUT1_PULLUP
       #define FIL_RUNOUT1_PULLUP FIL_RUNOUT_PULLUP

commit b5836b243ac9321841daa9380d55b298375aaa2e
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Mar 17 20:12:36 2023 -0500

    üîß Optional MPC_AUTOTUNE to save 5.5 - 5.8KB

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0031e17eea..dc9849399c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1464,20 +1464,24 @@
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
 
 #if ANY(PID_DEBUG, PID_BED_DEBUG, PID_CHAMBER_DEBUG)
   #define HAS_PID_DEBUG 1
 #endif
 
+#if DISABLED(MPC_AUTOTUNE)
+  #undef MPC_AUTOTUNE_MENU
+#endif
+
 /**
  * TFT Displays
  *
  * Configure parameters for TFT displays:
  *  - TFT_DEFAULT_ORIENTATION
  *  - TFT_DRIVER
  *  - TFT_WIDTH
  *  - TFT_HEIGHT
  *  - TFT_INTERFACE_(SPI|FSMC)
  *  - TFT_COLOR

commit e977232735abd759678e8665759dbc214df88202
Author: EvilGremlin <22657714+EvilGremlin@users.noreply.github.com>
Date:   Sat Mar 4 05:43:20 2023 +0300

    ‚ú® Switching extruder/nozzle without servo (e.g., Dondolo) (#24553)
    
    Co-authored-by: Anson Liu <ansonl@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 4e9285e6c1..0031e17eea 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -606,51 +606,60 @@
   #undef TEMP_SENSOR_0
   #undef TEMP_SENSOR_1
   #undef TEMP_SENSOR_2
   #undef TEMP_SENSOR_3
   #undef TEMP_SENSOR_4
   #undef TEMP_SENSOR_5
   #undef TEMP_SENSOR_6
   #undef TEMP_SENSOR_7
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
+  #undef MECHANICAL_SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
+  #undef MECHANICAL_SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef HOTEND_IDLE_TIMEOUT
   #undef DISABLE_E
   #undef THERMAL_PROTECTION_HOTENDS
   #undef PREVENT_COLD_EXTRUSION
   #undef PREVENT_LENGTHY_EXTRUDE
   #undef FILAMENT_RUNOUT_SENSOR
   #undef FILAMENT_RUNOUT_DISTANCE_MM
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
 #define E_OPTARG(N) OPTARG(HAS_MULTI_EXTRUDER, N)
 #define E_TERN_(N)  TERN_(HAS_MULTI_EXTRUDER, N)
 #define E_TERN0(N)  TERN0(HAS_MULTI_EXTRUDER, N)
 
+#if EITHER(SWITCHING_EXTRUDER, MECHANICAL_SWITCHING_EXTRUDER)
+  #define HAS_SWITCHING_EXTRUDER 1
+#endif
+#if EITHER(SWITCHING_NOZZLE, MECHANICAL_SWITCHING_NOZZLE)
+  #define HAS_SWITCHING_NOZZLE 1
+#endif
+
 #if ENABLED(E_DUAL_STEPPER_DRIVERS) // E0/E1 steppers act in tandem as E0
 
   #define E_STEPPERS      2
   #define E_MANUAL        1
 
-#elif ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
+#elif HAS_SWITCHING_EXTRUDER        // One stepper for every two EXTRUDERS
 
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
-  #if DISABLED(SWITCHING_NOZZLE)
+  #if !HAS_SWITCHING_NOZZLE
     #define HOTENDS       E_STEPPERS
   #endif
 
 #elif ENABLED(MIXING_EXTRUDER)      // Multiple feeds are mixed proportionally
 
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
   #if MIXING_STEPPERS == 2
     #define HAS_DUAL_MIXING 1
   #endif
@@ -661,21 +670,21 @@
   #define E_MANUAL        EXTRUDERS
 
 #elif HAS_PRUSA_MMU2                // Pr≈Ø≈°a Multi-Material Unit v2
 
   #define E_STEPPERS      1
   #define E_MANUAL        1
 
 #endif
 
 // No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1
-#if ENABLED(SWITCHING_NOZZLE) || HAS_PRUSA_MMU1
+#if HAS_SWITCHING_NOZZLE || HAS_PRUSA_MMU1
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
 // Pr≈Ø≈°a MMU1, MMU(S) 2.0 and EXTENDABLE_EMU_MMU2(S) force SINGLENOZZLE
 #if HAS_MMU
   #define SINGLENOZZLE
 #endif
 
 #if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
@@ -1057,21 +1066,21 @@
  * Disable unused SINGLENOZZLE sub-options
  */
 #if DISABLED(SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_TEMP
 #endif
 #if !BOTH(HAS_FAN, SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_FAN
 #endif
 
 // Switching extruder has its own servo?
-#if ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
+#if ENABLED(SWITCHING_EXTRUDER) && (!HAS_SWITCHING_NOZZLE || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
   #define DO_SWITCH_EXTRUDER 1
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0

commit 593567b4404a73ad1d933a47811ab7a7faae6025
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Mar 3 13:42:46 2023 -0600

    üìù Fix a comment

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index bddc0554f5..4e9285e6c1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -929,21 +929,21 @@
   #define HAS_X2_STEPPER 1
   // Dual X Carriage isn't known yet. TODO: Consider moving it to Configuration.h.
 #endif
 #ifdef Y2_DRIVER_TYPE
   #define HAS_Y2_STEPPER 1
   #define HAS_DUAL_Y_STEPPERS 1
 #endif
 
 /**
  * Number of Primary Linear Axes (e.g., XYZ)
- * X, XY, or XYZ axes. Excluding duplicate axes (X2, Y2. Z2. Z3, Z4)
+ * X, XY, or XYZ axes. Excluding duplicate axes (X2, Y2, Z2, Z3, Z4)
  */
 #if NUM_AXES >= 3
   #define PRIMARY_LINEAR_AXES 3
 #else
   #define PRIMARY_LINEAR_AXES NUM_AXES
 #endif
 
 /**
  * Number of Secondary Axes (e.g., IJKUVW)
  * All linear/rotational axes between XYZ and E.

commit f9f6662a8c4692cc67006fb302068c96a0e86ac1
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Feb 23 21:08:31 2023 -0600

    ‚ôªÔ∏è Stepper options refactor (#25422)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 920ad15c6c..bddc0554f5 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -751,84 +751,87 @@
 #elif defined(Z_DRIVER_TYPE)
   #define NUM_AXES 3
 #elif defined(Y_DRIVER_TYPE)
   #define NUM_AXES 2
 #else
   #define NUM_AXES 1
 #endif
 #define HAS_X_AXIS 1
 #if NUM_AXES >= XY
   #define HAS_Y_AXIS 1
-  #if NUM_AXES >= XYZ
-    #define HAS_Z_AXIS 1
-    #ifdef Z4_DRIVER_TYPE
-      #define NUM_Z_STEPPERS 4
-    #elif defined(Z3_DRIVER_TYPE)
-      #define NUM_Z_STEPPERS 3
-    #elif defined(Z2_DRIVER_TYPE)
-      #define NUM_Z_STEPPERS 2
-    #else
-      #define NUM_Z_STEPPERS 1
-    #endif
-    #if NUM_AXES >= 4
-      #define HAS_I_AXIS 1
-      #if NUM_AXES >= 5
-        #define HAS_J_AXIS 1
-        #if NUM_AXES >= 6
-          #define HAS_K_AXIS 1
-          #if NUM_AXES >= 7
-            #define HAS_U_AXIS 1
-            #if NUM_AXES >= 8
-              #define HAS_V_AXIS 1
-              #if NUM_AXES >= 9
-                #define HAS_W_AXIS 1
-              #endif
-            #endif
-          #endif
-        #endif
-      #endif
-    #endif
-  #endif
+#endif
+#if NUM_AXES >= XYZ
+  #define HAS_Z_AXIS 1
+#endif
+#if NUM_AXES >= 4
+  #define HAS_I_AXIS 1
+#endif
+#if NUM_AXES >= 5
+  #define HAS_J_AXIS 1
+#endif
+#if NUM_AXES >= 6
+  #define HAS_K_AXIS 1
+#endif
+#if NUM_AXES >= 7
+  #define HAS_U_AXIS 1
+#endif
+#if NUM_AXES >= 8
+  #define HAS_V_AXIS 1
+#endif
+#if NUM_AXES >= 9
+  #define HAS_W_AXIS 1
 #endif
 
 #if !HAS_Y_AXIS
+  #undef AVOID_OBSTACLES
   #undef ENDSTOPPULLUP_YMIN
   #undef ENDSTOPPULLUP_YMAX
   #undef Y_MIN_ENDSTOP_INVERTING
   #undef Y_MAX_ENDSTOP_INVERTING
   #undef Y2_DRIVER_TYPE
   #undef Y_ENABLE_ON
   #undef DISABLE_Y
   #undef INVERT_Y_DIR
   #undef Y_HOME_DIR
   #undef Y_MIN_POS
   #undef Y_MAX_POS
   #undef MANUAL_Y_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_Y
   #undef MAX_SOFTWARE_ENDSTOP_Y
 #endif
 
-#if !HAS_Z_AXIS
+#if HAS_Z_AXIS
+  #ifdef Z4_DRIVER_TYPE
+    #define NUM_Z_STEPPERS 4
+  #elif defined(Z3_DRIVER_TYPE)
+    #define NUM_Z_STEPPERS 3
+  #elif defined(Z2_DRIVER_TYPE)
+    #define NUM_Z_STEPPERS 2
+  #else
+    #define NUM_Z_STEPPERS 1
+  #endif
+#else
   #undef ENDSTOPPULLUP_ZMIN
   #undef ENDSTOPPULLUP_ZMAX
   #undef Z_MIN_ENDSTOP_INVERTING
   #undef Z_MAX_ENDSTOP_INVERTING
   #undef Z2_DRIVER_TYPE
   #undef Z3_DRIVER_TYPE
   #undef Z4_DRIVER_TYPE
   #undef Z_ENABLE_ON
   #undef DISABLE_Z
   #undef INVERT_Z_DIR
   #undef Z_HOME_DIR
   #undef Z_MIN_POS
   #undef Z_MAX_POS
   #undef MANUAL_Z_HOME_POS
+  #undef Z_SAFE_HOMING
   #undef MIN_SOFTWARE_ENDSTOP_Z
   #undef MAX_SOFTWARE_ENDSTOP_Z
 #endif
 
 #if !HAS_I_AXIS
   #undef ENDSTOPPULLUP_IMIN
   #undef ENDSTOPPULLUP_IMAX
   #undef I_MIN_ENDSTOP_INVERTING
   #undef I_MAX_ENDSTOP_INVERTING
   #undef I_ENABLE_ON

commit fbe9237a6c934b8c16e39b879b04973063c3988c
Author: alexgrach <gav@bmstu.ru>
Date:   Wed Feb 1 10:40:13 2023 +0300

    üêõ Fix TFT touch buttons, button colors (#25300)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7d4098d1cf..920ad15c6c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1604,23 +1604,23 @@
   #define HAS_UI_320x240 1
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
 #elif EITHER(TFT_480x272, TFT_480x272_SPI)
   #define HAS_UI_480x272 1
 #elif EITHER(TFT_1024x600_LTDC, TFT_1024x600_SIM)
   #define HAS_UI_1024x600 1
 #endif
 #if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
   #if ENABLED(TFT_COLOR_UI_PORTRAIT)
-    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
-  #else
     #define LCD_HEIGHT TERN(TOUCH_SCREEN, 8, 9) // Fewer lines with touch buttons onscreen
+  #else
+    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
   #endif
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN)
   #if TOUCH_IDLE_SLEEP_MINS
     #define HAS_TOUCH_SLEEP 1
   #endif

commit 087e19a0ed4b769224d42cca83c8caccefce63c9
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Mon Jan 30 22:11:50 2023 -0600

    üîß Fix build with no Y axis (#25311)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c4926edd51..7d4098d1cf 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -596,26 +596,40 @@
  */
 #if EXTRUDERS
   #define HAS_EXTRUDERS 1
   #if EXTRUDERS > 1
     #define HAS_MULTI_EXTRUDER 1
   #endif
   #define E_AXIS_N(E) AxisEnum(E_AXIS + E_INDEX_N(E))
 #else
   #undef EXTRUDERS
   #define EXTRUDERS 0
+  #undef TEMP_SENSOR_0
+  #undef TEMP_SENSOR_1
+  #undef TEMP_SENSOR_2
+  #undef TEMP_SENSOR_3
+  #undef TEMP_SENSOR_4
+  #undef TEMP_SENSOR_5
+  #undef TEMP_SENSOR_6
+  #undef TEMP_SENSOR_7
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef HOTEND_IDLE_TIMEOUT
   #undef DISABLE_E
+  #undef THERMAL_PROTECTION_HOTENDS
+  #undef PREVENT_COLD_EXTRUSION
+  #undef PREVENT_LENGTHY_EXTRUDE
+  #undef FILAMENT_RUNOUT_SENSOR
+  #undef FILAMENT_RUNOUT_DISTANCE_MM
+  #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
 #define E_OPTARG(N) OPTARG(HAS_MULTI_EXTRUDER, N)
 #define E_TERN_(N)  TERN_(HAS_MULTI_EXTRUDER, N)
 #define E_TERN0(N)  TERN0(HAS_MULTI_EXTRUDER, N)
 
 #if ENABLED(E_DUAL_STEPPER_DRIVERS) // E0/E1 steppers act in tandem as E0
 
   #define E_STEPPERS      2
   #define E_MANUAL        1
@@ -675,34 +689,42 @@
 #endif
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
 #if E_STEPPERS <= 7
   #undef INVERT_E7_DIR
+  #undef E7_DRIVER_TYPE
   #if E_STEPPERS <= 6
     #undef INVERT_E6_DIR
+    #undef E6_DRIVER_TYPE
     #if E_STEPPERS <= 5
       #undef INVERT_E5_DIR
+      #undef E5_DRIVER_TYPE
       #if E_STEPPERS <= 4
         #undef INVERT_E4_DIR
+        #undef E4_DRIVER_TYPE
         #if E_STEPPERS <= 3
           #undef INVERT_E3_DIR
+          #undef E3_DRIVER_TYPE
           #if E_STEPPERS <= 2
             #undef INVERT_E2_DIR
+            #undef E2_DRIVER_TYPE
             #if E_STEPPERS <= 1
               #undef INVERT_E1_DIR
+              #undef E1_DRIVER_TYPE
               #if E_STEPPERS == 0
                 #undef INVERT_E0_DIR
+                #undef E0_DRIVER_TYPE
               #endif
             #endif
           #endif
         #endif
       #endif
     #endif
   #endif
 #endif
 
 /**
@@ -726,20 +748,21 @@
   #define NUM_AXES 5
 #elif defined(I_DRIVER_TYPE)
   #define NUM_AXES 4
 #elif defined(Z_DRIVER_TYPE)
   #define NUM_AXES 3
 #elif defined(Y_DRIVER_TYPE)
   #define NUM_AXES 2
 #else
   #define NUM_AXES 1
 #endif
+#define HAS_X_AXIS 1
 #if NUM_AXES >= XY
   #define HAS_Y_AXIS 1
   #if NUM_AXES >= XYZ
     #define HAS_Z_AXIS 1
     #ifdef Z4_DRIVER_TYPE
       #define NUM_Z_STEPPERS 4
     #elif defined(Z3_DRIVER_TYPE)
       #define NUM_Z_STEPPERS 3
     #elif defined(Z2_DRIVER_TYPE)
       #define NUM_Z_STEPPERS 2
@@ -760,183 +783,150 @@
                 #define HAS_W_AXIS 1
               #endif
             #endif
           #endif
         #endif
       #endif
     #endif
   #endif
 #endif
 
-#if E_STEPPERS <= 0
-  #undef E0_DRIVER_TYPE
-#endif
-#if E_STEPPERS <= 1
-  #undef E1_DRIVER_TYPE
-#endif
-#if E_STEPPERS <= 2
-  #undef E2_DRIVER_TYPE
-#endif
-#if E_STEPPERS <= 3
-  #undef E3_DRIVER_TYPE
-#endif
-#if E_STEPPERS <= 4
-  #undef E4_DRIVER_TYPE
-#endif
-#if E_STEPPERS <= 5
-  #undef E5_DRIVER_TYPE
-#endif
-#if E_STEPPERS <= 6
-  #undef E6_DRIVER_TYPE
-#endif
-#if E_STEPPERS <= 7
-  #undef E7_DRIVER_TYPE
-#endif
-
 #if !HAS_Y_AXIS
   #undef ENDSTOPPULLUP_YMIN
   #undef ENDSTOPPULLUP_YMAX
   #undef Y_MIN_ENDSTOP_INVERTING
   #undef Y_MAX_ENDSTOP_INVERTING
   #undef Y2_DRIVER_TYPE
   #undef Y_ENABLE_ON
   #undef DISABLE_Y
   #undef INVERT_Y_DIR
   #undef Y_HOME_DIR
   #undef Y_MIN_POS
   #undef Y_MAX_POS
   #undef MANUAL_Y_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_Y
   #undef MAX_SOFTWARE_ENDSTOP_Y
-  #undef SAFE_BED_LEVELING_START_Y
 #endif
 
 #if !HAS_Z_AXIS
   #undef ENDSTOPPULLUP_ZMIN
   #undef ENDSTOPPULLUP_ZMAX
   #undef Z_MIN_ENDSTOP_INVERTING
   #undef Z_MAX_ENDSTOP_INVERTING
   #undef Z2_DRIVER_TYPE
   #undef Z3_DRIVER_TYPE
   #undef Z4_DRIVER_TYPE
   #undef Z_ENABLE_ON
   #undef DISABLE_Z
   #undef INVERT_Z_DIR
   #undef Z_HOME_DIR
   #undef Z_MIN_POS
   #undef Z_MAX_POS
   #undef MANUAL_Z_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_Z
   #undef MAX_SOFTWARE_ENDSTOP_Z
-  #undef SAFE_BED_LEVELING_START_Z
 #endif
 
 #if !HAS_I_AXIS
   #undef ENDSTOPPULLUP_IMIN
   #undef ENDSTOPPULLUP_IMAX
   #undef I_MIN_ENDSTOP_INVERTING
   #undef I_MAX_ENDSTOP_INVERTING
   #undef I_ENABLE_ON
   #undef DISABLE_I
   #undef INVERT_I_DIR
   #undef I_HOME_DIR
   #undef I_MIN_POS
   #undef I_MAX_POS
   #undef MANUAL_I_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_I
   #undef MAX_SOFTWARE_ENDSTOP_I
-  #undef SAFE_BED_LEVELING_START_I
 #endif
 
 #if !HAS_J_AXIS
   #undef ENDSTOPPULLUP_JMIN
   #undef ENDSTOPPULLUP_JMAX
   #undef J_MIN_ENDSTOP_INVERTING
   #undef J_MAX_ENDSTOP_INVERTING
   #undef J_ENABLE_ON
   #undef DISABLE_J
   #undef INVERT_J_DIR
   #undef J_HOME_DIR
   #undef J_MIN_POS
   #undef J_MAX_POS
   #undef MANUAL_J_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_J
   #undef MAX_SOFTWARE_ENDSTOP_J
-  #undef SAFE_BED_LEVELING_START_J
 #endif
 
 #if !HAS_K_AXIS
   #undef ENDSTOPPULLUP_KMIN
   #undef ENDSTOPPULLUP_KMAX
   #undef K_MIN_ENDSTOP_INVERTING
   #undef K_MAX_ENDSTOP_INVERTING
   #undef K_ENABLE_ON
   #undef DISABLE_K
   #undef INVERT_K_DIR
   #undef K_HOME_DIR
   #undef K_MIN_POS
   #undef K_MAX_POS
   #undef MANUAL_K_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_K
   #undef MAX_SOFTWARE_ENDSTOP_K
-  #undef SAFE_BED_LEVELING_START_K
 #endif
 
 #if !HAS_U_AXIS
   #undef ENDSTOPPULLUP_UMIN
   #undef ENDSTOPPULLUP_UMAX
   #undef U_MIN_ENDSTOP_INVERTING
   #undef U_MAX_ENDSTOP_INVERTING
   #undef U_ENABLE_ON
   #undef DISABLE_U
   #undef INVERT_U_DIR
   #undef U_HOME_DIR
   #undef U_MIN_POS
   #undef U_MAX_POS
   #undef MANUAL_U_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_U
   #undef MAX_SOFTWARE_ENDSTOP_U
-  #undef SAFE_BED_LEVELING_START_U
 #endif
 
 #if !HAS_V_AXIS
   #undef ENDSTOPPULLUP_VMIN
   #undef ENDSTOPPULLUP_VMAX
   #undef V_MIN_ENDSTOP_INVERTING
   #undef V_MAX_ENDSTOP_INVERTING
   #undef V_ENABLE_ON
   #undef DISABLE_V
   #undef INVERT_V_DIR
   #undef V_HOME_DIR
   #undef V_MIN_POS
   #undef V_MAX_POS
   #undef MANUAL_V_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_V
   #undef MAX_SOFTWARE_ENDSTOP_V
-  #undef SAFE_BED_LEVELING_START_V
 #endif
 
 #if !HAS_W_AXIS
   #undef ENDSTOPPULLUP_WMIN
   #undef ENDSTOPPULLUP_WMAX
   #undef W_MIN_ENDSTOP_INVERTING
   #undef W_MAX_ENDSTOP_INVERTING
   #undef W_ENABLE_ON
   #undef DISABLE_W
   #undef INVERT_W_DIR
   #undef W_HOME_DIR
   #undef W_MIN_POS
   #undef W_MAX_POS
   #undef MANUAL_W_HOME_POS
   #undef MIN_SOFTWARE_ENDSTOP_W
   #undef MAX_SOFTWARE_ENDSTOP_W
-  #undef SAFE_BED_LEVELING_START_W
 #endif
 
 #ifdef X2_DRIVER_TYPE
   #define HAS_X2_STEPPER 1
   // Dual X Carriage isn't known yet. TODO: Consider moving it to Configuration.h.
 #endif
 #ifdef Y2_DRIVER_TYPE
   #define HAS_Y2_STEPPER 1
   #define HAS_DUAL_Y_STEPPERS 1
 #endif
@@ -1658,21 +1648,23 @@
 #if !(defined(TOUCH_CALIBRATION_X) || defined(TOUCH_CALIBRATION_Y) || defined(TOUCH_OFFSET_X) || defined(TOUCH_OFFSET_Y) || defined(TOUCH_ORIENTATION))
   #if defined(XPT2046_X_CALIBRATION) && defined(XPT2046_Y_CALIBRATION) && defined(XPT2046_X_OFFSET) && defined(XPT2046_Y_OFFSET)
     #define TOUCH_CALIBRATION_X  XPT2046_X_CALIBRATION
     #define TOUCH_CALIBRATION_Y  XPT2046_Y_CALIBRATION
     #define TOUCH_OFFSET_X       XPT2046_X_OFFSET
     #define TOUCH_OFFSET_Y       XPT2046_Y_OFFSET
     #define TOUCH_ORIENTATION    TOUCH_LANDSCAPE
   #endif
 #endif
 
-#if X_HOME_DIR || (HAS_Y_AXIS && Y_HOME_DIR) || (HAS_Z_AXIS && Z_HOME_DIR) || (HAS_I_AXIS && I_HOME_DIR) || (HAS_J_AXIS && J_HOME_DIR) || (HAS_K_AXIS && K_HOME_DIR)
+#if X_HOME_DIR || (HAS_Y_AXIS && Y_HOME_DIR) || (HAS_Z_AXIS && Z_HOME_DIR) \
+  || (HAS_I_AXIS && I_HOME_DIR) || (HAS_J_AXIS && J_HOME_DIR) || (HAS_K_AXIS && K_HOME_DIR) \
+  || (HAS_U_AXIS && U_HOME_DIR) || (HAS_V_AXIS && V_HOME_DIR) || (HAS_W_AXIS && W_HOME_DIR)
   #define HAS_ENDSTOPS 1
   #define COORDINATE_OKAY(N,L,H) WITHIN(N,L,H)
 #else
   #define COORDINATE_OKAY(N,L,H) true
 #endif
 
 /**
  * LED Backlight INDEX END
  */
 #if defined(NEOPIXEL_BKGD_INDEX_FIRST) && !defined(NEOPIXEL_BKGD_INDEX_LAST)

commit ab767a4586a5c0c9ca1c7afeb43d0ee226a1e38d
Author: alexgrach <gav@bmstu.ru>
Date:   Fri Jan 27 03:20:09 2023 +0300

    üêõ Fix TFT Color UI LCD_HEIGHT (#25281)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b411d3e7c6..c4926edd51 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1613,23 +1613,25 @@
 #if EITHER(TFT_320x240, TFT_320x240_SPI)
   #define HAS_UI_320x240 1
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
 #elif EITHER(TFT_480x272, TFT_480x272_SPI)
   #define HAS_UI_480x272 1
 #elif EITHER(TFT_1024x600_LTDC, TFT_1024x600_SIM)
   #define HAS_UI_1024x600 1
 #endif
 #if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
-  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)   // Fewer lines with touch buttons onscreen
-#elif HAS_UI_240x320
-  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 8, 6)   // Fewer lines with touch buttons onscreen
+  #if ENABLED(TFT_COLOR_UI_PORTRAIT)
+    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
+  #else
+    #define LCD_HEIGHT TERN(TOUCH_SCREEN, 8, 9) // Fewer lines with touch buttons onscreen
+  #endif
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN)
   #if TOUCH_IDLE_SLEEP_MINS
     #define HAS_TOUCH_SLEEP 1
   #endif
   #if NONE(TFT_TOUCH_DEVICE_GT911, TFT_TOUCH_DEVICE_XPT2046)

commit 4f902ac950e02d1d4e4b13afdec46937364ec22d
Author: Alexander Gavrilenko <jmz52@users.noreply.github.com>
Date:   Thu Jan 26 07:05:43 2023 +0300

    üêõ Fix Simulator TFT compile (#25279)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index af9dd22557..b411d3e7c6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1542,43 +1542,22 @@
   #endif
 #elif ENABLED(TFT_INTERFACE_LTDC)
   #define HAS_LTDC_TFT 1
   #if TFT_SCALED_DOGLCD
     #define HAS_LTDC_GRAPHICAL_TFT 1
   #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_LTDC 1
   #endif
 #endif
 
-// Set TFT_COLOR_UI_PORTRAIT flag, if needed
-#if defined(TFT_ROTATION) && (HAS_SPI_TFT || HAS_FSMC_TFT || HAS_LTDC_TFT)
-  #define _CMP_TFT_ROTATE_90   90
-  #define _CMP_TFT_ROTATE_270 270
-  #define _CMP_TFT_ROTATE_90_MIRROR_X   90
-  #define _CMP_TFT_ROTATE_90_MIRROR_Y   90
-  #define _CMP_TFT_ROTATE_270_MIRROR_X 270
-  #define _CMP_TFT_ROTATE_270_MIRROR_Y 270
-  #define _ISROT(N) || (_CAT(_CMP_, TFT_ROTATION) == N)
-  #define ISROT(V...) (0 MAP(_ISROT, V))
-
-  #if ISROT(90, 270)
-    #define TFT_COLOR_UI_PORTRAIT 1
-  #endif
-
-  #undef _CMP_TFT_ROTATE_90
-  #undef _CMP_TFT_ROTATE_270
-  #undef _CMP_TFT_ROTATE_90_MIRROR_X
-  #undef _CMP_TFT_ROTATE_90_MIRROR_Y
-  #undef _CMP_TFT_ROTATE_270_MIRROR_X
-  #undef _CMP_TFT_ROTATE_270_MIRROR_Y
-  #undef _ISROT
-  #undef ISROT
+#if ANY(HAS_SPI_TFT, HAS_FSMC_TFT, HAS_LTDC_TFT)
+  #include "../lcd/tft_io/tft_orientation.h"
 #endif
 
 #if ENABLED(TFT_RES_320x240)
   #if ENABLED(TFT_COLOR_UI_PORTRAIT)
     #define TFT_WIDTH  240
     #define TFT_HEIGHT 320
   #else
     #define TFT_WIDTH  320
     #define TFT_HEIGHT 240
   #endif

commit 99d1b04a1f1d66aef78994fd98189a9ba9acbcb1
Author: alexgrach <gav@bmstu.ru>
Date:   Wed Jan 18 02:37:19 2023 +0300

    ‚ú® TFT 320x240 portrait (#25207)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 88d7c91c6e..af9dd22557 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -317,21 +317,21 @@
 #if ANY(ULTIMAKERCONTROLLER, IS_RRD_SC, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
   #define IS_ULTIPANEL 1
 #endif
 
 // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
 #if ENABLED(U8GLIB_SH1106_EINSTART)
   #define DOGLCD
   #define IS_ULTIPANEL 1
 #endif
 
-// TFT Compatibility
+// TFT Legacy Compatibility
 #if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
   #define IS_LEGACY_TFT 1
   #define TFT_GENERIC
 #endif
 
 #if ANY(FSMC_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_LVGL_UI_FSMC)
   #define TFT_INTERFACE_FSMC
 #elif ANY(SPI_GRAPHICAL_TFT, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_SPI)
   #define TFT_INTERFACE_SPI
 #endif
@@ -1518,44 +1518,20 @@
 #elif ENABLED(TFT_GENERIC)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #if NONE(TFT_RES_320x240, TFT_RES_480x272, TFT_RES_480x320, TFT_RES_1024x600)
     #define TFT_RES_320x240
   #endif
   #if NONE(TFT_INTERFACE_FSMC, TFT_INTERFACE_SPI)
     #define TFT_INTERFACE_SPI
   #endif
 #endif
 
-#if ENABLED(TFT_RES_320x240)
-  #define TFT_WIDTH  320
-  #define TFT_HEIGHT 240
-  #define GRAPHICAL_TFT_UPSCALE 2
-#elif ENABLED(TFT_RES_480x272)
-  #define TFT_WIDTH  480
-  #define TFT_HEIGHT 272
-  #define GRAPHICAL_TFT_UPSCALE 2
-#elif ENABLED(TFT_RES_480x320)
-  #define TFT_WIDTH  480
-  #define TFT_HEIGHT 320
-  #define GRAPHICAL_TFT_UPSCALE 3
-#elif ENABLED(TFT_RES_1024x600)
-  #define TFT_WIDTH  1024
-  #define TFT_HEIGHT 600
-  #if ENABLED(TOUCH_SCREEN)
-    #define GRAPHICAL_TFT_UPSCALE 6
-    #define TFT_PIXEL_OFFSET_X 120
-  #else
-    #define GRAPHICAL_TFT_UPSCALE 8
-    #define TFT_PIXEL_OFFSET_X 0
-  #endif
-#endif
-
 // FSMC/SPI TFT Panels using standard HAL/tft/tft_(fsmc|spi|ltdc).h
 #if ENABLED(TFT_INTERFACE_FSMC)
   #define HAS_FSMC_TFT 1
   #if TFT_SCALED_DOGLCD
     #define HAS_FSMC_GRAPHICAL_TFT 1
   #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_FSMC 1
   #endif
 #elif ENABLED(TFT_INTERFACE_SPI)
   #define HAS_SPI_TFT 1
@@ -1566,22 +1542,76 @@
   #endif
 #elif ENABLED(TFT_INTERFACE_LTDC)
   #define HAS_LTDC_TFT 1
   #if TFT_SCALED_DOGLCD
     #define HAS_LTDC_GRAPHICAL_TFT 1
   #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_LTDC 1
   #endif
 #endif
 
+// Set TFT_COLOR_UI_PORTRAIT flag, if needed
+#if defined(TFT_ROTATION) && (HAS_SPI_TFT || HAS_FSMC_TFT || HAS_LTDC_TFT)
+  #define _CMP_TFT_ROTATE_90   90
+  #define _CMP_TFT_ROTATE_270 270
+  #define _CMP_TFT_ROTATE_90_MIRROR_X   90
+  #define _CMP_TFT_ROTATE_90_MIRROR_Y   90
+  #define _CMP_TFT_ROTATE_270_MIRROR_X 270
+  #define _CMP_TFT_ROTATE_270_MIRROR_Y 270
+  #define _ISROT(N) || (_CAT(_CMP_, TFT_ROTATION) == N)
+  #define ISROT(V...) (0 MAP(_ISROT, V))
+
+  #if ISROT(90, 270)
+    #define TFT_COLOR_UI_PORTRAIT 1
+  #endif
+
+  #undef _CMP_TFT_ROTATE_90
+  #undef _CMP_TFT_ROTATE_270
+  #undef _CMP_TFT_ROTATE_90_MIRROR_X
+  #undef _CMP_TFT_ROTATE_90_MIRROR_Y
+  #undef _CMP_TFT_ROTATE_270_MIRROR_X
+  #undef _CMP_TFT_ROTATE_270_MIRROR_Y
+  #undef _ISROT
+  #undef ISROT
+#endif
+
+#if ENABLED(TFT_RES_320x240)
+  #if ENABLED(TFT_COLOR_UI_PORTRAIT)
+    #define TFT_WIDTH  240
+    #define TFT_HEIGHT 320
+  #else
+    #define TFT_WIDTH  320
+    #define TFT_HEIGHT 240
+  #endif
+  #define GRAPHICAL_TFT_UPSCALE 2
+#elif ENABLED(TFT_RES_480x272)
+  #define TFT_WIDTH  480
+  #define TFT_HEIGHT 272
+  #define GRAPHICAL_TFT_UPSCALE 2
+#elif ENABLED(TFT_RES_480x320)
+  #define TFT_WIDTH  480
+  #define TFT_HEIGHT 320
+  #define GRAPHICAL_TFT_UPSCALE 3
+#elif ENABLED(TFT_RES_1024x600)
+  #define TFT_WIDTH  1024
+  #define TFT_HEIGHT 600
+  #if ENABLED(TOUCH_SCREEN)
+    #define GRAPHICAL_TFT_UPSCALE 6
+    #define TFT_PIXEL_OFFSET_X 120
+  #else
+    #define GRAPHICAL_TFT_UPSCALE 8
+    #define TFT_PIXEL_OFFSET_X 0
+  #endif
+#endif
+
 #if ENABLED(TFT_COLOR_UI)
-  #if TFT_HEIGHT == 240
+  #if (TFT_WIDTH == 320 && TFT_HEIGHT == 240) || (TFT_WIDTH == 240 && TFT_HEIGHT == 320)
     #if ENABLED(TFT_INTERFACE_SPI)
       #define TFT_320x240_SPI
     #elif ENABLED(TFT_INTERFACE_FSMC)
       #define TFT_320x240
     #endif
   #elif TFT_HEIGHT == 320
     #if ENABLED(TFT_INTERFACE_SPI)
       #define TFT_480x320_SPI
     #elif ENABLED(TFT_INTERFACE_FSMC)
       #define TFT_480x320
@@ -1605,20 +1635,22 @@
   #define HAS_UI_320x240 1
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
 #elif EITHER(TFT_480x272, TFT_480x272_SPI)
   #define HAS_UI_480x272 1
 #elif EITHER(TFT_1024x600_LTDC, TFT_1024x600_SIM)
   #define HAS_UI_1024x600 1
 #endif
 #if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)   // Fewer lines with touch buttons onscreen
+#elif HAS_UI_240x320
+  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 8, 6)   // Fewer lines with touch buttons onscreen
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN)
   #if TOUCH_IDLE_SLEEP_MINS
     #define HAS_TOUCH_SLEEP 1
   #endif
   #if NONE(TFT_TOUCH_DEVICE_GT911, TFT_TOUCH_DEVICE_XPT2046)

commit 01e58de31a804731d21c491952afd2347fda3753
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Jan 10 22:38:08 2023 -0600

    ü©π ProUI - Remove ManualZOffset

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5463e9169c..88d7c91c6e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1291,20 +1291,21 @@
     #if EXTRA_PROBING > 0
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef USE_PROBE_FOR_Z_HOMING
+  #undef Z_MIN_PROBE_REPEATABILITY_TEST
 #endif
 
 #if ENABLED(BELTPRINTER) && !defined(HOME_Y_BEFORE_X)
   #define HOME_Y_BEFORE_X
 #endif
 
 #if Z_HOME_TO_MAX && DISABLED(Z_SAFE_HOMING)
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 

commit 7717beb79362522b8239d5af62b32ff3d0e2d748
Author: kadir ilkimen <kadirilkimen@gmail.com>
Date:   Wed Jan 11 06:29:38 2023 +0200

    ‚ú® Polar Kinematics (#25214)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0a66284df6..5463e9169c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1399,21 +1399,21 @@
 #elif EITHER(MARKFORGED_XY, MARKFORGED_YX)
   // Markforged kinematics
   #define CORE_AXIS_1 A_AXIS
   #define CORE_AXIS_2 B_AXIS
   #define NORMAL_AXIS Z_AXIS
 #endif
 
 #if ANY(MORGAN_SCARA, MP_SCARA, AXEL_TPARA)
   #define IS_SCARA 1
   #define IS_KINEMATIC 1
-#elif EITHER(DELTA, POLARGRAPH)
+#elif ANY(DELTA, POLARGRAPH, POLAR)
   #define IS_KINEMATIC 1
 #else
   #define IS_CARTESIAN 1
   #if !IS_CORE
     #define IS_FULL_CARTESIAN 1
   #endif
 #endif
 
 #if DISABLED(DELTA)
   #undef DELTA_HOME_TO_SAFE_ZONE

commit c3fe4abd446336c50bdb892f08fa24a08f1bdda5
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Jan 7 22:59:25 2023 -0600

    üî® DGUS_LCD_UI version check

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 6a1d0dbefb..0a66284df6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -29,33 +29,33 @@
 // MKS_LCD12864A/B is a variant of MKS_MINI_12864
 #if EITHER(MKS_LCD12864A, MKS_LCD12864B)
   #define MKS_MINI_12864
 #endif
 
 // MKS_MINI_12864_V3 and BTT_MINI_12864_V1 are identical to FYSETC_MINI_12864_2_1
 #if EITHER(MKS_MINI_12864_V3, BTT_MINI_12864_V1)
   #define FYSETC_MINI_12864_2_1
 #endif
 
-// Updated DGUS_UI shorthand single option can be used, or old settings, for now
+// Old settings are now conditional on DGUS_LCD_UI
 #if DGUS_UI_IS(ORIGIN)
-  #define DGUS_LCD_UI_ORIGIN
+  #define DGUS_LCD_UI_ORIGIN 1
 #elif DGUS_UI_IS(FYSETC)
-  #define DGUS_LCD_UI_FYSETC
+  #define DGUS_LCD_UI_FYSETC 1
 #elif DGUS_UI_IS(HIPRECY)
-  #define DGUS_LCD_UI_HIPRECY
+  #define DGUS_LCD_UI_HIPRECY 1
 #elif DGUS_UI_IS(MKS)
-  #define DGUS_LCD_UI_MKS
+  #define DGUS_LCD_UI_MKS 1
 #elif DGUS_UI_IS(RELOADED)
-  #define DGUS_LCD_UI_RELOADED
+  #define DGUS_LCD_UI_RELOADED 1
 #elif DGUS_UI_IS(IA_CREALITY)
-  #define DGUS_LCD_UI_IA_CREALITY
+  #define DGUS_LCD_UI_IA_CREALITY 1
 #endif
 
 /**
  * General Flags that may be set below by specific LCDs
  *
  *  DOGLCD                  : Run a Graphical LCD through U8GLib (with MarlinUI)
  *  IS_ULTIPANEL            : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
  *  HAS_WIRED_LCD           : Ultra LCD, not necessarily Ultipanel.
  *  IS_RRD_SC               : Common RRD Smart Controller digital interface pins
  *  IS_RRD_FG_SC            : Common RRD Full Graphical Smart Controller digital interface pins

commit 32e8627510498da3a88d9e198f7c17a6a2ad8a66
Author: ellensp <530024+ellensp@users.noreply.github.com>
Date:   Sun Jan 1 15:38:13 2023 +1300

    ‚ú® New DGUS_LCD_UI option, IA_CREALITY (#25143)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 56cbf1324c..6a1d0dbefb 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -29,20 +29,35 @@
 // MKS_LCD12864A/B is a variant of MKS_MINI_12864
 #if EITHER(MKS_LCD12864A, MKS_LCD12864B)
   #define MKS_MINI_12864
 #endif
 
 // MKS_MINI_12864_V3 and BTT_MINI_12864_V1 are identical to FYSETC_MINI_12864_2_1
 #if EITHER(MKS_MINI_12864_V3, BTT_MINI_12864_V1)
   #define FYSETC_MINI_12864_2_1
 #endif
 
+// Updated DGUS_UI shorthand single option can be used, or old settings, for now
+#if DGUS_UI_IS(ORIGIN)
+  #define DGUS_LCD_UI_ORIGIN
+#elif DGUS_UI_IS(FYSETC)
+  #define DGUS_LCD_UI_FYSETC
+#elif DGUS_UI_IS(HIPRECY)
+  #define DGUS_LCD_UI_HIPRECY
+#elif DGUS_UI_IS(MKS)
+  #define DGUS_LCD_UI_MKS
+#elif DGUS_UI_IS(RELOADED)
+  #define DGUS_LCD_UI_RELOADED
+#elif DGUS_UI_IS(IA_CREALITY)
+  #define DGUS_LCD_UI_IA_CREALITY
+#endif
+
 /**
  * General Flags that may be set below by specific LCDs
  *
  *  DOGLCD                  : Run a Graphical LCD through U8GLib (with MarlinUI)
  *  IS_ULTIPANEL            : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
  *  HAS_WIRED_LCD           : Ultra LCD, not necessarily Ultipanel.
  *  IS_RRD_SC               : Common RRD Smart Controller digital interface pins
  *  IS_RRD_FG_SC            : Common RRD Full Graphical Smart Controller digital interface pins
  *  IS_U8GLIB_ST7920        : Most common DOGM display SPI interface, supporting a "lightweight" display mode.
  *  U8GLIB_SH1106           : SH1106 OLED with I2C interface via U8GLib
@@ -455,26 +470,25 @@
 #endif
 
 #if EITHER(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
   #define IS_RRW_KEYPAD 1
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
-#if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY, DGUS_LCD_UI_MKS)
-  #define HAS_DGUS_LCD_CLASSIC 1
-#endif
-
-#if EITHER(HAS_DGUS_LCD_CLASSIC, DGUS_LCD_UI_RELOADED)
+#if !DGUS_UI_IS(NONE)
   #define HAS_DGUS_LCD 1
+  #if DGUS_UI_IS(ORIGIN, FYSETC, HIPRECY, MKS)
+    #define HAS_DGUS_LCD_CLASSIC 1
+  #endif
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)

commit 0c0ed150660543df84e8acdcd46de5e316c19f05
Author: Lukas Erlacher <l.erlacher@googlemail.com>
Date:   Sat Dec 31 14:38:01 2022 +1100

    üö∏ Z Servo Probe is HAS_STOWABLE_PROBE (#25158)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 545d553494..56cbf1324c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1080,24 +1080,24 @@
 #if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
   #define HAS_SERVO_ANGLES 1
 #endif
 #if !HAS_SERVO_ANGLES
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
  * Set flags for any form of bed probe
  */
-#if ANY(TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, SOLENOID_PROBE, Z_PROBE_SLED, RACK_AND_PINION_PROBE, SENSORLESS_PROBING, MAGLEV4, MAG_MOUNTED_PROBE)
+#if ANY(TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, HAS_Z_SERVO_PROBE, SOLENOID_PROBE, Z_PROBE_SLED, RACK_AND_PINION_PROBE, SENSORLESS_PROBING, MAGLEV4, MAG_MOUNTED_PROBE)
   #define HAS_STOWABLE_PROBE 1
 #endif
-#if ANY(HAS_STOWABLE_PROBE, HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, BD_SENSOR, NOZZLE_AS_PROBE)
+#if ANY(HAS_STOWABLE_PROBE, FIX_MOUNTED_PROBE, BD_SENSOR, NOZZLE_AS_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
 /**
  * Fill in undefined Filament Sensor options
  */
 #if ENABLED(FILAMENT_RUNOUT_SENSOR)
   #if NUM_RUNOUT_SENSORS >= 1
     #ifndef FIL_RUNOUT1_STATE
       #define FIL_RUNOUT1_STATE FIL_RUNOUT_STATE

commit 13c87c5b266ee767885c4347b0fd55a2f65c0125
Author: ellensp <530024+ellensp@users.noreply.github.com>
Date:   Tue Dec 13 12:01:45 2022 +1300

    ü©π Inverted probe pin flag (K8400) (#25085)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 49a2dc5f5c..545d553494 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1062,34 +1062,20 @@
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif
-  #ifdef DEACTIVATE_SERVOS_AFTER_MOVE
-    #error "BLTOUCH requires DEACTIVATE_SERVOS_AFTER_MOVE to be to disabled. Please update your Configuration.h file."
-  #endif
-
-  // Always disable probe pin inverting for BLTouch
-  #if Z_MIN_PROBE_ENDSTOP_INVERTING
-    #error "BLTOUCH requires Z_MIN_PROBE_ENDSTOP_INVERTING set to false. Please update your Configuration.h file."
-  #endif
-
-  #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
-    #if Z_MIN_ENDSTOP_INVERTING
-      #error "BLTOUCH requires Z_MIN_ENDSTOP_INVERTING set to false. Please update your Configuration.h file."
-    #endif
-  #endif
 #endif
 
 /**
  * Set a flag for a servo probe (or BLTouch)
  */
 #ifdef Z_PROBE_SERVO_NR
   #define HAS_Z_SERVO_PROBE 1
 #endif
 #if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
   #define HAS_SERVO_ANGLES 1

commit 049cfe659c8e4af282c50169ebbed98638a013fa
Author: Bart Meijer <brupje@gmail.com>
Date:   Mon Dec 12 22:36:50 2022 +0100

    ‚ú® SAMD21 HAL / Minitronics v2.0 (#24976)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c1b43d2fc0..49a2dc5f5c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -130,20 +130,21 @@
 
   #define LCD_I2C_TYPE_PCA8574
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
   #define IS_ULTIPANEL 1
 
 #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
   #define DOGLCD
   #define IS_U8GLIB_ST7920 1
   #define IS_ULTIPANEL 1
+  #define ENCODER_PULSES_PER_STEP 2
 
 #elif ENABLED(MKS_12864OLED)
 
   #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC 1
   #define IS_U8GLIB_SSD1306

commit 726321bc845bb45628a62158059157b455c9d39b
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Nov 4 20:10:59 2022 -0500

    ü©π MAX Thermocouple followup
    
    Followup to #24898

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b21eca30b2..c1b43d2fc0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1013,22 +1013,25 @@
   #endif
   #if HOTENDS > 1
     #define HAS_MULTI_HOTEND 1
     #define HAS_HOTEND_OFFSET 1
   #endif
 #else
   #undef PID_PARAMS_PER_HOTEND
 #endif
 
 // Helper macros for extruder and hotend arrays
-#define EXTRUDER_LOOP() for (int8_t e = 0; e < EXTRUDERS; e++)
-#define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
+#define _EXTRUDER_LOOP(E) for (int8_t E = 0; E < EXTRUDERS; E++)
+#define EXTRUDER_LOOP() _EXTRUDER_LOOP(e)
+#define _HOTEND_LOOP(H) for (int8_t H = 0; H < HOTENDS; H++)
+#define HOTEND_LOOP() _HOTEND_LOOP(e)
+
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_N_1(EXTRUDERS, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
 #define ARRAY_BY_HOTENDS1(v1) ARRAY_N_1(HOTENDS, v1)
 
 /**
  * Default hotend offsets, if not defined
  */
 #if HAS_HOTEND_OFFSET
   #ifndef HOTEND_OFFSET_X

commit 52096599b30d4d49b3fee61a85102054a2d298d8
Author: karliss <karlis3p70l1ij@gmail.com>
Date:   Tue Oct 18 04:01:18 2022 +0300

    üêõ Fix compile without Y/Z (#24858)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7f6857a3e0..b21eca30b2 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1197,59 +1197,75 @@
     #endif
   #endif
 #endif // FILAMENT_RUNOUT_SENSOR
 
 // Homing to Min or Max
 #if X_HOME_DIR > 0
   #define X_HOME_TO_MAX 1
 #elif X_HOME_DIR < 0
   #define X_HOME_TO_MIN 1
 #endif
-#if Y_HOME_DIR > 0
-  #define Y_HOME_TO_MAX 1
-#elif Y_HOME_DIR < 0
-  #define Y_HOME_TO_MIN 1
-#endif
-#if Z_HOME_DIR > 0
-  #define Z_HOME_TO_MAX 1
-#elif Z_HOME_DIR < 0
-  #define Z_HOME_TO_MIN 1
-#endif
-#if I_HOME_DIR > 0
-  #define I_HOME_TO_MAX 1
-#elif I_HOME_DIR < 0
-  #define I_HOME_TO_MIN 1
-#endif
-#if J_HOME_DIR > 0
-  #define J_HOME_TO_MAX 1
-#elif J_HOME_DIR < 0
-  #define J_HOME_TO_MIN 1
-#endif
-#if K_HOME_DIR > 0
-  #define K_HOME_TO_MAX 1
-#elif K_HOME_DIR < 0
-  #define K_HOME_TO_MIN 1
-#endif
-#if U_HOME_DIR > 0
-  #define U_HOME_TO_MAX 1
-#elif U_HOME_DIR < 0
-  #define U_HOME_TO_MIN 1
-#endif
-#if V_HOME_DIR > 0
-  #define V_HOME_TO_MAX 1
-#elif V_HOME_DIR < 0
-  #define V_HOME_TO_MIN 1
-#endif
-#if W_HOME_DIR > 0
-  #define W_HOME_TO_MAX 1
-#elif W_HOME_DIR < 0
-  #define W_HOME_TO_MIN 1
+#if HAS_Y_AXIS
+  #if Y_HOME_DIR > 0
+    #define Y_HOME_TO_MAX 1
+  #elif Y_HOME_DIR < 0
+    #define Y_HOME_TO_MIN 1
+  #endif
+#endif
+#if HAS_Z_AXIS
+  #if Z_HOME_DIR > 0
+    #define Z_HOME_TO_MAX 1
+  #elif Z_HOME_DIR < 0
+    #define Z_HOME_TO_MIN 1
+  #endif
+#endif
+#if HAS_I_AXIS
+  #if I_HOME_DIR > 0
+    #define I_HOME_TO_MAX 1
+  #elif I_HOME_DIR < 0
+    #define I_HOME_TO_MIN 1
+  #endif
+#endif
+#if HAS_J_AXIS
+  #if J_HOME_DIR > 0
+    #define J_HOME_TO_MAX 1
+  #elif J_HOME_DIR < 0
+    #define J_HOME_TO_MIN 1
+  #endif
+#endif
+#if HAS_K_AXIS
+  #if K_HOME_DIR > 0
+    #define K_HOME_TO_MAX 1
+  #elif K_HOME_DIR < 0
+    #define K_HOME_TO_MIN 1
+  #endif
+#endif
+#if HAS_U_AXIS
+  #if U_HOME_DIR > 0
+    #define U_HOME_TO_MAX 1
+  #elif U_HOME_DIR < 0
+    #define U_HOME_TO_MIN 1
+  #endif
+#endif
+#if HAS_V_AXIS
+  #if V_HOME_DIR > 0
+    #define V_HOME_TO_MAX 1
+  #elif V_HOME_DIR < 0
+    #define V_HOME_TO_MIN 1
+  #endif
+#endif
+#if HAS_W_AXIS
+  #if W_HOME_DIR > 0
+    #define W_HOME_TO_MAX 1
+  #elif W_HOME_DIR < 0
+    #define W_HOME_TO_MIN 1
+  #endif
 #endif
 
 /**
  * Conditionals based on the type of Bed Probe
  */
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if BOTH(DELTA, SENSORLESS_PROBING)

commit e37a23231aa6ebe5520b42f54720b76f7414c56a
Author: mjbogusz <mjbogusz@users.noreply.github.com>
Date:   Sat Oct 15 01:59:31 2022 +0200

    ü©π Fix TFT LCD in Simulation (#24871)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 47ae0a6dff..7f6857a3e0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1489,21 +1489,21 @@
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(BIQU_BX_TFT70)                                                  // RGB
   #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_1024x600
   #define TFT_INTERFACE_LTDC
   #if ENABLED(TOUCH_SCREEN)
     #define TFT_TOUCH_DEVICE_GT911
   #endif
 #elif ENABLED(TFT_GENERIC)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
-  #if NONE(TFT_RES_320x240, TFT_RES_480x272, TFT_RES_480x320)
+  #if NONE(TFT_RES_320x240, TFT_RES_480x272, TFT_RES_480x320, TFT_RES_1024x600)
     #define TFT_RES_320x240
   #endif
   #if NONE(TFT_INTERFACE_FSMC, TFT_INTERFACE_SPI)
     #define TFT_INTERFACE_SPI
   #endif
 #endif
 
 #if ENABLED(TFT_RES_320x240)
   #define TFT_WIDTH  320
   #define TFT_HEIGHT 240
@@ -1567,31 +1567,33 @@
     #endif
   #elif TFT_HEIGHT == 272
     #if ENABLED(TFT_INTERFACE_SPI)
       #define TFT_480x272_SPI
     #elif ENABLED(TFT_INTERFACE_FSMC)
       #define TFT_480x272
     #endif
   #elif TFT_HEIGHT == 600
     #if ENABLED(TFT_INTERFACE_LTDC)
       #define TFT_1024x600_LTDC
+    #else
+      #define TFT_1024x600_SIM  // "Simulation" - for testing purposes only
     #endif
   #endif
 #endif
 
 #if EITHER(TFT_320x240, TFT_320x240_SPI)
   #define HAS_UI_320x240 1
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
 #elif EITHER(TFT_480x272, TFT_480x272_SPI)
   #define HAS_UI_480x272 1
-#elif defined(TFT_1024x600_LTDC)
+#elif EITHER(TFT_1024x600_LTDC, TFT_1024x600_SIM)
   #define HAS_UI_1024x600 1
 #endif
 #if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)   // Fewer lines with touch buttons onscreen
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN)

commit efde96131d9e9288dc2ea28b548f691a184fb33e
Author: Giuliano Zaro <3684609+GMagician@users.noreply.github.com>
Date:   Mon Oct 10 20:49:37 2022 +0200

    ‚ú® ADVANCE_K per-extruder (#24821)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e1c764f9f0..47ae0a6dff 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -983,21 +983,21 @@
 
 /**
  * DISTINCT_E_FACTORS is set to give extruders (some) individual settings.
  *
  * DISTINCT_AXES is the number of distinct addressable axes (not steppers).
  *  Includes all linear axes plus all distinguished extruders.
  *  The default behavior is to treat all extruders as a single E axis
  *  with shared motion and temperature settings.
  *
  * DISTINCT_E is the number of distinguished extruders. By default this
- *  well be 1 which indicates all extruders share the same settings.
+ *  will be 1 which indicates all extruders share the same settings.
  *
  * E_INDEX_N(E) should be used to get the E index of any item that might be
  *  distinguished.
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define DISTINCT_AXES (NUM_AXES + E_STEPPERS)
   #define DISTINCT_E E_STEPPERS
   #define E_INDEX_N(E) (E)
 #else
   #undef DISTINCT_E_FACTORS

commit f595e40ceb0c79d7f0d6438636658dfcfa2a75b8
Author: EvilGremlin <22657714+EvilGremlin@users.noreply.github.com>
Date:   Sun Oct 9 18:30:47 2022 +0300

    ‚ôªÔ∏è Set Progress without LCD (#24767)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5e23cedc4d..e1c764f9f0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -522,24 +522,20 @@
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_MARLINUI_MENU 1
 #endif
 
 #if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
   #define HAS_MANUAL_MOVE_MENU 1
 #endif
 
-#if ANY(HAS_MARLINUI_U8GLIB, EXTENSIBLE_UI, HAS_MARLINUI_HD44780, IS_TFTGLCD_PANEL, IS_DWIN_MARLINUI, DWIN_CREALITY_LCD_JYERSUI)
-  #define CAN_SHOW_REMAINING_TIME 1
-#endif
-
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
   #endif
   #ifndef LCD_PIXEL_HEIGHT
     #define LCD_PIXEL_HEIGHT 64
   #endif
 #endif
 
 /**

commit 2f91154cbdcec3b81da9913bdd16556e8c775d06
Author: EvilGremlin <22657714+EvilGremlin@users.noreply.github.com>
Date:   Thu Aug 25 20:16:55 2022 +0300

    ‚ôªÔ∏è Display sleep minutes, encoder disable option (#24618)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a6c9f0ae43..5e23cedc4d 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1592,21 +1592,21 @@
   #define HAS_UI_1024x600 1
 #endif
 #if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)   // Fewer lines with touch buttons onscreen
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN)
-  #if TOUCH_IDLE_SLEEP
+  #if TOUCH_IDLE_SLEEP_MINS
     #define HAS_TOUCH_SLEEP 1
   #endif
   #if NONE(TFT_TOUCH_DEVICE_GT911, TFT_TOUCH_DEVICE_XPT2046)
     #define TFT_TOUCH_DEVICE_XPT2046          // ADS7843/XPT2046 ADC Touchscreen such as ILI9341 2.8
   #endif
   #if ENABLED(TFT_TOUCH_DEVICE_GT911)         // GT911 Capacitive touch screen such as BIQU_BX_TFT70
     #undef TOUCH_SCREEN_CALIBRATION
     #undef TOUCH_CALIBRATION_AUTO_SAVE
   #endif
   #if !HAS_GRAPHICAL_TFT

commit 6704c0bc4cf925cc1fb8aa2e461b4c1de0ff0f15
Author: DejitaruJin <dejitarujin@gmail.com>
Date:   Thu Aug 25 13:10:43 2022 -0400

    ü©π Fix SainSmart LCD (#24672)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c1c174da46..a6c9f0ae43 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -366,20 +366,21 @@
     #define LCD_I2C_TYPE_MCP23017 // I2C Character-based 12864 display
     #define LCD_I2C_ADDRESS 0x20  // I2C Address of the port expander
     #define LCD_USE_I2C_BUZZER    // Enable buzzer on LCD (optional)
     #define IS_ULTIPANEL 1
   #endif
 
 #elif EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575    // I2C Character-based 12864 display
   #define LCD_I2C_ADDRESS 0x27    // I2C Address of the port expander
+  #define IS_ULTIPANEL 1
 
   #if ENABLED(LCD_SAINSMART_I2C_2004)
     #define LCD_WIDTH 20
     #define LCD_HEIGHT 4
   #endif
 
 #elif ENABLED(LCD_I2C_VIKI)
 
   /**
    * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs

commit 83320f1052dd09bff7aae789372e7bffccbced97
Author: Mark <niujl123@sina.com>
Date:   Sat Aug 6 14:14:58 2022 +0800

    ‚ú® Bed Distance Sensor (#24554)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a6be04e237..c1c174da46 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1096,21 +1096,21 @@
 #if !HAS_SERVO_ANGLES
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
  * Set flags for any form of bed probe
  */
 #if ANY(TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, SOLENOID_PROBE, Z_PROBE_SLED, RACK_AND_PINION_PROBE, SENSORLESS_PROBING, MAGLEV4, MAG_MOUNTED_PROBE)
   #define HAS_STOWABLE_PROBE 1
 #endif
-#if ANY(HAS_STOWABLE_PROBE, HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE)
+#if ANY(HAS_STOWABLE_PROBE, HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, BD_SENSOR, NOZZLE_AS_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
 /**
  * Fill in undefined Filament Sensor options
  */
 #if ENABLED(FILAMENT_RUNOUT_SENSOR)
   #if NUM_RUNOUT_SENSORS >= 1
     #ifndef FIL_RUNOUT1_STATE
       #define FIL_RUNOUT1_STATE FIL_RUNOUT_STATE

commit 1bed10c38075a15bfec380c9c7763fea336e787e
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Aug 4 02:38:15 2022 -0500

    üîß Config INI, dump options (#24528)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0873c1f525..a6be04e237 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -661,20 +661,45 @@
 #ifndef HOTENDS
   #define HOTENDS EXTRUDERS
 #endif
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
+#if E_STEPPERS <= 7
+  #undef INVERT_E7_DIR
+  #if E_STEPPERS <= 6
+    #undef INVERT_E6_DIR
+    #if E_STEPPERS <= 5
+      #undef INVERT_E5_DIR
+      #if E_STEPPERS <= 4
+        #undef INVERT_E4_DIR
+        #if E_STEPPERS <= 3
+          #undef INVERT_E3_DIR
+          #if E_STEPPERS <= 2
+            #undef INVERT_E2_DIR
+            #if E_STEPPERS <= 1
+              #undef INVERT_E1_DIR
+              #if E_STEPPERS == 0
+                #undef INVERT_E0_DIR
+              #endif
+            #endif
+          #endif
+        #endif
+      #endif
+    #endif
+  #endif
+#endif
+
 /**
  * Number of Linear Axes (e.g., XYZIJKUVW)
  * All the logical axes except for the tool (E) axis
  */
 #ifdef NUM_AXES
   #undef NUM_AXES
   #define NUM_AXES_WARNING 1
 #endif
 
 #ifdef W_DRIVER_TYPE
@@ -761,121 +786,145 @@
   #undef Y_MIN_ENDSTOP_INVERTING
   #undef Y_MAX_ENDSTOP_INVERTING
   #undef Y2_DRIVER_TYPE
   #undef Y_ENABLE_ON
   #undef DISABLE_Y
   #undef INVERT_Y_DIR
   #undef Y_HOME_DIR
   #undef Y_MIN_POS
   #undef Y_MAX_POS
   #undef MANUAL_Y_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_Y
+  #undef MAX_SOFTWARE_ENDSTOP_Y
+  #undef SAFE_BED_LEVELING_START_Y
 #endif
 
 #if !HAS_Z_AXIS
   #undef ENDSTOPPULLUP_ZMIN
   #undef ENDSTOPPULLUP_ZMAX
   #undef Z_MIN_ENDSTOP_INVERTING
   #undef Z_MAX_ENDSTOP_INVERTING
   #undef Z2_DRIVER_TYPE
   #undef Z3_DRIVER_TYPE
   #undef Z4_DRIVER_TYPE
   #undef Z_ENABLE_ON
   #undef DISABLE_Z
   #undef INVERT_Z_DIR
   #undef Z_HOME_DIR
   #undef Z_MIN_POS
   #undef Z_MAX_POS
   #undef MANUAL_Z_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_Z
+  #undef MAX_SOFTWARE_ENDSTOP_Z
+  #undef SAFE_BED_LEVELING_START_Z
 #endif
 
 #if !HAS_I_AXIS
   #undef ENDSTOPPULLUP_IMIN
   #undef ENDSTOPPULLUP_IMAX
   #undef I_MIN_ENDSTOP_INVERTING
   #undef I_MAX_ENDSTOP_INVERTING
   #undef I_ENABLE_ON
   #undef DISABLE_I
   #undef INVERT_I_DIR
   #undef I_HOME_DIR
   #undef I_MIN_POS
   #undef I_MAX_POS
   #undef MANUAL_I_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_I
+  #undef MAX_SOFTWARE_ENDSTOP_I
+  #undef SAFE_BED_LEVELING_START_I
 #endif
 
 #if !HAS_J_AXIS
   #undef ENDSTOPPULLUP_JMIN
   #undef ENDSTOPPULLUP_JMAX
   #undef J_MIN_ENDSTOP_INVERTING
   #undef J_MAX_ENDSTOP_INVERTING
   #undef J_ENABLE_ON
   #undef DISABLE_J
   #undef INVERT_J_DIR
   #undef J_HOME_DIR
   #undef J_MIN_POS
   #undef J_MAX_POS
   #undef MANUAL_J_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_J
+  #undef MAX_SOFTWARE_ENDSTOP_J
+  #undef SAFE_BED_LEVELING_START_J
 #endif
 
 #if !HAS_K_AXIS
   #undef ENDSTOPPULLUP_KMIN
   #undef ENDSTOPPULLUP_KMAX
   #undef K_MIN_ENDSTOP_INVERTING
   #undef K_MAX_ENDSTOP_INVERTING
   #undef K_ENABLE_ON
   #undef DISABLE_K
   #undef INVERT_K_DIR
   #undef K_HOME_DIR
   #undef K_MIN_POS
   #undef K_MAX_POS
   #undef MANUAL_K_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_K
+  #undef MAX_SOFTWARE_ENDSTOP_K
+  #undef SAFE_BED_LEVELING_START_K
 #endif
 
 #if !HAS_U_AXIS
   #undef ENDSTOPPULLUP_UMIN
   #undef ENDSTOPPULLUP_UMAX
   #undef U_MIN_ENDSTOP_INVERTING
   #undef U_MAX_ENDSTOP_INVERTING
   #undef U_ENABLE_ON
   #undef DISABLE_U
   #undef INVERT_U_DIR
   #undef U_HOME_DIR
   #undef U_MIN_POS
   #undef U_MAX_POS
   #undef MANUAL_U_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_U
+  #undef MAX_SOFTWARE_ENDSTOP_U
+  #undef SAFE_BED_LEVELING_START_U
 #endif
 
 #if !HAS_V_AXIS
   #undef ENDSTOPPULLUP_VMIN
   #undef ENDSTOPPULLUP_VMAX
   #undef V_MIN_ENDSTOP_INVERTING
   #undef V_MAX_ENDSTOP_INVERTING
   #undef V_ENABLE_ON
   #undef DISABLE_V
   #undef INVERT_V_DIR
   #undef V_HOME_DIR
   #undef V_MIN_POS
   #undef V_MAX_POS
   #undef MANUAL_V_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_V
+  #undef MAX_SOFTWARE_ENDSTOP_V
+  #undef SAFE_BED_LEVELING_START_V
 #endif
 
 #if !HAS_W_AXIS
   #undef ENDSTOPPULLUP_WMIN
   #undef ENDSTOPPULLUP_WMAX
   #undef W_MIN_ENDSTOP_INVERTING
   #undef W_MAX_ENDSTOP_INVERTING
   #undef W_ENABLE_ON
   #undef DISABLE_W
   #undef INVERT_W_DIR
   #undef W_HOME_DIR
   #undef W_MIN_POS
   #undef W_MAX_POS
   #undef MANUAL_W_HOME_POS
+  #undef MIN_SOFTWARE_ENDSTOP_W
+  #undef MAX_SOFTWARE_ENDSTOP_W
+  #undef SAFE_BED_LEVELING_START_W
 #endif
 
 #ifdef X2_DRIVER_TYPE
   #define HAS_X2_STEPPER 1
   // Dual X Carriage isn't known yet. TODO: Consider moving it to Configuration.h.
 #endif
 #ifdef Y2_DRIVER_TYPE
   #define HAS_Y2_STEPPER 1
   #define HAS_DUAL_Y_STEPPERS 1
 #endif
@@ -1391,20 +1440,24 @@
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
 
+#if ANY(PID_DEBUG, PID_BED_DEBUG, PID_CHAMBER_DEBUG)
+  #define HAS_PID_DEBUG 1
+#endif
+
 /**
  * TFT Displays
  *
  * Configure parameters for TFT displays:
  *  - TFT_DEFAULT_ORIENTATION
  *  - TFT_DRIVER
  *  - TFT_WIDTH
  *  - TFT_HEIGHT
  *  - TFT_INTERFACE_(SPI|FSMC)
  *  - TFT_COLOR

commit 4ffa2e80e4db3413425a575aed14be30bbf2bb24
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Mon Jul 25 12:02:37 2022 -0700

    üì∫ Fix TFT Classic UI non-Touchscreen 1024x600 (#24541)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 95deed7b3f..0873c1f525 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1462,22 +1462,27 @@
   #define TFT_WIDTH  480
   #define TFT_HEIGHT 272
   #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(TFT_RES_480x320)
   #define TFT_WIDTH  480
   #define TFT_HEIGHT 320
   #define GRAPHICAL_TFT_UPSCALE 3
 #elif ENABLED(TFT_RES_1024x600)
   #define TFT_WIDTH  1024
   #define TFT_HEIGHT 600
-  #define GRAPHICAL_TFT_UPSCALE 6
-  #define TFT_PIXEL_OFFSET_X 120
+  #if ENABLED(TOUCH_SCREEN)
+    #define GRAPHICAL_TFT_UPSCALE 6
+    #define TFT_PIXEL_OFFSET_X 120
+  #else
+    #define GRAPHICAL_TFT_UPSCALE 8
+    #define TFT_PIXEL_OFFSET_X 0
+  #endif
 #endif
 
 // FSMC/SPI TFT Panels using standard HAL/tft/tft_(fsmc|spi|ltdc).h
 #if ENABLED(TFT_INTERFACE_FSMC)
   #define HAS_FSMC_TFT 1
   #if TFT_SCALED_DOGLCD
     #define HAS_FSMC_GRAPHICAL_TFT 1
   #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_FSMC 1
   #endif

commit 007af4776880fda761e925bce383ac41a7769833
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Jul 22 21:59:00 2022 -0500

    ‚ú® Reinstate JyersUI

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 1d3ad1c2d5..95deed7b3f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -470,20 +470,22 @@
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
   #define HAS_DWIN_E3V2_BASIC 1
+#endif
+#if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
 #if ENABLED(DWIN_LCD_PROUI)
   #define DO_LIST_BIN_FILES 1
 #endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #define HAS_LCD_BRIGHTNESS 1
@@ -499,41 +501,41 @@
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif IS_DWIN_MARLINUI
     // Since HAS_MARLINUI_U8GLIB refers to U8G displays
     // the DWIN display can define its own flags
   #elif !HAS_GRAPHICAL_TFT
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
-#if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI)
+#if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DISPLAY 1
 #endif
 
 #if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
   #define HAS_LCDPRINT 1
 #endif
 
 #if HAS_DISPLAY || HAS_DWIN_E3V2
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_MARLINUI_MENU 1
 #endif
 
 #if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
   #define HAS_MANUAL_MOVE_MENU 1
 #endif
 
-#if ANY(HAS_MARLINUI_U8GLIB, EXTENSIBLE_UI, HAS_MARLINUI_HD44780, IS_TFTGLCD_PANEL, IS_DWIN_MARLINUI)
+#if ANY(HAS_MARLINUI_U8GLIB, EXTENSIBLE_UI, HAS_MARLINUI_HD44780, IS_TFTGLCD_PANEL, IS_DWIN_MARLINUI, DWIN_CREALITY_LCD_JYERSUI)
   #define CAN_SHOW_REMAINING_TIME 1
 #endif
 
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
   #endif
   #ifndef LCD_PIXEL_HEIGHT
     #define LCD_PIXEL_HEIGHT 64
   #endif

commit 2dc543c4f58c39e6cdf7a4a001c15100268cdf46
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Jul 13 21:22:53 2022 -0500

    üé® ANY => EITHER

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 12314e6492..1d3ad1c2d5 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -457,21 +457,21 @@
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
 #if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY, DGUS_LCD_UI_MKS)
   #define HAS_DGUS_LCD_CLASSIC 1
 #endif
 
-#if ANY(HAS_DGUS_LCD_CLASSIC, DGUS_LCD_UI_RELOADED)
+#if EITHER(HAS_DGUS_LCD_CLASSIC, DGUS_LCD_UI_RELOADED)
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
@@ -1424,21 +1424,21 @@
 #elif ANY(MKS_ROBIN_TFT35, TFT_TRONXY_X5SA, ANYCUBIC_TFT35)                   // ILI9488
   #define TFT_DRIVER ILI9488
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(MKS_ROBIN_TFT43)
   #define TFT_DRIVER SSD1963
   #define TFT_DEFAULT_ORIENTATION 0
   #define TFT_RES_480x272
   #define TFT_INTERFACE_FSMC
-#elif ANY(MKS_ROBIN_TFT_V1_1R, LONGER_LK_TFT28)                               // ILI9328 or R61505
+#elif EITHER(MKS_ROBIN_TFT_V1_1R, LONGER_LK_TFT28)                            // ILI9328 or R61505
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(BIQU_BX_TFT70)                                                  // RGB
   #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_1024x600
   #define TFT_INTERFACE_LTDC
   #if ENABLED(TOUCH_SCREEN)
     #define TFT_TOUCH_DEVICE_GT911
   #endif

commit abe139192fc1771992ef5b49066f07b31471a386
Author: Pauli Jokela <pauli.jokela@didstopia.com>
Date:   Thu Jul 7 18:59:23 2022 +0300

    ü©π Fix safe homing sanity-check (#24462)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index fc66f5359c..12314e6492 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1203,21 +1203,21 @@
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if BOTH(DELTA, SENSORLESS_PROBING)
     #define HAS_DELTA_SENSORLESS_PROBING 1
   #endif
   #if NONE(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN, HAS_DELTA_SENSORLESS_PROBING)
     #define USES_Z_MIN_PROBE_PIN 1
   #endif
-  #if Z_HOME_TO_MIN && (DISABLED(USES_Z_MIN_PROBE_PIN) || USE_PROBE_FOR_Z_HOMING)
+  #if Z_HOME_TO_MIN && (DISABLED(USES_Z_MIN_PROBE_PIN) || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if EITHER(Z_PROBE_ALLEN_KEY, MAG_MOUNTED_PROBE)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0

commit 5979aab1c7cf96d91b89775ae988e59e3ff40106
Author: Farva42 <100859196+Farva42@users.noreply.github.com>
Date:   Wed Jul 6 19:40:09 2022 -0600

    ‚ú® MAG_MOUNTED_PROBE (#24420)
    
    Co-Authored-By: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b8cf66c8c4..fc66f5359c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1040,23 +1040,26 @@
   #define HAS_Z_SERVO_PROBE 1
 #endif
 #if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
   #define HAS_SERVO_ANGLES 1
 #endif
 #if !HAS_SERVO_ANGLES
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
- * Set a flag for any type of bed probe, including the paper-test
+ * Set flags for any form of bed probe
  */
-#if ANY(HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE, MAGLEV4)
+#if ANY(TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, SOLENOID_PROBE, Z_PROBE_SLED, RACK_AND_PINION_PROBE, SENSORLESS_PROBING, MAGLEV4, MAG_MOUNTED_PROBE)
+  #define HAS_STOWABLE_PROBE 1
+#endif
+#if ANY(HAS_STOWABLE_PROBE, HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
 /**
  * Fill in undefined Filament Sensor options
  */
 #if ENABLED(FILAMENT_RUNOUT_SENSOR)
   #if NUM_RUNOUT_SENSORS >= 1
     #ifndef FIL_RUNOUT1_STATE
       #define FIL_RUNOUT1_STATE FIL_RUNOUT_STATE
@@ -1200,27 +1203,27 @@
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if BOTH(DELTA, SENSORLESS_PROBING)
     #define HAS_DELTA_SENSORLESS_PROBING 1
   #endif
   #if NONE(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN, HAS_DELTA_SENSORLESS_PROBING)
     #define USES_Z_MIN_PROBE_PIN 1
   #endif
-  #if Z_HOME_TO_MIN && TERN1(USES_Z_MIN_PROBE_PIN, ENABLED(USE_PROBE_FOR_Z_HOMING))
+  #if Z_HOME_TO_MIN && (DISABLED(USES_Z_MIN_PROBE_PIN) || USE_PROBE_FOR_Z_HOMING)
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
-  #if ENABLED(Z_PROBE_ALLEN_KEY)
+  #if EITHER(Z_PROBE_ALLEN_KEY, MAG_MOUNTED_PROBE)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else

commit f73fad1b2fa6e70b3d632969ecf2773bee826643
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Jul 6 19:34:45 2022 -0500

    üî• Remove JyersUI (#24459)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index bf8d5e122a..b8cf66c8c4 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -470,22 +470,20 @@
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
   #define HAS_DWIN_E3V2_BASIC 1
-#endif
-#if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
 #if ENABLED(DWIN_LCD_PROUI)
   #define DO_LIST_BIN_FILES 1
 #endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #define HAS_LCD_BRIGHTNESS 1
@@ -501,41 +499,41 @@
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif IS_DWIN_MARLINUI
     // Since HAS_MARLINUI_U8GLIB refers to U8G displays
     // the DWIN display can define its own flags
   #elif !HAS_GRAPHICAL_TFT
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
-#if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
+#if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI)
   #define HAS_DISPLAY 1
 #endif
 
 #if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
   #define HAS_LCDPRINT 1
 #endif
 
 #if HAS_DISPLAY || HAS_DWIN_E3V2
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_MARLINUI_MENU 1
 #endif
 
 #if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
   #define HAS_MANUAL_MOVE_MENU 1
 #endif
 
-#if ANY(HAS_MARLINUI_U8GLIB, EXTENSIBLE_UI, HAS_MARLINUI_HD44780, IS_TFTGLCD_PANEL, IS_DWIN_MARLINUI, DWIN_CREALITY_LCD_JYERSUI)
+#if ANY(HAS_MARLINUI_U8GLIB, EXTENSIBLE_UI, HAS_MARLINUI_HD44780, IS_TFTGLCD_PANEL, IS_DWIN_MARLINUI)
   #define CAN_SHOW_REMAINING_TIME 1
 #endif
 
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
   #endif
   #ifndef LCD_PIXEL_HEIGHT
     #define LCD_PIXEL_HEIGHT 64
   #endif
@@ -1249,45 +1247,46 @@
   #endif
 #endif
 #if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_3POINT)
   #define ABL_PLANAR 1
 #endif
 #if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR)
   #define ABL_USES_GRID 1
 #endif
 #if ANY(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_3POINT)
   #define HAS_ABL_NOT_UBL 1
-#else
-  #undef PROBE_MANUALLY
 #endif
 #if ANY(AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_UBL, MESH_BED_LEVELING)
   #define HAS_MESH 1
 #endif
 #if EITHER(AUTO_BED_LEVELING_UBL, AUTO_BED_LEVELING_3POINT)
   #define NEEDS_THREE_PROBE_POINTS 1
 #endif
 #if EITHER(HAS_ABL_NOT_UBL, AUTO_BED_LEVELING_UBL)
   #define HAS_ABL_OR_UBL 1
   #if DISABLED(PROBE_MANUALLY)
     #define HAS_AUTOLEVEL 1
   #endif
 #endif
 #if EITHER(HAS_ABL_OR_UBL, MESH_BED_LEVELING)
   #define HAS_LEVELING 1
   #if DISABLED(AUTO_BED_LEVELING_UBL)
     #define PLANNER_LEVELING 1
   #endif
-#else
+#endif
+#if !HAS_LEVELING
   #undef RESTORE_LEVELING_AFTER_G28
   #undef ENABLE_LEVELING_AFTER_G28
   #undef G29_RETRY_AND_RECOVER
-  #undef PREHEAT_BEFORE_LEVELING
+#endif
+#if !HAS_LEVELING || EITHER(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
+  #undef PROBE_MANUALLY
 #endif
 #if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
   #define PROBE_SELECTED 1
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
   #define GRID_LOOP(A,B) LOOP_L_N(A, GRID_MAX_POINTS_X) LOOP_L_N(B, GRID_MAX_POINTS_Y)
 #endif
 

commit 509dfe92d0c2227ddece025fb97875582ca47aed
Author: Meilleur Gars <98503100+LCh-77@users.noreply.github.com>
Date:   Wed Jul 6 13:46:11 2022 -0700

    üö∏ JyersUI updates (#24451)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 8d29b177dd..bf8d5e122a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1249,46 +1249,45 @@
   #endif
 #endif
 #if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_3POINT)
   #define ABL_PLANAR 1
 #endif
 #if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR)
   #define ABL_USES_GRID 1
 #endif
 #if ANY(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_3POINT)
   #define HAS_ABL_NOT_UBL 1
+#else
+  #undef PROBE_MANUALLY
 #endif
 #if ANY(AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_UBL, MESH_BED_LEVELING)
   #define HAS_MESH 1
 #endif
 #if EITHER(AUTO_BED_LEVELING_UBL, AUTO_BED_LEVELING_3POINT)
   #define NEEDS_THREE_PROBE_POINTS 1
 #endif
 #if EITHER(HAS_ABL_NOT_UBL, AUTO_BED_LEVELING_UBL)
   #define HAS_ABL_OR_UBL 1
   #if DISABLED(PROBE_MANUALLY)
     #define HAS_AUTOLEVEL 1
   #endif
 #endif
 #if EITHER(HAS_ABL_OR_UBL, MESH_BED_LEVELING)
   #define HAS_LEVELING 1
   #if DISABLED(AUTO_BED_LEVELING_UBL)
     #define PLANNER_LEVELING 1
   #endif
-#endif
-#if !HAS_LEVELING
+#else
   #undef RESTORE_LEVELING_AFTER_G28
   #undef ENABLE_LEVELING_AFTER_G28
   #undef G29_RETRY_AND_RECOVER
-#endif
-#if !HAS_LEVELING || EITHER(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
-  #undef PROBE_MANUALLY
+  #undef PREHEAT_BEFORE_LEVELING
 #endif
 #if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
   #define PROBE_SELECTED 1
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
   #define GRID_LOOP(A,B) LOOP_L_N(A, GRID_MAX_POINTS_X) LOOP_L_N(B, GRID_MAX_POINTS_Y)
 #endif
 

commit 58048e7748568a77d64832e0c9ce2eada1e3873a
Author: Christophe Huriaux <c.huriaux@gmail.com>
Date:   Wed Jul 6 22:43:38 2022 +0200

    ü©π Fix ST7565 LCD contrast init (#24457)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e41bc0d489..8d29b177dd 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -92,37 +92,40 @@
   #define U8GLIB_SH1106
 
 #elif ENABLED(ZONESTAR_12864OLED_SSD1306)
   #define IS_RRD_SC 1
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(RADDS_DISPLAY)
   #define IS_ULTIPANEL 1
   #define STD_ENCODER_PULSES_PER_STEP 2
 
-#elif ANY(miniVIKI, VIKI2, WYH_L12864, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
+#elif ANY(miniVIKI, VIKI2, WYH_L12864, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, EMOTION_TECH_LCD)
 
   #define DOGLCD
   #define IS_DOGM_12864 1
   #define IS_ULTIPANEL 1
 
   #if ENABLED(miniVIKI)
     #define IS_U8GLIB_ST7565_64128N 1
   #elif ENABLED(VIKI2)
     #define IS_U8GLIB_ST7565_64128N 1
   #elif ENABLED(WYH_L12864)
     #define IS_U8GLIB_ST7565_64128N 1
     #define ST7565_XOFFSET 0x04
   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
     #define IS_U8GLIB_LM6059_AF 1
   #elif ENABLED(AZSMZ_12864)
     #define IS_U8GLIB_ST7565_64128N 1
+  #elif ENABLED(EMOTION_TECH_LCD)
+    #define IS_U8GLIB_ST7565_64128N 1
+    #define ST7565_VOLTAGE_DIVIDER_VALUE 0x07
   #endif
 
 #elif ENABLED(OLED_PANEL_TINYBOY2)
 
   #define IS_U8GLIB_SSD1306
   #define IS_ULTIPANEL 1
 
 #elif ENABLED(RA_CONTROL_PANEL)
 
   #define LCD_I2C_TYPE_PCA8574

commit 1a795376451ad4d2ae654f7e7ae1afdb052b6f56
Author: Victor Oliveira <rhapsodyv@gmail.com>
Date:   Thu Jun 23 06:18:36 2022 -0300

    ‚ú® Classic UI BIQU BX (#24387)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 01f9c02374..e41bc0d489 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1456,21 +1456,22 @@
   #define TFT_WIDTH  480
   #define TFT_HEIGHT 272
   #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(TFT_RES_480x320)
   #define TFT_WIDTH  480
   #define TFT_HEIGHT 320
   #define GRAPHICAL_TFT_UPSCALE 3
 #elif ENABLED(TFT_RES_1024x600)
   #define TFT_WIDTH  1024
   #define TFT_HEIGHT 600
-  #define GRAPHICAL_TFT_UPSCALE 4
+  #define GRAPHICAL_TFT_UPSCALE 6
+  #define TFT_PIXEL_OFFSET_X 120
 #endif
 
 // FSMC/SPI TFT Panels using standard HAL/tft/tft_(fsmc|spi|ltdc).h
 #if ENABLED(TFT_INTERFACE_FSMC)
   #define HAS_FSMC_TFT 1
   #if TFT_SCALED_DOGLCD
     #define HAS_FSMC_GRAPHICAL_TFT 1
   #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_FSMC 1
   #endif

commit 58d1b1be289a6e51a36f8a8b2d24baa59a99e9ff
Author: ellensp <530024+ellensp@users.noreply.github.com>
Date:   Wed Jun 22 22:08:24 2022 +1200

    ü©π Fix DGUS (MKS) compile (#24378)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index adb65f5f7d..01f9c02374 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -506,21 +506,21 @@
 #endif
 
 #if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DISPLAY 1
 #endif
 
 #if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
   #define HAS_LCDPRINT 1
 #endif
 
-#if ANY(HAS_DISPLAY, HAS_DWIN_E3V2)
+#if HAS_DISPLAY || HAS_DWIN_E3V2
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_MARLINUI_MENU 1
 #endif
 
 #if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
   #define HAS_MANUAL_MOVE_MENU 1
 #endif

commit a93146b71d723e6cd0520fc0b0c75752d59d190f
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sun May 22 16:53:12 2022 -0500

    üêõ Fix SEGMENT_LEVELED_MOVES with UBL

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ba60e2481f..adb65f5f7d 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1234,21 +1234,21 @@
 
 #if Z_HOME_TO_MAX && DISABLED(Z_SAFE_HOMING)
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 
 /**
  * Conditionals based on the type of Bed Leveling
  */
 #if ENABLED(AUTO_BED_LEVELING_UBL)
   #undef LCD_BED_LEVELING
-  #if ENABLED(DELTA)
+  #if EITHER(DELTA, SEGMENT_LEVELED_MOVES)
     #define UBL_SEGMENTED 1
   #endif
 #endif
 #if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_3POINT)
   #define ABL_PLANAR 1
 #endif
 #if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR)
   #define ABL_USES_GRID 1
 #endif
 #if ANY(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_3POINT)

commit 2bb9e0d58e6513b47f90e729876de98ac7ccdade
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri May 20 11:27:09 2022 -0500

    üîß Remove LCD_SERIAL_PORT defaults, warn on auto-assign (#24170)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b93478933d..ba60e2481f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -478,29 +478,20 @@
 #if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
 #if ENABLED(DWIN_LCD_PROUI)
   #define DO_LIST_BIN_FILES 1
 #endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
-  #ifndef LCD_SERIAL_PORT
-    #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_MINI_E3_V3_0, BTT_SKR_E3_TURBO)
-      #define LCD_SERIAL_PORT 1
-    #elif MB(CREALITY_V24S1_301, CREALITY_V24S1_301F4, CREALITY_V423)
-      #define LCD_SERIAL_PORT 2 // Creality Ender3S1 board
-    #else
-      #define LCD_SERIAL_PORT 3 // Creality 4.x board
-    #endif
-  #endif
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
   #if ENABLED(DWIN_LCD_PROUI)
     #define LCD_BRIGHTNESS_DEFAULT 127
   #endif
 #endif
 
 #if HAS_WIRED_LCD
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1

commit be0f1088f0f537be5e75af5e0a63a0c110b96efa
Author: Miguel Risco-Castillo <mriscoc@users.noreply.github.com>
Date:   Fri May 13 19:34:30 2022 -0500

    üö∏ DWIN/DACAI for Creality 4.2.3 (#24132)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0ce092ef2f..b93478933d 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -481,21 +481,21 @@
 #if ENABLED(DWIN_LCD_PROUI)
   #define DO_LIST_BIN_FILES 1
 #endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #ifndef LCD_SERIAL_PORT
     #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_MINI_E3_V3_0, BTT_SKR_E3_TURBO)
       #define LCD_SERIAL_PORT 1
-    #elif MB(CREALITY_V24S1_301, CREALITY_V24S1_301F4)
+    #elif MB(CREALITY_V24S1_301, CREALITY_V24S1_301F4, CREALITY_V423)
       #define LCD_SERIAL_PORT 2 // Creality Ender3S1 board
     #else
       #define LCD_SERIAL_PORT 3 // Creality 4.x board
     #endif
   #endif
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
   #if ENABLED(DWIN_LCD_PROUI)
     #define LCD_BRIGHTNESS_DEFAULT 127
   #endif

commit 38f4d8abfcc89d188674ec3b809102995efc9436
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu May 12 20:09:25 2022 -0500

    ‚ú® Add BOARD_CREALITY_V24S1_301F4
    
    Co-Authored-By: Miguel Risco-Castillo <mriscoc@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5fd0081165..0ce092ef2f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -481,21 +481,21 @@
 #if ENABLED(DWIN_LCD_PROUI)
   #define DO_LIST_BIN_FILES 1
 #endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #ifndef LCD_SERIAL_PORT
     #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_MINI_E3_V3_0, BTT_SKR_E3_TURBO)
       #define LCD_SERIAL_PORT 1
-    #elif MB(CREALITY_V24S1_301)
+    #elif MB(CREALITY_V24S1_301, CREALITY_V24S1_301F4)
       #define LCD_SERIAL_PORT 2 // Creality Ender3S1 board
     #else
       #define LCD_SERIAL_PORT 3 // Creality 4.x board
     #endif
   #endif
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
   #if ENABLED(DWIN_LCD_PROUI)
     #define LCD_BRIGHTNESS_DEFAULT 127
   #endif

commit 8e24b34160e462fc8f3cff30cdb28e5cbdb2457d
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon May 9 17:35:32 2022 -0500

    üìå Define RAMPS_SMART EXP headers, AZSMZ_12864
    
    See #23501

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2bca6c4557..5fd0081165 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -94,23 +94,22 @@
 #elif ENABLED(ZONESTAR_12864OLED_SSD1306)
   #define IS_RRD_SC 1
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(RADDS_DISPLAY)
   #define IS_ULTIPANEL 1
   #define STD_ENCODER_PULSES_PER_STEP 2
 
 #elif ANY(miniVIKI, VIKI2, WYH_L12864, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
 
-  #define IS_DOGM_12864 1
-
   #define DOGLCD
+  #define IS_DOGM_12864 1
   #define IS_ULTIPANEL 1
 
   #if ENABLED(miniVIKI)
     #define IS_U8GLIB_ST7565_64128N 1
   #elif ENABLED(VIKI2)
     #define IS_U8GLIB_ST7565_64128N 1
   #elif ENABLED(WYH_L12864)
     #define IS_U8GLIB_ST7565_64128N 1
     #define ST7565_XOFFSET 0x04
   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)

commit df40181357b08761766067ef5012b2b3d0e34d3e
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Wed May 4 17:25:02 2022 -0700

    üí• Num Axes and Multi-Stepper based on Driver Types (#24120)
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2945bec4a5..2bca6c4557 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -700,20 +700,29 @@
   #define NUM_AXES 3
 #elif defined(Y_DRIVER_TYPE)
   #define NUM_AXES 2
 #else
   #define NUM_AXES 1
 #endif
 #if NUM_AXES >= XY
   #define HAS_Y_AXIS 1
   #if NUM_AXES >= XYZ
     #define HAS_Z_AXIS 1
+    #ifdef Z4_DRIVER_TYPE
+      #define NUM_Z_STEPPERS 4
+    #elif defined(Z3_DRIVER_TYPE)
+      #define NUM_Z_STEPPERS 3
+    #elif defined(Z2_DRIVER_TYPE)
+      #define NUM_Z_STEPPERS 2
+    #else
+      #define NUM_Z_STEPPERS 1
+    #endif
     #if NUM_AXES >= 4
       #define HAS_I_AXIS 1
       #if NUM_AXES >= 5
         #define HAS_J_AXIS 1
         #if NUM_AXES >= 6
           #define HAS_K_AXIS 1
           #if NUM_AXES >= 7
             #define HAS_U_AXIS 1
             #if NUM_AXES >= 8
               #define HAS_V_AXIS 1
@@ -862,20 +871,29 @@
   #undef W_MAX_ENDSTOP_INVERTING
   #undef W_ENABLE_ON
   #undef DISABLE_W
   #undef INVERT_W_DIR
   #undef W_HOME_DIR
   #undef W_MIN_POS
   #undef W_MAX_POS
   #undef MANUAL_W_HOME_POS
 #endif
 
+#ifdef X2_DRIVER_TYPE
+  #define HAS_X2_STEPPER 1
+  // Dual X Carriage isn't known yet. TODO: Consider moving it to Configuration.h.
+#endif
+#ifdef Y2_DRIVER_TYPE
+  #define HAS_Y2_STEPPER 1
+  #define HAS_DUAL_Y_STEPPERS 1
+#endif
+
 /**
  * Number of Primary Linear Axes (e.g., XYZ)
  * X, XY, or XYZ axes. Excluding duplicate axes (X2, Y2. Z2. Z3, Z4)
  */
 #if NUM_AXES >= 3
   #define PRIMARY_LINEAR_AXES 3
 #else
   #define PRIMARY_LINEAR_AXES NUM_AXES
 #endif
 

commit b37d13af7278c241064b61279e7e8538a03206a3
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Fri Apr 29 15:21:15 2022 -0500

    üîß Base NUM_AXES on defined DRIVER_TYPEs (#24106)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 95647d100e..2945bec4a5 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -672,22 +672,43 @@
   #define E_STEPPERS EXTRUDERS
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
 /**
  * Number of Linear Axes (e.g., XYZIJKUVW)
  * All the logical axes except for the tool (E) axis
  */
-#ifndef NUM_AXES
-  #define NUM_AXES XYZ
+#ifdef NUM_AXES
+  #undef NUM_AXES
+  #define NUM_AXES_WARNING 1
+#endif
+
+#ifdef W_DRIVER_TYPE
+  #define NUM_AXES 9
+#elif defined(V_DRIVER_TYPE)
+  #define NUM_AXES 8
+#elif defined(U_DRIVER_TYPE)
+  #define NUM_AXES 7
+#elif defined(K_DRIVER_TYPE)
+  #define NUM_AXES 6
+#elif defined(J_DRIVER_TYPE)
+  #define NUM_AXES 5
+#elif defined(I_DRIVER_TYPE)
+  #define NUM_AXES 4
+#elif defined(Z_DRIVER_TYPE)
+  #define NUM_AXES 3
+#elif defined(Y_DRIVER_TYPE)
+  #define NUM_AXES 2
+#else
+  #define NUM_AXES 1
 #endif
 #if NUM_AXES >= XY
   #define HAS_Y_AXIS 1
   #if NUM_AXES >= XYZ
     #define HAS_Z_AXIS 1
     #if NUM_AXES >= 4
       #define HAS_I_AXIS 1
       #if NUM_AXES >= 5
         #define HAS_J_AXIS 1
         #if NUM_AXES >= 6
@@ -700,20 +721,161 @@
                 #define HAS_W_AXIS 1
               #endif
             #endif
           #endif
         #endif
       #endif
     #endif
   #endif
 #endif
 
+#if E_STEPPERS <= 0
+  #undef E0_DRIVER_TYPE
+#endif
+#if E_STEPPERS <= 1
+  #undef E1_DRIVER_TYPE
+#endif
+#if E_STEPPERS <= 2
+  #undef E2_DRIVER_TYPE
+#endif
+#if E_STEPPERS <= 3
+  #undef E3_DRIVER_TYPE
+#endif
+#if E_STEPPERS <= 4
+  #undef E4_DRIVER_TYPE
+#endif
+#if E_STEPPERS <= 5
+  #undef E5_DRIVER_TYPE
+#endif
+#if E_STEPPERS <= 6
+  #undef E6_DRIVER_TYPE
+#endif
+#if E_STEPPERS <= 7
+  #undef E7_DRIVER_TYPE
+#endif
+
+#if !HAS_Y_AXIS
+  #undef ENDSTOPPULLUP_YMIN
+  #undef ENDSTOPPULLUP_YMAX
+  #undef Y_MIN_ENDSTOP_INVERTING
+  #undef Y_MAX_ENDSTOP_INVERTING
+  #undef Y2_DRIVER_TYPE
+  #undef Y_ENABLE_ON
+  #undef DISABLE_Y
+  #undef INVERT_Y_DIR
+  #undef Y_HOME_DIR
+  #undef Y_MIN_POS
+  #undef Y_MAX_POS
+  #undef MANUAL_Y_HOME_POS
+#endif
+
+#if !HAS_Z_AXIS
+  #undef ENDSTOPPULLUP_ZMIN
+  #undef ENDSTOPPULLUP_ZMAX
+  #undef Z_MIN_ENDSTOP_INVERTING
+  #undef Z_MAX_ENDSTOP_INVERTING
+  #undef Z2_DRIVER_TYPE
+  #undef Z3_DRIVER_TYPE
+  #undef Z4_DRIVER_TYPE
+  #undef Z_ENABLE_ON
+  #undef DISABLE_Z
+  #undef INVERT_Z_DIR
+  #undef Z_HOME_DIR
+  #undef Z_MIN_POS
+  #undef Z_MAX_POS
+  #undef MANUAL_Z_HOME_POS
+#endif
+
+#if !HAS_I_AXIS
+  #undef ENDSTOPPULLUP_IMIN
+  #undef ENDSTOPPULLUP_IMAX
+  #undef I_MIN_ENDSTOP_INVERTING
+  #undef I_MAX_ENDSTOP_INVERTING
+  #undef I_ENABLE_ON
+  #undef DISABLE_I
+  #undef INVERT_I_DIR
+  #undef I_HOME_DIR
+  #undef I_MIN_POS
+  #undef I_MAX_POS
+  #undef MANUAL_I_HOME_POS
+#endif
+
+#if !HAS_J_AXIS
+  #undef ENDSTOPPULLUP_JMIN
+  #undef ENDSTOPPULLUP_JMAX
+  #undef J_MIN_ENDSTOP_INVERTING
+  #undef J_MAX_ENDSTOP_INVERTING
+  #undef J_ENABLE_ON
+  #undef DISABLE_J
+  #undef INVERT_J_DIR
+  #undef J_HOME_DIR
+  #undef J_MIN_POS
+  #undef J_MAX_POS
+  #undef MANUAL_J_HOME_POS
+#endif
+
+#if !HAS_K_AXIS
+  #undef ENDSTOPPULLUP_KMIN
+  #undef ENDSTOPPULLUP_KMAX
+  #undef K_MIN_ENDSTOP_INVERTING
+  #undef K_MAX_ENDSTOP_INVERTING
+  #undef K_ENABLE_ON
+  #undef DISABLE_K
+  #undef INVERT_K_DIR
+  #undef K_HOME_DIR
+  #undef K_MIN_POS
+  #undef K_MAX_POS
+  #undef MANUAL_K_HOME_POS
+#endif
+
+#if !HAS_U_AXIS
+  #undef ENDSTOPPULLUP_UMIN
+  #undef ENDSTOPPULLUP_UMAX
+  #undef U_MIN_ENDSTOP_INVERTING
+  #undef U_MAX_ENDSTOP_INVERTING
+  #undef U_ENABLE_ON
+  #undef DISABLE_U
+  #undef INVERT_U_DIR
+  #undef U_HOME_DIR
+  #undef U_MIN_POS
+  #undef U_MAX_POS
+  #undef MANUAL_U_HOME_POS
+#endif
+
+#if !HAS_V_AXIS
+  #undef ENDSTOPPULLUP_VMIN
+  #undef ENDSTOPPULLUP_VMAX
+  #undef V_MIN_ENDSTOP_INVERTING
+  #undef V_MAX_ENDSTOP_INVERTING
+  #undef V_ENABLE_ON
+  #undef DISABLE_V
+  #undef INVERT_V_DIR
+  #undef V_HOME_DIR
+  #undef V_MIN_POS
+  #undef V_MAX_POS
+  #undef MANUAL_V_HOME_POS
+#endif
+
+#if !HAS_W_AXIS
+  #undef ENDSTOPPULLUP_WMIN
+  #undef ENDSTOPPULLUP_WMAX
+  #undef W_MIN_ENDSTOP_INVERTING
+  #undef W_MAX_ENDSTOP_INVERTING
+  #undef W_ENABLE_ON
+  #undef DISABLE_W
+  #undef INVERT_W_DIR
+  #undef W_HOME_DIR
+  #undef W_MIN_POS
+  #undef W_MAX_POS
+  #undef MANUAL_W_HOME_POS
+#endif
+
 /**
  * Number of Primary Linear Axes (e.g., XYZ)
  * X, XY, or XYZ axes. Excluding duplicate axes (X2, Y2. Z2. Z3, Z4)
  */
 #if NUM_AXES >= 3
   #define PRIMARY_LINEAR_AXES 3
 #else
   #define PRIMARY_LINEAR_AXES NUM_AXES
 #endif
 
@@ -1207,118 +1369,20 @@
   #define NUM_SERIAL 0
   #undef BAUD_RATE_GCODE
 #endif
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1 || SERIAL_PORT_3 == -1
   #define HAS_USB_SERIAL 1
 #endif
 #if SERIAL_PORT_2 == -2
   #define HAS_ETHERNET 1
 #endif
 
-// Fallback Stepper Driver types that don't depend on Configuration_adv.h
-#ifndef X_DRIVER_TYPE
-  #define X_DRIVER_TYPE  A4988
-#endif
-#ifndef X2_DRIVER_TYPE
-  #define X2_DRIVER_TYPE A4988
-#endif
-#ifndef Y_DRIVER_TYPE
-  #define Y_DRIVER_TYPE  A4988
-#endif
-#ifndef Y2_DRIVER_TYPE
-  #define Y2_DRIVER_TYPE A4988
-#endif
-#ifndef Z_DRIVER_TYPE
-  #define Z_DRIVER_TYPE  A4988
-#endif
-#ifndef Z2_DRIVER_TYPE
-  #define Z2_DRIVER_TYPE A4988
-#endif
-#ifndef Z3_DRIVER_TYPE
-  #define Z3_DRIVER_TYPE A4988
-#endif
-#ifndef Z4_DRIVER_TYPE
-  #define Z4_DRIVER_TYPE A4988
-#endif
-#if E_STEPPERS <= 0
-  #undef E0_DRIVER_TYPE
-#elif !defined(E0_DRIVER_TYPE)
-  #define E0_DRIVER_TYPE A4988
-#endif
-#if E_STEPPERS <= 1
-  #undef E1_DRIVER_TYPE
-#elif !defined(E1_DRIVER_TYPE)
-  #define E1_DRIVER_TYPE A4988
-#endif
-#if E_STEPPERS <= 2
-  #undef E2_DRIVER_TYPE
-#elif !defined(E2_DRIVER_TYPE)
-  #define E2_DRIVER_TYPE A4988
-#endif
-#if E_STEPPERS <= 3
-  #undef E3_DRIVER_TYPE
-#elif !defined(E3_DRIVER_TYPE)
-  #define E3_DRIVER_TYPE A4988
-#endif
-#if E_STEPPERS <= 4
-  #undef E4_DRIVER_TYPE
-#elif !defined(E4_DRIVER_TYPE)
-  #define E4_DRIVER_TYPE A4988
-#endif
-#if E_STEPPERS <= 5
-  #undef E5_DRIVER_TYPE
-#elif !defined(E5_DRIVER_TYPE)
-  #define E5_DRIVER_TYPE A4988
-#endif
-#if E_STEPPERS <= 6
-  #undef E6_DRIVER_TYPE
-#elif !defined(E6_DRIVER_TYPE)
-  #define E6_DRIVER_TYPE A4988
-#endif
-#if E_STEPPERS <= 7
-  #undef E7_DRIVER_TYPE
-#elif !defined(E7_DRIVER_TYPE)
-  #define E7_DRIVER_TYPE A4988
-#endif
-
-// Fallback axis inverting
-#ifndef INVERT_X_DIR
-  #define INVERT_X_DIR false
-#endif
-#if HAS_Y_AXIS && !defined(INVERT_Y_DIR)
-  #define INVERT_Y_DIR false
-#endif
-#if HAS_Z_AXIS && !defined(INVERT_Z_DIR)
-  #define INVERT_Z_DIR false
-#endif
-#if HAS_I_AXIS && !defined(INVERT_I_DIR)
-  #define INVERT_I_DIR false
-#endif
-#if HAS_J_AXIS && !defined(INVERT_J_DIR)
-  #define INVERT_J_DIR false
-#endif
-#if HAS_K_AXIS && !defined(INVERT_K_DIR)
-  #define INVERT_K_DIR false
-#endif
-#if HAS_U_AXIS && !defined(INVERT_U_DIR)
-  #define INVERT_U_DIR false
-#endif
-#if HAS_V_AXIS && !defined(INVERT_V_DIR)
-  #define INVERT_V_DIR false
-#endif
-#if HAS_W_AXIS && !defined(INVERT_W_DIR)
-  #define INVERT_W_DIR false
-#endif
-#if HAS_EXTRUDERS && !defined(INVERT_E_DIR)
-  #define INVERT_E_DIR false
-#endif
-
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
 
 /**
  * TFT Displays

commit 741eb0c3e9e9a1c480ee49f85a071d38171e40c1
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Apr 21 09:05:12 2022 -0500

    üö∏  Home Y before X on belt printers

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 6a9d8725a1..95647d100e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1051,20 +1051,24 @@
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef USE_PROBE_FOR_Z_HOMING
 #endif
 
+#if ENABLED(BELTPRINTER) && !defined(HOME_Y_BEFORE_X)
+  #define HOME_Y_BEFORE_X
+#endif
+
 #if Z_HOME_TO_MAX && DISABLED(Z_SAFE_HOMING)
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 
 /**
  * Conditionals based on the type of Bed Leveling
  */
 #if ENABLED(AUTO_BED_LEVELING_UBL)
   #undef LCD_BED_LEVELING
   #if ENABLED(DELTA)

commit 91cf4eb977ff2ce04e7703f8b1599e68e71f7e46
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Apr 21 08:57:41 2022 -0500

    üêõ  Home Z to Max after Z_SAFE_HOMING

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index da0990ba30..6a9d8725a1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1051,21 +1051,21 @@
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef USE_PROBE_FOR_Z_HOMING
 #endif
 
-#if Z_HOME_TO_MAX
+#if Z_HOME_TO_MAX && DISABLED(Z_SAFE_HOMING)
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 
 /**
  * Conditionals based on the type of Bed Leveling
  */
 #if ENABLED(AUTO_BED_LEVELING_UBL)
   #undef LCD_BED_LEVELING
   #if ENABLED(DELTA)
     #define UBL_SEGMENTED 1

commit 01bb11b415d976e57878f75d7ec44675b529a29c
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Apr 21 07:16:52 2022 -0500

    üßë‚Äçüíª IS_ULTRA_LCD => HAS_WIRED_LCD

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 41fa84ddfa..da0990ba30 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -34,27 +34,27 @@
 // MKS_MINI_12864_V3 and BTT_MINI_12864_V1 are identical to FYSETC_MINI_12864_2_1
 #if EITHER(MKS_MINI_12864_V3, BTT_MINI_12864_V1)
   #define FYSETC_MINI_12864_2_1
 #endif
 
 /**
  * General Flags that may be set below by specific LCDs
  *
  *  DOGLCD                  : Run a Graphical LCD through U8GLib (with MarlinUI)
  *  IS_ULTIPANEL            : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
- *  IS_ULTRA_LCD            : Ultra LCD, not necessarily Ultipanel.
+ *  HAS_WIRED_LCD           : Ultra LCD, not necessarily Ultipanel.
  *  IS_RRD_SC               : Common RRD Smart Controller digital interface pins
  *  IS_RRD_FG_SC            : Common RRD Full Graphical Smart Controller digital interface pins
  *  IS_U8GLIB_ST7920        : Most common DOGM display SPI interface, supporting a "lightweight" display mode.
  *  U8GLIB_SH1106           : SH1106 OLED with I2C interface via U8GLib
  *  IS_U8GLIB_SSD1306       : SSD1306 OLED with I2C interface via U8GLib (U8GLIB_SSD1306)
- *  U8GLIB_SSD1309          : SSD1309 OLED with I2C interface via U8GLib (HAS_U8GLIB_I2C_OLED, IS_ULTRA_LCD, DOGLCD)
+ *  U8GLIB_SSD1309          : SSD1309 OLED with I2C interface via U8GLib (HAS_U8GLIB_I2C_OLED, HAS_WIRED_LCD, DOGLCD)
  *  IS_U8GLIB_ST7565_64128N : ST7565 128x64 LCD with SPI interface via U8GLib
  *  IS_U8GLIB_LM6059_AF     : LM6059 with Hardware SPI via U8GLib
  */
 #if EITHER(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
 
   #define MINIPANEL
 
 #elif ENABLED(YHCB2004)
 
   #define IS_ULTIPANEL 1
@@ -280,21 +280,21 @@
   #define PCA9632_BUZZER
   #define PCA9632_BUZZER_DATA { 0x09, 0x02 }
 
   #define STD_ENCODER_PULSES_PER_STEP     1 // Overlord uses buttons
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 
 // 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
 #if ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
   #define HAS_U8GLIB_I2C_OLED 1
-  #define IS_ULTRA_LCD 1
+  #define HAS_WIRED_LCD 1
   #define DOGLCD
 #endif
 
 /**
  * SPI Ultipanels
  */
 
 // Basic Ultipanel-like displays
 #if ANY(ULTIMAKERCONTROLLER, IS_RRD_SC, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
   #define IS_ULTIPANEL 1
@@ -436,21 +436,21 @@
   #define SR_LCD_3W_NL    // Non latching 3 wire shift register
   #define IS_ULTIPANEL 1
 #elif ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define IS_ULTIPANEL 1
 #elif ENABLED(ULTIPANEL)
   #define IS_ULTIPANEL 1
 #endif
 
 #if EITHER(IS_ULTIPANEL, ULTRA_LCD)
-  #define IS_ULTRA_LCD 1
+  #define HAS_WIRED_LCD 1
 #endif
 
 #if EITHER(IS_ULTIPANEL, REPRAPWORLD_KEYPAD)
   #define IS_NEWPANEL 1
 #endif
 
 #if EITHER(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
   #define IS_RRW_KEYPAD 1
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
@@ -495,22 +495,21 @@
       #define LCD_SERIAL_PORT 3 // Creality 4.x board
     #endif
   #endif
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
   #if ENABLED(DWIN_LCD_PROUI)
     #define LCD_BRIGHTNESS_DEFAULT 127
   #endif
 #endif
 
-#if IS_ULTRA_LCD
-  #define HAS_WIRED_LCD 1
+#if HAS_WIRED_LCD
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif IS_DWIN_MARLINUI
     // Since HAS_MARLINUI_U8GLIB refers to U8G displays
     // the DWIN display can define its own flags
   #elif !HAS_GRAPHICAL_TFT
     #define HAS_MARLINUI_HD44780 1
   #endif

commit 6ee34331b7a0e5ea82768f4df5f3956ce5322742
Author: Robert Brenckman <Robbery525@gmail.com>
Date:   Sun Apr 10 01:24:07 2022 -0400

    üêõ Fix Tool Change priming (#21142)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 65c4ac002f..41fa84ddfa 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -705,21 +705,21 @@
         #endif
       #endif
     #endif
   #endif
 #endif
 
 /**
  * Number of Primary Linear Axes (e.g., XYZ)
  * X, XY, or XYZ axes. Excluding duplicate axes (X2, Y2. Z2. Z3, Z4)
  */
-#if HAS_I_AXIS
+#if NUM_AXES >= 3
   #define PRIMARY_LINEAR_AXES 3
 #else
   #define PRIMARY_LINEAR_AXES NUM_AXES
 #endif
 
 /**
  * Number of Secondary Axes (e.g., IJKUVW)
  * All linear/rotational axes between XYZ and E.
  */
 #define SECONDARY_AXES SUB3(NUM_AXES)

commit 6fa930f04378283e8d5af9e3190508ae07a83860
Author: Robby Candra <robbycandra.mail@gmail.com>
Date:   Sun Apr 10 07:44:31 2022 +0700

    ‚ö∞Ô∏è Clean up dead option (#24006)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5adc04fe2d..65c4ac002f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -517,21 +517,21 @@
 #endif
 
 #if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DISPLAY 1
 #endif
 
 #if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
   #define HAS_LCDPRINT 1
 #endif
 
-#if ANY(HAS_DISPLAY, HAS_DWIN_E3V2, GLOBAL_STATUS_MESSAGE)
+#if ANY(HAS_DISPLAY, HAS_DWIN_E3V2)
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_MARLINUI_MENU 1
 #endif
 
 #if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
   #define HAS_MANUAL_MOVE_MENU 1
 #endif

commit e5b651f407fcb743e2d00c45b0d361fb98230efb
Author: DerAndere <26200979+DerAndere1@users.noreply.github.com>
Date:   Fri Apr 1 07:10:38 2022 +0200

    ‚ú® Support for up to 9 axes (linear, rotary) (#23112)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e7473420cf..5adc04fe2d 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -670,69 +670,122 @@
   #define HOTENDS EXTRUDERS
 #endif
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
 /**
- * Number of Linear Axes (e.g., XYZ)
+ * Number of Linear Axes (e.g., XYZIJKUVW)
  * All the logical axes except for the tool (E) axis
  */
-#ifndef LINEAR_AXES
-  #define LINEAR_AXES XYZ
+#ifndef NUM_AXES
+  #define NUM_AXES XYZ
 #endif
-#if LINEAR_AXES >= XY
+#if NUM_AXES >= XY
   #define HAS_Y_AXIS 1
-  #if LINEAR_AXES >= XYZ
+  #if NUM_AXES >= XYZ
     #define HAS_Z_AXIS 1
-    #if LINEAR_AXES >= 4
+    #if NUM_AXES >= 4
       #define HAS_I_AXIS 1
-      #if LINEAR_AXES >= 5
+      #if NUM_AXES >= 5
         #define HAS_J_AXIS 1
-        #if LINEAR_AXES >= 6
+        #if NUM_AXES >= 6
           #define HAS_K_AXIS 1
+          #if NUM_AXES >= 7
+            #define HAS_U_AXIS 1
+            #if NUM_AXES >= 8
+              #define HAS_V_AXIS 1
+              #if NUM_AXES >= 9
+                #define HAS_W_AXIS 1
+              #endif
+            #endif
+          #endif
         #endif
       #endif
     #endif
   #endif
 #endif
 
 /**
- * Number of Logical Axes (e.g., XYZE)
- * All the logical axes that can be commanded directly by G-code.
+ * Number of Primary Linear Axes (e.g., XYZ)
+ * X, XY, or XYZ axes. Excluding duplicate axes (X2, Y2. Z2. Z3, Z4)
+ */
+#if HAS_I_AXIS
+  #define PRIMARY_LINEAR_AXES 3
+#else
+  #define PRIMARY_LINEAR_AXES NUM_AXES
+#endif
+
+/**
+ * Number of Secondary Axes (e.g., IJKUVW)
+ * All linear/rotational axes between XYZ and E.
+ */
+#define SECONDARY_AXES SUB3(NUM_AXES)
+
+/**
+ * Number of Rotational Axes (e.g., IJK)
+ * All axes for which AXIS*_ROTATES is defined.
+ * For these axes, positions are specified in angular degrees.
+ */
+#if ENABLED(AXIS9_ROTATES)
+  #define ROTATIONAL_AXES 6
+#elif ENABLED(AXIS8_ROTATES)
+  #define ROTATIONAL_AXES 5
+#elif ENABLED(AXIS7_ROTATES)
+  #define ROTATIONAL_AXES 4
+#elif ENABLED(AXIS6_ROTATES)
+  #define ROTATIONAL_AXES 3
+#elif ENABLED(AXIS5_ROTATES)
+  #define ROTATIONAL_AXES 2
+#elif ENABLED(AXIS4_ROTATES)
+  #define ROTATIONAL_AXES 1
+#else
+  #define ROTATIONAL_AXES 0
+#endif
+
+/**
+ * Number of Secondary Linear Axes (e.g., UVW)
+ * All secondary axes for which AXIS*_ROTATES is not defined.
+ * Excluding primary axes and excluding duplicate axes (X2, Y2, Z2, Z3, Z4)
+ */
+#define SECONDARY_LINEAR_AXES (NUM_AXES - PRIMARY_LINEAR_AXES - ROTATIONAL_AXES)
+
+/**
+ * Number of Logical Axes (e.g., XYZIJKUVWE)
+ * All logical axes that can be commanded directly by G-code.
  * Delta maps stepper-specific values to ABC steppers.
  */
 #if HAS_EXTRUDERS
-  #define LOGICAL_AXES INCREMENT(LINEAR_AXES)
+  #define LOGICAL_AXES INCREMENT(NUM_AXES)
 #else
-  #define LOGICAL_AXES LINEAR_AXES
+  #define LOGICAL_AXES NUM_AXES
 #endif
 
 /**
  * DISTINCT_E_FACTORS is set to give extruders (some) individual settings.
  *
  * DISTINCT_AXES is the number of distinct addressable axes (not steppers).
  *  Includes all linear axes plus all distinguished extruders.
  *  The default behavior is to treat all extruders as a single E axis
  *  with shared motion and temperature settings.
  *
  * DISTINCT_E is the number of distinguished extruders. By default this
  *  well be 1 which indicates all extruders share the same settings.
  *
  * E_INDEX_N(E) should be used to get the E index of any item that might be
  *  distinguished.
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
-  #define DISTINCT_AXES (LINEAR_AXES + E_STEPPERS)
+  #define DISTINCT_AXES (NUM_AXES + E_STEPPERS)
   #define DISTINCT_E E_STEPPERS
   #define E_INDEX_N(E) (E)
 #else
   #undef DISTINCT_E_FACTORS
   #define DISTINCT_AXES LOGICAL_AXES
   #define DISTINCT_E 1
   #define E_INDEX_N(E) 0
 #endif
 
 #if HOTENDS
@@ -948,20 +1001,35 @@
 #if J_HOME_DIR > 0
   #define J_HOME_TO_MAX 1
 #elif J_HOME_DIR < 0
   #define J_HOME_TO_MIN 1
 #endif
 #if K_HOME_DIR > 0
   #define K_HOME_TO_MAX 1
 #elif K_HOME_DIR < 0
   #define K_HOME_TO_MIN 1
 #endif
+#if U_HOME_DIR > 0
+  #define U_HOME_TO_MAX 1
+#elif U_HOME_DIR < 0
+  #define U_HOME_TO_MIN 1
+#endif
+#if V_HOME_DIR > 0
+  #define V_HOME_TO_MAX 1
+#elif V_HOME_DIR < 0
+  #define V_HOME_TO_MIN 1
+#endif
+#if W_HOME_DIR > 0
+  #define W_HOME_TO_MAX 1
+#elif W_HOME_DIR < 0
+  #define W_HOME_TO_MIN 1
+#endif
 
 /**
  * Conditionals based on the type of Bed Probe
  */
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if BOTH(DELTA, SENSORLESS_PROBING)
     #define HAS_DELTA_SENSORLESS_PROBING 1
@@ -1221,20 +1289,29 @@
 #endif
 #if HAS_I_AXIS && !defined(INVERT_I_DIR)
   #define INVERT_I_DIR false
 #endif
 #if HAS_J_AXIS && !defined(INVERT_J_DIR)
   #define INVERT_J_DIR false
 #endif
 #if HAS_K_AXIS && !defined(INVERT_K_DIR)
   #define INVERT_K_DIR false
 #endif
+#if HAS_U_AXIS && !defined(INVERT_U_DIR)
+  #define INVERT_U_DIR false
+#endif
+#if HAS_V_AXIS && !defined(INVERT_V_DIR)
+  #define INVERT_V_DIR false
+#endif
+#if HAS_W_AXIS && !defined(INVERT_W_DIR)
+  #define INVERT_W_DIR false
+#endif
 #if HAS_EXTRUDERS && !defined(INVERT_E_DIR)
   #define INVERT_E_DIR false
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170

commit a80a303cbe057b02e8d9cd29bc94c161e48784f1
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Mar 22 22:22:08 2022 -0500

    üßë‚Äçüíª EXTRUDER_LOOP macro

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 33d9e46220..e7473420cf 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -742,20 +742,21 @@
   #endif
   #if HOTENDS > 1
     #define HAS_MULTI_HOTEND 1
     #define HAS_HOTEND_OFFSET 1
   #endif
 #else
   #undef PID_PARAMS_PER_HOTEND
 #endif
 
 // Helper macros for extruder and hotend arrays
+#define EXTRUDER_LOOP() for (int8_t e = 0; e < EXTRUDERS; e++)
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_N_1(EXTRUDERS, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
 #define ARRAY_BY_HOTENDS1(v1) ARRAY_N_1(HOTENDS, v1)
 
 /**
  * Default hotend offsets, if not defined
  */
 #if HAS_HOTEND_OFFSET

commit 79b38e0e14074b52e0aeb98b08a686a99a9b1aad
Author: Miguel Risco-Castillo <mriscoc@users.noreply.github.com>
Date:   Fri Mar 11 15:06:49 2022 -0500

    üö∏ Update Ender3 V2/S1 Pro UI (#23878)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9d9fddc8c1..33d9e46220 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -472,20 +472,23 @@
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
   #define HAS_DWIN_E3V2_BASIC 1
 #endif
 #if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
+#if ENABLED(DWIN_LCD_PROUI)
+  #define DO_LIST_BIN_FILES 1
+#endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #ifndef LCD_SERIAL_PORT
     #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_MINI_E3_V3_0, BTT_SKR_E3_TURBO)
       #define LCD_SERIAL_PORT 1
     #elif MB(CREALITY_V24S1_301)
       #define LCD_SERIAL_PORT 2 // Creality Ender3S1 board
     #else
@@ -506,21 +509,21 @@
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif IS_DWIN_MARLINUI
     // Since HAS_MARLINUI_U8GLIB refers to U8G displays
     // the DWIN display can define its own flags
   #elif !HAS_GRAPHICAL_TFT
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
-#if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_CREALITY_LCD_JYERSUI)
+#if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_LCD_PROUI, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DISPLAY 1
 #endif
 
 #if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
   #define HAS_LCDPRINT 1
 #endif
 
 #if ANY(HAS_DISPLAY, HAS_DWIN_E3V2, GLOBAL_STATUS_MESSAGE)
   #define HAS_STATUS_MESSAGE 1
 #endif

commit 48b5362cf02ff12c9e9fc4d5825ceebe457ea34b
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Mar 10 22:07:47 2022 -0600

    üîß DWIN_CREALITY_LCD_ENHANCED => DWIN_LCD_PROUI
    
    Followup to #23624

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 34a160fc5c..9d9fddc8c1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -466,42 +466,42 @@
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
-#if EITHER(DWIN_CREALITY_LCD, DWIN_CREALITY_LCD_ENHANCED)
+#if EITHER(DWIN_CREALITY_LCD, DWIN_LCD_PROUI)
   #define HAS_DWIN_E3V2_BASIC 1
 #endif
 #if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #ifndef LCD_SERIAL_PORT
     #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_MINI_E3_V3_0, BTT_SKR_E3_TURBO)
       #define LCD_SERIAL_PORT 1
     #elif MB(CREALITY_V24S1_301)
       #define LCD_SERIAL_PORT 2 // Creality Ender3S1 board
     #else
       #define LCD_SERIAL_PORT 3 // Creality 4.x board
     #endif
   #endif
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
-  #if ENABLED(DWIN_CREALITY_LCD_ENHANCED)
+  #if ENABLED(DWIN_LCD_PROUI)
     #define LCD_BRIGHTNESS_DEFAULT 127
   #endif
 #endif
 
 #if IS_ULTRA_LCD
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.

commit cf013a7f3e8f8030e3ac092692988d4e53fd03c3
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Feb 13 12:55:00 2022 -0600

    üîß HAS_LCDPRINT conditional

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f4b517dd23..34a160fc5c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -510,20 +510,24 @@
     // the DWIN display can define its own flags
   #elif !HAS_GRAPHICAL_TFT
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
 #if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DISPLAY 1
 #endif
 
+#if HAS_WIRED_LCD && !HAS_GRAPHICAL_TFT && !IS_DWIN_MARLINUI
+  #define HAS_LCDPRINT 1
+#endif
+
 #if ANY(HAS_DISPLAY, HAS_DWIN_E3V2, GLOBAL_STATUS_MESSAGE)
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_MARLINUI_MENU 1
 #endif
 
 #if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
   #define HAS_MANUAL_MOVE_MENU 1

commit 0564cb188f1a74dc9ecfb55b793f4225424a9ca4
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Feb 5 10:30:17 2022 -0600

    üö∏ Enhanced UI => Professional UI - with updates (#23624)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5444841db3..f4b517dd23 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -487,20 +487,23 @@
     #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_MINI_E3_V3_0, BTT_SKR_E3_TURBO)
       #define LCD_SERIAL_PORT 1
     #elif MB(CREALITY_V24S1_301)
       #define LCD_SERIAL_PORT 2 // Creality Ender3S1 board
     #else
       #define LCD_SERIAL_PORT 3 // Creality 4.x board
     #endif
   #endif
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
+  #if ENABLED(DWIN_CREALITY_LCD_ENHANCED)
+    #define LCD_BRIGHTNESS_DEFAULT 127
+  #endif
 #endif
 
 #if IS_ULTRA_LCD
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif IS_DWIN_MARLINUI
     // Since HAS_MARLINUI_U8GLIB refers to U8G displays

commit f07fc7e96f512f4900619049761f75d28f9e0403
Author: GHGiampy <83699429+GHGiampy@users.noreply.github.com>
Date:   Wed Feb 2 00:35:38 2022 +0100

    üö∏ Case Light, LED menus for E3V2 DWIN Enhanced UI (#23590)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d044a0e681..5444841db3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -71,40 +71,40 @@
 
 #elif ENABLED(ZONESTAR_LCD)
 
   #define HAS_ADC_BUTTONS 1
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
   #define IS_ULTIPANEL 1
 
   // This helps to implement HAS_ADC_BUTTONS menus
   #define REVERSE_MENU_DIRECTION
-  #define ENCODER_PULSES_PER_STEP 1
-  #define ENCODER_STEPS_PER_MENU_ITEM 1
+  #define STD_ENCODER_PULSES_PER_STEP 1
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
 
 #elif ENABLED(ZONESTAR_12864LCD)
   #define DOGLCD
   #define IS_RRD_SC 1
   #define IS_U8GLIB_ST7920 1
 
 #elif ENABLED(ZONESTAR_12864OLED)
   #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
 #elif ENABLED(ZONESTAR_12864OLED_SSD1306)
   #define IS_RRD_SC 1
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(RADDS_DISPLAY)
   #define IS_ULTIPANEL 1
-  #define ENCODER_PULSES_PER_STEP 2
+  #define STD_ENCODER_PULSES_PER_STEP 2
 
 #elif ANY(miniVIKI, VIKI2, WYH_L12864, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
 
   #define IS_DOGM_12864 1
 
   #define DOGLCD
   #define IS_ULTIPANEL 1
 
   #if ENABLED(miniVIKI)
     #define IS_U8GLIB_ST7565_64128N 1
@@ -151,71 +151,46 @@
   #ifdef U8GLIB_SSD1306
     #define IS_U8GLIB_SSD1306 // Allow for U8GLIB_SSD1306 + SAV_3DGLCD
   #endif
   #define IS_NEWPANEL 1
 
 #elif ENABLED(FYSETC_242_OLED_12864)
 
   #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
-  #define LED_CONTROL_MENU
-  #define NEOPIXEL_LED
-  #undef NEOPIXEL_TYPE
-  #define NEOPIXEL_TYPE       NEO_RGB
-  #if NEOPIXEL_PIXELS < 3
-    #undef NEOPIXELS_PIXELS
-    #define NEOPIXEL_PIXELS     3
-  #endif
   #ifndef NEOPIXEL_BRIGHTNESS
     #define NEOPIXEL_BRIGHTNESS 127
   #endif
 
-  #if ENABLED(PSU_CONTROL)
-    #define LED_BACKLIGHT_TIMEOUT 10000
-  #endif
-
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1, FYSETC_GENERIC_12864_1_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define IS_ULTIPANEL 1
   #define LED_COLORS_REDUCE_GREEN
-  #if ENABLED(PSU_CONTROL) && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
-    #define LED_BACKLIGHT_TIMEOUT 10000
-  #endif
 
   // Require LED backlighting enabled
-  #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
-    #define RGB_LED
-  #elif ENABLED(FYSETC_MINI_12864_2_1)
-    #define LED_CONTROL_MENU
-    #define NEOPIXEL_LED
-    #undef NEOPIXEL_TYPE
-    #define NEOPIXEL_TYPE       NEO_RGB
-    #if NEOPIXEL_PIXELS < 3
-      #undef NEOPIXELS_PIXELS
-      #define NEOPIXEL_PIXELS     3
-    #endif
+  #if ENABLED(FYSETC_MINI_12864_2_1)
     #ifndef NEOPIXEL_BRIGHTNESS
       #define NEOPIXEL_BRIGHTNESS 127
     #endif
     //#define NEOPIXEL_STARTUP_TEST
   #endif
 
 #elif ENABLED(ULTI_CONTROLLER)
 
   #define IS_ULTIPANEL 1
   #define U8GLIB_SSD1309
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
-  #define ENCODER_PULSES_PER_STEP 4
-  #define ENCODER_STEPS_PER_MENU_ITEM 1
+  #define STD_ENCODER_PULSES_PER_STEP 4
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #ifndef PCA9632
     #define PCA9632
   #endif
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
   #define IS_RRD_SC 1
   #define LCD_WIDTH 16
   #define LCD_HEIGHT 2
 
@@ -298,22 +273,22 @@
    * PCA9632 for buzzer and LEDs via i2c
    * No auto-inc, red and green leds switched, buzzer
    */
   #define PCA9632
   #define PCA9632_NO_AUTO_INC
   #define PCA9632_GRN         0x00
   #define PCA9632_RED         0x02
   #define PCA9632_BUZZER
   #define PCA9632_BUZZER_DATA { 0x09, 0x02 }
 
-  #define ENCODER_PULSES_PER_STEP     1 // Overlord uses buttons
-  #define ENCODER_STEPS_PER_MENU_ITEM 1
+  #define STD_ENCODER_PULSES_PER_STEP     1 // Overlord uses buttons
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 
 // 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
 #if ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
   #define HAS_U8GLIB_I2C_OLED 1
   #define IS_ULTRA_LCD 1
   #define DOGLCD
 #endif
 
 /**

commit 91c7db027f3cecabc2708bcd3ec9254c70b38e8b
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Jan 25 18:33:30 2022 -0600

    ‚ú® BOARD_CREALITY_V24S1_301 (#23620)
    
    Co-Authored-By: Miguel Risco-Castillo <mriscoc@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 825898f882..d044a0e681 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -504,20 +504,22 @@
 #if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #ifndef LCD_SERIAL_PORT
     #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_MINI_E3_V3_0, BTT_SKR_E3_TURBO)
       #define LCD_SERIAL_PORT 1
+    #elif MB(CREALITY_V24S1_301)
+      #define LCD_SERIAL_PORT 2 // Creality Ender3S1 board
     #else
       #define LCD_SERIAL_PORT 3 // Creality 4.x board
     #endif
   #endif
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
 #endif
 
 #if IS_ULTRA_LCD
   #define HAS_WIRED_LCD 1

commit ab46b7e2f298826a5512569d6e79bb59a7a6b8ea
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Jan 25 15:33:03 2022 -0600

    üßë‚Äçüíª HAS_MARLINUI_MENU, HAS_MANUAL_MOVE_MENU

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 1200d18dd0..825898f882 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -535,21 +535,25 @@
 
 #if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DISPLAY 1
 #endif
 
 #if ANY(HAS_DISPLAY, HAS_DWIN_E3V2, GLOBAL_STATUS_MESSAGE)
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
-  #define HAS_LCD_MENU 1
+  #define HAS_MARLINUI_MENU 1
+#endif
+
+#if ANY(HAS_MARLINUI_MENU, EXTENSIBLE_UI, HAS_DWIN_E3V2)
+  #define HAS_MANUAL_MOVE_MENU 1
 #endif
 
 #if ANY(HAS_MARLINUI_U8GLIB, EXTENSIBLE_UI, HAS_MARLINUI_HD44780, IS_TFTGLCD_PANEL, IS_DWIN_MARLINUI, DWIN_CREALITY_LCD_JYERSUI)
   #define CAN_SHOW_REMAINING_TIME 1
 #endif
 
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
   #endif

commit 7f97ba9cdb17a82e9aed5eb4c64a1bdf2f419e81
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Tue Jan 25 01:25:19 2022 -0800

    üêõ Fix Creality DWIN LCD with SKR Mini E3 V3 (#23593)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2daa15d0d3..1200d18dd0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -502,21 +502,21 @@
   #define HAS_DWIN_E3V2_BASIC 1
 #endif
 #if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
 
 // E3V2 extras
 #if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
   #define SERIAL_CATCHALL 0
   #ifndef LCD_SERIAL_PORT
-    #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_E3_TURBO)
+    #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_MINI_E3_V3_0, BTT_SKR_E3_TURBO)
       #define LCD_SERIAL_PORT 1
     #else
       #define LCD_SERIAL_PORT 3 // Creality 4.x board
     #endif
   #endif
   #define HAS_LCD_BRIGHTNESS 1
   #define LCD_BRIGHTNESS_MAX 250
 #endif
 
 #if IS_ULTRA_LCD

commit d5f2334140e6f8ead29d3648b371547ebe72c7aa
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat Jan 22 10:14:47 2022 -0600

    ‚ôªÔ∏è Adjust LCD init, contrast default, settings load

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 4386964744..2daa15d0d3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -230,21 +230,21 @@
   #if ENABLED(TFTGLCD_PANEL_I2C)
     #define LCD_I2C_ADDRESS           0x33  // Must be 0x33 for STM32 main boards and equal to panel's I2C slave address
   #endif
   #define LCD_USE_I2C_BUZZER                // Enable buzzer on LCD, used for both I2C and SPI buses (LiquidTWI2 not required)
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #define LCD_WIDTH                   20    // 20 or 24 chars in line
   #define LCD_HEIGHT                  10    // Character lines
   #define LCD_CONTRAST_MIN            127
   #define LCD_CONTRAST_MAX            255
-  #define DEFAULT_LCD_CONTRAST        250
+  #define LCD_CONTRAST_DEFAULT        250
   #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define IS_RRD_FG_SC 1
   #define LCD_ST7920_DELAY_1           125
   #define LCD_ST7920_DELAY_2           125
   #define LCD_ST7920_DELAY_3           125

commit e99d95b7707f04bc28513322dad88eeb0d45778e
Author: Anson Liu <ansonl@users.noreply.github.com>
Date:   Thu Jan 6 06:26:12 2022 -0500

    üì∫ Tune ULTI_CONTROLLER encoder, enable PCA9632 (#23461)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d49a917842..4386964744 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -200,22 +200,25 @@
       #define NEOPIXEL_BRIGHTNESS 127
     #endif
     //#define NEOPIXEL_STARTUP_TEST
   #endif
 
 #elif ENABLED(ULTI_CONTROLLER)
 
   #define IS_ULTIPANEL 1
   #define U8GLIB_SSD1309
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
-  #define ENCODER_PULSES_PER_STEP 2
-  #define ENCODER_STEPS_PER_MENU_ITEM 2
+  #define ENCODER_PULSES_PER_STEP 4
+  #define ENCODER_STEPS_PER_MENU_ITEM 1
+  #ifndef PCA9632
+    #define PCA9632
+  #endif
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
   #define IS_RRD_SC 1
   #define LCD_WIDTH 16
   #define LCD_HEIGHT 2
 
 #elif EITHER(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
 
   #define IS_TFTGLCD_PANEL 1

commit 9140016e0264b731b074e6d04f286f1e8c23a29e
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Jan 5 11:44:22 2022 -0600

    üêõ Fix X2_HOME_TO_*

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 53c1bb302a..d49a917842 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -928,25 +928,20 @@
     #endif
   #endif
 #endif // FILAMENT_RUNOUT_SENSOR
 
 // Homing to Min or Max
 #if X_HOME_DIR > 0
   #define X_HOME_TO_MAX 1
 #elif X_HOME_DIR < 0
   #define X_HOME_TO_MIN 1
 #endif
-#if X2_HOME_DIR > 0
-  #define X2_HOME_TO_MAX 1
-#elif X2_HOME_DIR < 0
-  #define X2_HOME_TO_MIN 1
-#endif
 #if Y_HOME_DIR > 0
   #define Y_HOME_TO_MAX 1
 #elif Y_HOME_DIR < 0
   #define Y_HOME_TO_MIN 1
 #endif
 #if Z_HOME_DIR > 0
   #define Z_HOME_TO_MAX 1
 #elif Z_HOME_DIR < 0
   #define Z_HOME_TO_MIN 1
 #endif

commit e65c12cf96a226019a7456099078ee5cb03f9a49
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Jan 2 09:22:36 2022 -0600

    üßë‚Äçüíª Apply axis conditionals

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 803a182654..53c1bb302a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -686,20 +686,29 @@
  * Number of Linear Axes (e.g., XYZ)
  * All the logical axes except for the tool (E) axis
  */
 #ifndef LINEAR_AXES
   #define LINEAR_AXES XYZ
 #endif
 #if LINEAR_AXES >= XY
   #define HAS_Y_AXIS 1
   #if LINEAR_AXES >= XYZ
     #define HAS_Z_AXIS 1
+    #if LINEAR_AXES >= 4
+      #define HAS_I_AXIS 1
+      #if LINEAR_AXES >= 5
+        #define HAS_J_AXIS 1
+        #if LINEAR_AXES >= 6
+          #define HAS_K_AXIS 1
+        #endif
+      #endif
+    #endif
   #endif
 #endif
 
 /**
  * Number of Logical Axes (e.g., XYZE)
  * All the logical axes that can be commanded directly by G-code.
  * Delta maps stepper-specific values to ABC steppers.
  */
 #if HAS_EXTRUDERS
   #define LOGICAL_AXES INCREMENT(LINEAR_AXES)
@@ -919,20 +928,25 @@
     #endif
   #endif
 #endif // FILAMENT_RUNOUT_SENSOR
 
 // Homing to Min or Max
 #if X_HOME_DIR > 0
   #define X_HOME_TO_MAX 1
 #elif X_HOME_DIR < 0
   #define X_HOME_TO_MIN 1
 #endif
+#if X2_HOME_DIR > 0
+  #define X2_HOME_TO_MAX 1
+#elif X2_HOME_DIR < 0
+  #define X2_HOME_TO_MIN 1
+#endif
 #if Y_HOME_DIR > 0
   #define Y_HOME_TO_MAX 1
 #elif Y_HOME_DIR < 0
   #define Y_HOME_TO_MIN 1
 #endif
 #if Z_HOME_DIR > 0
   #define Z_HOME_TO_MAX 1
 #elif Z_HOME_DIR < 0
   #define Z_HOME_TO_MIN 1
 #endif
@@ -1208,27 +1222,27 @@
 // Fallback axis inverting
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif
 #if HAS_Y_AXIS && !defined(INVERT_Y_DIR)
   #define INVERT_Y_DIR false
 #endif
 #if HAS_Z_AXIS && !defined(INVERT_Z_DIR)
   #define INVERT_Z_DIR false
 #endif
-#if LINEAR_AXES >= 4 && !defined(INVERT_I_DIR)
+#if HAS_I_AXIS && !defined(INVERT_I_DIR)
   #define INVERT_I_DIR false
 #endif
-#if LINEAR_AXES >= 5 && !defined(INVERT_J_DIR)
+#if HAS_J_AXIS && !defined(INVERT_J_DIR)
   #define INVERT_J_DIR false
 #endif
-#if LINEAR_AXES >= 6 && !defined(INVERT_K_DIR)
+#if HAS_K_AXIS && !defined(INVERT_K_DIR)
   #define INVERT_K_DIR false
 #endif
 #if HAS_EXTRUDERS && !defined(INVERT_E_DIR)
   #define INVERT_E_DIR false
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
@@ -1404,21 +1418,21 @@
 #if !(defined(TOUCH_CALIBRATION_X) || defined(TOUCH_CALIBRATION_Y) || defined(TOUCH_OFFSET_X) || defined(TOUCH_OFFSET_Y) || defined(TOUCH_ORIENTATION))
   #if defined(XPT2046_X_CALIBRATION) && defined(XPT2046_Y_CALIBRATION) && defined(XPT2046_X_OFFSET) && defined(XPT2046_Y_OFFSET)
     #define TOUCH_CALIBRATION_X  XPT2046_X_CALIBRATION
     #define TOUCH_CALIBRATION_Y  XPT2046_Y_CALIBRATION
     #define TOUCH_OFFSET_X       XPT2046_X_OFFSET
     #define TOUCH_OFFSET_Y       XPT2046_Y_OFFSET
     #define TOUCH_ORIENTATION    TOUCH_LANDSCAPE
   #endif
 #endif
 
-#if ANY(USE_XMIN_PLUG, USE_YMIN_PLUG, USE_ZMIN_PLUG, USE_XMAX_PLUG, USE_YMAX_PLUG, USE_ZMAX_PLUG)
+#if X_HOME_DIR || (HAS_Y_AXIS && Y_HOME_DIR) || (HAS_Z_AXIS && Z_HOME_DIR) || (HAS_I_AXIS && I_HOME_DIR) || (HAS_J_AXIS && J_HOME_DIR) || (HAS_K_AXIS && K_HOME_DIR)
   #define HAS_ENDSTOPS 1
   #define COORDINATE_OKAY(N,L,H) WITHIN(N,L,H)
 #else
   #define COORDINATE_OKAY(N,L,H) true
 #endif
 
 /**
  * LED Backlight INDEX END
  */
 #if defined(NEOPIXEL_BKGD_INDEX_FIRST) && !defined(NEOPIXEL_BKGD_INDEX_LAST)

commit d557db842598639f4ab49447e216557515b3ba9e
Author: Ave6683 <53094187+Ave6683@users.noreply.github.com>
Date:   Mon Dec 27 22:28:27 2021 +0100

    ‚ú® MagLev V4 probe by MDD (#23192)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9e050101aa..803a182654 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -815,21 +815,21 @@
 #if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
   #define HAS_SERVO_ANGLES 1
 #endif
 #if !HAS_SERVO_ANGLES
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
  * Set a flag for any type of bed probe, including the paper-test
  */
-#if ANY(HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE)
+#if ANY(HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE, MAGLEV4)
   #define HAS_BED_PROBE 1
 #endif
 
 /**
  * Fill in undefined Filament Sensor options
  */
 #if ENABLED(FILAMENT_RUNOUT_SENSOR)
   #if NUM_RUNOUT_SENSORS >= 1
     #ifndef FIL_RUNOUT1_STATE
       #define FIL_RUNOUT1_STATE FIL_RUNOUT_STATE

commit e5154ec28179c7dc7b58a830412e7cb09c2f878c
Author: John Robertson <john@cirtech.co.uk>
Date:   Tue Nov 23 21:24:24 2021 +0000

    ‚ú® MarkForged YX kinematics (#23163)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7d8b50f7be..9e050101aa 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1072,21 +1072,21 @@
   #elif CORE_IS_XZ
     #define CORE_AXIS_1 A_AXIS
     #define NORMAL_AXIS Y_AXIS
     #define CORE_AXIS_2 C_AXIS
   #elif CORE_IS_YZ
     #define NORMAL_AXIS X_AXIS
     #define CORE_AXIS_1 B_AXIS
     #define CORE_AXIS_2 C_AXIS
   #endif
   #define CORESIGN(n) (ANY(COREYX, COREZX, COREZY) ? (-(n)) : (n))
-#elif ENABLED(MARKFORGED_XY)
+#elif EITHER(MARKFORGED_XY, MARKFORGED_YX)
   // Markforged kinematics
   #define CORE_AXIS_1 A_AXIS
   #define CORE_AXIS_2 B_AXIS
   #define NORMAL_AXIS Z_AXIS
 #endif
 
 #if ANY(MORGAN_SCARA, MP_SCARA, AXEL_TPARA)
   #define IS_SCARA 1
   #define IS_KINEMATIC 1
 #elif EITHER(DELTA, POLARGRAPH)

commit 6ac0d4727cd4abe70002c32faf3d87c7e24bfad3
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Sun Nov 21 11:25:06 2021 -0800

    ‚ú® BigTreeTech Mini 12864 V1.0 (#23130)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7b0c992868..7d8b50f7be 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -24,22 +24,22 @@
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
 // MKS_LCD12864A/B is a variant of MKS_MINI_12864
 #if EITHER(MKS_LCD12864A, MKS_LCD12864B)
   #define MKS_MINI_12864
 #endif
 
-// MKS_MINI_12864_V3 is simply identical to FYSETC_MINI_12864_2_1
-#if ENABLED(MKS_MINI_12864_V3)
+// MKS_MINI_12864_V3 and BTT_MINI_12864_V1 are identical to FYSETC_MINI_12864_2_1
+#if EITHER(MKS_MINI_12864_V3, BTT_MINI_12864_V1)
   #define FYSETC_MINI_12864_2_1
 #endif
 
 /**
  * General Flags that may be set below by specific LCDs
  *
  *  DOGLCD                  : Run a Graphical LCD through U8GLib (with MarlinUI)
  *  IS_ULTIPANEL            : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
  *  IS_ULTRA_LCD            : Ultra LCD, not necessarily Ultipanel.
  *  IS_RRD_SC               : Common RRD Smart Controller digital interface pins

commit de3c563a990e72533fb9ea9f376c53595c3e986b
Author: tome9111991 <57866234+tome9111991@users.noreply.github.com>
Date:   Fri Oct 22 18:16:07 2021 +0200

    üêõ Fix SHOW_REMAINING_TIME option for JyersUI (#22999)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c9ef448162..7b0c992868 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -535,20 +535,24 @@
 #endif
 
 #if ANY(HAS_DISPLAY, HAS_DWIN_E3V2, GLOBAL_STATUS_MESSAGE)
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_LCD_MENU 1
 #endif
 
+#if ANY(HAS_MARLINUI_U8GLIB, EXTENSIBLE_UI, HAS_MARLINUI_HD44780, IS_TFTGLCD_PANEL, IS_DWIN_MARLINUI, DWIN_CREALITY_LCD_JYERSUI)
+  #define CAN_SHOW_REMAINING_TIME 1
+#endif
+
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
   #endif
   #ifndef LCD_PIXEL_HEIGHT
     #define LCD_PIXEL_HEIGHT 64
   #endif
 #endif
 
 /**

commit 9a19ea50d8451fc0970843cc896bd2553e0f987e
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Fri Oct 22 08:52:31 2021 -0700

    ‚ú® BigTreeTech TFT35 SPI V1.0 (#22986)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e80dd3ed69..c9ef448162 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1237,48 +1237,48 @@
  *
  * Configure parameters for TFT displays:
  *  - TFT_DEFAULT_ORIENTATION
  *  - TFT_DRIVER
  *  - TFT_WIDTH
  *  - TFT_HEIGHT
  *  - TFT_INTERFACE_(SPI|FSMC)
  *  - TFT_COLOR
  *  - GRAPHICAL_TFT_UPSCALE
  */
-#if ENABLED(MKS_TS35_V2_0)          // ST7796
+#if EITHER(MKS_TS35_V2_0, BTT_TFT35_SPI_V1_0)                                 // ST7796
   #define TFT_DEFAULT_DRIVER ST7796
   #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_480x320
   #define TFT_INTERFACE_SPI
-#elif EITHER(LERDGE_TFT35, ANET_ET5_TFT35) // ST7796
+#elif EITHER(LERDGE_TFT35, ANET_ET5_TFT35)                                    // ST7796
   #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
-#elif ANY(ANET_ET4_TFT28, MKS_ROBIN_TFT24, MKS_ROBIN_TFT28, MKS_ROBIN_TFT32) // ST7789
+#elif ANY(ANET_ET4_TFT28, MKS_ROBIN_TFT24, MKS_ROBIN_TFT28, MKS_ROBIN_TFT32)  // ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif ANY(MKS_ROBIN_TFT35, TFT_TRONXY_X5SA, ANYCUBIC_TFT35) // ILI9488
+#elif ANY(MKS_ROBIN_TFT35, TFT_TRONXY_X5SA, ANYCUBIC_TFT35)                   // ILI9488
   #define TFT_DRIVER ILI9488
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(MKS_ROBIN_TFT43)
   #define TFT_DRIVER SSD1963
   #define TFT_DEFAULT_ORIENTATION 0
   #define TFT_RES_480x272
   #define TFT_INTERFACE_FSMC
-#elif ANY(MKS_ROBIN_TFT_V1_1R, LONGER_LK_TFT28)  // ILI9328 or R61505
+#elif ANY(MKS_ROBIN_TFT_V1_1R, LONGER_LK_TFT28)                               // ILI9328 or R61505
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(BIQU_BX_TFT70)        // RGB
+#elif ENABLED(BIQU_BX_TFT70)                                                  // RGB
   #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_1024x600
   #define TFT_INTERFACE_LTDC
   #if ENABLED(TOUCH_SCREEN)
     #define TFT_TOUCH_DEVICE_GT911
   #endif
 #elif ENABLED(TFT_GENERIC)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #if NONE(TFT_RES_320x240, TFT_RES_480x272, TFT_RES_480x320)
     #define TFT_RES_320x240

commit de5aefd09e2ede1314382c4a10e51335d07524f9
Author: ellensp <530024+ellensp@users.noreply.github.com>
Date:   Fri Oct 15 14:38:03 2021 +1300

    üîß Add, update TFT sanity checks (#22928)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 46b969a478..e80dd3ed69 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -325,21 +325,20 @@
 // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
 #if ENABLED(U8GLIB_SH1106_EINSTART)
   #define DOGLCD
   #define IS_ULTIPANEL 1
 #endif
 
 // TFT Compatibility
 #if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
   #define IS_LEGACY_TFT 1
   #define TFT_GENERIC
-  #warning "Don't forget to update your TFT settings in Configuration.h."
 #endif
 
 #if ANY(FSMC_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_LVGL_UI_FSMC)
   #define TFT_INTERFACE_FSMC
 #elif ANY(SPI_GRAPHICAL_TFT, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_SPI)
   #define TFT_INTERFACE_SPI
 #endif
 
 #if EITHER(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
   #define TFT_CLASSIC_UI

commit 9bb562f40a5570a63430bbf9392da0fdb85c5c8c
Author: VragVideo <91742261+VragVideo@users.noreply.github.com>
Date:   Sun Oct 3 06:12:51 2021 +0300

    ‚ú® WYH L12864 LCD (Alfawise Ex8) (#22863)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 99b360f9f0..46b969a478 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -32,31 +32,31 @@
 #endif
 
 // MKS_MINI_12864_V3 is simply identical to FYSETC_MINI_12864_2_1
 #if ENABLED(MKS_MINI_12864_V3)
   #define FYSETC_MINI_12864_2_1
 #endif
 
 /**
  * General Flags that may be set below by specific LCDs
  *
- *  DOGLCD                : Run a Graphical LCD through U8GLib (with MarlinUI)
- *  IS_ULTIPANEL          : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
- *  IS_ULTRA_LCD          : Ultra LCD, not necessarily Ultipanel.
- *  IS_RRD_SC             : Common RRD Smart Controller digital interface pins
- *  IS_RRD_FG_SC          : Common RRD Full Graphical Smart Controller digital interface pins
- *  U8GLIB_ST7920         : Most common DOGM display SPI interface, supporting a "lightweight" display mode.
- *  U8GLIB_SH1106         : SH1106 OLED with I2C interface via U8GLib
- *  IS_U8GLIB_SSD1306     : SSD1306 OLED with I2C interface via U8GLib
- *  U8GLIB_SSD1309        : SSD1309 OLED with I2C interface via U8GLib
- *  U8GLIB_ST7565_64128N  : ST7565 128x64 LCD with SPI interface via U8GLib
- *  U8GLIB_LM6059_AF      : LM6059 with Hardware SPI via U8GLib
+ *  DOGLCD                  : Run a Graphical LCD through U8GLib (with MarlinUI)
+ *  IS_ULTIPANEL            : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
+ *  IS_ULTRA_LCD            : Ultra LCD, not necessarily Ultipanel.
+ *  IS_RRD_SC               : Common RRD Smart Controller digital interface pins
+ *  IS_RRD_FG_SC            : Common RRD Full Graphical Smart Controller digital interface pins
+ *  IS_U8GLIB_ST7920        : Most common DOGM display SPI interface, supporting a "lightweight" display mode.
+ *  U8GLIB_SH1106           : SH1106 OLED with I2C interface via U8GLib
+ *  IS_U8GLIB_SSD1306       : SSD1306 OLED with I2C interface via U8GLib (U8GLIB_SSD1306)
+ *  U8GLIB_SSD1309          : SSD1309 OLED with I2C interface via U8GLib (HAS_U8GLIB_I2C_OLED, IS_ULTRA_LCD, DOGLCD)
+ *  IS_U8GLIB_ST7565_64128N : ST7565 128x64 LCD with SPI interface via U8GLib
+ *  IS_U8GLIB_LM6059_AF     : LM6059 with Hardware SPI via U8GLib
  */
 #if EITHER(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
 
   #define MINIPANEL
 
 #elif ENABLED(YHCB2004)
 
   #define IS_ULTIPANEL 1
 
 #elif ENABLED(CARTESIO_UI)
@@ -78,80 +78,85 @@
 
   // This helps to implement HAS_ADC_BUTTONS menus
   #define REVERSE_MENU_DIRECTION
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
 
 #elif ENABLED(ZONESTAR_12864LCD)
   #define DOGLCD
   #define IS_RRD_SC 1
-  #define U8GLIB_ST7920
+  #define IS_U8GLIB_ST7920 1
 
 #elif ENABLED(ZONESTAR_12864OLED)
   #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
 #elif ENABLED(ZONESTAR_12864OLED_SSD1306)
   #define IS_RRD_SC 1
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(RADDS_DISPLAY)
   #define IS_ULTIPANEL 1
   #define ENCODER_PULSES_PER_STEP 2
 
-#elif ANY(miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
+#elif ANY(miniVIKI, VIKI2, WYH_L12864, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
+
+  #define IS_DOGM_12864 1
 
   #define DOGLCD
   #define IS_ULTIPANEL 1
 
   #if ENABLED(miniVIKI)
-    #define U8GLIB_ST7565_64128N
+    #define IS_U8GLIB_ST7565_64128N 1
   #elif ENABLED(VIKI2)
-    #define U8GLIB_ST7565_64128N
+    #define IS_U8GLIB_ST7565_64128N 1
+  #elif ENABLED(WYH_L12864)
+    #define IS_U8GLIB_ST7565_64128N 1
+    #define ST7565_XOFFSET 0x04
   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
-    #define U8GLIB_LM6059_AF
+    #define IS_U8GLIB_LM6059_AF 1
   #elif ENABLED(AZSMZ_12864)
-    #define U8GLIB_ST7565_64128N
+    #define IS_U8GLIB_ST7565_64128N 1
   #endif
 
 #elif ENABLED(OLED_PANEL_TINYBOY2)
 
   #define IS_U8GLIB_SSD1306
   #define IS_ULTIPANEL 1
 
 #elif ENABLED(RA_CONTROL_PANEL)
 
   #define LCD_I2C_TYPE_PCA8574
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
   #define IS_ULTIPANEL 1
 
 #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
   #define DOGLCD
-  #define U8GLIB_ST7920
+  #define IS_U8GLIB_ST7920 1
   #define IS_ULTIPANEL 1
 
 #elif ENABLED(MKS_12864OLED)
 
   #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC 1
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(SAV_3DGLCD)
 
   #ifdef U8GLIB_SSD1306
-    #define IS_U8GLIB_SSD1306
+    #define IS_U8GLIB_SSD1306 // Allow for U8GLIB_SSD1306 + SAV_3DGLCD
   #endif
   #define IS_NEWPANEL 1
 
 #elif ENABLED(FYSETC_242_OLED_12864)
 
   #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
   #define LED_CONTROL_MENU
   #define NEOPIXEL_LED
@@ -259,30 +264,30 @@
 #elif ENABLED(K3D_242_OLED_CONTROLLER)
 
   #define IS_RRD_SC 1
   #define U8GLIB_SSD1309
 
 #endif
 
 // ST7920-based graphical displays
 #if ANY(IS_RRD_FG_SC, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
-  #define U8GLIB_ST7920
+  #define IS_U8GLIB_ST7920 1
   #define IS_RRD_SC 1
 #endif
 
 // ST7565 / 64128N graphical displays
 #if EITHER(MAKRPANEL, MINIPANEL)
   #define IS_ULTIPANEL 1
   #define DOGLCD
   #if ENABLED(MAKRPANEL)
-    #define U8GLIB_ST7565_64128N
+    #define IS_U8GLIB_ST7565_64128N 1
   #endif
 #endif
 
 #if ENABLED(IS_U8GLIB_SSD1306)
   #define U8GLIB_SSD1306
 #endif
 
 #if ENABLED(OVERLORD_OLED)
   #define IS_ULTIPANEL 1
   #define U8GLIB_SH1106
@@ -366,38 +371,41 @@
 // Color UI
 #if ENABLED(TFT_COLOR_UI)
   #define HAS_GRAPHICAL_TFT 1
   #define IS_ULTIPANEL 1
 #endif
 
 /**
  * I2C Panels
  */
 
-#if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
+#if ANY(IS_RRD_SC, IS_DOGM_12864, OLED_PANEL_TINYBOY2, LCD_I2C_PANELOLU2)
 
-  #define LCD_I2C_TYPE_PCF8575
-  #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
+  #define STD_ENCODER_PULSES_PER_STEP 4
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
-  #if ENABLED(LCD_SAINSMART_I2C_2004)
-    #define LCD_WIDTH 20
-    #define LCD_HEIGHT 4
+  #if ENABLED(LCD_I2C_PANELOLU2)  // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
+    #define LCD_I2C_TYPE_MCP23017 // I2C Character-based 12864 display
+    #define LCD_I2C_ADDRESS 0x20  // I2C Address of the port expander
+    #define LCD_USE_I2C_BUZZER    // Enable buzzer on LCD (optional)
+    #define IS_ULTIPANEL 1
   #endif
 
-#elif ENABLED(LCD_I2C_PANELOLU2)
+#elif EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
-  // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
+  #define LCD_I2C_TYPE_PCF8575    // I2C Character-based 12864 display
+  #define LCD_I2C_ADDRESS 0x27    // I2C Address of the port expander
 
-  #define LCD_I2C_TYPE_MCP23017
-  #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
-  #define LCD_USE_I2C_BUZZER   // Enable buzzer on LCD (optional)
-  #define IS_ULTIPANEL 1
+  #if ENABLED(LCD_SAINSMART_I2C_2004)
+    #define LCD_WIDTH 20
+    #define LCD_HEIGHT 4
+  #endif
 
 #elif ENABLED(LCD_I2C_VIKI)
 
   /**
    * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
    *
    * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
    * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
    * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
    *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
@@ -410,25 +418,20 @@
   #define ENCODER_FEEDRATE_DEADZONE 4
 
   #define STD_ENCODER_PULSES_PER_STEP 1
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(G3D_PANEL)
 
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
-#elif ANY(IS_RRD_SC, miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, OLED_PANEL_TINYBOY2, BQ_LCD_SMART_CONTROLLER, LCD_I2C_PANELOLU2)
-
-  #define STD_ENCODER_PULSES_PER_STEP 4
-  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
-
 #endif
 
 #if EITHER(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008) && DISABLED(NO_LCD_DETECT)
   #define DETECT_I2C_LCD_DEVICE 1
 #endif
 
 #ifndef STD_ENCODER_PULSES_PER_STEP
   #if ENABLED(TOUCH_SCREEN)
     #define STD_ENCODER_PULSES_PER_STEP 2
   #else

commit 33e0855e2c173680865aaa6c6aa93047d63fc469
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Sep 28 01:07:51 2021 -0500

    ‚ö°Ô∏è Handle shared enable pins (#22824)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 381a0827e1..99b360f9f0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -580,41 +580,48 @@
 #undef EXTENDABLE_EMU_MMU2S
 
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
+ *
+ * These defines must be simple constants for use in REPEAT, etc.
  */
 #if EXTRUDERS
   #define HAS_EXTRUDERS 1
   #if EXTRUDERS > 1
     #define HAS_MULTI_EXTRUDER 1
   #endif
   #define E_AXIS_N(E) AxisEnum(E_AXIS + E_INDEX_N(E))
 #else
   #undef EXTRUDERS
   #define EXTRUDERS 0
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef HOTEND_IDLE_TIMEOUT
   #undef DISABLE_E
 #endif
 
+#define E_OPTARG(N) OPTARG(HAS_MULTI_EXTRUDER, N)
+#define E_TERN_(N)  TERN_(HAS_MULTI_EXTRUDER, N)
+#define E_TERN0(N)  TERN0(HAS_MULTI_EXTRUDER, N)
+
 #if ENABLED(E_DUAL_STEPPER_DRIVERS) // E0/E1 steppers act in tandem as E0
 
   #define E_STEPPERS      2
+  #define E_MANUAL        1
 
 #elif ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
 
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
@@ -630,21 +637,22 @@
     #define HAS_DUAL_MIXING 1
   #endif
 
 #elif ENABLED(SWITCHING_TOOLHEAD)   // Toolchanger
 
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 
 #elif HAS_PRUSA_MMU2                // Pr≈Ø≈°a Multi-Material Unit v2
 
-  #define E_STEPPERS 1
+  #define E_STEPPERS      1
+  #define E_MANUAL        1
 
 #endif
 
 // No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1
 #if ENABLED(SWITCHING_NOZZLE) || HAS_PRUSA_MMU1
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
 // Pr≈Ø≈°a MMU1, MMU(S) 2.0 and EXTENDABLE_EMU_MMU2(S) force SINGLENOZZLE
 #if HAS_MMU

commit 1ac7a56a823b5012250dd7259a9a7a46d3bfcde5
Author: Miguel Risco-Castillo <mriscoc@users.noreply.github.com>
Date:   Sat Sep 25 05:59:43 2021 -0500

    üêõ E3V2 Brightness followup (#22821)
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5feb3959f6..381a0827e1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -493,20 +493,34 @@
 #endif
 
 // Aliases for LCD features
 #if EITHER(DWIN_CREALITY_LCD, DWIN_CREALITY_LCD_ENHANCED)
   #define HAS_DWIN_E3V2_BASIC 1
 #endif
 #if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
 
+// E3V2 extras
+#if HAS_DWIN_E3V2 || IS_DWIN_MARLINUI
+  #define SERIAL_CATCHALL 0
+  #ifndef LCD_SERIAL_PORT
+    #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_E3_TURBO)
+      #define LCD_SERIAL_PORT 1
+    #else
+      #define LCD_SERIAL_PORT 3 // Creality 4.x board
+    #endif
+  #endif
+  #define HAS_LCD_BRIGHTNESS 1
+  #define LCD_BRIGHTNESS_MAX 250
+#endif
+
 #if IS_ULTRA_LCD
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif IS_DWIN_MARLINUI
     // Since HAS_MARLINUI_U8GLIB refers to U8G displays
     // the DWIN display can define its own flags
   #elif !HAS_GRAPHICAL_TFT
@@ -1104,31 +1118,20 @@
   #define NUM_SERIAL 0
   #undef BAUD_RATE_GCODE
 #endif
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1 || SERIAL_PORT_3 == -1
   #define HAS_USB_SERIAL 1
 #endif
 #if SERIAL_PORT_2 == -2
   #define HAS_ETHERNET 1
 #endif
 
-#if EITHER(HAS_DWIN_E3V2, IS_DWIN_MARLINUI)
-  #define SERIAL_CATCHALL 0
-  #ifndef LCD_SERIAL_PORT
-    #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_E3_TURBO)
-      #define LCD_SERIAL_PORT 1
-    #else
-      #define LCD_SERIAL_PORT 3 // Creality 4.x board
-    #endif
-  #endif
-#endif
-
 // Fallback Stepper Driver types that don't depend on Configuration_adv.h
 #ifndef X_DRIVER_TYPE
   #define X_DRIVER_TYPE  A4988
 #endif
 #ifndef X2_DRIVER_TYPE
   #define X2_DRIVER_TYPE A4988
 #endif
 #ifndef Y_DRIVER_TYPE
   #define Y_DRIVER_TYPE  A4988
 #endif

commit 3344071f24b505d180dd1423b11510172c3f1c1c
Author: Dan Royer <dan@marginallyclever.com>
Date:   Mon Sep 20 13:42:33 2021 -0700

    Polargraph / Makelangelo kinematics (#22790)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 023bf46426..5feb3959f6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1054,21 +1054,21 @@
 #elif ENABLED(MARKFORGED_XY)
   // Markforged kinematics
   #define CORE_AXIS_1 A_AXIS
   #define CORE_AXIS_2 B_AXIS
   #define NORMAL_AXIS Z_AXIS
 #endif
 
 #if ANY(MORGAN_SCARA, MP_SCARA, AXEL_TPARA)
   #define IS_SCARA 1
   #define IS_KINEMATIC 1
-#elif ENABLED(DELTA)
+#elif EITHER(DELTA, POLARGRAPH)
   #define IS_KINEMATIC 1
 #else
   #define IS_CARTESIAN 1
   #if !IS_CORE
     #define IS_FULL_CARTESIAN 1
   #endif
 #endif
 
 #if DISABLED(DELTA)
   #undef DELTA_HOME_TO_SAFE_ZONE

commit c2e4b1626f0cce82a55e8de9dc98ed9381e1d9ad
Author: Tanguy Pruvot <tpruvot@users.noreply.github.com>
Date:   Tue Sep 14 04:07:08 2021 +0200

    ‚ú® TFT Screen/Backlight Sleep (#22617)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7f8891b514..023bf46426 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1353,20 +1353,23 @@
   #define HAS_UI_1024x600 1
 #endif
 #if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)   // Fewer lines with touch buttons onscreen
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN)
+  #if TOUCH_IDLE_SLEEP
+    #define HAS_TOUCH_SLEEP 1
+  #endif
   #if NONE(TFT_TOUCH_DEVICE_GT911, TFT_TOUCH_DEVICE_XPT2046)
     #define TFT_TOUCH_DEVICE_XPT2046          // ADS7843/XPT2046 ADC Touchscreen such as ILI9341 2.8
   #endif
   #if ENABLED(TFT_TOUCH_DEVICE_GT911)         // GT911 Capacitive touch screen such as BIQU_BX_TFT70
     #undef TOUCH_SCREEN_CALIBRATION
     #undef TOUCH_CALIBRATION_AUTO_SAVE
   #endif
   #if !HAS_GRAPHICAL_TFT
     #undef TOUCH_SCREEN
     #if ENABLED(TFT_CLASSIC_UI)

commit d69c053225bab92bf53bec064a1830079a2092f9
Author: Vert <45634861+Vertabreak@users.noreply.github.com>
Date:   Sun Sep 12 22:39:52 2021 -0400

    üêõ Fix ENABLED => EITHER typo (#22756)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index fc7e05b896..7f8891b514 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -234,21 +234,21 @@
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define IS_RRD_FG_SC 1
   #define LCD_ST7920_DELAY_1           125
   #define LCD_ST7920_DELAY_2           125
   #define LCD_ST7920_DELAY_3           125
 
-#elif ENABLED(ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING)
+#elif EITHER(ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING)
 
   #define IS_RRD_FG_SC 1
   #define LCD_ST7920_DELAY_1           150
   #define LCD_ST7920_DELAY_2           150
   #define LCD_ST7920_DELAY_3           150
 
 #elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, BQ_LCD_SMART_CONTROLLER, K3D_FULL_GRAPHIC_SMART_CONTROLLER)
 
   #define IS_RRD_FG_SC 1
 

commit 011329fe55f82e0c64c48a6bc983c10569206fb3
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat Sep 11 02:47:53 2021 -0500

    üêõ No probe enum for DELTA + SENSORLESS_PROBING
    
    Fix #22729

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a7bde803ba..fc7e05b896 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -924,21 +924,24 @@
   #define K_HOME_TO_MIN 1
 #endif
 
 /**
  * Conditionals based on the type of Bed Probe
  */
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
-  #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN) && !BOTH(DELTA, SENSORLESS_PROBING)
+  #if BOTH(DELTA, SENSORLESS_PROBING)
+    #define HAS_DELTA_SENSORLESS_PROBING 1
+  #endif
+  #if NONE(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN, HAS_DELTA_SENSORLESS_PROBING)
     #define USES_Z_MIN_PROBE_PIN 1
   #endif
   #if Z_HOME_TO_MIN && TERN1(USES_Z_MIN_PROBE_PIN, ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe

commit 0f61d9e4dd4d4e4f27e5c688ab2c5dbd0f03af84
Author: Miguel Risco-Castillo <mriscoc@users.noreply.github.com>
Date:   Tue Sep 7 02:15:24 2021 -0500

    ‚ú® Ender-3 V2 CrealityUI Enhanced (#21942)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 825ad58f9a..a7bde803ba 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -486,21 +486,24 @@
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
-#if ANY(DWIN_CREALITY_LCD, DWIN_CREALITY_LCD_JYERSUI)
+#if EITHER(DWIN_CREALITY_LCD, DWIN_CREALITY_LCD_ENHANCED)
+  #define HAS_DWIN_E3V2_BASIC 1
+#endif
+#if EITHER(HAS_DWIN_E3V2_BASIC, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DWIN_E3V2 1
 #endif
 
 #if IS_ULTRA_LCD
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif IS_DWIN_MARLINUI

commit 43a9c71ef7a1c9e9e294707017d372d344c774ce
Author: Jyers <76993396+Jyers@users.noreply.github.com>
Date:   Mon Sep 6 21:06:27 2021 -0700

    ‚ú® Ender-3 V2 with Jyers UI (#22422)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0715b1f514..825ad58f9a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -486,39 +486,43 @@
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
+#if ANY(DWIN_CREALITY_LCD, DWIN_CREALITY_LCD_JYERSUI)
+  #define HAS_DWIN_E3V2 1
+#endif
+
 #if IS_ULTRA_LCD
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif IS_DWIN_MARLINUI
     // Since HAS_MARLINUI_U8GLIB refers to U8G displays
     // the DWIN display can define its own flags
   #elif !HAS_GRAPHICAL_TFT
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
-#if EITHER(HAS_WIRED_LCD, EXTENSIBLE_UI)
+#if ANY(HAS_WIRED_LCD, EXTENSIBLE_UI, DWIN_CREALITY_LCD_JYERSUI)
   #define HAS_DISPLAY 1
 #endif
 
-#if ANY(HAS_DISPLAY, DWIN_CREALITY_LCD, GLOBAL_STATUS_MESSAGE)
+#if ANY(HAS_DISPLAY, HAS_DWIN_E3V2, GLOBAL_STATUS_MESSAGE)
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_LCD_MENU 1
 #endif
 
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
@@ -1094,21 +1098,21 @@
   #define NUM_SERIAL 0
   #undef BAUD_RATE_GCODE
 #endif
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1 || SERIAL_PORT_3 == -1
   #define HAS_USB_SERIAL 1
 #endif
 #if SERIAL_PORT_2 == -2
   #define HAS_ETHERNET 1
 #endif
 
-#if EITHER(DWIN_CREALITY_LCD, IS_DWIN_MARLINUI)
+#if EITHER(HAS_DWIN_E3V2, IS_DWIN_MARLINUI)
   #define SERIAL_CATCHALL 0
   #ifndef LCD_SERIAL_PORT
     #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_E3_TURBO)
       #define LCD_SERIAL_PORT 1
     #else
       #define LCD_SERIAL_PORT 3 // Creality 4.x board
     #endif
   #endif
 #endif
 

commit b0e798330d8f5ade4a230e0a91f05482d100bb97
Author: mrv96 <mrv96@users.noreply.github.com>
Date:   Tue Sep 7 02:51:04 2021 +0200

    ‚ú®Add DGUS_LCD_UI_RELOADED (#21931)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9875422742..0715b1f514 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -472,20 +472,24 @@
 
 #if EITHER(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
   #define IS_RRW_KEYPAD 1
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
 #if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY, DGUS_LCD_UI_MKS)
+  #define HAS_DGUS_LCD_CLASSIC 1
+#endif
+
+#if ANY(HAS_DGUS_LCD_CLASSIC, DGUS_LCD_UI_RELOADED)
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features

commit 853eebc3f2f6326000da790cfd549c2a44dfeae2
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Sep 6 17:38:47 2021 -0500

    üö∏ Show ExtUI message for PID_STARTED

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b6f76564f9..9875422742 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -471,21 +471,21 @@
 #endif
 
 #if EITHER(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
   #define IS_RRW_KEYPAD 1
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
-#if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY,DGUS_LCD_UI_MKS)
+#if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY, DGUS_LCD_UI_MKS)
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features

commit c881fab1280f338e32015e1556890d647ee967fb
Author: dotdash32 <dotdash32@gmail.com>
Date:   Sun Sep 5 17:21:25 2021 -0700

    üé® Use largest default ST9720 delays (#22713)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 13af3c25f5..b6f76564f9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -230,30 +230,30 @@
   #define LCD_CONTRAST_MIN            127
   #define LCD_CONTRAST_MAX            255
   #define DEFAULT_LCD_CONTRAST        250
   #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define IS_RRD_FG_SC 1
-  #define LCD_ST7920_DELAY_1 DELAY_NS(125)
-  #define LCD_ST7920_DELAY_2 DELAY_NS(125)
-  #define LCD_ST7920_DELAY_3 DELAY_NS(125)
+  #define LCD_ST7920_DELAY_1           125
+  #define LCD_ST7920_DELAY_2           125
+  #define LCD_ST7920_DELAY_3           125
 
 #elif ENABLED(ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING)
 
   #define IS_RRD_FG_SC 1
-  #define LCD_ST7920_DELAY_1 DELAY_NS(150)
-  #define LCD_ST7920_DELAY_2 DELAY_NS(150)
-  #define LCD_ST7920_DELAY_3 DELAY_NS(150)
+  #define LCD_ST7920_DELAY_1           150
+  #define LCD_ST7920_DELAY_2           150
+  #define LCD_ST7920_DELAY_3           150
 
 #elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, BQ_LCD_SMART_CONTROLLER, K3D_FULL_GRAPHIC_SMART_CONTROLLER)
 
   #define IS_RRD_FG_SC 1
 
 #elif ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
 
   #define IS_RRD_SC 1   // RepRapDiscount LCD or Graphical LCD with rotary click encoder
 
 #elif ENABLED(K3D_242_OLED_CONTROLLER)

commit 71a2a958858f47545bb9f02764af26fb68991b36
Author: Tanguy Pruvot <tpruvot@users.noreply.github.com>
Date:   Thu Sep 2 01:55:36 2021 +0200

    üî® Enhance Lerdge pins, TFTs, and variants (#22658)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index bfbe5ba6cf..13af3c25f5 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1212,67 +1212,47 @@
  *  - TFT_DEFAULT_ORIENTATION
  *  - TFT_DRIVER
  *  - TFT_WIDTH
  *  - TFT_HEIGHT
  *  - TFT_INTERFACE_(SPI|FSMC)
  *  - TFT_COLOR
  *  - GRAPHICAL_TFT_UPSCALE
  */
 #if ENABLED(MKS_TS35_V2_0)          // ST7796
   #define TFT_DEFAULT_DRIVER ST7796
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
+  #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_480x320
   #define TFT_INTERFACE_SPI
-#elif ENABLED(ANET_ET5_TFT35)       // ST7796
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
+#elif EITHER(LERDGE_TFT35, ANET_ET5_TFT35) // ST7796
+  #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(ANET_ET4_TFT28)       // ST7789
+#elif ANY(ANET_ET4_TFT28, MKS_ROBIN_TFT24, MKS_ROBIN_TFT28, MKS_ROBIN_TFT32) // ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT24)      // ST7789
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
-  #define TFT_RES_320x240
-  #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT28)      // ST7789
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
-  #define TFT_RES_320x240
-  #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT32)      // ST7789
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
-  #define TFT_RES_320x240
-  #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT35)      // ILI9488
+#elif ANY(MKS_ROBIN_TFT35, TFT_TRONXY_X5SA, ANYCUBIC_TFT35) // ILI9488
+  #define TFT_DRIVER ILI9488
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(MKS_ROBIN_TFT43)
   #define TFT_DRIVER SSD1963
   #define TFT_DEFAULT_ORIENTATION 0
   #define TFT_RES_480x272
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT_V1_1R)  // ILI9328 or R61505
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
-  #define TFT_RES_320x240
-  #define TFT_INTERFACE_FSMC
-#elif EITHER(TFT_TRONXY_X5SA, ANYCUBIC_TFT35) // ILI9488
-  #define TFT_DRIVER ILI9488
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
-  #define TFT_RES_480x320
-  #define TFT_INTERFACE_FSMC
-#elif ENABLED(LONGER_LK_TFT28)
+#elif ANY(MKS_ROBIN_TFT_V1_1R, LONGER_LK_TFT28)  // ILI9328 or R61505
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(BIQU_BX_TFT70)        // RGB
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
+  #define TFT_DEFAULT_ORIENTATION TFT_EXCHANGE_XY
   #define TFT_RES_1024x600
   #define TFT_INTERFACE_LTDC
   #if ENABLED(TOUCH_SCREEN)
     #define TFT_TOUCH_DEVICE_GT911
   #endif
 #elif ENABLED(TFT_GENERIC)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #if NONE(TFT_RES_320x240, TFT_RES_480x272, TFT_RES_480x320)
     #define TFT_RES_320x240
   #endif

commit d818a019c5d80e8b2238f0ea8311ad53154be4ec
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Aug 28 15:27:52 2021 -0500

    üé® EXP headers, ST7920 delays (#22641)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c4309db144..bfbe5ba6cf 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -230,25 +230,32 @@
   #define LCD_CONTRAST_MIN            127
   #define LCD_CONTRAST_MAX            255
   #define DEFAULT_LCD_CONTRAST        250
   #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define IS_RRD_FG_SC 1
-  #define BOARD_ST7920_DELAY_1 DELAY_NS(125)
-  #define BOARD_ST7920_DELAY_2 DELAY_NS(125)
-  #define BOARD_ST7920_DELAY_3 DELAY_NS(125)
+  #define LCD_ST7920_DELAY_1 DELAY_NS(125)
+  #define LCD_ST7920_DELAY_2 DELAY_NS(125)
+  #define LCD_ST7920_DELAY_3 DELAY_NS(125)
 
-#elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING, BQ_LCD_SMART_CONTROLLER, K3D_FULL_GRAPHIC_SMART_CONTROLLER)
+#elif ENABLED(ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING)
+
+  #define IS_RRD_FG_SC 1
+  #define LCD_ST7920_DELAY_1 DELAY_NS(150)
+  #define LCD_ST7920_DELAY_2 DELAY_NS(150)
+  #define LCD_ST7920_DELAY_3 DELAY_NS(150)
+
+#elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, BQ_LCD_SMART_CONTROLLER, K3D_FULL_GRAPHIC_SMART_CONTROLLER)
 
   #define IS_RRD_FG_SC 1
 
 #elif ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
 
   #define IS_RRD_SC 1   // RepRapDiscount LCD or Graphical LCD with rotary click encoder
 
 #elif ENABLED(K3D_242_OLED_CONTROLLER)
 
   #define IS_RRD_SC 1

commit 7d416bd055e3ccddf765208b2937dcc1fcd4ea8b
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Aug 22 05:25:07 2021 -0500

    ‚ú® MarlinUI for Ender 3 v2 DWIN LCD (#22594)
    
    Co-Authored-By: Taylor Talkington <taylor.talkington@gmail.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 137b9fce3e..c4309db144 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -481,21 +481,24 @@
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if IS_ULTRA_LCD
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
-  #elif DISABLED(HAS_GRAPHICAL_TFT)
+  #elif IS_DWIN_MARLINUI
+    // Since HAS_MARLINUI_U8GLIB refers to U8G displays
+    // the DWIN display can define its own flags
+  #elif !HAS_GRAPHICAL_TFT
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
 #if EITHER(HAS_WIRED_LCD, EXTENSIBLE_UI)
   #define HAS_DISPLAY 1
 #endif
 
 #if ANY(HAS_DISPLAY, DWIN_CREALITY_LCD, GLOBAL_STATUS_MESSAGE)
   #define HAS_STATUS_MESSAGE 1
@@ -1080,21 +1083,21 @@
   #define NUM_SERIAL 0
   #undef BAUD_RATE_GCODE
 #endif
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1 || SERIAL_PORT_3 == -1
   #define HAS_USB_SERIAL 1
 #endif
 #if SERIAL_PORT_2 == -2
   #define HAS_ETHERNET 1
 #endif
 
-#if ENABLED(DWIN_CREALITY_LCD)
+#if EITHER(DWIN_CREALITY_LCD, IS_DWIN_MARLINUI)
   #define SERIAL_CATCHALL 0
   #ifndef LCD_SERIAL_PORT
     #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_E3_TURBO)
       #define LCD_SERIAL_PORT 1
     #else
       #define LCD_SERIAL_PORT 3 // Creality 4.x board
     #endif
   #endif
 #endif
 

commit afca6e745932d295b88d37fa9bd4274e22705b0b
Author: luzpaz <luzpaz@users.noreply.github.com>
Date:   Tue Aug 3 20:02:34 2021 -0400

    üêõ Spellcheck comments (#22496)
    
    codespell -q 3 --builtin=clear,rare,informal,code -S ./Marlin/src/lcd/language -L alo,amin,endcode,stdio,uint

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 1025a8153b..137b9fce3e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -213,21 +213,21 @@
 
 #elif EITHER(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
 
   #define IS_TFTGLCD_PANEL 1
   #define IS_ULTIPANEL 1                    // Note that IS_ULTIPANEL leads to HAS_WIRED_LCD
 
   #if ENABLED(SDSUPPORT) && DISABLED(LCD_PROGRESS_BAR)
     #define LCD_PROGRESS_BAR
   #endif
   #if ENABLED(TFTGLCD_PANEL_I2C)
-    #define LCD_I2C_ADDRESS           0x33  // Must be 0x33 for STM32 main boards and equal to panel's I2C slave addres
+    #define LCD_I2C_ADDRESS           0x33  // Must be 0x33 for STM32 main boards and equal to panel's I2C slave address
   #endif
   #define LCD_USE_I2C_BUZZER                // Enable buzzer on LCD, used for both I2C and SPI buses (LiquidTWI2 not required)
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #define LCD_WIDTH                   20    // 20 or 24 chars in line
   #define LCD_HEIGHT                  10    // Character lines
   #define LCD_CONTRAST_MIN            127
   #define LCD_CONTRAST_MAX            255
   #define DEFAULT_LCD_CONTRAST        250
   #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.

commit a90c8b762c8b8ca06093d6e62f4355e8a5726115
Author: Grayson <mxpklx@gmail.com>
Date:   Sat Jul 31 22:55:22 2021 -0500

    üêõ Fix G38 with probe on Z_MIN (#22452)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0ebe8e265a..1025a8153b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -764,21 +764,21 @@
   #define HAS_Z_SERVO_PROBE 1
 #endif
 #if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
   #define HAS_SERVO_ANGLES 1
 #endif
 #if !HAS_SERVO_ANGLES
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
- * Set flags for enabled probes
+ * Set a flag for any type of bed probe, including the paper-test
  */
 #if ANY(HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
 /**
  * Fill in undefined Filament Sensor options
  */
 #if ENABLED(FILAMENT_RUNOUT_SENSOR)
   #if NUM_RUNOUT_SENSORS >= 1
@@ -906,21 +906,21 @@
 /**
  * Conditionals based on the type of Bed Probe
  */
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN) && !BOTH(DELTA, SENSORLESS_PROBING)
     #define USES_Z_MIN_PROBE_PIN 1
   #endif
-  #if Z_HOME_TO_MIN && (!USES_Z_MIN_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
+  #if Z_HOME_TO_MIN && TERN1(USES_Z_MIN_PROBE_PIN, ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0

commit 9bb5b10c0c9cf5a61d2bfb9dfdb6cfe210b6002b
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Jul 31 05:32:13 2021 -0500

    üöö Relocate and adjust DWIN E3V2 (#22471)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d47bfcb81a..0ebe8e265a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -475,35 +475,35 @@
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
-#if EITHER(IS_ULTRA_LCD, EXTENSIBLE_UI)
-  #define HAS_DISPLAY 1
-#endif
-
 #if IS_ULTRA_LCD
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif DISABLED(HAS_GRAPHICAL_TFT)
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
+#if EITHER(HAS_WIRED_LCD, EXTENSIBLE_UI)
+  #define HAS_DISPLAY 1
+#endif
+
 #if ANY(HAS_DISPLAY, DWIN_CREALITY_LCD, GLOBAL_STATUS_MESSAGE)
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_LCD_MENU 1
 #endif
 
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH

commit 99a53e2c86e95cea0427742b267b244870526304
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Jul 29 19:55:04 2021 -0500

    üêõ Fix 5-axis no extruder compile
    
    Fixes #22446

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index cd9f127e28..d47bfcb81a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1053,21 +1053,21 @@
 // This flag indicates some kind of jerk storage is needed
 #if EITHER(CLASSIC_JERK, IS_KINEMATIC)
   #define HAS_CLASSIC_JERK 1
 #endif
 
 #if DISABLED(CLASSIC_JERK)
   #define HAS_JUNCTION_DEVIATION 1
 #endif
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
-#if ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE))
+#if HAS_EXTRUDERS && (ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE)))
   #define HAS_CLASSIC_E_JERK 1
 #endif
 
 //
 // Serial Port Info
 //
 #ifdef SERIAL_PORT_2
   #define HAS_MULTI_SERIAL 1
   #ifdef SERIAL_PORT_3
     #define NUM_SERIAL 3

commit 363e83731f7b045d7b3e9842882b1f53e032ca89
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Jul 28 23:24:30 2021 -0500

    üîß HAS_CUSTOM_PROBE_PIN => USES_Z_MIN_PROBE_PIN

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 4d6055b435..cd9f127e28 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -904,23 +904,23 @@
 #endif
 
 /**
  * Conditionals based on the type of Bed Probe
  */
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN) && !BOTH(DELTA, SENSORLESS_PROBING)
-    #define HAS_CUSTOM_PROBE_PIN 1
+    #define USES_Z_MIN_PROBE_PIN 1
   #endif
-  #if Z_HOME_TO_MIN && (!HAS_CUSTOM_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
+  #if Z_HOME_TO_MIN && (!USES_Z_MIN_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0

commit 4942cb796c24a669e6d9d177eb21e5b2f71fbde0
Author: ellensp <ellensp@hotmail.com>
Date:   Wed Jul 28 16:28:15 2021 +1200

    üêõ SAV_3DGLCD conditionals (#22447)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7e2239b3f6..4d6055b435 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -134,20 +134,27 @@
 #elif ENABLED(MKS_12864OLED)
 
   #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC 1
   #define IS_U8GLIB_SSD1306
 
+#elif ENABLED(SAV_3DGLCD)
+
+  #ifdef U8GLIB_SSD1306
+    #define IS_U8GLIB_SSD1306
+  #endif
+  #define IS_NEWPANEL 1
+
 #elif ENABLED(FYSETC_242_OLED_12864)
 
   #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
   #define LED_CONTROL_MENU
   #define NEOPIXEL_LED
   #undef NEOPIXEL_TYPE
   #define NEOPIXEL_TYPE       NEO_RGB
   #if NEOPIXEL_PIXELS < 3

commit c2f72cde1024538a6026b9db794fcd4f6b7ca07a
Author: Serhiy-K <52166448+Serhiy-K@users.noreply.github.com>
Date:   Mon Jul 19 05:39:01 2021 +0300

    ‚ú® Laser support for TFT GLCD (#22391)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 6cf0b82241..7e2239b3f6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -206,21 +206,21 @@
 
 #elif EITHER(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
 
   #define IS_TFTGLCD_PANEL 1
   #define IS_ULTIPANEL 1                    // Note that IS_ULTIPANEL leads to HAS_WIRED_LCD
 
   #if ENABLED(SDSUPPORT) && DISABLED(LCD_PROGRESS_BAR)
     #define LCD_PROGRESS_BAR
   #endif
   #if ENABLED(TFTGLCD_PANEL_I2C)
-    #define LCD_I2C_ADDRESS           0x27  // Must be equal to panel's I2C slave addres
+    #define LCD_I2C_ADDRESS           0x33  // Must be 0x33 for STM32 main boards and equal to panel's I2C slave addres
   #endif
   #define LCD_USE_I2C_BUZZER                // Enable buzzer on LCD, used for both I2C and SPI buses (LiquidTWI2 not required)
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #define LCD_WIDTH                   20    // 20 or 24 chars in line
   #define LCD_HEIGHT                  10    // Character lines
   #define LCD_CONTRAST_MIN            127
   #define LCD_CONTRAST_MAX            255
   #define DEFAULT_LCD_CONTRAST        250
   #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.

commit 938d86d1c5512a39ac2527b497a0875d742d17e9
Author: mks-viva <1224833100@qq.com>
Date:   Fri Jul 9 17:59:36 2021 -0500

    ‚ú® MKS MINI12864 V3 for MKS Robin Nano V2/3 (#22285)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a9ad5018e8..6cf0b82241 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -24,20 +24,25 @@
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
 // MKS_LCD12864A/B is a variant of MKS_MINI_12864
 #if EITHER(MKS_LCD12864A, MKS_LCD12864B)
   #define MKS_MINI_12864
 #endif
 
+// MKS_MINI_12864_V3 is simply identical to FYSETC_MINI_12864_2_1
+#if ENABLED(MKS_MINI_12864_V3)
+  #define FYSETC_MINI_12864_2_1
+#endif
+
 /**
  * General Flags that may be set below by specific LCDs
  *
  *  DOGLCD                : Run a Graphical LCD through U8GLib (with MarlinUI)
  *  IS_ULTIPANEL          : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
  *  IS_ULTRA_LCD          : Ultra LCD, not necessarily Ultipanel.
  *  IS_RRD_SC             : Common RRD Smart Controller digital interface pins
  *  IS_RRD_FG_SC          : Common RRD Full Graphical Smart Controller digital interface pins
  *  U8GLIB_ST7920         : Most common DOGM display SPI interface, supporting a "lightweight" display mode.
  *  U8GLIB_SH1106         : SH1106 OLED with I2C interface via U8GLib

commit 82193b092367f23069129a42c37e9c46654ff4af
Author: Krzysztof B≈Ça≈ºewicz <blazewicz.krzysztof@gmail.com>
Date:   Wed Jul 7 04:10:40 2021 +0200

    ‚ú® DWIN LCD for BTT SKR Mini E3 (#22288)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 833fe0d227..a9ad5018e8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1071,21 +1071,25 @@
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1 || SERIAL_PORT_3 == -1
   #define HAS_USB_SERIAL 1
 #endif
 #if SERIAL_PORT_2 == -2
   #define HAS_ETHERNET 1
 #endif
 
 #if ENABLED(DWIN_CREALITY_LCD)
   #define SERIAL_CATCHALL 0
   #ifndef LCD_SERIAL_PORT
-    #define LCD_SERIAL_PORT 3 // Creality 4.x board
+    #if MB(BTT_SKR_MINI_E3_V1_0, BTT_SKR_MINI_E3_V1_2, BTT_SKR_MINI_E3_V2_0, BTT_SKR_E3_TURBO)
+      #define LCD_SERIAL_PORT 1
+    #else
+      #define LCD_SERIAL_PORT 3 // Creality 4.x board
+    #endif
   #endif
 #endif
 
 // Fallback Stepper Driver types that don't depend on Configuration_adv.h
 #ifndef X_DRIVER_TYPE
   #define X_DRIVER_TYPE  A4988
 #endif
 #ifndef X2_DRIVER_TYPE
   #define X2_DRIVER_TYPE A4988
 #endif

commit 3d0e8346be1a8da6ec665a8e8afc4b6809ebe4a4
Author: Bo Herrmannsen <bo.herrmannsen@gmail.com>
Date:   Mon Jun 14 11:28:13 2021 +0200

    ‚ú® Extruder with Dual Stepper Drivers (#21403)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ea83b5abbc..833fe0d227 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -551,42 +551,54 @@
   #undef EXTRUDERS
   #define EXTRUDERS 0
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef HOTEND_IDLE_TIMEOUT
   #undef DISABLE_E
 #endif
 
-#if ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
+#if ENABLED(E_DUAL_STEPPER_DRIVERS) // E0/E1 steppers act in tandem as E0
+
+  #define E_STEPPERS      2
+
+#elif ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
+
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
   #if DISABLED(SWITCHING_NOZZLE)
     #define HOTENDS       E_STEPPERS
   #endif
-#elif ENABLED(MIXING_EXTRUDER)
+
+#elif ENABLED(MIXING_EXTRUDER)      // Multiple feeds are mixed proportionally
+
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
   #if MIXING_STEPPERS == 2
     #define HAS_DUAL_MIXING 1
   #endif
-#elif ENABLED(SWITCHING_TOOLHEAD)
+
+#elif ENABLED(SWITCHING_TOOLHEAD)   // Toolchanger
+
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
-#elif HAS_PRUSA_MMU2
+
+#elif HAS_PRUSA_MMU2                // Pr≈Ø≈°a Multi-Material Unit v2
+
   #define E_STEPPERS 1
+
 #endif
 
 // No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1
 #if ENABLED(SWITCHING_NOZZLE) || HAS_PRUSA_MMU1
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
 // Pr≈Ø≈°a MMU1, MMU(S) 2.0 and EXTENDABLE_EMU_MMU2(S) force SINGLENOZZLE
 #if HAS_MMU
   #define SINGLENOZZLE

commit 54d526f6b613b408a3fd61f2d9f6ddbf9cb73e99
Author: ellensp <ellensp@hotmail.com>
Date:   Thu Jun 10 19:09:52 2021 +1200

    üîß Enforce BLTouch settings (#22086)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0eaa749126..ea83b5abbc 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -711,36 +711,31 @@
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif
   #ifdef DEACTIVATE_SERVOS_AFTER_MOVE
-    #warning "BLTOUCH requires DEACTIVATE_SERVOS_AFTER_MOVE to be to disabled. Undefining DEACTIVATE_SERVOS_AFTER_MOVE. Please update your Configuration.h file."
-    #undef DEACTIVATE_SERVOS_AFTER_MOVE
+    #error "BLTOUCH requires DEACTIVATE_SERVOS_AFTER_MOVE to be to disabled. Please update your Configuration.h file."
   #endif
 
   // Always disable probe pin inverting for BLTouch
   #if Z_MIN_PROBE_ENDSTOP_INVERTING
-    #warning "BLTOUCH requires Z_MIN_PROBE_ENDSTOP_INVERTING set to false. Resetting Z_MIN_PROBE_ENDSTOP_INVERTING to false. Please update your Configuration.h file."
-    #undef Z_MIN_PROBE_ENDSTOP_INVERTING
-    #define Z_MIN_PROBE_ENDSTOP_INVERTING false
+    #error "BLTOUCH requires Z_MIN_PROBE_ENDSTOP_INVERTING set to false. Please update your Configuration.h file."
   #endif
 
   #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #if Z_MIN_ENDSTOP_INVERTING
-      #warning "BLTOUCH requires Z_MIN_ENDSTOP_INVERTING set to false. Resetting Z_MIN_ENDSTOP_INVERTING to false. Please update your Configuration.h file."
-      #undef Z_MIN_ENDSTOP_INVERTING
-      #define Z_MIN_ENDSTOP_INVERTING false
+      #error "BLTOUCH requires Z_MIN_ENDSTOP_INVERTING set to false. Please update your Configuration.h file."
     #endif
   #endif
 #endif
 
 /**
  * Set a flag for a servo probe (or BLTouch)
  */
 #ifdef Z_PROBE_SERVO_NR
   #define HAS_Z_SERVO_PROBE 1
 #endif

commit 0e1e1591879077cdda868a28b095c427098fda07
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Jun 10 02:05:04 2021 -0500

    üé® Adjust some conditionals

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9e87589ca8..0eaa749126 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1020,20 +1020,24 @@
   #define IS_KINEMATIC 1
 #elif ENABLED(DELTA)
   #define IS_KINEMATIC 1
 #else
   #define IS_CARTESIAN 1
   #if !IS_CORE
     #define IS_FULL_CARTESIAN 1
   #endif
 #endif
 
+#if DISABLED(DELTA)
+  #undef DELTA_HOME_TO_SAFE_ZONE
+#endif
+
 // This flag indicates some kind of jerk storage is needed
 #if EITHER(CLASSIC_JERK, IS_KINEMATIC)
   #define HAS_CLASSIC_JERK 1
 #endif
 
 #if DISABLED(CLASSIC_JERK)
   #define HAS_JUNCTION_DEVIATION 1
 #endif
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA

commit d320545066676338d4a0142268931bb66eedfccc
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Jun 8 07:51:28 2021 -0500

    üé® Laser Ammeter followup (#22079)
    
    Followup to #21835

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d66ceabc19..9e87589ca8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -398,20 +398,24 @@
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #elif ANY(IS_RRD_SC, miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, OLED_PANEL_TINYBOY2, BQ_LCD_SMART_CONTROLLER, LCD_I2C_PANELOLU2)
 
   #define STD_ENCODER_PULSES_PER_STEP 4
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #endif
 
+#if EITHER(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008) && DISABLED(NO_LCD_DETECT)
+  #define DETECT_I2C_LCD_DEVICE 1
+#endif
+
 #ifndef STD_ENCODER_PULSES_PER_STEP
   #if ENABLED(TOUCH_SCREEN)
     #define STD_ENCODER_PULSES_PER_STEP 2
   #else
     #define STD_ENCODER_PULSES_PER_STEP 5
   #endif
 #endif
 #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 #endif

commit 588a74fd9dc5e2f2a8432528699556a65b0136d1
Author: ellensp <ellensp@hotmail.com>
Date:   Tue Jun 8 07:09:12 2021 +1200

    expose hidden BLTOUCH setting changes (#22069)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 445cc3c067..d66ceabc19 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -706,28 +706,38 @@
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif
-  #undef DEACTIVATE_SERVOS_AFTER_MOVE
+  #ifdef DEACTIVATE_SERVOS_AFTER_MOVE
+    #warning "BLTOUCH requires DEACTIVATE_SERVOS_AFTER_MOVE to be to disabled. Undefining DEACTIVATE_SERVOS_AFTER_MOVE. Please update your Configuration.h file."
+    #undef DEACTIVATE_SERVOS_AFTER_MOVE
+  #endif
 
   // Always disable probe pin inverting for BLTouch
-  #undef Z_MIN_PROBE_ENDSTOP_INVERTING
-  #define Z_MIN_PROBE_ENDSTOP_INVERTING false
+  #if Z_MIN_PROBE_ENDSTOP_INVERTING
+    #warning "BLTOUCH requires Z_MIN_PROBE_ENDSTOP_INVERTING set to false. Resetting Z_MIN_PROBE_ENDSTOP_INVERTING to false. Please update your Configuration.h file."
+    #undef Z_MIN_PROBE_ENDSTOP_INVERTING
+    #define Z_MIN_PROBE_ENDSTOP_INVERTING false
+  #endif
+
   #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
-    #undef Z_MIN_ENDSTOP_INVERTING
-    #define Z_MIN_ENDSTOP_INVERTING false
+    #if Z_MIN_ENDSTOP_INVERTING
+      #warning "BLTOUCH requires Z_MIN_ENDSTOP_INVERTING set to false. Resetting Z_MIN_ENDSTOP_INVERTING to false. Please update your Configuration.h file."
+      #undef Z_MIN_ENDSTOP_INVERTING
+      #define Z_MIN_ENDSTOP_INVERTING false
+    #endif
   #endif
 #endif
 
 /**
  * Set a flag for a servo probe (or BLTouch)
  */
 #ifdef Z_PROBE_SERVO_NR
   #define HAS_Z_SERVO_PROBE 1
 #endif
 #if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)

commit 3c522fff31f7e1d4127ab09bb27345b098186cd5
Author: ellensp <ellensp@hotmail.com>
Date:   Sun Jun 6 21:21:14 2021 +1200

    ü©π Fallback ID for MKS TS35 V2.0 (#22031)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 07c0439e28..445cc3c067 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1159,66 +1159,67 @@
  *
  * Configure parameters for TFT displays:
  *  - TFT_DEFAULT_ORIENTATION
  *  - TFT_DRIVER
  *  - TFT_WIDTH
  *  - TFT_HEIGHT
  *  - TFT_INTERFACE_(SPI|FSMC)
  *  - TFT_COLOR
  *  - GRAPHICAL_TFT_UPSCALE
  */
-#if ENABLED(MKS_TS35_V2_0)          // Most common: ST7796
+#if ENABLED(MKS_TS35_V2_0)          // ST7796
+  #define TFT_DEFAULT_DRIVER ST7796
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_SPI
-#elif ENABLED(MKS_ROBIN_TFT24)      // Most common: ST7789
+#elif ENABLED(ANET_ET5_TFT35)       // ST7796
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
+  #define TFT_RES_480x320
+  #define TFT_INTERFACE_FSMC
+#elif ENABLED(ANET_ET4_TFT28)       // ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT28)      // Most common: ST7789
+#elif ENABLED(MKS_ROBIN_TFT24)      // ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT32)      // Most common: ST7789
+#elif ENABLED(MKS_ROBIN_TFT28)      // ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT35)      // Most common: ILI9488
+#elif ENABLED(MKS_ROBIN_TFT32)      // ST7789
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
+  #define TFT_RES_320x240
+  #define TFT_INTERFACE_FSMC
+#elif ENABLED(MKS_ROBIN_TFT35)      // ILI9488
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(MKS_ROBIN_TFT43)
-  #define TFT_DEFAULT_ORIENTATION 0
   #define TFT_DRIVER SSD1963
+  #define TFT_DEFAULT_ORIENTATION 0
   #define TFT_RES_480x272
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(MKS_ROBIN_TFT_V1_1R)  // ILI9328 or R61505
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
 #elif EITHER(TFT_TRONXY_X5SA, ANYCUBIC_TFT35) // ILI9488
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_DRIVER ILI9488
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(LONGER_LK_TFT28)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(ANET_ET4_TFT28)       // ST7789
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
-  #define TFT_RES_320x240
-  #define TFT_INTERFACE_FSMC
-#elif ENABLED(ANET_ET5_TFT35)       // ST7796
-  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
-  #define TFT_RES_480x320
-  #define TFT_INTERFACE_FSMC
 #elif ENABLED(BIQU_BX_TFT70)        // RGB
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
   #define TFT_RES_1024x600
   #define TFT_INTERFACE_LTDC
   #if ENABLED(TOUCH_SCREEN)
     #define TFT_TOUCH_DEVICE_GT911
   #endif
 #elif ENABLED(TFT_GENERIC)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #if NONE(TFT_RES_320x240, TFT_RES_480x272, TFT_RES_480x320)

commit 7726af9c5348c1c7d0fd9a56eca87d00cd75fee6
Author: DerAndere <26200979+DerAndere1@users.noreply.github.com>
Date:   Sat Jun 5 09:18:47 2021 +0200

    üèóÔ∏è Support for up to 6 linear axes (#19112)
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 8e4241bf64..07c0439e28 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -605,36 +605,38 @@
   #define E_MANUAL EXTRUDERS
 #endif
 
 /**
  * Number of Linear Axes (e.g., XYZ)
  * All the logical axes except for the tool (E) axis
  */
 #ifndef LINEAR_AXES
   #define LINEAR_AXES XYZ
 #endif
+#if LINEAR_AXES >= XY
+  #define HAS_Y_AXIS 1
+  #if LINEAR_AXES >= XYZ
+    #define HAS_Z_AXIS 1
+  #endif
+#endif
 
 /**
  * Number of Logical Axes (e.g., XYZE)
  * All the logical axes that can be commanded directly by G-code.
  * Delta maps stepper-specific values to ABC steppers.
  */
 #if HAS_EXTRUDERS
   #define LOGICAL_AXES INCREMENT(LINEAR_AXES)
 #else
   #define LOGICAL_AXES LINEAR_AXES
 #endif
 
-#if LINEAR_AXES >= XYZ
-  #define HAS_Z_AXIS 1
-#endif
-
 /**
  * DISTINCT_E_FACTORS is set to give extruders (some) individual settings.
  *
  * DISTINCT_AXES is the number of distinct addressable axes (not steppers).
  *  Includes all linear axes plus all distinguished extruders.
  *  The default behavior is to treat all extruders as a single E axis
  *  with shared motion and temperature settings.
  *
  * DISTINCT_E is the number of distinguished extruders. By default this
  *  well be 1 which indicates all extruders share the same settings.
@@ -845,20 +847,35 @@
 #if Y_HOME_DIR > 0
   #define Y_HOME_TO_MAX 1
 #elif Y_HOME_DIR < 0
   #define Y_HOME_TO_MIN 1
 #endif
 #if Z_HOME_DIR > 0
   #define Z_HOME_TO_MAX 1
 #elif Z_HOME_DIR < 0
   #define Z_HOME_TO_MIN 1
 #endif
+#if I_HOME_DIR > 0
+  #define I_HOME_TO_MAX 1
+#elif I_HOME_DIR < 0
+  #define I_HOME_TO_MIN 1
+#endif
+#if J_HOME_DIR > 0
+  #define J_HOME_TO_MAX 1
+#elif J_HOME_DIR < 0
+  #define J_HOME_TO_MIN 1
+#endif
+#if K_HOME_DIR > 0
+  #define K_HOME_TO_MAX 1
+#elif K_HOME_DIR < 0
+  #define K_HOME_TO_MIN 1
+#endif
 
 /**
  * Conditionals based on the type of Bed Probe
  */
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN) && !BOTH(DELTA, SENSORLESS_PROBING)
     #define HAS_CUSTOM_PROBE_PIN 1
@@ -1103,27 +1120,36 @@
 #if E_STEPPERS <= 7
   #undef E7_DRIVER_TYPE
 #elif !defined(E7_DRIVER_TYPE)
   #define E7_DRIVER_TYPE A4988
 #endif
 
 // Fallback axis inverting
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif
-#ifndef INVERT_Y_DIR
+#if HAS_Y_AXIS && !defined(INVERT_Y_DIR)
   #define INVERT_Y_DIR false
 #endif
-#ifndef INVERT_Z_DIR
+#if HAS_Z_AXIS && !defined(INVERT_Z_DIR)
   #define INVERT_Z_DIR false
 #endif
-#ifndef INVERT_E_DIR
+#if LINEAR_AXES >= 4 && !defined(INVERT_I_DIR)
+  #define INVERT_I_DIR false
+#endif
+#if LINEAR_AXES >= 5 && !defined(INVERT_J_DIR)
+  #define INVERT_J_DIR false
+#endif
+#if LINEAR_AXES >= 6 && !defined(INVERT_K_DIR)
+  #define INVERT_K_DIR false
+#endif
+#if HAS_EXTRUDERS && !defined(INVERT_E_DIR)
   #define INVERT_E_DIR false
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif

commit eea9b6d8ae38af3ca9d5b2f6fb355fc8fce405fb
Author: Giuliano Zaro <3684609+GMagician@users.noreply.github.com>
Date:   Sat Jun 5 03:02:37 2021 +0200

    üêõ Fix MMU compile with >5 EXTRUDERS (#22036)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9b4f832a05..8e4241bf64 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -510,21 +510,21 @@
 #ifdef MMU_MODEL
   #define HAS_MMU 1
   #if MMU_MODEL == PRUSA_MMU1
     #define HAS_PRUSA_MMU1 1
   #elif MMU_MODEL % 10 == PRUSA_MMU2
     #define HAS_PRUSA_MMU2 1
   #elif MMU_MODEL % 10 == PRUSA_MMU2S
     #define HAS_PRUSA_MMU2 1
     #define HAS_PRUSA_MMU2S 1
   #endif
-  #if MMU_MODEL == EXTENDABLE_EMU_MMU2 || MMU_MODEL == EXTENDABLE_EMU_MMU2S
+  #if MMU_MODEL >= EXTENDABLE_EMU_MMU2
     #define HAS_EXTENDABLE_MMU 1
   #endif
 #endif
 
 #undef PRUSA_MMU1
 #undef PRUSA_MMU2
 #undef PRUSA_MMU2S
 #undef EXTENDABLE_EMU_MMU2
 #undef EXTENDABLE_EMU_MMU2S
 

commit 82ea06e6a4ffdb0816ab92a5dd721ec5d770015d
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Jun 1 20:23:37 2021 -0500

    ‚ôªÔ∏è Patches for Zero Extruders (with TMC)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c89aaada37..9b4f832a05 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -617,20 +617,24 @@
  * Number of Logical Axes (e.g., XYZE)
  * All the logical axes that can be commanded directly by G-code.
  * Delta maps stepper-specific values to ABC steppers.
  */
 #if HAS_EXTRUDERS
   #define LOGICAL_AXES INCREMENT(LINEAR_AXES)
 #else
   #define LOGICAL_AXES LINEAR_AXES
 #endif
 
+#if LINEAR_AXES >= XYZ
+  #define HAS_Z_AXIS 1
+#endif
+
 /**
  * DISTINCT_E_FACTORS is set to give extruders (some) individual settings.
  *
  * DISTINCT_AXES is the number of distinct addressable axes (not steppers).
  *  Includes all linear axes plus all distinguished extruders.
  *  The default behavior is to treat all extruders as a single E axis
  *  with shared motion and temperature settings.
  *
  * DISTINCT_E is the number of distinguished extruders. By default this
  *  well be 1 which indicates all extruders share the same settings.

commit e60c38b6220678b3b9f3a3b31516852f8d25b3b0
Author: ellensp <ellensp@hotmail.com>
Date:   Wed May 26 11:38:23 2021 +1200

    ‚ôªÔ∏è LEDs refactor and extend (#21962)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a8bd7a70ac..c89aaada37 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1314,10 +1314,17 @@
     #define TOUCH_ORIENTATION    TOUCH_LANDSCAPE
   #endif
 #endif
 
 #if ANY(USE_XMIN_PLUG, USE_YMIN_PLUG, USE_ZMIN_PLUG, USE_XMAX_PLUG, USE_YMAX_PLUG, USE_ZMAX_PLUG)
   #define HAS_ENDSTOPS 1
   #define COORDINATE_OKAY(N,L,H) WITHIN(N,L,H)
 #else
   #define COORDINATE_OKAY(N,L,H) true
 #endif
+
+/**
+ * LED Backlight INDEX END
+ */
+#if defined(NEOPIXEL_BKGD_INDEX_FIRST) && !defined(NEOPIXEL_BKGD_INDEX_LAST)
+  #define NEOPIXEL_BKGD_INDEX_LAST NEOPIXEL_BKGD_INDEX_FIRST
+#endif

commit dd4990252e891cdfe56cb7d6e3bbe1e6289be649
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Mon May 24 16:38:57 2021 -0500

    ‚ôªÔ∏è Refactor Linear / Logical / Distinct Axes (#21953)
    
    * More patches supporting EXTRUDERS 0
    * Extend types in prep for more axes

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 8001674dc4..a8bd7a70ac 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -530,34 +530,35 @@
 
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  */
-
 #if EXTRUDERS
   #define HAS_EXTRUDERS 1
   #if EXTRUDERS > 1
     #define HAS_MULTI_EXTRUDER 1
   #endif
+  #define E_AXIS_N(E) AxisEnum(E_AXIS + E_INDEX_N(E))
 #else
   #undef EXTRUDERS
   #define EXTRUDERS 0
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef HOTEND_IDLE_TIMEOUT
+  #undef DISABLE_E
 #endif
 
 #if ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
@@ -597,44 +598,84 @@
 #ifndef HOTENDS
   #define HOTENDS EXTRUDERS
 #endif
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
+/**
+ * Number of Linear Axes (e.g., XYZ)
+ * All the logical axes except for the tool (E) axis
+ */
+#ifndef LINEAR_AXES
+  #define LINEAR_AXES XYZ
+#endif
+
+/**
+ * Number of Logical Axes (e.g., XYZE)
+ * All the logical axes that can be commanded directly by G-code.
+ * Delta maps stepper-specific values to ABC steppers.
+ */
+#if HAS_EXTRUDERS
+  #define LOGICAL_AXES INCREMENT(LINEAR_AXES)
+#else
+  #define LOGICAL_AXES LINEAR_AXES
+#endif
+
+/**
+ * DISTINCT_E_FACTORS is set to give extruders (some) individual settings.
+ *
+ * DISTINCT_AXES is the number of distinct addressable axes (not steppers).
+ *  Includes all linear axes plus all distinguished extruders.
+ *  The default behavior is to treat all extruders as a single E axis
+ *  with shared motion and temperature settings.
+ *
+ * DISTINCT_E is the number of distinguished extruders. By default this
+ *  well be 1 which indicates all extruders share the same settings.
+ *
+ * E_INDEX_N(E) should be used to get the E index of any item that might be
+ *  distinguished.
+ */
+#if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
+  #define DISTINCT_AXES (LINEAR_AXES + E_STEPPERS)
+  #define DISTINCT_E E_STEPPERS
+  #define E_INDEX_N(E) (E)
+#else
+  #undef DISTINCT_E_FACTORS
+  #define DISTINCT_AXES LOGICAL_AXES
+  #define DISTINCT_E 1
+  #define E_INDEX_N(E) 0
+#endif
+
 #if HOTENDS
   #define HAS_HOTEND 1
   #ifndef HOTEND_OVERSHOOT
     #define HOTEND_OVERSHOOT 15
   #endif
   #if HOTENDS > 1
     #define HAS_MULTI_HOTEND 1
     #define HAS_HOTEND_OFFSET 1
   #endif
 #else
   #undef PID_PARAMS_PER_HOTEND
 #endif
 
 // Helper macros for extruder and hotend arrays
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_N_1(EXTRUDERS, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
 #define ARRAY_BY_HOTENDS1(v1) ARRAY_N_1(HOTENDS, v1)
 
-#if ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
-  #define DO_SWITCH_EXTRUDER 1
-#endif
-
 /**
  * Default hotend offsets, if not defined
  */
 #if HAS_HOTEND_OFFSET
   #ifndef HOTEND_OFFSET_X
     #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
   #endif
   #ifndef HOTEND_OFFSET_Y
     #define HOTEND_OFFSET_Y { 0 } // Y offsets for each extruder
   #endif
@@ -646,53 +687,24 @@
 /**
  * Disable unused SINGLENOZZLE sub-options
  */
 #if DISABLED(SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_TEMP
 #endif
 #if !BOTH(HAS_FAN, SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_FAN
 #endif
 
-/**
- * Number of Linear Axes (e.g., XYZ)
- * All the logical axes except for the tool (E) axis
- */
-#ifndef LINEAR_AXES
-  #define LINEAR_AXES XYZ
-#endif
-
-/**
- * Number of Logical Axes (e.g., XYZE)
- * All the logical axes that can be commanded directly by G-code.
- * Delta maps stepper-specific values to ABC steppers.
- */
-#if HAS_EXTRUDERS
-  #define LOGICAL_AXES INCREMENT(LINEAR_AXES)
-#else
-  #define LOGICAL_AXES LINEAR_AXES
-#endif
-
-/**
- * DISTINCT_E_FACTORS affects whether Extruders use different settings
- */
-#if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
-  #define DISTINCT_E E_STEPPERS
-  #define DISTINCT_AXES (LINEAR_AXES + E_STEPPERS)
-  #define E_INDEX_N(E) (E)
-#else
-  #undef DISTINCT_E_FACTORS
-  #define DISTINCT_E 1
-  #define DISTINCT_AXES LOGICAL_AXES
-  #define E_INDEX_N(E) 0
+// Switching extruder has its own servo?
+#if ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
+  #define DO_SWITCH_EXTRUDER 1
 #endif
-#define E_AXIS_N(E) AxisEnum(E_AXIS + E_INDEX_N(E))
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif
   #undef DEACTIVATE_SERVOS_AFTER_MOVE
@@ -719,20 +731,23 @@
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
  * Set flags for enabled probes
  */
 #if ANY(HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
+/**
+ * Fill in undefined Filament Sensor options
+ */
 #if ENABLED(FILAMENT_RUNOUT_SENSOR)
   #if NUM_RUNOUT_SENSORS >= 1
     #ifndef FIL_RUNOUT1_STATE
       #define FIL_RUNOUT1_STATE FIL_RUNOUT_STATE
     #endif
     #ifndef FIL_RUNOUT1_PULLUP
       #define FIL_RUNOUT1_PULLUP FIL_RUNOUT_PULLUP
     #endif
     #ifndef FIL_RUNOUT1_PULLDOWN
       #define FIL_RUNOUT1_PULLDOWN FIL_RUNOUT_PULLDOWN
@@ -827,20 +842,23 @@
   #define Y_HOME_TO_MAX 1
 #elif Y_HOME_DIR < 0
   #define Y_HOME_TO_MIN 1
 #endif
 #if Z_HOME_DIR > 0
   #define Z_HOME_TO_MAX 1
 #elif Z_HOME_DIR < 0
   #define Z_HOME_TO_MIN 1
 #endif
 
+/**
+ * Conditionals based on the type of Bed Probe
+ */
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN) && !BOTH(DELTA, SENSORLESS_PROBING)
     #define HAS_CUSTOM_PROBE_PIN 1
   #endif
   #if Z_HOME_TO_MIN && (!HAS_CUSTOM_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
@@ -861,21 +879,21 @@
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef USE_PROBE_FOR_Z_HOMING
 #endif
 
 #if Z_HOME_TO_MAX
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 
 /**
- * Set granular options based on the specific type of leveling
+ * Conditionals based on the type of Bed Leveling
  */
 #if ENABLED(AUTO_BED_LEVELING_UBL)
   #undef LCD_BED_LEVELING
   #if ENABLED(DELTA)
     #define UBL_SEGMENTED 1
   #endif
 #endif
 #if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_3POINT)
   #define ABL_PLANAR 1
 #endif

commit 2de54dab84d82ef69fb9ac3bd9025444f4f84813
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri May 21 08:23:09 2021 -0500

    üé® Move HAS_EXTRUDERS

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 545ee403a1..8001674dc4 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -531,30 +531,33 @@
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  */
 
-#if EXTRUDERS == 0
+#if EXTRUDERS
+  #define HAS_EXTRUDERS 1
+  #if EXTRUDERS > 1
+    #define HAS_MULTI_EXTRUDER 1
+  #endif
+#else
   #undef EXTRUDERS
   #define EXTRUDERS 0
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef HOTEND_IDLE_TIMEOUT
-#elif EXTRUDERS > 1
-  #define HAS_MULTI_EXTRUDER 1
 #endif
 
 #if ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
@@ -656,21 +659,21 @@
  */
 #ifndef LINEAR_AXES
   #define LINEAR_AXES XYZ
 #endif
 
 /**
  * Number of Logical Axes (e.g., XYZE)
  * All the logical axes that can be commanded directly by G-code.
  * Delta maps stepper-specific values to ABC steppers.
  */
-#if EXTRUDERS
+#if HAS_EXTRUDERS
   #define LOGICAL_AXES INCREMENT(LINEAR_AXES)
 #else
   #define LOGICAL_AXES LINEAR_AXES
 #endif
 
 /**
  * DISTINCT_E_FACTORS affects whether Extruders use different settings
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define DISTINCT_E E_STEPPERS

commit 49771c4a9ed2afa1e572f82a24b5edb3de120f78
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed May 19 00:21:34 2021 -0500

    üé® Flags for homing directions

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index de97712a08..545ee403a1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -807,28 +807,45 @@
     #endif
     #ifndef FIL_RUNOUT8_PULLUP
       #define FIL_RUNOUT8_PULLUP FIL_RUNOUT_PULLUP
     #endif
     #ifndef FIL_RUNOUT8_PULLDOWN
       #define FIL_RUNOUT8_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
 #endif // FILAMENT_RUNOUT_SENSOR
 
+// Homing to Min or Max
+#if X_HOME_DIR > 0
+  #define X_HOME_TO_MAX 1
+#elif X_HOME_DIR < 0
+  #define X_HOME_TO_MIN 1
+#endif
+#if Y_HOME_DIR > 0
+  #define Y_HOME_TO_MAX 1
+#elif Y_HOME_DIR < 0
+  #define Y_HOME_TO_MIN 1
+#endif
+#if Z_HOME_DIR > 0
+  #define Z_HOME_TO_MAX 1
+#elif Z_HOME_DIR < 0
+  #define Z_HOME_TO_MIN 1
+#endif
+
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN) && !BOTH(DELTA, SENSORLESS_PROBING)
     #define HAS_CUSTOM_PROBE_PIN 1
   #endif
-  #if Z_HOME_DIR < 0 && (!HAS_CUSTOM_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
+  #if Z_HOME_TO_MIN && (!HAS_CUSTOM_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0
@@ -836,21 +853,21 @@
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef USE_PROBE_FOR_Z_HOMING
 #endif
 
-#if Z_HOME_DIR > 0
+#if Z_HOME_TO_MAX
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 
 /**
  * Set granular options based on the specific type of leveling
  */
 #if ENABLED(AUTO_BED_LEVELING_UBL)
   #undef LCD_BED_LEVELING
   #if ENABLED(DELTA)
     #define UBL_SEGMENTED 1

commit 0dae140080c611089f8cb7e937c9f48516eb944d
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue May 18 23:30:49 2021 -0500

    üêõ Fix DELTA with SENSORLESS_PROBING

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ccfe30947c..de97712a08 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -811,21 +811,21 @@
     #ifndef FIL_RUNOUT8_PULLDOWN
       #define FIL_RUNOUT8_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
 #endif // FILAMENT_RUNOUT_SENSOR
 
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
-  #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
+  #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN) && !BOTH(DELTA, SENSORLESS_PROBING)
     #define HAS_CUSTOM_PROBE_PIN 1
   #endif
   #if Z_HOME_DIR < 0 && (!HAS_CUSTOM_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe

commit a6e5492b088add3589aeac168136369f21614e60
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue May 18 22:51:19 2021 -0500

    ‚ôªÔ∏è Refactor axis counts and loops

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 000aa60347..ccfe30947c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -644,36 +644,52 @@
  * Disable unused SINGLENOZZLE sub-options
  */
 #if DISABLED(SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_TEMP
 #endif
 #if !BOTH(HAS_FAN, SINGLENOZZLE)
   #undef SINGLENOZZLE_STANDBY_FAN
 #endif
 
 /**
- * DISTINCT_E_FACTORS affects how some E factors are accessed
+ * Number of Linear Axes (e.g., XYZ)
+ * All the logical axes except for the tool (E) axis
+ */
+#ifndef LINEAR_AXES
+  #define LINEAR_AXES XYZ
+#endif
+
+/**
+ * Number of Logical Axes (e.g., XYZE)
+ * All the logical axes that can be commanded directly by G-code.
+ * Delta maps stepper-specific values to ABC steppers.
+ */
+#if EXTRUDERS
+  #define LOGICAL_AXES INCREMENT(LINEAR_AXES)
+#else
+  #define LOGICAL_AXES LINEAR_AXES
+#endif
+
+/**
+ * DISTINCT_E_FACTORS affects whether Extruders use different settings
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define DISTINCT_E E_STEPPERS
-  #define XYZE_N (XYZ + E_STEPPERS)
+  #define DISTINCT_AXES (LINEAR_AXES + E_STEPPERS)
   #define E_INDEX_N(E) (E)
-  #define E_AXIS_N(E) AxisEnum(E_AXIS + E)
-  #define UNUSED_E(E) NOOP
 #else
   #undef DISTINCT_E_FACTORS
   #define DISTINCT_E 1
-  #define XYZE_N XYZE
+  #define DISTINCT_AXES LOGICAL_AXES
   #define E_INDEX_N(E) 0
-  #define E_AXIS_N(E) E_AXIS
-  #define UNUSED_E(E) UNUSED(E)
 #endif
+#define E_AXIS_N(E) AxisEnum(E_AXIS + E_INDEX_N(E))
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif
   #undef DEACTIVATE_SERVOS_AFTER_MOVE

commit 874c531f27e7f342c7864c12310ef12c177d9000
Author: ondrada <82547068+ondrada@users.noreply.github.com>
Date:   Sat May 15 05:29:17 2021 +0200

    Fix G29_RETRY_AND_RECOVER dependency (#21907)
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 42349b955e..000aa60347 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -863,20 +863,21 @@
 #endif
 #if EITHER(HAS_ABL_OR_UBL, MESH_BED_LEVELING)
   #define HAS_LEVELING 1
   #if DISABLED(AUTO_BED_LEVELING_UBL)
     #define PLANNER_LEVELING 1
   #endif
 #endif
 #if !HAS_LEVELING
   #undef RESTORE_LEVELING_AFTER_G28
   #undef ENABLE_LEVELING_AFTER_G28
+  #undef G29_RETRY_AND_RECOVER
 #endif
 #if !HAS_LEVELING || EITHER(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
   #undef PROBE_MANUALLY
 #endif
 #if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
   #define PROBE_SELECTED 1
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))

commit 390878e78af3a0f07e2a1b2e784fc882e22edbd4
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue May 11 04:01:21 2021 -0500

    :art: Additional utility macros

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ed86c1bf65..42349b955e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -610,23 +610,23 @@
     #define HAS_MULTI_HOTEND 1
     #define HAS_HOTEND_OFFSET 1
   #endif
 #else
   #undef PID_PARAMS_PER_HOTEND
 #endif
 
 // Helper macros for extruder and hotend arrays
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
-#define ARRAY_BY_EXTRUDERS1(v1) ARRAY_BY_EXTRUDERS(v1, v1, v1, v1, v1, v1, v1, v1)
+#define ARRAY_BY_EXTRUDERS1(v1) ARRAY_N_1(EXTRUDERS, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
-#define ARRAY_BY_HOTENDS1(v1) ARRAY_BY_HOTENDS(v1, v1, v1, v1, v1, v1, v1, v1)
+#define ARRAY_BY_HOTENDS1(v1) ARRAY_N_1(HOTENDS, v1)
 
 #if ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
   #define DO_SWITCH_EXTRUDER 1
 #endif
 
 /**
  * Default hotend offsets, if not defined
  */
 #if HAS_HOTEND_OFFSET
   #ifndef HOTEND_OFFSET_X

commit c9de9d4f9b8aee4ac3dfd0f49591b822230f43c7
Author: BigTreeTech <38851044+bigtreetech@users.noreply.github.com>
Date:   Sun May 9 10:02:16 2021 +0800

    Capacitive Touch Screen (GT911) for SKR SE BX (#21843)
    
    Co-authored-by: Msq001 <alansayyeah@gmail.com>
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index afec2c2b44..ed86c1bf65 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1124,20 +1124,23 @@
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(ANET_ET5_TFT35)       // ST7796
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(BIQU_BX_TFT70)        // RGB
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
   #define TFT_RES_1024x600
   #define TFT_INTERFACE_LTDC
+  #if ENABLED(TOUCH_SCREEN)
+    #define TFT_TOUCH_DEVICE_GT911
+  #endif
 #elif ENABLED(TFT_GENERIC)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #if NONE(TFT_RES_320x240, TFT_RES_480x272, TFT_RES_480x320)
     #define TFT_RES_320x240
   #endif
   #if NONE(TFT_INTERFACE_FSMC, TFT_INTERFACE_SPI)
     #define TFT_INTERFACE_SPI
   #endif
 #endif
 
@@ -1212,30 +1215,44 @@
 #if EITHER(TFT_320x240, TFT_320x240_SPI)
   #define HAS_UI_320x240 1
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
 #elif EITHER(TFT_480x272, TFT_480x272_SPI)
   #define HAS_UI_480x272 1
 #elif defined(TFT_1024x600_LTDC)
   #define HAS_UI_1024x600 1
 #endif
 #if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
-  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
+  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)   // Fewer lines with touch buttons onscreen
 #elif HAS_UI_1024x600
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
-#if ENABLED(TOUCH_SCREEN) && !HAS_GRAPHICAL_TFT
-  #undef TOUCH_SCREEN
-  #if ENABLED(TFT_CLASSIC_UI)
-    #define HAS_TOUCH_BUTTONS 1
+#if ENABLED(TOUCH_SCREEN)
+  #if NONE(TFT_TOUCH_DEVICE_GT911, TFT_TOUCH_DEVICE_XPT2046)
+    #define TFT_TOUCH_DEVICE_XPT2046          // ADS7843/XPT2046 ADC Touchscreen such as ILI9341 2.8
+  #endif
+  #if ENABLED(TFT_TOUCH_DEVICE_GT911)         // GT911 Capacitive touch screen such as BIQU_BX_TFT70
+    #undef TOUCH_SCREEN_CALIBRATION
+    #undef TOUCH_CALIBRATION_AUTO_SAVE
+  #endif
+  #if !HAS_GRAPHICAL_TFT
+    #undef TOUCH_SCREEN
+    #if ENABLED(TFT_CLASSIC_UI)
+      #define HAS_TOUCH_BUTTONS 1
+      #if ENABLED(TFT_TOUCH_DEVICE_GT911)
+        #define HAS_CAP_TOUCH_BUTTONS 1
+      #else
+        #define HAS_RES_TOUCH_BUTTONS 1
+      #endif
+    #endif
   #endif
 #endif
 
 // XPT2046_** Compatibility
 #if !(defined(TOUCH_CALIBRATION_X) || defined(TOUCH_CALIBRATION_Y) || defined(TOUCH_OFFSET_X) || defined(TOUCH_OFFSET_Y) || defined(TOUCH_ORIENTATION))
   #if defined(XPT2046_X_CALIBRATION) && defined(XPT2046_Y_CALIBRATION) && defined(XPT2046_X_OFFSET) && defined(XPT2046_Y_OFFSET)
     #define TOUCH_CALIBRATION_X  XPT2046_X_CALIBRATION
     #define TOUCH_CALIBRATION_Y  XPT2046_Y_CALIBRATION
     #define TOUCH_OFFSET_X       XPT2046_X_OFFSET
     #define TOUCH_OFFSET_Y       XPT2046_Y_OFFSET

commit 02405add76e722701ab49434549e7d8bf5690162
Author: ellensp <ellensp@hotmail.com>
Date:   Fri May 7 17:31:45 2021 +1200

    Support a third serial port (#21784)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d767000501..afec2c2b44 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -948,29 +948,33 @@
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
 #if ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE))
   #define HAS_CLASSIC_E_JERK 1
 #endif
 
 //
 // Serial Port Info
 //
 #ifdef SERIAL_PORT_2
-  #define NUM_SERIAL 2
   #define HAS_MULTI_SERIAL 1
+  #ifdef SERIAL_PORT_3
+    #define NUM_SERIAL 3
+  #else
+    #define NUM_SERIAL 2
+  #endif
 #elif defined(SERIAL_PORT)
   #define NUM_SERIAL 1
 #else
   #define NUM_SERIAL 0
   #undef BAUD_RATE_GCODE
 #endif
-#if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1
+#if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1 || SERIAL_PORT_3 == -1
   #define HAS_USB_SERIAL 1
 #endif
 #if SERIAL_PORT_2 == -2
   #define HAS_ETHERNET 1
 #endif
 
 #if ENABLED(DWIN_CREALITY_LCD)
   #define SERIAL_CATCHALL 0
   #ifndef LCD_SERIAL_PORT
     #define LCD_SERIAL_PORT 3 // Creality 4.x board

commit 301ee6c57aeafbe121f6896b532fada07c2b3477
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed May 5 04:24:42 2021 -0500

    Add MKS_LCD12864B

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a6df825ad9..d767000501 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -19,22 +19,22 @@
  * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
-// MKS_LCD12864 is a variant of MKS_MINI_12864
-#if ENABLED(MKS_LCD12864)
+// MKS_LCD12864A/B is a variant of MKS_MINI_12864
+#if EITHER(MKS_LCD12864A, MKS_LCD12864B)
   #define MKS_MINI_12864
 #endif
 
 /**
  * General Flags that may be set below by specific LCDs
  *
  *  DOGLCD                : Run a Graphical LCD through U8GLib (with MarlinUI)
  *  IS_ULTIPANEL          : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
  *  IS_ULTRA_LCD          : Ultra LCD, not necessarily Ultipanel.
  *  IS_RRD_SC             : Common RRD Smart Controller digital interface pins

commit ef9ca61039514efef6e2bf100c4b6b1db8f0316c
Author: ellensp <ellensp@hotmail.com>
Date:   Sat May 1 20:21:18 2021 +1200

    Fix Singlenozzle Standby issues (#21759)
    
    Fixes #21758
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 429877ce84..a6df825ad9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -633,20 +633,30 @@
     #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
   #endif
   #ifndef HOTEND_OFFSET_Y
     #define HOTEND_OFFSET_Y { 0 } // Y offsets for each extruder
   #endif
   #ifndef HOTEND_OFFSET_Z
     #define HOTEND_OFFSET_Z { 0 } // Z offsets for each extruder
   #endif
 #endif
 
+/**
+ * Disable unused SINGLENOZZLE sub-options
+ */
+#if DISABLED(SINGLENOZZLE)
+  #undef SINGLENOZZLE_STANDBY_TEMP
+#endif
+#if !BOTH(HAS_FAN, SINGLENOZZLE)
+  #undef SINGLENOZZLE_STANDBY_FAN
+#endif
+
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define DISTINCT_E E_STEPPERS
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_INDEX_N(E) (E)
   #define E_AXIS_N(E) AxisEnum(E_AXIS + E)
   #define UNUSED_E(E) NOOP
 #else

commit a1ee5124d3673077e7812c00f883fca7179b30bd
Author: pinchies <pinchies@gmail.com>
Date:   Sun Apr 25 18:48:20 2021 +1000

    Fix usage, commentary of MANUAL_PROBE_START_Z, Z_AFTER_PROBING (#21692)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 78a6f2c821..429877ce84 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -781,28 +781,20 @@
     #endif
     #ifndef FIL_RUNOUT8_PULLUP
       #define FIL_RUNOUT8_PULLUP FIL_RUNOUT_PULLUP
     #endif
     #ifndef FIL_RUNOUT8_PULLDOWN
       #define FIL_RUNOUT8_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
 #endif // FILAMENT_RUNOUT_SENSOR
 
-#if EITHER(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
-  #undef PROBE_MANUALLY
-#endif
-
-#if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
-  #define PROBE_SELECTED 1
-#endif
-
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #define HAS_CUSTOM_PROBE_PIN 1
   #endif
   #if Z_HOME_DIR < 0 && (!HAS_CUSTOM_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
@@ -858,28 +850,30 @@
   #if DISABLED(PROBE_MANUALLY)
     #define HAS_AUTOLEVEL 1
   #endif
 #endif
 #if EITHER(HAS_ABL_OR_UBL, MESH_BED_LEVELING)
   #define HAS_LEVELING 1
   #if DISABLED(AUTO_BED_LEVELING_UBL)
     #define PLANNER_LEVELING 1
   #endif
 #endif
-#if EITHER(HAS_ABL_OR_UBL, Z_MIN_PROBE_REPEATABILITY_TEST)
-  #define HAS_PROBING_PROCEDURE 1
-#endif
 #if !HAS_LEVELING
-  #undef PROBE_MANUALLY
   #undef RESTORE_LEVELING_AFTER_G28
   #undef ENABLE_LEVELING_AFTER_G28
 #endif
+#if !HAS_LEVELING || EITHER(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
+  #undef PROBE_MANUALLY
+#endif
+#if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
+  #define PROBE_SELECTED 1
+#endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
   #define GRID_LOOP(A,B) LOOP_L_N(A, GRID_MAX_POINTS_X) LOOP_L_N(B, GRID_MAX_POINTS_Y)
 #endif
 
 // Slim menu optimizations
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif

commit 949d2d9e50d34d7b2111a6c23e153687f59a1b2d
Author: ellensp <ellensp@hotmail.com>
Date:   Sat Apr 24 17:11:11 2021 +1200

    Fix MP_SCARA compile (#21686)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7ae1d8dccd..78a6f2c821 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -914,21 +914,21 @@
     #define CORE_AXIS_2 C_AXIS
   #endif
   #define CORESIGN(n) (ANY(COREYX, COREZX, COREZY) ? (-(n)) : (n))
 #elif ENABLED(MARKFORGED_XY)
   // Markforged kinematics
   #define CORE_AXIS_1 A_AXIS
   #define CORE_AXIS_2 B_AXIS
   #define NORMAL_AXIS Z_AXIS
 #endif
 
-#if EITHER(MORGAN_SCARA, AXEL_TPARA)
+#if ANY(MORGAN_SCARA, MP_SCARA, AXEL_TPARA)
   #define IS_SCARA 1
   #define IS_KINEMATIC 1
 #elif ENABLED(DELTA)
   #define IS_KINEMATIC 1
 #else
   #define IS_CARTESIAN 1
   #if !IS_CORE
     #define IS_FULL_CARTESIAN 1
   #endif
 #endif

commit b483a8d652c18626d57b5a38c78fdd2caa6e91c3
Author: BigTreeTech <38851044+bigtreetech@users.noreply.github.com>
Date:   Tue Apr 6 10:40:50 2021 +0800

    BTT SKR-SE-BX (STM32H743IIT6 ARM Cortex M7) and BIQU_BX_TFT70 (#21536)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 88bd382020..7ae1d8dccd 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1112,20 +1112,24 @@
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(ANET_ET4_TFT28)       // ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(ANET_ET5_TFT35)       // ST7796
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
+#elif ENABLED(BIQU_BX_TFT70)        // RGB
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
+  #define TFT_RES_1024x600
+  #define TFT_INTERFACE_LTDC
 #elif ENABLED(TFT_GENERIC)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #if NONE(TFT_RES_320x240, TFT_RES_480x272, TFT_RES_480x320)
     #define TFT_RES_320x240
   #endif
   #if NONE(TFT_INTERFACE_FSMC, TFT_INTERFACE_SPI)
     #define TFT_INTERFACE_SPI
   #endif
 #endif
 
@@ -1134,37 +1138,48 @@
   #define TFT_HEIGHT 240
   #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(TFT_RES_480x272)
   #define TFT_WIDTH  480
   #define TFT_HEIGHT 272
   #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(TFT_RES_480x320)
   #define TFT_WIDTH  480
   #define TFT_HEIGHT 320
   #define GRAPHICAL_TFT_UPSCALE 3
+#elif ENABLED(TFT_RES_1024x600)
+  #define TFT_WIDTH  1024
+  #define TFT_HEIGHT 600
+  #define GRAPHICAL_TFT_UPSCALE 4
 #endif
 
-// FSMC/SPI TFT Panels using standard HAL/tft/tft_(fsmc|spi).h
+// FSMC/SPI TFT Panels using standard HAL/tft/tft_(fsmc|spi|ltdc).h
 #if ENABLED(TFT_INTERFACE_FSMC)
   #define HAS_FSMC_TFT 1
   #if TFT_SCALED_DOGLCD
     #define HAS_FSMC_GRAPHICAL_TFT 1
   #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_FSMC 1
   #endif
 #elif ENABLED(TFT_INTERFACE_SPI)
   #define HAS_SPI_TFT 1
   #if TFT_SCALED_DOGLCD
     #define HAS_SPI_GRAPHICAL_TFT 1
   #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_SPI 1
   #endif
+#elif ENABLED(TFT_INTERFACE_LTDC)
+  #define HAS_LTDC_TFT 1
+  #if TFT_SCALED_DOGLCD
+    #define HAS_LTDC_GRAPHICAL_TFT 1
+  #elif HAS_TFT_LVGL_UI
+    #define HAS_TFT_LVGL_UI_LTDC 1
+  #endif
 #endif
 
 #if ENABLED(TFT_COLOR_UI)
   #if TFT_HEIGHT == 240
     #if ENABLED(TFT_INTERFACE_SPI)
       #define TFT_320x240_SPI
     #elif ENABLED(TFT_INTERFACE_FSMC)
       #define TFT_320x240
     #endif
   #elif TFT_HEIGHT == 320
@@ -1172,32 +1187,40 @@
       #define TFT_480x320_SPI
     #elif ENABLED(TFT_INTERFACE_FSMC)
       #define TFT_480x320
     #endif
   #elif TFT_HEIGHT == 272
     #if ENABLED(TFT_INTERFACE_SPI)
       #define TFT_480x272_SPI
     #elif ENABLED(TFT_INTERFACE_FSMC)
       #define TFT_480x272
     #endif
+  #elif TFT_HEIGHT == 600
+    #if ENABLED(TFT_INTERFACE_LTDC)
+      #define TFT_1024x600_LTDC
+    #endif
   #endif
 #endif
 
 #if EITHER(TFT_320x240, TFT_320x240_SPI)
   #define HAS_UI_320x240 1
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
 #elif EITHER(TFT_480x272, TFT_480x272_SPI)
   #define HAS_UI_480x272 1
+#elif defined(TFT_1024x600_LTDC)
+  #define HAS_UI_1024x600 1
 #endif
 #if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
+#elif HAS_UI_1024x600
+  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 12, 13) // Fewer lines with touch buttons onscreen
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN) && !HAS_GRAPHICAL_TFT
   #undef TOUCH_SCREEN
   #if ENABLED(TFT_CLASSIC_UI)
     #define HAS_TOUCH_BUTTONS 1
   #endif
 #endif
 

commit 8d083eb2488c6e4bd19bec8090b1673d60d2da2a
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Mar 30 21:54:34 2021 -0500

    Put ABL state into a class

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a0fced150f..88bd382020 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -835,21 +835,21 @@
 #if ENABLED(AUTO_BED_LEVELING_UBL)
   #undef LCD_BED_LEVELING
   #if ENABLED(DELTA)
     #define UBL_SEGMENTED 1
   #endif
 #endif
 #if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_3POINT)
   #define ABL_PLANAR 1
 #endif
 #if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR)
-  #define ABL_GRID 1
+  #define ABL_USES_GRID 1
 #endif
 #if ANY(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_3POINT)
   #define HAS_ABL_NOT_UBL 1
 #endif
 #if ANY(AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_UBL, MESH_BED_LEVELING)
   #define HAS_MESH 1
 #endif
 #if EITHER(AUTO_BED_LEVELING_UBL, AUTO_BED_LEVELING_3POINT)
   #define NEEDS_THREE_PROBE_POINTS 1
 #endif

commit 3f7cd45df4b7159e92b37eb561fe4d7980d031af
Author: Giuliano Zaro <3684609+GMagician@users.noreply.github.com>
Date:   Tue Mar 30 04:14:11 2021 +0200

    Generalize MMU (#21469)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index af902481f3..a0fced150f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -494,46 +494,46 @@
     #define LCD_PIXEL_WIDTH 128
   #endif
   #ifndef LCD_PIXEL_HEIGHT
     #define LCD_PIXEL_HEIGHT 64
   #endif
 #endif
 
 /**
  *  Multi-Material-Unit supported models
  */
-#define PRUSA_MMU1      1
-#define PRUSA_MMU2      2
-#define PRUSA_MMU2S     3
-#define SMUFF_EMU_MMU2  12
-#define SMUFF_EMU_MMU2S 13
+#define PRUSA_MMU1             1
+#define PRUSA_MMU2             2
+#define PRUSA_MMU2S            3
+#define EXTENDABLE_EMU_MMU2   12
+#define EXTENDABLE_EMU_MMU2S  13
 
 #ifdef MMU_MODEL
   #define HAS_MMU 1
   #if MMU_MODEL == PRUSA_MMU1
     #define HAS_PRUSA_MMU1 1
   #elif MMU_MODEL % 10 == PRUSA_MMU2
     #define HAS_PRUSA_MMU2 1
   #elif MMU_MODEL % 10 == PRUSA_MMU2S
     #define HAS_PRUSA_MMU2 1
     #define HAS_PRUSA_MMU2S 1
   #endif
-  #if MMU_MODEL == SMUFF_EMU_MMU2 || MMU_MODEL == SMUFF_EMU_MMU2S
-    #define HAS_SMUFF 1
+  #if MMU_MODEL == EXTENDABLE_EMU_MMU2 || MMU_MODEL == EXTENDABLE_EMU_MMU2S
+    #define HAS_EXTENDABLE_MMU 1
   #endif
 #endif
 
 #undef PRUSA_MMU1
 #undef PRUSA_MMU2
 #undef PRUSA_MMU2S
-#undef SMUFF_EMU_MMU2
-#undef SMUFF_EMU_MMU2S
+#undef EXTENDABLE_EMU_MMU2
+#undef EXTENDABLE_EMU_MMU2S
 
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  */
@@ -572,21 +572,21 @@
   #define E_MANUAL        EXTRUDERS
 #elif HAS_PRUSA_MMU2
   #define E_STEPPERS 1
 #endif
 
 // No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1
 #if ENABLED(SWITCHING_NOZZLE) || HAS_PRUSA_MMU1
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
-// Pr≈Ø≈°a MMU1, MMU 2.0, MMUS 2.0 and SMuFF force SINGLENOZZLE
+// Pr≈Ø≈°a MMU1, MMU(S) 2.0 and EXTENDABLE_EMU_MMU2(S) force SINGLENOZZLE
 #if HAS_MMU
   #define SINGLENOZZLE
 #endif
 
 #if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
   #define HOTENDS       1
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #endif

commit 930752d46e6aacb484ea89dacae6baf823d78d62
Author: Miguel Risco-Castillo <mriscoc@users.noreply.github.com>
Date:   Wed Mar 24 10:12:57 2021 -0500

    Ender 3 V2 Status Line (#21369)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index fc83a1ff87..af902481f3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -474,21 +474,21 @@
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif DISABLED(HAS_GRAPHICAL_TFT)
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
-#if EITHER(HAS_DISPLAY, GLOBAL_STATUS_MESSAGE)
+#if ANY(HAS_DISPLAY, DWIN_CREALITY_LCD, GLOBAL_STATUS_MESSAGE)
   #define HAS_STATUS_MESSAGE 1
 #endif
 
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_LCD_MENU 1
 #endif
 
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128

commit b51aed8aa54f41cc5897485d3b34b019ce38343d
Author: Skorpi08 <skorpik08@gmail.com>
Date:   Fri Mar 19 02:51:19 2021 +0100

    Nextion TFT touch screen (#21324)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index fc7eec84ee..fc83a1ff87 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -453,21 +453,21 @@
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
 #if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY,DGUS_LCD_UI_MKS)
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
-#if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON)
+#if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON, NEXTION_TFT)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(IS_ULTRA_LCD, EXTENSIBLE_UI)
   #define HAS_DISPLAY 1
 #endif
 
 #if IS_ULTRA_LCD

commit 1a23ffd7768483914485f9ea569c5813613eef92
Author: K.3D <40525619+KA8888@users.noreply.github.com>
Date:   Mon Mar 15 17:02:40 2021 +0100

    KRATOS32 / K.32 board and LCD controllers (#21334)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b9b86a7bf3..fc7eec84ee 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -222,28 +222,32 @@
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define IS_RRD_FG_SC 1
   #define BOARD_ST7920_DELAY_1 DELAY_NS(125)
   #define BOARD_ST7920_DELAY_2 DELAY_NS(125)
   #define BOARD_ST7920_DELAY_3 DELAY_NS(125)
 
-#elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING, BQ_LCD_SMART_CONTROLLER)
+#elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING, BQ_LCD_SMART_CONTROLLER, K3D_FULL_GRAPHIC_SMART_CONTROLLER)
 
   #define IS_RRD_FG_SC 1
 
 #elif ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
 
-  // RepRapDiscount LCD or Graphical LCD with rotary click encoder
+  #define IS_RRD_SC 1   // RepRapDiscount LCD or Graphical LCD with rotary click encoder
+
+#elif ENABLED(K3D_242_OLED_CONTROLLER)
+
   #define IS_RRD_SC 1
+  #define U8GLIB_SSD1309
 
 #endif
 
 // ST7920-based graphical displays
 #if ANY(IS_RRD_FG_SC, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
   #define U8GLIB_ST7920
   #define IS_RRD_SC 1
 #endif
 

commit d787cd307680c5c4f155ad4643c1137db56bb006
Author: X-Ryl669 <boite.pour.spam@gmail.com>
Date:   Sun Mar 14 18:11:11 2021 +0100

    Fix build with Meatpack only on 2nd port (#21336)
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e5f7441e77..b9b86a7bf3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -647,27 +647,20 @@
   #define UNUSED_E(E) NOOP
 #else
   #undef DISTINCT_E_FACTORS
   #define DISTINCT_E 1
   #define XYZE_N XYZE
   #define E_INDEX_N(E) 0
   #define E_AXIS_N(E) E_AXIS
   #define UNUSED_E(E) UNUSED(E)
 #endif
 
-#if ENABLED(DWIN_CREALITY_LCD)
-  #define SERIAL_CATCHALL 0
-  #ifndef LCD_SERIAL_PORT
-    #define LCD_SERIAL_PORT 3 // Creality 4.x board
-  #endif
-#endif
-
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif
   #undef DEACTIVATE_SERVOS_AFTER_MOVE
 
@@ -943,27 +936,46 @@
 
 #if DISABLED(CLASSIC_JERK)
   #define HAS_JUNCTION_DEVIATION 1
 #endif
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
 #if ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE))
   #define HAS_CLASSIC_E_JERK 1
 #endif
 
+//
+// Serial Port Info
+//
+#ifdef SERIAL_PORT_2
+  #define NUM_SERIAL 2
+  #define HAS_MULTI_SERIAL 1
+#elif defined(SERIAL_PORT)
+  #define NUM_SERIAL 1
+#else
+  #define NUM_SERIAL 0
+  #undef BAUD_RATE_GCODE
+#endif
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1
   #define HAS_USB_SERIAL 1
 #endif
 #if SERIAL_PORT_2 == -2
   #define HAS_ETHERNET 1
 #endif
 
+#if ENABLED(DWIN_CREALITY_LCD)
+  #define SERIAL_CATCHALL 0
+  #ifndef LCD_SERIAL_PORT
+    #define LCD_SERIAL_PORT 3 // Creality 4.x board
+  #endif
+#endif
+
 // Fallback Stepper Driver types that don't depend on Configuration_adv.h
 #ifndef X_DRIVER_TYPE
   #define X_DRIVER_TYPE  A4988
 #endif
 #ifndef X2_DRIVER_TYPE
   #define X2_DRIVER_TYPE A4988
 #endif
 #ifndef Y_DRIVER_TYPE
   #define Y_DRIVER_TYPE  A4988
 #endif

commit 9299f4e98a95066c232d4657ff6d7c6acbb72fe0
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Thu Mar 4 01:32:02 2021 -0800

    SMUFF => SMuFF (#21243)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 4931c767b8..e5f7441e77 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -568,21 +568,21 @@
   #define E_MANUAL        EXTRUDERS
 #elif HAS_PRUSA_MMU2
   #define E_STEPPERS 1
 #endif
 
 // No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1
 #if ENABLED(SWITCHING_NOZZLE) || HAS_PRUSA_MMU1
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
-// Pr≈Ø≈°a MMU1, MMU 2.0, MMUS 2.0 and SMUFF force SINGLENOZZLE
+// Pr≈Ø≈°a MMU1, MMU 2.0, MMUS 2.0 and SMuFF force SINGLENOZZLE
 #if HAS_MMU
   #define SINGLENOZZLE
 #endif
 
 #if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
   #define HOTENDS       1
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #endif

commit a46e0257252bcd50f4c7acb04215f3ad2a92047c
Author: Axel <ansepulveda@uc.cl>
Date:   Wed Mar 3 20:46:32 2021 -0300

    TPARA - 3DOF robot arm IK (#21005)
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c8b683ecf9..4931c767b8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -917,21 +917,21 @@
     #define CORE_AXIS_2 C_AXIS
   #endif
   #define CORESIGN(n) (ANY(COREYX, COREZX, COREZY) ? (-(n)) : (n))
 #elif ENABLED(MARKFORGED_XY)
   // Markforged kinematics
   #define CORE_AXIS_1 A_AXIS
   #define CORE_AXIS_2 B_AXIS
   #define NORMAL_AXIS Z_AXIS
 #endif
 
-#if ENABLED(MORGAN_SCARA)
+#if EITHER(MORGAN_SCARA, AXEL_TPARA)
   #define IS_SCARA 1
   #define IS_KINEMATIC 1
 #elif ENABLED(DELTA)
   #define IS_KINEMATIC 1
 #else
   #define IS_CARTESIAN 1
   #if !IS_CORE
     #define IS_FULL_CARTESIAN 1
   #endif
 #endif

commit c76008bd6a7bc0f88fec7fa58f11cfec88ab366f
Author: Sola <42537573+solawc@users.noreply.github.com>
Date:   Sun Feb 28 07:35:32 2021 +0800

    MKS H43 controller (#20609)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3e20bb90c0..c8b683ecf9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -444,21 +444,21 @@
 #endif
 
 #if EITHER(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
   #define IS_RRW_KEYPAD 1
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
-#if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY)
+#if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY,DGUS_LCD_UI_MKS)
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON)
   #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features

commit 4f840c211c02f4ccf4cb50ebe7a0371a9fcdc55b
Author: Giuliano Zaro <3684609+GMagician@users.noreply.github.com>
Date:   Sat Feb 27 20:23:00 2021 +0100

    [SMUFF] Use EXTRUDERS for extended commands (#21212)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index cff1424eb3..3e20bb90c0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -506,21 +506,21 @@
 #ifdef MMU_MODEL
   #define HAS_MMU 1
   #if MMU_MODEL == PRUSA_MMU1
     #define HAS_PRUSA_MMU1 1
   #elif MMU_MODEL % 10 == PRUSA_MMU2
     #define HAS_PRUSA_MMU2 1
   #elif MMU_MODEL % 10 == PRUSA_MMU2S
     #define HAS_PRUSA_MMU2 1
     #define HAS_PRUSA_MMU2S 1
   #endif
-  #if MMU_MODEL >= SMUFF_EMU_MMU2
+  #if MMU_MODEL == SMUFF_EMU_MMU2 || MMU_MODEL == SMUFF_EMU_MMU2S
     #define HAS_SMUFF 1
   #endif
 #endif
 
 #undef PRUSA_MMU1
 #undef PRUSA_MMU2
 #undef PRUSA_MMU2S
 #undef SMUFF_EMU_MMU2
 #undef SMUFF_EMU_MMU2S
 

commit 468e437390afdb1de7059e7f9049d0b30c312024
Author: deirdreobyrne <deirdre.dub@gmail.com>
Date:   Thu Feb 25 10:49:34 2021 +0000

    Allow Zero Endstops (e.g., for CNC) (#21120)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7ac4fe4c31..cff1424eb3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1188,10 +1188,17 @@
 // XPT2046_** Compatibility
 #if !(defined(TOUCH_CALIBRATION_X) || defined(TOUCH_CALIBRATION_Y) || defined(TOUCH_OFFSET_X) || defined(TOUCH_OFFSET_Y) || defined(TOUCH_ORIENTATION))
   #if defined(XPT2046_X_CALIBRATION) && defined(XPT2046_Y_CALIBRATION) && defined(XPT2046_X_OFFSET) && defined(XPT2046_Y_OFFSET)
     #define TOUCH_CALIBRATION_X  XPT2046_X_CALIBRATION
     #define TOUCH_CALIBRATION_Y  XPT2046_Y_CALIBRATION
     #define TOUCH_OFFSET_X       XPT2046_X_OFFSET
     #define TOUCH_OFFSET_Y       XPT2046_Y_OFFSET
     #define TOUCH_ORIENTATION    TOUCH_LANDSCAPE
   #endif
 #endif
+
+#if ANY(USE_XMIN_PLUG, USE_YMIN_PLUG, USE_ZMIN_PLUG, USE_XMAX_PLUG, USE_YMAX_PLUG, USE_ZMAX_PLUG)
+  #define HAS_ENDSTOPS 1
+  #define COORDINATE_OKAY(N,L,H) WITHIN(N,L,H)
+#else
+  #define COORDINATE_OKAY(N,L,H) true
+#endif

commit 490d4a504a40a70e1a51c4758d37ec6116272b38
Author: Vert <45634861+Vertabreak@users.noreply.github.com>
Date:   Tue Feb 16 21:29:55 2021 -0500

    GT2560 v4.1B, YHCB2004 SPI character LCD (#21091)
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 17f427a8dd..7ac4fe4c31 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -43,20 +43,24 @@
  *  U8GLIB_SH1106         : SH1106 OLED with I2C interface via U8GLib
  *  IS_U8GLIB_SSD1306     : SSD1306 OLED with I2C interface via U8GLib
  *  U8GLIB_SSD1309        : SSD1309 OLED with I2C interface via U8GLib
  *  U8GLIB_ST7565_64128N  : ST7565 128x64 LCD with SPI interface via U8GLib
  *  U8GLIB_LM6059_AF      : LM6059 with Hardware SPI via U8GLib
  */
 #if EITHER(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
 
   #define MINIPANEL
 
+#elif ENABLED(YHCB2004)
+
+  #define IS_ULTIPANEL 1
+
 #elif ENABLED(CARTESIO_UI)
 
   #define DOGLCD
   #define IS_ULTIPANEL 1
 
 #elif EITHER(DWIN_MARLINUI_PORTRAIT, DWIN_MARLINUI_LANDSCAPE)
 
   #define IS_DWIN_MARLINUI 1
   #define IS_ULTIPANEL 1
 

commit 42d00b13df5af260adf44213e5fae0f7e04681ec
Author: Michael Telatynski <7t3chguy@googlemail.com>
Date:   Fri Feb 12 00:32:31 2021 +0000

    Improve probe preheat behavior (#21033)
    
    Co-authored-by: InsanityAutomation <d.menzel@insanityautomation.com>
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 712ed39cf1..17f427a8dd 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -811,36 +811,20 @@
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
-  #if ENABLED(PREHEAT_BEFORE_PROBING)
-    #ifndef PROBING_NOZZLE_TEMP
-      #define PROBING_NOZZLE_TEMP 0
-    #endif
-    #ifndef PROBING_BED_TEMP
-      #define PROBING_BED_TEMP 0
-    #endif
-  #endif
-  #if ENABLED(PREHEAT_BEFORE_LEVELING)
-    #ifndef LEVELING_NOZZLE_TEMP
-      #define LEVELING_NOZZLE_TEMP 0
-    #endif
-    #ifndef LEVELING_BED_TEMP
-      #define LEVELING_BED_TEMP 0
-    #endif
-  #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef USE_PROBE_FOR_Z_HOMING
 #endif
 
 #if Z_HOME_DIR > 0
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 

commit 3f01b222b2b4f77cff66096dd5a18a64828e1fa4
Author: X-Ryl669 <boite.pour.spam@gmail.com>
Date:   Thu Jan 28 09:02:06 2021 +0100

    Refactor serial class with templates (#20783)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2acda7bd59..712ed39cf1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -313,20 +313,21 @@
   #define TFT_CLASSIC_UI
 #elif ANY(TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI)
   #define TFT_COLOR_UI
 #elif EITHER(TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
   #define TFT_LVGL_UI
 #endif
 
 // FSMC/SPI TFT Panels (LVGL)
 #if ENABLED(TFT_LVGL_UI)
   #define HAS_TFT_LVGL_UI 1
+  #define SERIAL_RUNTIME_HOOK 1
 #endif
 
 // FSMC/SPI TFT Panels
 #if ENABLED(TFT_CLASSIC_UI)
   #define TFT_SCALED_DOGLCD 1
 #endif
 
 #if TFT_SCALED_DOGLCD
   #define DOGLCD
   #define IS_ULTIPANEL 1

commit c12be1f98cf1efdc6fc1e66c528d5975adc6626c
Author: Tanguy Pruvot <tpruvot@users.noreply.github.com>
Date:   Mon Jan 25 08:44:39 2021 +0100

    Graphical TFT fixes, cleanup (#20861)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a5bb24f27c..2acda7bd59 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1148,50 +1148,51 @@
   #endif
 #elif ENABLED(TFT_INTERFACE_SPI)
   #define HAS_SPI_TFT 1
   #if TFT_SCALED_DOGLCD
     #define HAS_SPI_GRAPHICAL_TFT 1
   #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_SPI 1
   #endif
 #endif
 
-#if ENABLED(TFT_COLOR_UI) && TFT_HEIGHT == 240
-  #if ENABLED(TFT_INTERFACE_SPI)
-    #define TFT_320x240_SPI
-  #elif ENABLED(TFT_INTERFACE_FSMC)
-    #define TFT_320x240
-  #endif
-#elif ENABLED(TFT_COLOR_UI) && TFT_HEIGHT == 320
-  #if ENABLED(TFT_INTERFACE_SPI)
-    #define TFT_480x320_SPI
-  #elif ENABLED(TFT_INTERFACE_FSMC)
-    #define TFT_480x320
-  #endif
-#elif ENABLED(TFT_COLOR_UI) && TFT_HEIGHT == 272
-  #if ENABLED(TFT_INTERFACE_SPI)
-    #define TFT_480x272_SPI
-  #elif ENABLED(TFT_INTERFACE_FSMC)
-    #define TFT_480x272
+#if ENABLED(TFT_COLOR_UI)
+  #if TFT_HEIGHT == 240
+    #if ENABLED(TFT_INTERFACE_SPI)
+      #define TFT_320x240_SPI
+    #elif ENABLED(TFT_INTERFACE_FSMC)
+      #define TFT_320x240
+    #endif
+  #elif TFT_HEIGHT == 320
+    #if ENABLED(TFT_INTERFACE_SPI)
+      #define TFT_480x320_SPI
+    #elif ENABLED(TFT_INTERFACE_FSMC)
+      #define TFT_480x320
+    #endif
+  #elif TFT_HEIGHT == 272
+    #if ENABLED(TFT_INTERFACE_SPI)
+      #define TFT_480x272_SPI
+    #elif ENABLED(TFT_INTERFACE_FSMC)
+      #define TFT_480x272
+    #endif
   #endif
 #endif
 
-// Fewer lines with touch buttons on-screen
 #if EITHER(TFT_320x240, TFT_320x240_SPI)
   #define HAS_UI_320x240 1
-  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
-  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #elif EITHER(TFT_480x272, TFT_480x272_SPI)
   #define HAS_UI_480x272 1
-  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
+#endif
+#if ANY(HAS_UI_320x240, HAS_UI_480x320, HAS_UI_480x272)
+  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7) // Fewer lines with touch buttons onscreen
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN) && !HAS_GRAPHICAL_TFT
   #undef TOUCH_SCREEN
   #if ENABLED(TFT_CLASSIC_UI)
     #define HAS_TOUCH_BUTTONS 1
   #endif
 #endif
 

commit 7f3dcb3e8a8cc1a82c1d9315e9fada5ff59058f2
Author: Johan van der Vyver <9843081+jvandervyver@users.noreply.github.com>
Date:   Wed Jan 13 02:05:49 2021 +0200

    Multi-platform DWIN_CREALITY_LCD support (#20738)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 79b65e7a9b..a5bb24f27c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -644,20 +644,23 @@
   #undef DISTINCT_E_FACTORS
   #define DISTINCT_E 1
   #define XYZE_N XYZE
   #define E_INDEX_N(E) 0
   #define E_AXIS_N(E) E_AXIS
   #define UNUSED_E(E) UNUSED(E)
 #endif
 
 #if ENABLED(DWIN_CREALITY_LCD)
   #define SERIAL_CATCHALL 0
+  #ifndef LCD_SERIAL_PORT
+    #define LCD_SERIAL_PORT 3 // Creality 4.x board
+  #endif
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif

commit 6b458676b1a5477b73ccdd5071ee322fcf23f814
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Sun Jan 3 22:59:48 2021 -0500

    Fix SD SPI Speed override, FTDI mesh edit (#20657)
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 388adb1809..79b65e7a9b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1038,25 +1038,20 @@
 #ifndef INVERT_Y_DIR
   #define INVERT_Y_DIR false
 #endif
 #ifndef INVERT_Z_DIR
   #define INVERT_Z_DIR false
 #endif
 #ifndef INVERT_E_DIR
   #define INVERT_E_DIR false
 #endif
 
-// Fallback SPI Speed for SD
-#if ENABLED(SDSUPPORT) && !defined(SD_SPI_SPEED)
-  #define SD_SPI_SPEED SPI_FULL_SPEED
-#endif
-
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
 
 /**
  * TFT Displays

commit c840bbc970c2684c2c9c193ee967c03dd621d99a
Author: Victor Oliveira <rhapsodyv@gmail.com>
Date:   Fri Jan 1 17:31:15 2021 -0300

    Prefix SD SPI pins (SCK, MISO, MOSI, SS) (#20606)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c94fcd0cfe..388adb1809 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1038,23 +1038,23 @@
 #ifndef INVERT_Y_DIR
   #define INVERT_Y_DIR false
 #endif
 #ifndef INVERT_Z_DIR
   #define INVERT_Z_DIR false
 #endif
 #ifndef INVERT_E_DIR
   #define INVERT_E_DIR false
 #endif
 
-// Fallback SPI Speed
-#ifndef SPI_SPEED
-  #define SPI_SPEED SPI_FULL_SPEED
+// Fallback SPI Speed for SD
+#if ENABLED(SDSUPPORT) && !defined(SD_SPI_SPEED)
+  #define SD_SPI_SPEED SPI_FULL_SPEED
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
 

commit 41e4124af9cba37f1e7cd598f47bf21c51d00488
Author: Victor Oliveira <rhapsodyv@gmail.com>
Date:   Tue Dec 29 02:26:35 2020 -0300

    Support 4.3" (480x272) Color UI display (#20334)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f1192cea12..c94fcd0cfe 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1162,29 +1162,38 @@
     #define TFT_320x240_SPI
   #elif ENABLED(TFT_INTERFACE_FSMC)
     #define TFT_320x240
   #endif
 #elif ENABLED(TFT_COLOR_UI) && TFT_HEIGHT == 320
   #if ENABLED(TFT_INTERFACE_SPI)
     #define TFT_480x320_SPI
   #elif ENABLED(TFT_INTERFACE_FSMC)
     #define TFT_480x320
   #endif
+#elif ENABLED(TFT_COLOR_UI) && TFT_HEIGHT == 272
+  #if ENABLED(TFT_INTERFACE_SPI)
+    #define TFT_480x272_SPI
+  #elif ENABLED(TFT_INTERFACE_FSMC)
+    #define TFT_480x272
+  #endif
 #endif
 
 // Fewer lines with touch buttons on-screen
 #if EITHER(TFT_320x240, TFT_320x240_SPI)
   #define HAS_UI_320x240 1
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
+#elif EITHER(TFT_480x272, TFT_480x272_SPI)
+  #define HAS_UI_480x272 1
+  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN) && !HAS_GRAPHICAL_TFT
   #undef TOUCH_SCREEN
   #if ENABLED(TFT_CLASSIC_UI)
     #define HAS_TOUCH_BUTTONS 1
   #endif
 #endif
 

commit d6a56b882fb0b02724086b8af2aa123ec8725c1d
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Dec 28 23:10:48 2020 -0600

    Pins, comment cleanup

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 8188d55316..f1192cea12 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -826,20 +826,21 @@
     #ifndef LEVELING_NOZZLE_TEMP
       #define LEVELING_NOZZLE_TEMP 0
     #endif
     #ifndef LEVELING_BED_TEMP
       #define LEVELING_BED_TEMP 0
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
+  #undef USE_PROBE_FOR_Z_HOMING
 #endif
 
 #if Z_HOME_DIR > 0
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 
 /**
  * Set granular options based on the specific type of leveling
  */
 #if ENABLED(AUTO_BED_LEVELING_UBL)

commit aff4fccfc33dc6b2211bb3999fc8971549b4cad4
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Mon Dec 28 19:56:37 2020 -0800

    Apply SHOW_BOOTSCREEN to TFT_COLOR_UI (#20586)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ed01f54a0b..8188d55316 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1190,14 +1190,10 @@
 // XPT2046_** Compatibility
 #if !(defined(TOUCH_CALIBRATION_X) || defined(TOUCH_CALIBRATION_Y) || defined(TOUCH_OFFSET_X) || defined(TOUCH_OFFSET_Y) || defined(TOUCH_ORIENTATION))
   #if defined(XPT2046_X_CALIBRATION) && defined(XPT2046_Y_CALIBRATION) && defined(XPT2046_X_OFFSET) && defined(XPT2046_Y_OFFSET)
     #define TOUCH_CALIBRATION_X  XPT2046_X_CALIBRATION
     #define TOUCH_CALIBRATION_Y  XPT2046_Y_CALIBRATION
     #define TOUCH_OFFSET_X       XPT2046_X_OFFSET
     #define TOUCH_OFFSET_Y       XPT2046_Y_OFFSET
     #define TOUCH_ORIENTATION    TOUCH_LANDSCAPE
   #endif
 #endif
-
-#if MB(ANET_ET4, ANET_ET4P)
-  #define IS_ANET_ET 1
-#endif

commit d00c89946dac44326dd1eb0fd381fb404cfd654d
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Dec 27 16:15:15 2020 -0600

    Remove CREALITY_TOUCH

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3e61eb6d4a..ed01f54a0b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -646,25 +646,20 @@
   #define XYZE_N XYZE
   #define E_INDEX_N(E) 0
   #define E_AXIS_N(E) E_AXIS
   #define UNUSED_E(E) UNUSED(E)
 #endif
 
 #if ENABLED(DWIN_CREALITY_LCD)
   #define SERIAL_CATCHALL 0
 #endif
 
-// Pressure sensor with a BLTouch-like interface
-#if ENABLED(CREALITY_TOUCH)
-  #define BLTOUCH
-#endif
-
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif
   #undef DEACTIVATE_SERVOS_AFTER_MOVE
 

commit 4d6b6bcffc5082de84614aea0bdd2b280f503430
Author: Victor Oliveira <rhapsodyv@gmail.com>
Date:   Wed Dec 23 23:01:21 2020 -0300

    LVGL and Classic UI for STM32 (#20552)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7c581bef90..3e61eb6d4a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1180,21 +1180,21 @@
   #define HAS_UI_320x240 1
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN) && !HAS_GRAPHICAL_TFT
   #undef TOUCH_SCREEN
-  #if !HAS_TFT_LVGL_UI
+  #if ENABLED(TFT_CLASSIC_UI)
     #define HAS_TOUCH_BUTTONS 1
   #endif
 #endif
 
 // XPT2046_** Compatibility
 #if !(defined(TOUCH_CALIBRATION_X) || defined(TOUCH_CALIBRATION_Y) || defined(TOUCH_OFFSET_X) || defined(TOUCH_OFFSET_Y) || defined(TOUCH_ORIENTATION))
   #if defined(XPT2046_X_CALIBRATION) && defined(XPT2046_Y_CALIBRATION) && defined(XPT2046_X_OFFSET) && defined(XPT2046_Y_OFFSET)
     #define TOUCH_CALIBRATION_X  XPT2046_X_CALIBRATION
     #define TOUCH_CALIBRATION_Y  XPT2046_Y_CALIBRATION
     #define TOUCH_OFFSET_X       XPT2046_X_OFFSET

commit c559fc82271e1c609b7f0211ce1075c4a1eac815
Author: Tanguy Pruvot <tpruvot@users.noreply.github.com>
Date:   Tue Dec 22 14:01:24 2020 +0100

    Fix G28 leveling state, UBL compile (#20499)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 386482b3ac..7c581bef90 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -879,20 +879,21 @@
   #if DISABLED(AUTO_BED_LEVELING_UBL)
     #define PLANNER_LEVELING 1
   #endif
 #endif
 #if EITHER(HAS_ABL_OR_UBL, Z_MIN_PROBE_REPEATABILITY_TEST)
   #define HAS_PROBING_PROCEDURE 1
 #endif
 #if !HAS_LEVELING
   #undef PROBE_MANUALLY
   #undef RESTORE_LEVELING_AFTER_G28
+  #undef ENABLE_LEVELING_AFTER_G28
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
   #define GRID_LOOP(A,B) LOOP_L_N(A, GRID_MAX_POINTS_X) LOOP_L_N(B, GRID_MAX_POINTS_Y)
 #endif
 
 // Slim menu optimizations
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL

commit a0c8d348a0baa179a13bc47be6edce4bb652dac9
Author: Keith Bennett <13375512+thisiskeithb@users.noreply.github.com>
Date:   Tue Dec 22 04:51:29 2020 -0800

    Anet ET4 / ET4P and Anet TFT28 / TFT35 (#20280)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c683753600..386482b3ac 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1066,64 +1066,66 @@
  *
  * Configure parameters for TFT displays:
  *  - TFT_DEFAULT_ORIENTATION
  *  - TFT_DRIVER
  *  - TFT_WIDTH
  *  - TFT_HEIGHT
  *  - TFT_INTERFACE_(SPI|FSMC)
  *  - TFT_COLOR
  *  - GRAPHICAL_TFT_UPSCALE
  */
-#if ENABLED(MKS_TS35_V2_0)
-  // Most common: ST7796
+#if ENABLED(MKS_TS35_V2_0)          // Most common: ST7796
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_SPI
-#elif ENABLED(MKS_ROBIN_TFT24)
-  // Most common: ST7789
+#elif ENABLED(MKS_ROBIN_TFT24)      // Most common: ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT28)
-  // Most common: ST7789
+#elif ENABLED(MKS_ROBIN_TFT28)      // Most common: ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT32)
-  // Most common: ST7789
+#elif ENABLED(MKS_ROBIN_TFT32)      // Most common: ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT35)
-  // Most common: ILI9488
+#elif ENABLED(MKS_ROBIN_TFT35)      // Most common: ILI9488
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(MKS_ROBIN_TFT43)
   #define TFT_DEFAULT_ORIENTATION 0
   #define TFT_DRIVER SSD1963
   #define TFT_RES_480x272
   #define TFT_INTERFACE_FSMC
-#elif ENABLED(MKS_ROBIN_TFT_V1_1R)
-  // ILI9328 or R61505
+#elif ENABLED(MKS_ROBIN_TFT_V1_1R)  // ILI9328 or R61505
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-#elif EITHER(TFT_TRONXY_X5SA, ANYCUBIC_TFT35)
+#elif EITHER(TFT_TRONXY_X5SA, ANYCUBIC_TFT35) // ILI9488
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_DRIVER ILI9488
   #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
 #elif ENABLED(LONGER_LK_TFT28)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
+#elif ENABLED(ANET_ET4_TFT28)       // ST7789
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
+  #define TFT_RES_320x240
+  #define TFT_INTERFACE_FSMC
+#elif ENABLED(ANET_ET5_TFT35)       // ST7796
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
+  #define TFT_RES_480x320
+  #define TFT_INTERFACE_FSMC
 #elif ENABLED(TFT_GENERIC)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #if NONE(TFT_RES_320x240, TFT_RES_480x272, TFT_RES_480x320)
     #define TFT_RES_320x240
   #endif
   #if NONE(TFT_INTERFACE_FSMC, TFT_INTERFACE_SPI)
     #define TFT_INTERFACE_SPI
   #endif
 #endif
 
@@ -1190,18 +1192,16 @@
 #endif
 
 // XPT2046_** Compatibility
 #if !(defined(TOUCH_CALIBRATION_X) || defined(TOUCH_CALIBRATION_Y) || defined(TOUCH_OFFSET_X) || defined(TOUCH_OFFSET_Y) || defined(TOUCH_ORIENTATION))
   #if defined(XPT2046_X_CALIBRATION) && defined(XPT2046_Y_CALIBRATION) && defined(XPT2046_X_OFFSET) && defined(XPT2046_Y_OFFSET)
     #define TOUCH_CALIBRATION_X  XPT2046_X_CALIBRATION
     #define TOUCH_CALIBRATION_Y  XPT2046_Y_CALIBRATION
     #define TOUCH_OFFSET_X       XPT2046_X_OFFSET
     #define TOUCH_OFFSET_Y       XPT2046_Y_OFFSET
     #define TOUCH_ORIENTATION    TOUCH_LANDSCAPE
-  #else
-    #define TOUCH_CALIBRATION_X  0
-    #define TOUCH_CALIBRATION_Y  0
-    #define TOUCH_OFFSET_X       0
-    #define TOUCH_OFFSET_Y       0
-    #define TOUCH_ORIENTATION    TOUCH_ORIENTATION_NONE
   #endif
 #endif
+
+#if MB(ANET_ET4, ANET_ET4P)
+  #define IS_ANET_ET 1
+#endif

commit 7a168205eb2463022ab1a4306bafa8152ab2d8bc
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Sat Dec 19 23:02:38 2020 -0500

    Minimum temp options for Probing and G12 Nozzle Clean (#20383)
    
    Co-authored-by: Jason Smith <jason.inet@gmail.com>
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9c080ee286..c683753600 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -812,20 +812,36 @@
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING > 0
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
+  #if ENABLED(PREHEAT_BEFORE_PROBING)
+    #ifndef PROBING_NOZZLE_TEMP
+      #define PROBING_NOZZLE_TEMP 0
+    #endif
+    #ifndef PROBING_BED_TEMP
+      #define PROBING_BED_TEMP 0
+    #endif
+  #endif
+  #if ENABLED(PREHEAT_BEFORE_LEVELING)
+    #ifndef LEVELING_NOZZLE_TEMP
+      #define LEVELING_NOZZLE_TEMP 0
+    #endif
+    #ifndef LEVELING_BED_TEMP
+      #define LEVELING_BED_TEMP 0
+    #endif
+  #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 
 #if Z_HOME_DIR > 0
   #define HOME_Z_FIRST // If homing away from BED do Z first
 #endif
 
 /**

commit 6f272e13c5ce132c0bd7fdc2401ceadad5f3b06c
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Nov 22 18:44:17 2020 -0600

    Allow Status Message without LCD (#20246)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 952ff2bbd6..9c080ee286 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -465,20 +465,24 @@
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif DISABLED(HAS_GRAPHICAL_TFT)
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
+#if EITHER(HAS_DISPLAY, GLOBAL_STATUS_MESSAGE)
+  #define HAS_STATUS_MESSAGE 1
+#endif
+
 #if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_LCD_MENU 1
 #endif
 
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
   #endif
   #ifndef LCD_PIXEL_HEIGHT
     #define LCD_PIXEL_HEIGHT 64

commit d8a3b9eb3a891258ef3ba75052b0f2ee78a167b9
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sun Nov 1 20:30:58 2020 -0600

    Move core conditionals earlier

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 42a4e037d8..952ff2bbd6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -19,30 +19,20 @@
  * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
-// Kinematics
-#if ENABLED(MORGAN_SCARA)
-  #define IS_SCARA 1
-  #define IS_KINEMATIC 1
-#elif ENABLED(DELTA)
-  #define IS_KINEMATIC 1
-#else
-  #define IS_CARTESIAN 1
-#endif
-
 // MKS_LCD12864 is a variant of MKS_MINI_12864
 #if ENABLED(MKS_LCD12864)
   #define MKS_MINI_12864
 #endif
 
 /**
  * General Flags that may be set below by specific LCDs
  *
  *  DOGLCD                : Run a Graphical LCD through U8GLib (with MarlinUI)
  *  IS_ULTIPANEL          : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
@@ -881,20 +871,69 @@
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
   #define GRID_LOOP(A,B) LOOP_L_N(A, GRID_MAX_POINTS_X) LOOP_L_N(B, GRID_MAX_POINTS_Y)
 #endif
 
 // Slim menu optimizations
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
+/**
+ * CoreXY, CoreXZ, and CoreYZ - and their reverse
+ */
+#if EITHER(COREXY, COREYX)
+  #define CORE_IS_XY 1
+#endif
+#if EITHER(COREXZ, COREZX)
+  #define CORE_IS_XZ 1
+#endif
+#if EITHER(COREYZ, COREZY)
+  #define CORE_IS_YZ 1
+#endif
+#if CORE_IS_XY || CORE_IS_XZ || CORE_IS_YZ
+  #define IS_CORE 1
+#endif
+#if IS_CORE
+  #if CORE_IS_XY
+    #define CORE_AXIS_1 A_AXIS
+    #define CORE_AXIS_2 B_AXIS
+    #define NORMAL_AXIS Z_AXIS
+  #elif CORE_IS_XZ
+    #define CORE_AXIS_1 A_AXIS
+    #define NORMAL_AXIS Y_AXIS
+    #define CORE_AXIS_2 C_AXIS
+  #elif CORE_IS_YZ
+    #define NORMAL_AXIS X_AXIS
+    #define CORE_AXIS_1 B_AXIS
+    #define CORE_AXIS_2 C_AXIS
+  #endif
+  #define CORESIGN(n) (ANY(COREYX, COREZX, COREZY) ? (-(n)) : (n))
+#elif ENABLED(MARKFORGED_XY)
+  // Markforged kinematics
+  #define CORE_AXIS_1 A_AXIS
+  #define CORE_AXIS_2 B_AXIS
+  #define NORMAL_AXIS Z_AXIS
+#endif
+
+#if ENABLED(MORGAN_SCARA)
+  #define IS_SCARA 1
+  #define IS_KINEMATIC 1
+#elif ENABLED(DELTA)
+  #define IS_KINEMATIC 1
+#else
+  #define IS_CARTESIAN 1
+  #if !IS_CORE
+    #define IS_FULL_CARTESIAN 1
+  #endif
+#endif
+
 // This flag indicates some kind of jerk storage is needed
 #if EITHER(CLASSIC_JERK, IS_KINEMATIC)
   #define HAS_CLASSIC_JERK 1
 #endif
 
 #if DISABLED(CLASSIC_JERK)
   #define HAS_JUNCTION_DEVIATION 1
 #endif
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA

commit ca83e1a26f1a386344803cf5326016a8f8335008
Author: Kurt Haenen <Misterke@users.noreply.github.com>
Date:   Sun Nov 22 00:56:56 2020 +0100

    Proper pullup/pulldown configurability (#20242)
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5fe73a9467..42a4e037d8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -701,78 +701,102 @@
  */
 #if ANY(HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
 #if ENABLED(FILAMENT_RUNOUT_SENSOR)
   #if NUM_RUNOUT_SENSORS >= 1
     #ifndef FIL_RUNOUT1_STATE
       #define FIL_RUNOUT1_STATE FIL_RUNOUT_STATE
     #endif
-    #ifndef FIL_RUNOUT1_PULL
-      #define FIL_RUNOUT1_PULL FIL_RUNOUT_PULL
+    #ifndef FIL_RUNOUT1_PULLUP
+      #define FIL_RUNOUT1_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_RUNOUT1_PULLDOWN
+      #define FIL_RUNOUT1_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
   #if NUM_RUNOUT_SENSORS >= 2
     #ifndef FIL_RUNOUT2_STATE
       #define FIL_RUNOUT2_STATE FIL_RUNOUT_STATE
     #endif
-    #ifndef FIL_RUNOUT2_PULL
-      #define FIL_RUNOUT2_PULL FIL_RUNOUT_PULL
+    #ifndef FIL_RUNOUT2_PULLUP
+      #define FIL_RUNOUT2_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_RUNOUT2_PULLDOWN
+      #define FIL_RUNOUT2_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
   #if NUM_RUNOUT_SENSORS >= 3
     #ifndef FIL_RUNOUT3_STATE
       #define FIL_RUNOUT3_STATE FIL_RUNOUT_STATE
     #endif
-    #ifndef FIL_RUNOUT3_PULL
-      #define FIL_RUNOUT3_PULL FIL_RUNOUT_PULL
+    #ifndef FIL_RUNOUT3_PULLUP
+      #define FIL_RUNOUT3_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_RUNOUT3_PULLDOWN
+      #define FIL_RUNOUT3_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
   #if NUM_RUNOUT_SENSORS >= 4
     #ifndef FIL_RUNOUT4_STATE
       #define FIL_RUNOUT4_STATE FIL_RUNOUT_STATE
     #endif
-    #ifndef FIL_RUNOUT4_PULL
-      #define FIL_RUNOUT4_PULL FIL_RUNOUT_PULL
+    #ifndef FIL_RUNOUT4_PULLUP
+      #define FIL_RUNOUT4_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_RUNOUT4_PULLDOWN
+      #define FIL_RUNOUT4_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
   #if NUM_RUNOUT_SENSORS >= 5
     #ifndef FIL_RUNOUT5_STATE
       #define FIL_RUNOUT5_STATE FIL_RUNOUT_STATE
     #endif
-    #ifndef FIL_RUNOUT5_PULL
-      #define FIL_RUNOUT5_PULL FIL_RUNOUT_PULL
+    #ifndef FIL_RUNOUT5_PULLUP
+      #define FIL_RUNOUT5_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_RUNOUT5_PULLDOWN
+      #define FIL_RUNOUT5_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
   #if NUM_RUNOUT_SENSORS >= 6
     #ifndef FIL_RUNOUT6_STATE
       #define FIL_RUNOUT6_STATE FIL_RUNOUT_STATE
     #endif
-    #ifndef FIL_RUNOUT6_PULL
-      #define FIL_RUNOUT6_PULL FIL_RUNOUT_PULL
+    #ifndef FIL_RUNOUT6_PULLUP
+      #define FIL_RUNOUT6_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_RUNOUT6_PULLDOWN
+      #define FIL_RUNOUT6_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
   #if NUM_RUNOUT_SENSORS >= 7
     #ifndef FIL_RUNOUT7_STATE
       #define FIL_RUNOUT7_STATE FIL_RUNOUT_STATE
     #endif
-    #ifndef FIL_RUNOUT7_PULL
-      #define FIL_RUNOUT7_PULL FIL_RUNOUT_PULL
+    #ifndef FIL_RUNOUT7_PULLUP
+      #define FIL_RUNOUT7_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_RUNOUT7_PULLDOWN
+      #define FIL_RUNOUT7_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
   #if NUM_RUNOUT_SENSORS >= 8
     #ifndef FIL_RUNOUT8_STATE
       #define FIL_RUNOUT8_STATE FIL_RUNOUT_STATE
     #endif
-    #ifndef FIL_RUNOUT8_PULL
-      #define FIL_RUNOUT8_PULL FIL_RUNOUT_PULL
+    #ifndef FIL_RUNOUT8_PULLUP
+      #define FIL_RUNOUT8_PULLUP FIL_RUNOUT_PULLUP
+    #endif
+    #ifndef FIL_RUNOUT8_PULLDOWN
+      #define FIL_RUNOUT8_PULLDOWN FIL_RUNOUT_PULLDOWN
     #endif
   #endif
 #endif // FILAMENT_RUNOUT_SENSOR
 
 #if EITHER(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
   #undef PROBE_MANUALLY
 #endif
 
 #if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
   #define PROBE_SELECTED 1

commit 41529b65988a58ba512977e0fe1692aaeeb6c811
Author: Giuliano Zaro <3684609+GMagician@users.noreply.github.com>
Date:   Wed Nov 18 08:27:21 2020 +0100

    SMUFF (MMU2 clone) support (#19912)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b784e12b99..5fe73a9467 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -488,39 +488,67 @@
 
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
   #endif
   #ifndef LCD_PIXEL_HEIGHT
     #define LCD_PIXEL_HEIGHT 64
   #endif
 #endif
 
+/**
+ *  Multi-Material-Unit supported models
+ */
+#define PRUSA_MMU1      1
+#define PRUSA_MMU2      2
+#define PRUSA_MMU2S     3
+#define SMUFF_EMU_MMU2  12
+#define SMUFF_EMU_MMU2S 13
+
+#ifdef MMU_MODEL
+  #define HAS_MMU 1
+  #if MMU_MODEL == PRUSA_MMU1
+    #define HAS_PRUSA_MMU1 1
+  #elif MMU_MODEL % 10 == PRUSA_MMU2
+    #define HAS_PRUSA_MMU2 1
+  #elif MMU_MODEL % 10 == PRUSA_MMU2S
+    #define HAS_PRUSA_MMU2 1
+    #define HAS_PRUSA_MMU2S 1
+  #endif
+  #if MMU_MODEL >= SMUFF_EMU_MMU2
+    #define HAS_SMUFF 1
+  #endif
+#endif
+
+#undef PRUSA_MMU1
+#undef PRUSA_MMU2
+#undef PRUSA_MMU2S
+#undef SMUFF_EMU_MMU2
+#undef SMUFF_EMU_MMU2S
+
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  */
 
 #if EXTRUDERS == 0
   #undef EXTRUDERS
   #define EXTRUDERS 0
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
-  #undef MK2_MULTIPLEXER
-  #undef PRUSA_MMU2
   #undef HOTEND_IDLE_TIMEOUT
 #elif EXTRUDERS > 1
   #define HAS_MULTI_EXTRUDER 1
 #endif
 
 #if ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
@@ -532,31 +560,31 @@
   #endif
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
   #if MIXING_STEPPERS == 2
     #define HAS_DUAL_MIXING 1
   #endif
 #elif ENABLED(SWITCHING_TOOLHEAD)
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
-#elif ENABLED(PRUSA_MMU2)
+#elif HAS_PRUSA_MMU2
   #define E_STEPPERS 1
 #endif
 
-// No inactive extruders with MK2_MULTIPLEXER or SWITCHING_NOZZLE
-#if EITHER(MK2_MULTIPLEXER, SWITCHING_NOZZLE)
+// No inactive extruders with SWITCHING_NOZZLE or Pr≈Ø≈°a MMU1
+#if ENABLED(SWITCHING_NOZZLE) || HAS_PRUSA_MMU1
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
-// Pr≈Ø≈°a MK2 Multiplexer and MMU 2.0 force SINGLENOZZLE
-#if EITHER(MK2_MULTIPLEXER, PRUSA_MMU2)
+// Pr≈Ø≈°a MMU1, MMU 2.0, MMUS 2.0 and SMUFF force SINGLENOZZLE
+#if HAS_MMU
   #define SINGLENOZZLE
 #endif
 
 #if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
   #define HOTENDS       1
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #endif
 

commit ea371618da71dc43e6aee95a8e479c8797867e04
Author: Victor Oliveira <rhapsodyv@gmail.com>
Date:   Sun Nov 15 19:39:58 2020 -0300

    Add Touch Calibration screen (#20049)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0bb98e9e06..b784e12b99 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1066,15 +1066,31 @@
   #define HAS_UI_320x240 1
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN) && !HAS_GRAPHICAL_TFT
   #undef TOUCH_SCREEN
-  #undef TOUCH_SCREEN_CALIBRATION
   #if !HAS_TFT_LVGL_UI
-    #define HAS_TOUCH_XPT2046 1
+    #define HAS_TOUCH_BUTTONS 1
+  #endif
+#endif
+
+// XPT2046_** Compatibility
+#if !(defined(TOUCH_CALIBRATION_X) || defined(TOUCH_CALIBRATION_Y) || defined(TOUCH_OFFSET_X) || defined(TOUCH_OFFSET_Y) || defined(TOUCH_ORIENTATION))
+  #if defined(XPT2046_X_CALIBRATION) && defined(XPT2046_Y_CALIBRATION) && defined(XPT2046_X_OFFSET) && defined(XPT2046_Y_OFFSET)
+    #define TOUCH_CALIBRATION_X  XPT2046_X_CALIBRATION
+    #define TOUCH_CALIBRATION_Y  XPT2046_Y_CALIBRATION
+    #define TOUCH_OFFSET_X       XPT2046_X_OFFSET
+    #define TOUCH_OFFSET_Y       XPT2046_Y_OFFSET
+    #define TOUCH_ORIENTATION    TOUCH_LANDSCAPE
+  #else
+    #define TOUCH_CALIBRATION_X  0
+    #define TOUCH_CALIBRATION_Y  0
+    #define TOUCH_OFFSET_X       0
+    #define TOUCH_OFFSET_Y       0
+    #define TOUCH_ORIENTATION    TOUCH_ORIENTATION_NONE
   #endif
 #endif

commit 2282801172abdbce0b26b993d8d3be9ab4ae3649
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Nov 11 16:58:34 2020 -0600

    Add HOME_Z_FIRST option (#20113)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 865365c0ee..0bb98e9e06 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -771,20 +771,24 @@
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 
+#if Z_HOME_DIR > 0
+  #define HOME_Z_FIRST // If homing away from BED do Z first
+#endif
+
 /**
  * Set granular options based on the specific type of leveling
  */
 #if ENABLED(AUTO_BED_LEVELING_UBL)
   #undef LCD_BED_LEVELING
   #if ENABLED(DELTA)
     #define UBL_SEGMENTED 1
   #endif
 #endif
 #if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_3POINT)

commit 0465e0ae3aaec257618d095f7e2b28ef677dbe4a
Author: Costas Basdekis <costas.basdekis@gmail.com>
Date:   Wed Nov 11 06:39:23 2020 +0000

    Distinct runout states (#19965)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 98aa4afb8c..865365c0ee 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -668,20 +668,87 @@
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
  * Set flags for enabled probes
  */
 #if ANY(HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
+#if ENABLED(FILAMENT_RUNOUT_SENSOR)
+  #if NUM_RUNOUT_SENSORS >= 1
+    #ifndef FIL_RUNOUT1_STATE
+      #define FIL_RUNOUT1_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_RUNOUT1_PULL
+      #define FIL_RUNOUT1_PULL FIL_RUNOUT_PULL
+    #endif
+  #endif
+  #if NUM_RUNOUT_SENSORS >= 2
+    #ifndef FIL_RUNOUT2_STATE
+      #define FIL_RUNOUT2_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_RUNOUT2_PULL
+      #define FIL_RUNOUT2_PULL FIL_RUNOUT_PULL
+    #endif
+  #endif
+  #if NUM_RUNOUT_SENSORS >= 3
+    #ifndef FIL_RUNOUT3_STATE
+      #define FIL_RUNOUT3_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_RUNOUT3_PULL
+      #define FIL_RUNOUT3_PULL FIL_RUNOUT_PULL
+    #endif
+  #endif
+  #if NUM_RUNOUT_SENSORS >= 4
+    #ifndef FIL_RUNOUT4_STATE
+      #define FIL_RUNOUT4_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_RUNOUT4_PULL
+      #define FIL_RUNOUT4_PULL FIL_RUNOUT_PULL
+    #endif
+  #endif
+  #if NUM_RUNOUT_SENSORS >= 5
+    #ifndef FIL_RUNOUT5_STATE
+      #define FIL_RUNOUT5_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_RUNOUT5_PULL
+      #define FIL_RUNOUT5_PULL FIL_RUNOUT_PULL
+    #endif
+  #endif
+  #if NUM_RUNOUT_SENSORS >= 6
+    #ifndef FIL_RUNOUT6_STATE
+      #define FIL_RUNOUT6_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_RUNOUT6_PULL
+      #define FIL_RUNOUT6_PULL FIL_RUNOUT_PULL
+    #endif
+  #endif
+  #if NUM_RUNOUT_SENSORS >= 7
+    #ifndef FIL_RUNOUT7_STATE
+      #define FIL_RUNOUT7_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_RUNOUT7_PULL
+      #define FIL_RUNOUT7_PULL FIL_RUNOUT_PULL
+    #endif
+  #endif
+  #if NUM_RUNOUT_SENSORS >= 8
+    #ifndef FIL_RUNOUT8_STATE
+      #define FIL_RUNOUT8_STATE FIL_RUNOUT_STATE
+    #endif
+    #ifndef FIL_RUNOUT8_PULL
+      #define FIL_RUNOUT8_PULL FIL_RUNOUT_PULL
+    #endif
+  #endif
+#endif // FILAMENT_RUNOUT_SENSOR
+
 #if EITHER(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
   #undef PROBE_MANUALLY
 #endif
 
 #if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
   #define PROBE_SELECTED 1
 #endif
 
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)

commit 10fd9ed896bc2eebc4f4d81e02d7f7502e207039
Author: Darren Horrocks <killallthehumans@gmail.com>
Date:   Sat Nov 7 08:42:14 2020 +0000

    Anet 1.0 alternative graphical LCD wiring (#20022)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a2ac480f2a..98aa4afb8c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -228,21 +228,21 @@
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define IS_RRD_FG_SC 1
   #define BOARD_ST7920_DELAY_1 DELAY_NS(125)
   #define BOARD_ST7920_DELAY_2 DELAY_NS(125)
   #define BOARD_ST7920_DELAY_3 DELAY_NS(125)
 
-#elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, ANET_FULL_GRAPHICS_LCD, BQ_LCD_SMART_CONTROLLER)
+#elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, ANET_FULL_GRAPHICS_LCD, ANET_FULL_GRAPHICS_LCD_ALT_WIRING, BQ_LCD_SMART_CONTROLLER)
 
   #define IS_RRD_FG_SC 1
 
 #elif ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
 
   // RepRapDiscount LCD or Graphical LCD with rotary click encoder
   #define IS_RRD_SC 1
 
 #endif
 

commit 1f6612dfc411d777c1e12df153b6f35703e54213
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Nov 5 17:16:27 2020 -0600

    Comment, spacing cleanup

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 6f632aa569..a2ac480f2a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -668,20 +668,24 @@
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
  * Set flags for enabled probes
  */
 #if ANY(HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
+#if EITHER(MESH_BED_LEVELING, AUTO_BED_LEVELING_UBL)
+  #undef PROBE_MANUALLY
+#endif
+
 #if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
   #define PROBE_SELECTED 1
 #endif
 
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #define HAS_CUSTOM_PROBE_PIN 1
@@ -740,20 +744,21 @@
 #if EITHER(HAS_ABL_OR_UBL, MESH_BED_LEVELING)
   #define HAS_LEVELING 1
   #if DISABLED(AUTO_BED_LEVELING_UBL)
     #define PLANNER_LEVELING 1
   #endif
 #endif
 #if EITHER(HAS_ABL_OR_UBL, Z_MIN_PROBE_REPEATABILITY_TEST)
   #define HAS_PROBING_PROCEDURE 1
 #endif
 #if !HAS_LEVELING
+  #undef PROBE_MANUALLY
   #undef RESTORE_LEVELING_AFTER_G28
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
   #define GRID_LOOP(A,B) LOOP_L_N(A, GRID_MAX_POINTS_X) LOOP_L_N(B, GRID_MAX_POINTS_Y)
 #endif
 
 // Slim menu optimizations
 #if ENABLED(SLIM_LCD_MENUS)

commit 072f996af70b5ac635893eca2d4bd4bbb4f00acc
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Oct 21 12:45:27 2020 -0500

    General cleanup, mostly MKS UI (#19825)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b22c608658..6f632aa569 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -334,21 +334,21 @@
 
 // FSMC/SPI TFT Panels
 #if ENABLED(TFT_CLASSIC_UI)
   #define TFT_SCALED_DOGLCD 1
 #endif
 
 #if TFT_SCALED_DOGLCD
   #define DOGLCD
   #define IS_ULTIPANEL 1
   #define DELAYED_BACKLIGHT_INIT
-#elif ENABLED(TFT_LVGL_UI)
+#elif HAS_TFT_LVGL_UI
   #define DELAYED_BACKLIGHT_INIT
 #endif
 
 // Color UI
 #if ENABLED(TFT_COLOR_UI)
   #define HAS_GRAPHICAL_TFT 1
   #define IS_ULTIPANEL 1
 #endif
 
 /**
@@ -950,30 +950,30 @@
   #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(TFT_RES_480x320)
   #define TFT_WIDTH  480
   #define TFT_HEIGHT 320
   #define GRAPHICAL_TFT_UPSCALE 3
 #endif
 
 // FSMC/SPI TFT Panels using standard HAL/tft/tft_(fsmc|spi).h
 #if ENABLED(TFT_INTERFACE_FSMC)
   #define HAS_FSMC_TFT 1
-  #if ENABLED(TFT_CLASSIC_UI)
+  #if TFT_SCALED_DOGLCD
     #define HAS_FSMC_GRAPHICAL_TFT 1
-  #elif ENABLED(TFT_LVGL_UI)
+  #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_FSMC 1
   #endif
 #elif ENABLED(TFT_INTERFACE_SPI)
   #define HAS_SPI_TFT 1
-  #if ENABLED(TFT_CLASSIC_UI)
+  #if TFT_SCALED_DOGLCD
     #define HAS_SPI_GRAPHICAL_TFT 1
-  #elif ENABLED(TFT_LVGL_UI)
+  #elif HAS_TFT_LVGL_UI
     #define HAS_TFT_LVGL_UI_SPI 1
   #endif
 #endif
 
 #if ENABLED(TFT_COLOR_UI) && TFT_HEIGHT == 240
   #if ENABLED(TFT_INTERFACE_SPI)
     #define TFT_320x240_SPI
   #elif ENABLED(TFT_INTERFACE_FSMC)
     #define TFT_320x240
   #endif

commit 69d55cabd483c93ab5421bf98e9bec2b597a00f3
Author: ellensp <ellensp@hotmail.com>
Date:   Wed Oct 21 09:01:46 2020 +1300

    Handle dependent Stepper Driver defaults later (#19820)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d4cae0b64c..b22c608658 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -774,91 +774,81 @@
   #define HAS_CLASSIC_E_JERK 1
 #endif
 
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1
   #define HAS_USB_SERIAL 1
 #endif
 #if SERIAL_PORT_2 == -2
   #define HAS_ETHERNET 1
 #endif
 
-// Fallback Stepper Driver types
+// Fallback Stepper Driver types that don't depend on Configuration_adv.h
 #ifndef X_DRIVER_TYPE
-  #define X_DRIVER_TYPE A4988
+  #define X_DRIVER_TYPE  A4988
 #endif
-#ifndef Y_DRIVER_TYPE
-  #define Y_DRIVER_TYPE A4988
-#endif
-#ifndef Z_DRIVER_TYPE
-  #define Z_DRIVER_TYPE A4988
-#endif
-#if NONE(DUAL_X_CARRIAGE, X_DUAL_STEPPER_DRIVERS)
-  #undef X2_DRIVER_TYPE
-#elif !defined(X2_DRIVER_TYPE)
+#ifndef X2_DRIVER_TYPE
   #define X2_DRIVER_TYPE A4988
 #endif
-#if DISABLED(Y_DUAL_STEPPER_DRIVERS)
-  #undef Y2_DRIVER_TYPE
-#elif !defined(Y2_DRIVER_TYPE)
+#ifndef Y_DRIVER_TYPE
+  #define Y_DRIVER_TYPE  A4988
+#endif
+#ifndef Y2_DRIVER_TYPE
   #define Y2_DRIVER_TYPE A4988
 #endif
-#if NUM_Z_STEPPER_DRIVERS < 2
-  #undef Z2_DRIVER_TYPE
-#elif !defined(Z2_DRIVER_TYPE)
+#ifndef Z_DRIVER_TYPE
+  #define Z_DRIVER_TYPE  A4988
+#endif
+#ifndef Z2_DRIVER_TYPE
   #define Z2_DRIVER_TYPE A4988
 #endif
-#if NUM_Z_STEPPER_DRIVERS < 3
-  #undef Z3_DRIVER_TYPE
-#elif !defined(Z3_DRIVER_TYPE)
+#ifndef Z3_DRIVER_TYPE
   #define Z3_DRIVER_TYPE A4988
 #endif
-#if NUM_Z_STEPPER_DRIVERS < 4
-  #undef Z4_DRIVER_TYPE
-#elif !defined(Z4_DRIVER_TYPE)
+#ifndef Z4_DRIVER_TYPE
   #define Z4_DRIVER_TYPE A4988
 #endif
-#if E_STEPPERS < 1
+#if E_STEPPERS <= 0
   #undef E0_DRIVER_TYPE
 #elif !defined(E0_DRIVER_TYPE)
   #define E0_DRIVER_TYPE A4988
 #endif
-#if E_STEPPERS < 2
+#if E_STEPPERS <= 1
   #undef E1_DRIVER_TYPE
 #elif !defined(E1_DRIVER_TYPE)
   #define E1_DRIVER_TYPE A4988
 #endif
-#if E_STEPPERS < 3
+#if E_STEPPERS <= 2
   #undef E2_DRIVER_TYPE
 #elif !defined(E2_DRIVER_TYPE)
   #define E2_DRIVER_TYPE A4988
 #endif
-#if E_STEPPERS < 4
+#if E_STEPPERS <= 3
   #undef E3_DRIVER_TYPE
 #elif !defined(E3_DRIVER_TYPE)
   #define E3_DRIVER_TYPE A4988
 #endif
-#if E_STEPPERS < 5
+#if E_STEPPERS <= 4
   #undef E4_DRIVER_TYPE
 #elif !defined(E4_DRIVER_TYPE)
   #define E4_DRIVER_TYPE A4988
 #endif
-#if E_STEPPERS < 6
+#if E_STEPPERS <= 5
   #undef E5_DRIVER_TYPE
 #elif !defined(E5_DRIVER_TYPE)
   #define E5_DRIVER_TYPE A4988
 #endif
-#if E_STEPPERS < 7
+#if E_STEPPERS <= 6
   #undef E6_DRIVER_TYPE
 #elif !defined(E6_DRIVER_TYPE)
   #define E6_DRIVER_TYPE A4988
 #endif
-#if E_STEPPERS < 8
+#if E_STEPPERS <= 7
   #undef E7_DRIVER_TYPE
 #elif !defined(E7_DRIVER_TYPE)
   #define E7_DRIVER_TYPE A4988
 #endif
 
 // Fallback axis inverting
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif
 #ifndef INVERT_Y_DIR

commit 9baa944460e0bf5f15e46a501b64ebd39a9d5f34
Author: bilsef <bilsef1@gmail.com>
Date:   Tue Oct 20 12:35:29 2020 -0700

    Teensy 4.1 Ethernet support (#19801)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f909112507..d4cae0b64c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -770,20 +770,23 @@
 #endif
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
 #if ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE))
   #define HAS_CLASSIC_E_JERK 1
 #endif
 
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1
   #define HAS_USB_SERIAL 1
 #endif
+#if SERIAL_PORT_2 == -2
+  #define HAS_ETHERNET 1
+#endif
 
 // Fallback Stepper Driver types
 #ifndef X_DRIVER_TYPE
   #define X_DRIVER_TYPE A4988
 #endif
 #ifndef Y_DRIVER_TYPE
   #define Y_DRIVER_TYPE A4988
 #endif
 #ifndef Z_DRIVER_TYPE
   #define Z_DRIVER_TYPE A4988

commit ea80b2c8fc4209160eed377437610c298312e97f
Author: ellensp <ellensp@hotmail.com>
Date:   Mon Oct 19 21:16:02 2020 +1300

    Ensure A4988 for unspecified driver type (#19798)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index cbc75cfb6d..f909112507 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -748,59 +748,138 @@
 #endif
 #if !HAS_LEVELING
   #undef RESTORE_LEVELING_AFTER_G28
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
   #define GRID_LOOP(A,B) LOOP_L_N(A, GRID_MAX_POINTS_X) LOOP_L_N(B, GRID_MAX_POINTS_Y)
 #endif
 
-#ifndef INVERT_X_DIR
-  #define INVERT_X_DIR false
-#endif
-#ifndef INVERT_Y_DIR
-  #define INVERT_Y_DIR false
-#endif
-#ifndef INVERT_Z_DIR
-  #define INVERT_Z_DIR false
-#endif
-#ifndef INVERT_E_DIR
-  #define INVERT_E_DIR false
-#endif
-
+// Slim menu optimizations
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 // This flag indicates some kind of jerk storage is needed
 #if EITHER(CLASSIC_JERK, IS_KINEMATIC)
   #define HAS_CLASSIC_JERK 1
 #endif
 
 #if DISABLED(CLASSIC_JERK)
   #define HAS_JUNCTION_DEVIATION 1
 #endif
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
 #if ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE))
   #define HAS_CLASSIC_E_JERK 1
 #endif
 
-#ifndef SPI_SPEED
-  #define SPI_SPEED SPI_FULL_SPEED
-#endif
-
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1
   #define HAS_USB_SERIAL 1
 #endif
 
+// Fallback Stepper Driver types
+#ifndef X_DRIVER_TYPE
+  #define X_DRIVER_TYPE A4988
+#endif
+#ifndef Y_DRIVER_TYPE
+  #define Y_DRIVER_TYPE A4988
+#endif
+#ifndef Z_DRIVER_TYPE
+  #define Z_DRIVER_TYPE A4988
+#endif
+#if NONE(DUAL_X_CARRIAGE, X_DUAL_STEPPER_DRIVERS)
+  #undef X2_DRIVER_TYPE
+#elif !defined(X2_DRIVER_TYPE)
+  #define X2_DRIVER_TYPE A4988
+#endif
+#if DISABLED(Y_DUAL_STEPPER_DRIVERS)
+  #undef Y2_DRIVER_TYPE
+#elif !defined(Y2_DRIVER_TYPE)
+  #define Y2_DRIVER_TYPE A4988
+#endif
+#if NUM_Z_STEPPER_DRIVERS < 2
+  #undef Z2_DRIVER_TYPE
+#elif !defined(Z2_DRIVER_TYPE)
+  #define Z2_DRIVER_TYPE A4988
+#endif
+#if NUM_Z_STEPPER_DRIVERS < 3
+  #undef Z3_DRIVER_TYPE
+#elif !defined(Z3_DRIVER_TYPE)
+  #define Z3_DRIVER_TYPE A4988
+#endif
+#if NUM_Z_STEPPER_DRIVERS < 4
+  #undef Z4_DRIVER_TYPE
+#elif !defined(Z4_DRIVER_TYPE)
+  #define Z4_DRIVER_TYPE A4988
+#endif
+#if E_STEPPERS < 1
+  #undef E0_DRIVER_TYPE
+#elif !defined(E0_DRIVER_TYPE)
+  #define E0_DRIVER_TYPE A4988
+#endif
+#if E_STEPPERS < 2
+  #undef E1_DRIVER_TYPE
+#elif !defined(E1_DRIVER_TYPE)
+  #define E1_DRIVER_TYPE A4988
+#endif
+#if E_STEPPERS < 3
+  #undef E2_DRIVER_TYPE
+#elif !defined(E2_DRIVER_TYPE)
+  #define E2_DRIVER_TYPE A4988
+#endif
+#if E_STEPPERS < 4
+  #undef E3_DRIVER_TYPE
+#elif !defined(E3_DRIVER_TYPE)
+  #define E3_DRIVER_TYPE A4988
+#endif
+#if E_STEPPERS < 5
+  #undef E4_DRIVER_TYPE
+#elif !defined(E4_DRIVER_TYPE)
+  #define E4_DRIVER_TYPE A4988
+#endif
+#if E_STEPPERS < 6
+  #undef E5_DRIVER_TYPE
+#elif !defined(E5_DRIVER_TYPE)
+  #define E5_DRIVER_TYPE A4988
+#endif
+#if E_STEPPERS < 7
+  #undef E6_DRIVER_TYPE
+#elif !defined(E6_DRIVER_TYPE)
+  #define E6_DRIVER_TYPE A4988
+#endif
+#if E_STEPPERS < 8
+  #undef E7_DRIVER_TYPE
+#elif !defined(E7_DRIVER_TYPE)
+  #define E7_DRIVER_TYPE A4988
+#endif
+
+// Fallback axis inverting
+#ifndef INVERT_X_DIR
+  #define INVERT_X_DIR false
+#endif
+#ifndef INVERT_Y_DIR
+  #define INVERT_Y_DIR false
+#endif
+#ifndef INVERT_Z_DIR
+  #define INVERT_Z_DIR false
+#endif
+#ifndef INVERT_E_DIR
+  #define INVERT_E_DIR false
+#endif
+
+// Fallback SPI Speed
+#ifndef SPI_SPEED
+  #define SPI_SPEED SPI_FULL_SPEED
+#endif
+
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
 
 /**
  * TFT Displays

commit 8a885dc61b8ded0a02f003915e8883eda3b22f7a
Author: Victor Oliveira <rhapsodyv@gmail.com>
Date:   Thu Oct 15 20:38:27 2020 -0300

    Fix TOUCH_SCREEN + TFT_LVGL_UI compile (#19754)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 4eeb0e8a44..cbc75cfb6d 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -919,12 +919,14 @@
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #endif
 
 // This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
 #if ENABLED(TOUCH_SCREEN) && !HAS_GRAPHICAL_TFT
   #undef TOUCH_SCREEN
   #undef TOUCH_SCREEN_CALIBRATION
-  #define HAS_TOUCH_XPT2046 1
+  #if !HAS_TFT_LVGL_UI
+    #define HAS_TOUCH_XPT2046 1
+  #endif
 #endif

commit f6ffbe548c81abfeecc996c8f2bffd27cabe0014
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Oct 15 03:00:27 2020 -0500

    TFT Presets, Generic options, Sanity checks (#19723)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 56ce2ca5ed..4eeb0e8a44 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -39,131 +39,119 @@
 // MKS_LCD12864 is a variant of MKS_MINI_12864
 #if ENABLED(MKS_LCD12864)
   #define MKS_MINI_12864
 #endif
 
 /**
  * General Flags that may be set below by specific LCDs
  *
  *  DOGLCD                : Run a Graphical LCD through U8GLib (with MarlinUI)
  *  IS_ULTIPANEL          : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
- *  IS_ULTRA_LCD          : Ultra LCD, not necessarily Ultipanel. Used most often with NEWPANEL.
+ *  IS_ULTRA_LCD          : Ultra LCD, not necessarily Ultipanel.
  *  IS_RRD_SC             : Common RRD Smart Controller digital interface pins
  *  IS_RRD_FG_SC          : Common RRD Full Graphical Smart Controller digital interface pins
  *  U8GLIB_ST7920         : Most common DOGM display SPI interface, supporting a "lightweight" display mode.
  *  U8GLIB_SH1106         : SH1106 OLED with I2C interface via U8GLib
  *  IS_U8GLIB_SSD1306     : SSD1306 OLED with I2C interface via U8GLib
  *  U8GLIB_SSD1309        : SSD1309 OLED with I2C interface via U8GLib
  *  U8GLIB_ST7565_64128N  : ST7565 128x64 LCD with SPI interface via U8GLib
  *  U8GLIB_LM6059_AF      : LM6059 with Hardware SPI via U8GLib
  */
 #if EITHER(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
 
   #define MINIPANEL
 
 #elif ENABLED(CARTESIO_UI)
 
   #define DOGLCD
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 
 #elif EITHER(DWIN_MARLINUI_PORTRAIT, DWIN_MARLINUI_LANDSCAPE)
 
   #define IS_DWIN_MARLINUI 1
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 
 #elif ENABLED(ZONESTAR_LCD)
 
-  #define ADC_KEYPAD
-  #define IS_RRW_KEYPAD
+  #define HAS_ADC_BUTTONS 1
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 
-  // This helps to implement ADC_KEYPAD menus
+  // This helps to implement HAS_ADC_BUTTONS menus
   #define REVERSE_MENU_DIRECTION
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
 
 #elif ENABLED(ZONESTAR_12864LCD)
   #define DOGLCD
-  #define IS_RRD_SC
+  #define IS_RRD_SC 1
   #define U8GLIB_ST7920
 
 #elif ENABLED(ZONESTAR_12864OLED)
-  #define IS_RRD_SC
+  #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
 #elif ENABLED(ZONESTAR_12864OLED_SSD1306)
-  #define IS_RRD_SC
+  #define IS_RRD_SC 1
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(RADDS_DISPLAY)
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
   #define ENCODER_PULSES_PER_STEP 2
 
-#elif EITHER(ANET_FULL_GRAPHICS_LCD, BQ_LCD_SMART_CONTROLLER)
-
-  #define IS_RRD_FG_SC
-
 #elif ANY(miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
 
   #define DOGLCD
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 
   #if ENABLED(miniVIKI)
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(VIKI2)
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
     #define U8GLIB_LM6059_AF
   #elif ENABLED(AZSMZ_12864)
     #define U8GLIB_ST7565_64128N
   #endif
 
 #elif ENABLED(OLED_PANEL_TINYBOY2)
 
   #define IS_U8GLIB_SSD1306
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 
 #elif ENABLED(RA_CONTROL_PANEL)
 
   #define LCD_I2C_TYPE_PCA8574
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 
 #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
   #define DOGLCD
   #define U8GLIB_ST7920
-  #define IS_ULTIPANEL
-
-#elif ENABLED(CR10_STOCKDISPLAY)
-
-  #define IS_RRD_FG_SC
-  #define BOARD_ST7920_DELAY_1 DELAY_NS(125)
-  #define BOARD_ST7920_DELAY_2 DELAY_NS(125)
-  #define BOARD_ST7920_DELAY_3 DELAY_NS(125)
+  #define IS_ULTIPANEL 1
 
 #elif ENABLED(MKS_12864OLED)
 
-  #define IS_RRD_SC
+  #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
-  #define IS_RRD_SC
+  #define IS_RRD_SC 1
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(FYSETC_242_OLED_12864)
 
-  #define IS_RRD_SC
+  #define IS_RRD_SC 1
   #define U8GLIB_SH1106
 
   #define LED_CONTROL_MENU
   #define NEOPIXEL_LED
   #undef NEOPIXEL_TYPE
   #define NEOPIXEL_TYPE       NEO_RGB
   #if NEOPIXEL_PIXELS < 3
     #undef NEOPIXELS_PIXELS
     #define NEOPIXEL_PIXELS     3
   #endif
@@ -172,21 +160,21 @@
   #endif
 
   #if ENABLED(PSU_CONTROL)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1, FYSETC_GENERIC_12864_1_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
   #define LED_COLORS_REDUCE_GREEN
   #if ENABLED(PSU_CONTROL) && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
     #define LED_CONTROL_MENU
@@ -198,175 +186,176 @@
       #define NEOPIXEL_PIXELS     3
     #endif
     #ifndef NEOPIXEL_BRIGHTNESS
       #define NEOPIXEL_BRIGHTNESS 127
     #endif
     //#define NEOPIXEL_STARTUP_TEST
   #endif
 
 #elif ENABLED(ULTI_CONTROLLER)
 
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
   #define U8GLIB_SSD1309
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
   #define ENCODER_PULSES_PER_STEP 2
   #define ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
-  #define IS_RRD_SC
+  #define IS_RRD_SC 1
   #define LCD_WIDTH 16
   #define LCD_HEIGHT 2
 
 #elif EITHER(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
 
   #define IS_TFTGLCD_PANEL 1
-  #define IS_ULTIPANEL                      // Note that IS_ULTIPANEL leads to HAS_WIRED_LCD
+  #define IS_ULTIPANEL 1                    // Note that IS_ULTIPANEL leads to HAS_WIRED_LCD
 
   #if ENABLED(SDSUPPORT) && DISABLED(LCD_PROGRESS_BAR)
     #define LCD_PROGRESS_BAR
   #endif
   #if ENABLED(TFTGLCD_PANEL_I2C)
     #define LCD_I2C_ADDRESS           0x27  // Must be equal to panel's I2C slave addres
   #endif
   #define LCD_USE_I2C_BUZZER                // Enable buzzer on LCD, used for both I2C and SPI buses (LiquidTWI2 not required)
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #define LCD_WIDTH                   20    // 20 or 24 chars in line
   #define LCD_HEIGHT                  10    // Character lines
   #define LCD_CONTRAST_MIN            127
   #define LCD_CONTRAST_MAX            255
   #define DEFAULT_LCD_CONTRAST        250
   #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
+
+#elif ENABLED(CR10_STOCKDISPLAY)
+
+  #define IS_RRD_FG_SC 1
+  #define BOARD_ST7920_DELAY_1 DELAY_NS(125)
+  #define BOARD_ST7920_DELAY_2 DELAY_NS(125)
+  #define BOARD_ST7920_DELAY_3 DELAY_NS(125)
+
+#elif ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, ANET_FULL_GRAPHICS_LCD, BQ_LCD_SMART_CONTROLLER)
+
+  #define IS_RRD_FG_SC 1
+
+#elif ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
+
+  // RepRapDiscount LCD or Graphical LCD with rotary click encoder
+  #define IS_RRD_SC 1
+
 #endif
 
-#if ENABLED(IS_RRD_FG_SC)
-  #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+// ST7920-based graphical displays
+#if ANY(IS_RRD_FG_SC, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
+  #define DOGLCD
+  #define U8GLIB_ST7920
+  #define IS_RRD_SC 1
 #endif
 
+// ST7565 / 64128N graphical displays
 #if EITHER(MAKRPANEL, MINIPANEL)
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
   #define DOGLCD
   #if ENABLED(MAKRPANEL)
     #define U8GLIB_ST7565_64128N
   #endif
 #endif
 
 #if ENABLED(IS_U8GLIB_SSD1306)
   #define U8GLIB_SSD1306
 #endif
 
 #if ENABLED(OVERLORD_OLED)
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
   #define U8GLIB_SH1106
   /**
    * PCA9632 for buzzer and LEDs via i2c
    * No auto-inc, red and green leds switched, buzzer
    */
   #define PCA9632
   #define PCA9632_NO_AUTO_INC
   #define PCA9632_GRN         0x00
   #define PCA9632_RED         0x02
   #define PCA9632_BUZZER
   #define PCA9632_BUZZER_DATA { 0x09, 0x02 }
 
   #define ENCODER_PULSES_PER_STEP     1 // Overlord uses buttons
   #define ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 
 // 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
 #if ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
   #define HAS_U8GLIB_I2C_OLED 1
-#endif
-#if HAS_U8GLIB_I2C_OLED
-  #define IS_ULTRA_LCD
+  #define IS_ULTRA_LCD 1
   #define DOGLCD
 #endif
 
-// ST7920-based graphical displays
-#if ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
-  #define DOGLCD
-  #define U8GLIB_ST7920
-  #define IS_RRD_SC
-#endif
-
-// RepRapDiscount LCD or Graphical LCD with rotary click encoder
-#if ENABLED(IS_RRD_SC)
-  #define REPRAP_DISCOUNT_SMART_CONTROLLER
-#endif
-
 /**
  * SPI Ultipanels
  */
 
 // Basic Ultipanel-like displays
-#if ANY(ULTIMAKERCONTROLLER, REPRAP_DISCOUNT_SMART_CONTROLLER, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
-  #define IS_ULTIPANEL
+#if ANY(ULTIMAKERCONTROLLER, IS_RRD_SC, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
+  #define IS_ULTIPANEL 1
 #endif
 
 // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
 #if ENABLED(U8GLIB_SH1106_EINSTART)
   #define DOGLCD
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 #endif
 
-// Compatibility
-#if ENABLED(FSMC_GRAPHICAL_TFT)
-  #define TFT_CLASSIC_UI
-  #define TFT_INTERFACE_FSMC
-  #define TFT_GENERIC
-#elif ENABLED(SPI_GRAPHICAL_TFT)
-  #define TFT_CLASSIC_UI
-  #define TFT_INTERFACE_SPI
+// TFT Compatibility
+#if ANY(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
+  #define IS_LEGACY_TFT 1
   #define TFT_GENERIC
-#elif EITHER(TFT_320x240, TFT_480x320)
-  #define TFT_COLOR_UI
+  #warning "Don't forget to update your TFT settings in Configuration.h."
+#endif
+
+#if ANY(FSMC_GRAPHICAL_TFT, TFT_320x240, TFT_480x320, TFT_LVGL_UI_FSMC)
   #define TFT_INTERFACE_FSMC
-  #define TFT_GENERIC
-#elif EITHER(TFT_320x240_SPI, TFT_480x320_SPI)
-  #define TFT_COLOR_UI
+#elif ANY(SPI_GRAPHICAL_TFT, TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_SPI)
   #define TFT_INTERFACE_SPI
-  #define TFT_GENERIC
-#elif ENABLED(TFT_LVGL_UI_FSMC)
-  #define TFT_LVGL_UI
-  #define TFT_INTERFACE_FSMC
-  #define TFT_GENERIC
-#elif ENABLED(TFT_LVGL_UI_SPI)
+#endif
+
+#if EITHER(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
+  #define TFT_CLASSIC_UI
+#elif ANY(TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI)
+  #define TFT_COLOR_UI
+#elif EITHER(TFT_LVGL_UI_FSMC, TFT_LVGL_UI_SPI)
   #define TFT_LVGL_UI
-  #define TFT_INTERFACE_SPI
-  #define TFT_GENERIC
 #endif
 
 // FSMC/SPI TFT Panels (LVGL)
 #if ENABLED(TFT_LVGL_UI)
   #define HAS_TFT_LVGL_UI 1
 #endif
 
 // FSMC/SPI TFT Panels
 #if ENABLED(TFT_CLASSIC_UI)
   #define TFT_SCALED_DOGLCD 1
 #endif
 
 #if TFT_SCALED_DOGLCD
   #define DOGLCD
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
   #define DELAYED_BACKLIGHT_INIT
 #elif ENABLED(TFT_LVGL_UI)
   #define DELAYED_BACKLIGHT_INIT
 #endif
 
 // Color UI
 #if ENABLED(TFT_COLOR_UI)
   #define HAS_GRAPHICAL_TFT 1
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 #endif
 
 /**
  * I2C Panels
  */
 
 #if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
@@ -376,48 +365,48 @@
     #define LCD_HEIGHT 4
   #endif
 
 #elif ENABLED(LCD_I2C_PANELOLU2)
 
   // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
 
   #define LCD_I2C_TYPE_MCP23017
   #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
   #define LCD_USE_I2C_BUZZER   // Enable buzzer on LCD (optional)
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 
 #elif ENABLED(LCD_I2C_VIKI)
 
   /**
    * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
    *
    * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
    * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
    * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
    *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
    */
   #define LCD_I2C_TYPE_MCP23017
   #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
   #define LCD_USE_I2C_BUZZER   // Enable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 
   #define ENCODER_FEEDRATE_DEADZONE 4
 
   #define STD_ENCODER_PULSES_PER_STEP 1
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(G3D_PANEL)
 
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
-#elif ANY(REPRAP_DISCOUNT_SMART_CONTROLLER, miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, OLED_PANEL_TINYBOY2, BQ_LCD_SMART_CONTROLLER, LCD_I2C_PANELOLU2)
+#elif ANY(IS_RRD_SC, miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, OLED_PANEL_TINYBOY2, BQ_LCD_SMART_CONTROLLER, LCD_I2C_PANELOLU2)
 
   #define STD_ENCODER_PULSES_PER_STEP 4
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #endif
 
 #ifndef STD_ENCODER_PULSES_PER_STEP
   #if ENABLED(TOUCH_SCREEN)
     #define STD_ENCODER_PULSES_PER_STEP 2
   #else
@@ -436,82 +425,73 @@
 #ifndef ENCODER_FEEDRATE_DEADZONE
   #define ENCODER_FEEDRATE_DEADZONE 6
 #endif
 
 // Shift register panels
 // ---------------------
 // 2 wire Non-latching LCD SR from:
 // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
 #if ENABLED(FF_INTERFACEBOARD)
   #define SR_LCD_3W_NL    // Non latching 3 wire shift register
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
 #elif ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
-  #define IS_ULTIPANEL
+  #define IS_ULTIPANEL 1
+#elif ENABLED(ULTIPANEL)
+  #define IS_ULTIPANEL 1
 #endif
 
-#if ENABLED(IS_ULTIPANEL)
-  #define ULTIPANEL
-#endif
-#if ENABLED(ULTIPANEL)
-  #define IS_ULTRA_LCD
-  #define NEWPANEL
-#endif
-#if ENABLED(IS_ULTRA_LCD)
-  #define ULTRA_LCD
+#if EITHER(IS_ULTIPANEL, ULTRA_LCD)
+  #define IS_ULTRA_LCD 1
 #endif
 
-#if ENABLED(IS_RRW_KEYPAD)
-  #define REPRAPWORLD_KEYPAD
+#if EITHER(IS_ULTIPANEL, REPRAPWORLD_KEYPAD)
+  #define IS_NEWPANEL 1
 #endif
 
-// Keypad needs a move step
-#if ENABLED(REPRAPWORLD_KEYPAD)
-  #define NEWPANEL
+#if EITHER(ZONESTAR_LCD, REPRAPWORLD_KEYPAD)
+  #define IS_RRW_KEYPAD 1
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
 #if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY)
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON)
-  #define IS_EXTUI
+  #define IS_EXTUI 1
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
-#if EITHER(ULTRA_LCD, EXTENSIBLE_UI)
+#if EITHER(IS_ULTRA_LCD, EXTENSIBLE_UI)
   #define HAS_DISPLAY 1
 #endif
 
-#if ENABLED(ULTRA_LCD)
+#if IS_ULTRA_LCD
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
   #elif IS_TFTGLCD_PANEL
     // Neither DOGM nor HD44780. Fully customized interface.
   #elif DISABLED(HAS_GRAPHICAL_TFT)
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
-#if ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS)
+#if IS_ULTIPANEL && DISABLED(NO_LCD_MENUS)
   #define HAS_LCD_MENU 1
 #endif
-#if ENABLED(ADC_KEYPAD)
-  #define HAS_ADC_BUTTONS 1
-#endif
 
 #if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
   #endif
   #ifndef LCD_PIXEL_HEIGHT
     #define LCD_PIXEL_HEIGHT 64
   #endif
 #endif
 
@@ -830,97 +810,99 @@
  *  - TFT_DRIVER
  *  - TFT_WIDTH
  *  - TFT_HEIGHT
  *  - TFT_INTERFACE_(SPI|FSMC)
  *  - TFT_COLOR
  *  - GRAPHICAL_TFT_UPSCALE
  */
 #if ENABLED(MKS_TS35_V2_0)
   // Most common: ST7796
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
-  #define TFT_WIDTH  480
-  #define TFT_HEIGHT 320
+  #define TFT_RES_480x320
   #define TFT_INTERFACE_SPI
-  #define GRAPHICAL_TFT_UPSCALE 3
 #elif ENABLED(MKS_ROBIN_TFT24)
   // Most common: ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
-  #define TFT_WIDTH  320
-  #define TFT_HEIGHT 240
+  #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-  #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(MKS_ROBIN_TFT28)
   // Most common: ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
-  #define TFT_WIDTH  320
-  #define TFT_HEIGHT 240
+  #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-  #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(MKS_ROBIN_TFT32)
   // Most common: ST7789
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
-  #define TFT_WIDTH  320
-  #define TFT_HEIGHT 240
+  #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-  #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(MKS_ROBIN_TFT35)
   // Most common: ILI9488
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
-  #define TFT_WIDTH  480
-  #define TFT_HEIGHT 320
+  #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
-  #define GRAPHICAL_TFT_UPSCALE 3
 #elif ENABLED(MKS_ROBIN_TFT43)
   #define TFT_DEFAULT_ORIENTATION 0
   #define TFT_DRIVER SSD1963
-  #define TFT_WIDTH  480
-  #define TFT_HEIGHT 272
+  #define TFT_RES_480x272
   #define TFT_INTERFACE_FSMC
-  #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(MKS_ROBIN_TFT_V1_1R)
   // ILI9328 or R61505
-  #define TFT_DEFAULT_ORIENTATION (TFT_INVERT_X | TFT_INVERT_Y | TFT_EXCHANGE_XY)
-  #define TFT_WIDTH  320
-  #define TFT_HEIGHT 240
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
+  #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-  #define GRAPHICAL_TFT_UPSCALE 2
 #elif EITHER(TFT_TRONXY_X5SA, ANYCUBIC_TFT35)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
   #define TFT_DRIVER ILI9488
-  #define TFT_WIDTH  480
-  #define TFT_HEIGHT 320
+  #define TFT_RES_480x320
   #define TFT_INTERFACE_FSMC
-  #define GRAPHICAL_TFT_UPSCALE 3
 #elif ENABLED(LONGER_LK_TFT28)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
-  #define TFT_WIDTH  320
-  #define TFT_HEIGHT 240
+  #define TFT_RES_320x240
   #define TFT_INTERFACE_FSMC
-  #define GRAPHICAL_TFT_UPSCALE 2
 #elif ENABLED(TFT_GENERIC)
   #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
+  #if NONE(TFT_RES_320x240, TFT_RES_480x272, TFT_RES_480x320)
+    #define TFT_RES_320x240
+  #endif
+  #if NONE(TFT_INTERFACE_FSMC, TFT_INTERFACE_SPI)
+    #define TFT_INTERFACE_SPI
+  #endif
+#endif
+
+#if ENABLED(TFT_RES_320x240)
+  #define TFT_WIDTH  320
+  #define TFT_HEIGHT 240
+  #define GRAPHICAL_TFT_UPSCALE 2
+#elif ENABLED(TFT_RES_480x272)
+  #define TFT_WIDTH  480
+  #define TFT_HEIGHT 272
+  #define GRAPHICAL_TFT_UPSCALE 2
+#elif ENABLED(TFT_RES_480x320)
+  #define TFT_WIDTH  480
+  #define TFT_HEIGHT 320
+  #define GRAPHICAL_TFT_UPSCALE 3
 #endif
 
 // FSMC/SPI TFT Panels using standard HAL/tft/tft_(fsmc|spi).h
 #if ENABLED(TFT_INTERFACE_FSMC)
   #define HAS_FSMC_TFT 1
   #if ENABLED(TFT_CLASSIC_UI)
-    #define FSMC_GRAPHICAL_TFT
+    #define HAS_FSMC_GRAPHICAL_TFT 1
   #elif ENABLED(TFT_LVGL_UI)
-    #define TFT_LVGL_UI_FSMC
+    #define HAS_TFT_LVGL_UI_FSMC 1
   #endif
 #elif ENABLED(TFT_INTERFACE_SPI)
   #define HAS_SPI_TFT 1
   #if ENABLED(TFT_CLASSIC_UI)
-    #define SPI_GRAPHICAL_TFT
+    #define HAS_SPI_GRAPHICAL_TFT 1
   #elif ENABLED(TFT_LVGL_UI)
-    #define TFT_LVGL_UI_SPI
+    #define HAS_TFT_LVGL_UI_SPI 1
   #endif
 #endif
 
 #if ENABLED(TFT_COLOR_UI) && TFT_HEIGHT == 240
   #if ENABLED(TFT_INTERFACE_SPI)
     #define TFT_320x240_SPI
   #elif ENABLED(TFT_INTERFACE_FSMC)
     #define TFT_320x240
   #endif
 #elif ENABLED(TFT_COLOR_UI) && TFT_HEIGHT == 320

commit c0920bbf6a2490b7ea66d2a9e828c0f527a6c77b
Author: Victor Oliveira <rhapsodyv@gmail.com>
Date:   Mon Oct 12 18:38:07 2020 -0300

    TFT Refactoring (#19192)
    
    * split tft folder in two: tft for color ui; tft_io for shared tft code
    
    * after the files got moved, now the code was moved to the right place
    
    * classic ui using TFT IO init lcd codes
    
    * feature to compile tft_io when enabled
    
    * compiling fix
    
    * lvgl spi tft working with tft io init codes
    
    * there is no need for separeted fsmc and spi class in lvgl anymore, as tft io handle everything
    
    * remove debug
    
    * base for TFT rotation and mirroring API, and ILI9488 support
    
    * ST7796S rotate and mirror support
    
    * ST7789V rotate and mirror support
    
    * ST7735 rotate and mirror support
    
    * ILI9341 rotate and mirror support
    
    * ILI9328 rotate and mirror support
    
    * R61505 rotate and mirror support
    
    * MKS TFT definitions
    
    * more configs for mks tfts
    
    * update config
    
    * naming typo
    
    * to configure the user interface
    
    * ANYCUBIC_TFT35
    
    * tft configs
    
    * support for SSD1963
    
    * tft display types
    
    * updated conditionals lcd; first board fully working with the new code - all 3 ui!
    
    * compatiblity
    
    * changed name
    
    * move classic ui file name
    
    * rename TURN -> ROTATE
    
    * GRAPHICAL_TFT_ROTATE_180 deprecated
    
    * first fsmc board fully working - chitu v5
    
    * mks robin nano v1.2 + tft 35 ok!
    
    * right pin name
    
    * anycubic tft tested in a TRIGORILLA_PRO
    
    * chitu v6
    
    * nano 32 tft orientation
    
    * mks tft43
    
    * mks tft43 rotation
    
    * fixed LONGER LK tft setup
    
    * GRAPHICAL_TFT_UPSCALE defined by the display type
    
    * better offsets defaults
    
    * Update Configuration.h
    
    * Update tft_fsmc.cpp
    
    * Update Conditionals_LCD.h
    
    * Tweak comments
    
    * update nano tests
    
    * Revert "update nano tests"
    
    This reverts commit a071ebbfad30e28855a4a5695ec8a726542a1a65.
    
    * default tft
    
    * outdated comments
    
    * to not break non-vscode builds
    
    * upscale tft 35
    
    * support tft 180 rotation for color ui
    
    * Each TFT Driver is responsible for its default color mode.
    
    * use auto detect in mks displays, because some of them could be shipped with diferent drivers
    
    * extra s
    
    * unused code
    
    * wrong -1
    
    * missing mirror options
    
    * Smaller regex pattern
    
    * Comment updates
    
    * Clean up old defines
    
    * Apply pins formatting
    
    * GRAPHICAL_TFT_ROTATE_180 => TFT_ROTATE_180
    
    * MKS_ROBIN_TFT_V1_1R
    
    * merge fix
    
    * correct resolution
    
    * auto is default, dont need be there, and it will allow the user to configure it even for named displays
    
    * to not use rotation with MKS_ROBIN_TFT_V1_1R
    
    * i like () in macros
    
    * avoid sleepy commits
    
    * default for st7789 is rgb
    
    * nano follow up
    
    * to allow ili9328 rotation
    
    * default is rgb
    
    * boards merge follow up
    
    * to match bootloader orientation
    
    * HAS_TOUCH_XPT2046 is not hal specific anymore
    
    * lets not forget LPC
    
    * 180 rotation for ili9328 and R61505
    
    * Clean up whitespace
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 42d82dcc10..56ce2ca5ed 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -304,60 +304,71 @@
 #if ANY(ULTIMAKERCONTROLLER, REPRAP_DISCOUNT_SMART_CONTROLLER, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
   #define IS_ULTIPANEL
 #endif
 
 // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
 #if ENABLED(U8GLIB_SH1106_EINSTART)
   #define DOGLCD
   #define IS_ULTIPANEL
 #endif
 
+// Compatibility
+#if ENABLED(FSMC_GRAPHICAL_TFT)
+  #define TFT_CLASSIC_UI
+  #define TFT_INTERFACE_FSMC
+  #define TFT_GENERIC
+#elif ENABLED(SPI_GRAPHICAL_TFT)
+  #define TFT_CLASSIC_UI
+  #define TFT_INTERFACE_SPI
+  #define TFT_GENERIC
+#elif EITHER(TFT_320x240, TFT_480x320)
+  #define TFT_COLOR_UI
+  #define TFT_INTERFACE_FSMC
+  #define TFT_GENERIC
+#elif EITHER(TFT_320x240_SPI, TFT_480x320_SPI)
+  #define TFT_COLOR_UI
+  #define TFT_INTERFACE_SPI
+  #define TFT_GENERIC
+#elif ENABLED(TFT_LVGL_UI_FSMC)
+  #define TFT_LVGL_UI
+  #define TFT_INTERFACE_FSMC
+  #define TFT_GENERIC
+#elif ENABLED(TFT_LVGL_UI_SPI)
+  #define TFT_LVGL_UI
+  #define TFT_INTERFACE_SPI
+  #define TFT_GENERIC
+#endif
+
 // FSMC/SPI TFT Panels (LVGL)
-#if EITHER(TFT_LVGL_UI_SPI, TFT_LVGL_UI_FSMC)
+#if ENABLED(TFT_LVGL_UI)
   #define HAS_TFT_LVGL_UI 1
 #endif
 
 // FSMC/SPI TFT Panels
-#if EITHER(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
+#if ENABLED(TFT_CLASSIC_UI)
   #define TFT_SCALED_DOGLCD 1
 #endif
 
 #if TFT_SCALED_DOGLCD
   #define DOGLCD
   #define IS_ULTIPANEL
   #define DELAYED_BACKLIGHT_INIT
-#elif ENABLED(TFT_LVGL_UI_SPI)
+#elif ENABLED(TFT_LVGL_UI)
   #define DELAYED_BACKLIGHT_INIT
 #endif
 
-// FSMC/SPI TFT Panels using standard HAL/tft/tft_(fsmc|spi).h
-#if ANY(TFT_320x240, TFT_480x320, TFT_LVGL_UI_FSMC, FSMC_GRAPHICAL_TFT)
-  #define HAS_FSMC_TFT 1
-#elif ANY(TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_SPI, SPI_GRAPHICAL_TFT)
-  #define HAS_SPI_TFT 1
-#endif
-
 // Color UI
-#if ANY(TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI)
+#if ENABLED(TFT_COLOR_UI)
   #define HAS_GRAPHICAL_TFT 1
   #define IS_ULTIPANEL
 #endif
 
-// Fewer lines with touch buttons on-screen
-#if EITHER(TFT_320x240, TFT_320x240_SPI)
-  #define HAS_UI_320x240 1
-  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
-#elif EITHER(TFT_480x320, TFT_480x320_SPI)
-  #define HAS_UI_480x320 1
-  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
-#endif
-
 /**
  * I2C Panels
  */
 
 #if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
 
   #if ENABLED(LCD_SAINSMART_I2C_2004)
@@ -803,10 +814,135 @@
   #define HAS_USB_SERIAL 1
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
+
+/**
+ * TFT Displays
+ *
+ * Configure parameters for TFT displays:
+ *  - TFT_DEFAULT_ORIENTATION
+ *  - TFT_DRIVER
+ *  - TFT_WIDTH
+ *  - TFT_HEIGHT
+ *  - TFT_INTERFACE_(SPI|FSMC)
+ *  - TFT_COLOR
+ *  - GRAPHICAL_TFT_UPSCALE
+ */
+#if ENABLED(MKS_TS35_V2_0)
+  // Most common: ST7796
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY)
+  #define TFT_WIDTH  480
+  #define TFT_HEIGHT 320
+  #define TFT_INTERFACE_SPI
+  #define GRAPHICAL_TFT_UPSCALE 3
+#elif ENABLED(MKS_ROBIN_TFT24)
+  // Most common: ST7789
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
+  #define TFT_WIDTH  320
+  #define TFT_HEIGHT 240
+  #define TFT_INTERFACE_FSMC
+  #define GRAPHICAL_TFT_UPSCALE 2
+#elif ENABLED(MKS_ROBIN_TFT28)
+  // Most common: ST7789
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
+  #define TFT_WIDTH  320
+  #define TFT_HEIGHT 240
+  #define TFT_INTERFACE_FSMC
+  #define GRAPHICAL_TFT_UPSCALE 2
+#elif ENABLED(MKS_ROBIN_TFT32)
+  // Most common: ST7789
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_Y)
+  #define TFT_WIDTH  320
+  #define TFT_HEIGHT 240
+  #define TFT_INTERFACE_FSMC
+  #define GRAPHICAL_TFT_UPSCALE 2
+#elif ENABLED(MKS_ROBIN_TFT35)
+  // Most common: ILI9488
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
+  #define TFT_WIDTH  480
+  #define TFT_HEIGHT 320
+  #define TFT_INTERFACE_FSMC
+  #define GRAPHICAL_TFT_UPSCALE 3
+#elif ENABLED(MKS_ROBIN_TFT43)
+  #define TFT_DEFAULT_ORIENTATION 0
+  #define TFT_DRIVER SSD1963
+  #define TFT_WIDTH  480
+  #define TFT_HEIGHT 272
+  #define TFT_INTERFACE_FSMC
+  #define GRAPHICAL_TFT_UPSCALE 2
+#elif ENABLED(MKS_ROBIN_TFT_V1_1R)
+  // ILI9328 or R61505
+  #define TFT_DEFAULT_ORIENTATION (TFT_INVERT_X | TFT_INVERT_Y | TFT_EXCHANGE_XY)
+  #define TFT_WIDTH  320
+  #define TFT_HEIGHT 240
+  #define TFT_INTERFACE_FSMC
+  #define GRAPHICAL_TFT_UPSCALE 2
+#elif EITHER(TFT_TRONXY_X5SA, ANYCUBIC_TFT35)
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
+  #define TFT_DRIVER ILI9488
+  #define TFT_WIDTH  480
+  #define TFT_HEIGHT 320
+  #define TFT_INTERFACE_FSMC
+  #define GRAPHICAL_TFT_UPSCALE 3
+#elif ENABLED(LONGER_LK_TFT28)
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
+  #define TFT_WIDTH  320
+  #define TFT_HEIGHT 240
+  #define TFT_INTERFACE_FSMC
+  #define GRAPHICAL_TFT_UPSCALE 2
+#elif ENABLED(TFT_GENERIC)
+  #define TFT_DEFAULT_ORIENTATION (TFT_EXCHANGE_XY | TFT_INVERT_X | TFT_INVERT_Y)
+#endif
+
+// FSMC/SPI TFT Panels using standard HAL/tft/tft_(fsmc|spi).h
+#if ENABLED(TFT_INTERFACE_FSMC)
+  #define HAS_FSMC_TFT 1
+  #if ENABLED(TFT_CLASSIC_UI)
+    #define FSMC_GRAPHICAL_TFT
+  #elif ENABLED(TFT_LVGL_UI)
+    #define TFT_LVGL_UI_FSMC
+  #endif
+#elif ENABLED(TFT_INTERFACE_SPI)
+  #define HAS_SPI_TFT 1
+  #if ENABLED(TFT_CLASSIC_UI)
+    #define SPI_GRAPHICAL_TFT
+  #elif ENABLED(TFT_LVGL_UI)
+    #define TFT_LVGL_UI_SPI
+  #endif
+#endif
+
+#if ENABLED(TFT_COLOR_UI) && TFT_HEIGHT == 240
+  #if ENABLED(TFT_INTERFACE_SPI)
+    #define TFT_320x240_SPI
+  #elif ENABLED(TFT_INTERFACE_FSMC)
+    #define TFT_320x240
+  #endif
+#elif ENABLED(TFT_COLOR_UI) && TFT_HEIGHT == 320
+  #if ENABLED(TFT_INTERFACE_SPI)
+    #define TFT_480x320_SPI
+  #elif ENABLED(TFT_INTERFACE_FSMC)
+    #define TFT_480x320
+  #endif
+#endif
+
+// Fewer lines with touch buttons on-screen
+#if EITHER(TFT_320x240, TFT_320x240_SPI)
+  #define HAS_UI_320x240 1
+  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
+#elif EITHER(TFT_480x320, TFT_480x320_SPI)
+  #define HAS_UI_480x320 1
+  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
+#endif
+
+// This emulated DOGM has 'touch/xpt2046', not 'tft/xpt2046'
+#if ENABLED(TOUCH_SCREEN) && !HAS_GRAPHICAL_TFT
+  #undef TOUCH_SCREEN
+  #undef TOUCH_SCREEN_CALIBRATION
+  #define HAS_TOUCH_XPT2046 1
+#endif

commit 6fdaaf3d203002fb7b437e86cd3aaa80e5da77bd
Author: Serhiy-K <52166448+Serhiy-K@users.noreply.github.com>
Date:   Sat Oct 10 13:01:46 2020 +0300

    Fixes for TFTGLCD Panel, FastIO (#19614)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 210bf3e91b..42d82dcc10 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -219,23 +219,23 @@
 
 #elif EITHER(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
 
   #define IS_TFTGLCD_PANEL 1
   #define IS_ULTIPANEL                      // Note that IS_ULTIPANEL leads to HAS_WIRED_LCD
 
   #if ENABLED(SDSUPPORT) && DISABLED(LCD_PROGRESS_BAR)
     #define LCD_PROGRESS_BAR
   #endif
   #if ENABLED(TFTGLCD_PANEL_I2C)
-    #define LCD_USE_I2C_BUZZER              // Enable buzzer on LCD for I2C and SPI buses (LiquidTWI2 not required)
     #define LCD_I2C_ADDRESS           0x27  // Must be equal to panel's I2C slave addres
   #endif
+  #define LCD_USE_I2C_BUZZER                // Enable buzzer on LCD, used for both I2C and SPI buses (LiquidTWI2 not required)
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #define LCD_WIDTH                   20    // 20 or 24 chars in line
   #define LCD_HEIGHT                  10    // Character lines
   #define LCD_CONTRAST_MIN            127
   #define LCD_CONTRAST_MAX            255
   #define DEFAULT_LCD_CONTRAST        250
   #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.
                                       // At this time present conversion only for cyrillic - bg, ru and uk languages.
                                       // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.

commit 2c99c1e06f534e6c629dcbfebe2c591c1132a992
Author: ladismrkolj <ladismrkolj@gmail.com>
Date:   Wed Oct 7 01:36:01 2020 +0200

    Add Chamber servo vent, auto fan (#19519)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d2c939b9b4..210bf3e91b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -596,24 +596,20 @@
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_BY_EXTRUDERS(v1, v1, v1, v1, v1, v1, v1, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
 #define ARRAY_BY_HOTENDS1(v1) ARRAY_BY_HOTENDS(v1, v1, v1, v1, v1, v1, v1, v1)
 
 #if ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
   #define DO_SWITCH_EXTRUDER 1
 #endif
 
-#ifdef SWITCHING_NOZZLE_E1_SERVO_NR
-  #define SWITCHING_NOZZLE_TWO_SERVOS 1
-#endif
-
 /**
  * Default hotend offsets, if not defined
  */
 #if HAS_HOTEND_OFFSET
   #ifndef HOTEND_OFFSET_X
     #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
   #endif
   #ifndef HOTEND_OFFSET_Y
     #define HOTEND_OFFSET_Y { 0 } // Y offsets for each extruder
   #endif
@@ -650,46 +646,35 @@
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif
-  #ifndef NUM_SERVOS
-    #define NUM_SERVOS (Z_PROBE_SERVO_NR + 1)
-  #endif
   #undef DEACTIVATE_SERVOS_AFTER_MOVE
-  #if NUM_SERVOS == 1
-    #undef SERVO_DELAY
-    #define SERVO_DELAY { 50 }
-  #endif
 
   // Always disable probe pin inverting for BLTouch
   #undef Z_MIN_PROBE_ENDSTOP_INVERTING
   #define Z_MIN_PROBE_ENDSTOP_INVERTING false
   #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #undef Z_MIN_ENDSTOP_INVERTING
     #define Z_MIN_ENDSTOP_INVERTING false
   #endif
 #endif
 
-#ifndef NUM_SERVOS
-  #define NUM_SERVOS 0
-#endif
-
 /**
  * Set a flag for a servo probe (or BLTouch)
  */
-#if defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0
+#ifdef Z_PROBE_SERVO_NR
   #define HAS_Z_SERVO_PROBE 1
 #endif
 #if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
   #define HAS_SERVO_ANGLES 1
 #endif
 #if !HAS_SERVO_ANGLES
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**

commit 4424645e04c9e75462d36de8f7a82e67cc9c262e
Author: qwewer0 <57561110+qwewer0@users.noreply.github.com>
Date:   Mon Sep 28 21:53:50 2020 +0200

    Multi-line comments cleanup (#19535)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index fa65991c2f..d2c939b9b4 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -505,21 +505,20 @@
 #endif
 
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
- *
  */
 
 #if EXTRUDERS == 0
   #undef EXTRUDERS
   #define EXTRUDERS 0
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef MK2_MULTIPLEXER

commit 27bdf4b24e8da06ea7923b6382f38b5fb6292914
Author: Serhiy-K <52166448+Serhiy-K@users.noreply.github.com>
Date:   Mon Sep 28 09:52:38 2020 +0300

    MarlinUI for SPI/I2C TFT-GLCD character-based display bridge (#19375)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index af8ef73817..fa65991c2f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -210,20 +210,42 @@
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
   #define ENCODER_PULSES_PER_STEP 2
   #define ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
   #define IS_RRD_SC
   #define LCD_WIDTH 16
   #define LCD_HEIGHT 2
 
+#elif EITHER(TFTGLCD_PANEL_SPI, TFTGLCD_PANEL_I2C)
+
+  #define IS_TFTGLCD_PANEL 1
+  #define IS_ULTIPANEL                      // Note that IS_ULTIPANEL leads to HAS_WIRED_LCD
+
+  #if ENABLED(SDSUPPORT) && DISABLED(LCD_PROGRESS_BAR)
+    #define LCD_PROGRESS_BAR
+  #endif
+  #if ENABLED(TFTGLCD_PANEL_I2C)
+    #define LCD_USE_I2C_BUZZER              // Enable buzzer on LCD for I2C and SPI buses (LiquidTWI2 not required)
+    #define LCD_I2C_ADDRESS           0x27  // Must be equal to panel's I2C slave addres
+  #endif
+  #define STD_ENCODER_PULSES_PER_STEP 2
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+  #define LCD_WIDTH                   20    // 20 or 24 chars in line
+  #define LCD_HEIGHT                  10    // Character lines
+  #define LCD_CONTRAST_MIN            127
+  #define LCD_CONTRAST_MAX            255
+  #define DEFAULT_LCD_CONTRAST        250
+  #define CONVERT_TO_EXT_ASCII        // Use extended 128-255 symbols from ASCII table.
+                                      // At this time present conversion only for cyrillic - bg, ru and uk languages.
+                                      // First 7 ASCII symbols in panel font must be replaced with Marlin's special symbols.
 #endif
 
 #if ENABLED(IS_RRD_FG_SC)
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 #endif
 
 #if EITHER(MAKRPANEL, MINIPANEL)
   #define IS_ULTIPANEL
   #define DOGLCD
   #if ENABLED(MAKRPANEL)
@@ -452,20 +474,22 @@
 
 // Aliases for LCD features
 #if EITHER(ULTRA_LCD, EXTENSIBLE_UI)
   #define HAS_DISPLAY 1
 #endif
 
 #if ENABLED(ULTRA_LCD)
   #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_MARLINUI_U8GLIB 1
+  #elif IS_TFTGLCD_PANEL
+    // Neither DOGM nor HD44780. Fully customized interface.
   #elif DISABLED(HAS_GRAPHICAL_TFT)
     #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
 #if ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS)
   #define HAS_LCD_MENU 1
 #endif
 #if ENABLED(ADC_KEYPAD)
   #define HAS_ADC_BUTTONS 1

commit c2c6a679ea4bdf48ce1800a8831fcec36c09ce53
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Mon Sep 28 01:13:27 2020 -0500

    Rename LCD conditionals (#19533)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 95c93beb9e..af8ef73817 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -449,36 +449,36 @@
   #define IS_EXTUI
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(ULTRA_LCD, EXTENSIBLE_UI)
   #define HAS_DISPLAY 1
 #endif
 
 #if ENABLED(ULTRA_LCD)
-  #define HAS_SPI_LCD 1
+  #define HAS_WIRED_LCD 1
   #if ENABLED(DOGLCD)
-    #define HAS_GRAPHICAL_LCD 1
+    #define HAS_MARLINUI_U8GLIB 1
   #elif DISABLED(HAS_GRAPHICAL_TFT)
-    #define HAS_CHARACTER_LCD 1
+    #define HAS_MARLINUI_HD44780 1
   #endif
 #endif
 
 #if ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS)
   #define HAS_LCD_MENU 1
 #endif
 #if ENABLED(ADC_KEYPAD)
   #define HAS_ADC_BUTTONS 1
 #endif
 
-#if HAS_GRAPHICAL_LCD
+#if HAS_MARLINUI_U8GLIB
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
   #endif
   #ifndef LCD_PIXEL_HEIGHT
     #define LCD_PIXEL_HEIGHT 64
   #endif
 #endif
 
 /**
  * Extruders have some combination of stepper motors and hotends

commit 76d8d1742c1d4a1efe0fd6c0645d3fc656bfd0b2
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Sep 20 18:29:08 2020 -0500

    Add multi-extruder condition

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d5ef62b621..95c93beb9e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -494,20 +494,22 @@
 #if EXTRUDERS == 0
   #undef EXTRUDERS
   #define EXTRUDERS 0
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef MK2_MULTIPLEXER
   #undef PRUSA_MMU2
   #undef HOTEND_IDLE_TIMEOUT
+#elif EXTRUDERS > 1
+  #define HAS_MULTI_EXTRUDER 1
 #endif
 
 #if ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif

commit a445746a8b6dd752de725eb67d264153c3b393d7
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sun Sep 6 21:40:58 2020 -0500

    Clean up LCD conditionals, DWIN

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 112ff93a0e..d5ef62b621 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -19,42 +19,64 @@
  * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
+// Kinematics
 #if ENABLED(MORGAN_SCARA)
   #define IS_SCARA 1
   #define IS_KINEMATIC 1
 #elif ENABLED(DELTA)
   #define IS_KINEMATIC 1
 #else
   #define IS_CARTESIAN 1
 #endif
 
+// MKS_LCD12864 is a variant of MKS_MINI_12864
 #if ENABLED(MKS_LCD12864)
   #define MKS_MINI_12864
 #endif
 
+/**
+ * General Flags that may be set below by specific LCDs
+ *
+ *  DOGLCD                : Run a Graphical LCD through U8GLib (with MarlinUI)
+ *  IS_ULTIPANEL          : Define LCD_PINS_D5/6/7 for direct-connected "Ultipanel" LCDs
+ *  IS_ULTRA_LCD          : Ultra LCD, not necessarily Ultipanel. Used most often with NEWPANEL.
+ *  IS_RRD_SC             : Common RRD Smart Controller digital interface pins
+ *  IS_RRD_FG_SC          : Common RRD Full Graphical Smart Controller digital interface pins
+ *  U8GLIB_ST7920         : Most common DOGM display SPI interface, supporting a "lightweight" display mode.
+ *  U8GLIB_SH1106         : SH1106 OLED with I2C interface via U8GLib
+ *  IS_U8GLIB_SSD1306     : SSD1306 OLED with I2C interface via U8GLib
+ *  U8GLIB_SSD1309        : SSD1309 OLED with I2C interface via U8GLib
+ *  U8GLIB_ST7565_64128N  : ST7565 128x64 LCD with SPI interface via U8GLib
+ *  U8GLIB_LM6059_AF      : LM6059 with Hardware SPI via U8GLib
+ */
 #if EITHER(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
 
   #define MINIPANEL
 
 #elif ENABLED(CARTESIO_UI)
 
   #define DOGLCD
   #define IS_ULTIPANEL
 
+#elif EITHER(DWIN_MARLINUI_PORTRAIT, DWIN_MARLINUI_LANDSCAPE)
+
+  #define IS_DWIN_MARLINUI 1
+  #define IS_ULTIPANEL
+
 #elif ENABLED(ZONESTAR_LCD)
 
   #define ADC_KEYPAD
   #define IS_RRW_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
   #define IS_ULTIPANEL
 
   // This helps to implement ADC_KEYPAD menus
   #define REVERSE_MENU_DIRECTION
@@ -78,21 +100,20 @@
 #elif ENABLED(RADDS_DISPLAY)
   #define IS_ULTIPANEL
   #define ENCODER_PULSES_PER_STEP 2
 
 #elif EITHER(ANET_FULL_GRAPHICS_LCD, BQ_LCD_SMART_CONTROLLER)
 
   #define IS_RRD_FG_SC
 
 #elif ANY(miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
 
-  #define IS_ULTRA_LCD
   #define DOGLCD
   #define IS_ULTIPANEL
 
   #if ENABLED(miniVIKI)
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(VIKI2)
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
     #define U8GLIB_LM6059_AF
   #elif ENABLED(AZSMZ_12864)
@@ -227,23 +248,23 @@
   #define PCA9632_RED         0x02
   #define PCA9632_BUZZER
   #define PCA9632_BUZZER_DATA { 0x09, 0x02 }
 
   #define ENCODER_PULSES_PER_STEP     1 // Overlord uses buttons
   #define ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 
 // 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
 #if ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
-  #define HAS_SSD1306_OLED_I2C 1
+  #define HAS_U8GLIB_I2C_OLED 1
 #endif
-#if HAS_SSD1306_OLED_I2C
+#if HAS_U8GLIB_I2C_OLED
   #define IS_ULTRA_LCD
   #define DOGLCD
 #endif
 
 // ST7920-based graphical displays
 #if ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
   #define U8GLIB_ST7920
   #define IS_RRD_SC
 #endif
@@ -395,21 +416,20 @@
   #define IS_ULTIPANEL
 #endif
 
 #if ENABLED(IS_ULTIPANEL)
   #define ULTIPANEL
 #endif
 #if ENABLED(ULTIPANEL)
   #define IS_ULTRA_LCD
   #define NEWPANEL
 #endif
-
 #if ENABLED(IS_ULTRA_LCD)
   #define ULTRA_LCD
 #endif
 
 #if ENABLED(IS_RRW_KEYPAD)
   #define REPRAPWORLD_KEYPAD
 #endif
 
 // Keypad needs a move step
 #if ENABLED(REPRAPWORLD_KEYPAD)

commit 41c7ae5d5466c3a234ac52a97e7b91afa16774b8
Author: Zachary Annand <baconfixation@gmail.com>
Date:   Mon Aug 31 16:06:24 2020 -0500

    Separate Neopixels followup (#19179)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index bbe89b7c50..112ff93a0e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -773,15 +773,10 @@
   #define HAS_USB_SERIAL 1
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
-
-// This flag indicates if Neopixel pins are shared or separated  
-#if EITHER(MULTIPLE_NEOPIXEL_TYPES, NEOPIXEL2_INSERIES)
-  #define CONJOINED_NEOPIXEL 1
-#endif

commit 97ec6c1be6f7b3b2e185be9f1637639815acbb1a
Author: Zachary Annand <baconfixation@gmail.com>
Date:   Thu Aug 27 14:18:16 2020 -0500

    Independent Neopixel option (#19115)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 112ff93a0e..bbe89b7c50 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -773,10 +773,15 @@
   #define HAS_USB_SERIAL 1
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
+
+// This flag indicates if Neopixel pins are shared or separated  
+#if EITHER(MULTIPLE_NEOPIXEL_TYPES, NEOPIXEL2_INSERIES)
+  #define CONJOINED_NEOPIXEL 1
+#endif

commit 4955aa5b783794c6a600ad2bf162748647f89143
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Aug 26 02:15:43 2020 -0500

    Prusa => Pr≈Ø≈°a

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ccafd413cf..112ff93a0e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -505,21 +505,21 @@
   #define E_MANUAL        EXTRUDERS
 #elif ENABLED(PRUSA_MMU2)
   #define E_STEPPERS 1
 #endif
 
 // No inactive extruders with MK2_MULTIPLEXER or SWITCHING_NOZZLE
 #if EITHER(MK2_MULTIPLEXER, SWITCHING_NOZZLE)
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
-// Prusa MK2 Multiplexer and MMU 2.0 force SINGLENOZZLE
+// Pr≈Ø≈°a MK2 Multiplexer and MMU 2.0 force SINGLENOZZLE
 #if EITHER(MK2_MULTIPLEXER, PRUSA_MMU2)
   #define SINGLENOZZLE
 #endif
 
 #if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
   #define HOTENDS       1
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #endif

commit a37cf2490054ece3c16f0caca26a02c3d33057c8
Author: Victor Oliveira <rhapsodyv@gmail.com>
Date:   Fri Aug 21 20:54:21 2020 -0300

    Emulated DOGM via HAL TFT, XPT IO (#19017)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d8c8103a42..ccafd413cf 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -279,28 +279,29 @@
 #endif
 
 #if TFT_SCALED_DOGLCD
   #define DOGLCD
   #define IS_ULTIPANEL
   #define DELAYED_BACKLIGHT_INIT
 #elif ENABLED(TFT_LVGL_UI_SPI)
   #define DELAYED_BACKLIGHT_INIT
 #endif
 
-// FSMC/SPI TFT Panels (HAL STM32)
-#if EITHER(TFT_320x240, TFT_480x320)
+// FSMC/SPI TFT Panels using standard HAL/tft/tft_(fsmc|spi).h
+#if ANY(TFT_320x240, TFT_480x320, TFT_LVGL_UI_FSMC, FSMC_GRAPHICAL_TFT)
   #define HAS_FSMC_TFT 1
-#elif EITHER(TFT_320x240_SPI, TFT_480x320_SPI)
+#elif ANY(TFT_320x240_SPI, TFT_480x320_SPI, TFT_LVGL_UI_SPI, SPI_GRAPHICAL_TFT)
   #define HAS_SPI_TFT 1
 #endif
 
-#if HAS_FSMC_TFT || HAS_SPI_TFT
+// Color UI
+#if ANY(TFT_320x240, TFT_480x320, TFT_320x240_SPI, TFT_480x320_SPI)
   #define HAS_GRAPHICAL_TFT 1
   #define IS_ULTIPANEL
 #endif
 
 // Fewer lines with touch buttons on-screen
 #if EITHER(TFT_320x240, TFT_320x240_SPI)
   #define HAS_UI_320x240 1
   #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
 #elif EITHER(TFT_480x320, TFT_480x320_SPI)
   #define HAS_UI_480x320 1

commit da4eaebdc9c1adc7387e302fe6516ed009974edd
Author: wmariz <11435639+wmariz@users.noreply.github.com>
Date:   Fri Aug 7 19:03:59 2020 -0300

    ZoneStar Z6FB (#18918)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index cabca762ab..d8c8103a42 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -55,20 +55,33 @@
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
   #define IS_ULTIPANEL
 
   // This helps to implement ADC_KEYPAD menus
   #define REVERSE_MENU_DIRECTION
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
 
+#elif ENABLED(ZONESTAR_12864LCD)
+  #define DOGLCD
+  #define IS_RRD_SC
+  #define U8GLIB_ST7920
+
+#elif ENABLED(ZONESTAR_12864OLED)
+  #define IS_RRD_SC
+  #define U8GLIB_SH1106
+
+#elif ENABLED(ZONESTAR_12864OLED_SSD1306)
+  #define IS_RRD_SC
+  #define IS_U8GLIB_SSD1306
+
 #elif ENABLED(RADDS_DISPLAY)
   #define IS_ULTIPANEL
   #define ENCODER_PULSES_PER_STEP 2
 
 #elif EITHER(ANET_FULL_GRAPHICS_LCD, BQ_LCD_SMART_CONTROLLER)
 
   #define IS_RRD_FG_SC
 
 #elif ANY(miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
 

commit 99ba866d8d3c9abc16558ca12ba34efb9a7922e5
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Aug 6 08:14:00 2020 -0500

    Optimize G-code / feature dependencies (#18919)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 4ffd6fddcc..cabca762ab 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -423,28 +423,20 @@
 
 #if ENABLED(ULTRA_LCD)
   #define HAS_SPI_LCD 1
   #if ENABLED(DOGLCD)
     #define HAS_GRAPHICAL_LCD 1
   #elif DISABLED(HAS_GRAPHICAL_TFT)
     #define HAS_CHARACTER_LCD 1
   #endif
 #endif
 
-#if ENABLED(SR_LCD_3W_NL)
-  // Feature checks for SR_LCD_3W_NL
-#elif EITHER(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008)
-  #define USES_LIQUIDTWI2
-#elif ANY(HAS_CHARACTER_LCD, LCD_I2C_TYPE_PCF8575, LCD_I2C_TYPE_PCA8574, SR_LCD_2W_NL, LCM1602)
-  #define USES_LIQUIDCRYSTAL
-#endif
-
 #if ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS)
   #define HAS_LCD_MENU 1
 #endif
 #if ENABLED(ADC_KEYPAD)
   #define HAS_ADC_BUTTONS 1
 #endif
 
 #if HAS_GRAPHICAL_LCD
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
@@ -767,17 +759,10 @@
   #define HAS_USB_SERIAL 1
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
-
-/**
- * To check if we need the folder src/features/leds
- */
-#if ANY(TEMP_STAT_LEDS, HAS_COLOR_LEDS, HAS_CASE_LIGHT, PRINTER_EVENT_LEDS, LED_BACKLIGHT_TIMEOUT, PCA9632_BUZZER, LED_CONTROL_MENU, NEOPIXEL_LED)
-  #define HAS_LED_FEATURE 1
-#endif

commit 6bcfb58cd4b208cf042fa4a66faf14f382d33d07
Author: Marco Burato <zmaster.adsl@gmail.com>
Date:   Thu Aug 6 12:38:18 2020 +0200

    More Anycubic + Trigorilla mappings, ExtUI (#18903)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c309822f92..4ffd6fddcc 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -404,21 +404,21 @@
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
 #if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY)
   #define HAS_DGUS_LCD 1
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
-#if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE)
+#if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE, ANYCUBIC_LCD_I3MEGA, ANYCUBIC_LCD_CHIRON)
   #define IS_EXTUI
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(ULTRA_LCD, EXTENSIBLE_UI)
   #define HAS_DISPLAY 1
 #endif
 
 #if ENABLED(ULTRA_LCD)

commit 117df87d193994f6fbcd46c45573095adf921784
Author: Alexander Gavrilenko <jmz52@users.noreply.github.com>
Date:   Thu Jul 30 09:43:19 2020 +0300

    Support for TFT & Touch Screens (#18130)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 1605ced3c8..c309822f92 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -248,38 +248,59 @@
 #if ANY(ULTIMAKERCONTROLLER, REPRAP_DISCOUNT_SMART_CONTROLLER, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
   #define IS_ULTIPANEL
 #endif
 
 // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
 #if ENABLED(U8GLIB_SH1106_EINSTART)
   #define DOGLCD
   #define IS_ULTIPANEL
 #endif
 
-// LVGL UI, SPI or FSMC
+// FSMC/SPI TFT Panels (LVGL)
 #if EITHER(TFT_LVGL_UI_SPI, TFT_LVGL_UI_FSMC)
   #define HAS_TFT_LVGL_UI 1
 #endif
 
 // FSMC/SPI TFT Panels
 #if EITHER(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
   #define TFT_SCALED_DOGLCD 1
 #endif
 
 #if TFT_SCALED_DOGLCD
   #define DOGLCD
   #define IS_ULTIPANEL
   #define DELAYED_BACKLIGHT_INIT
 #elif ENABLED(TFT_LVGL_UI_SPI)
   #define DELAYED_BACKLIGHT_INIT
 #endif
 
+// FSMC/SPI TFT Panels (HAL STM32)
+#if EITHER(TFT_320x240, TFT_480x320)
+  #define HAS_FSMC_TFT 1
+#elif EITHER(TFT_320x240_SPI, TFT_480x320_SPI)
+  #define HAS_SPI_TFT 1
+#endif
+
+#if HAS_FSMC_TFT || HAS_SPI_TFT
+  #define HAS_GRAPHICAL_TFT 1
+  #define IS_ULTIPANEL
+#endif
+
+// Fewer lines with touch buttons on-screen
+#if EITHER(TFT_320x240, TFT_320x240_SPI)
+  #define HAS_UI_320x240 1
+  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
+#elif EITHER(TFT_480x320, TFT_480x320_SPI)
+  #define HAS_UI_480x320 1
+  #define LCD_HEIGHT TERN(TOUCH_SCREEN, 6, 7)
+#endif
+
 /**
  * I2C Panels
  */
 
 #if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
 
   #if ENABLED(LCD_SAINSMART_I2C_2004)
@@ -322,21 +343,21 @@
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #elif ANY(REPRAP_DISCOUNT_SMART_CONTROLLER, miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, OLED_PANEL_TINYBOY2, BQ_LCD_SMART_CONTROLLER, LCD_I2C_PANELOLU2)
 
   #define STD_ENCODER_PULSES_PER_STEP 4
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #endif
 
 #ifndef STD_ENCODER_PULSES_PER_STEP
-  #if ENABLED(TOUCH_BUTTONS)
+  #if ENABLED(TOUCH_SCREEN)
     #define STD_ENCODER_PULSES_PER_STEP 2
   #else
     #define STD_ENCODER_PULSES_PER_STEP 5
   #endif
 #endif
 #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 #ifndef ENCODER_PULSES_PER_STEP
   #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
@@ -391,27 +412,28 @@
 
 // Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE)
   #define IS_EXTUI
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(ULTRA_LCD, EXTENSIBLE_UI)
   #define HAS_DISPLAY 1
-  #if ENABLED(ULTRA_LCD)
-    #define HAS_SPI_LCD 1
-    #if ENABLED(DOGLCD)
-      #define HAS_GRAPHICAL_LCD 1
-    #else
-      #define HAS_CHARACTER_LCD 1
-    #endif
+#endif
+
+#if ENABLED(ULTRA_LCD)
+  #define HAS_SPI_LCD 1
+  #if ENABLED(DOGLCD)
+    #define HAS_GRAPHICAL_LCD 1
+  #elif DISABLED(HAS_GRAPHICAL_TFT)
+    #define HAS_CHARACTER_LCD 1
   #endif
 #endif
 
 #if ENABLED(SR_LCD_3W_NL)
   // Feature checks for SR_LCD_3W_NL
 #elif EITHER(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008)
   #define USES_LIQUIDTWI2
 #elif ANY(HAS_CHARACTER_LCD, LCD_I2C_TYPE_PCF8575, LCD_I2C_TYPE_PCA8574, SR_LCD_2W_NL, LCM1602)
   #define USES_LIQUIDCRYSTAL
 #endif

commit 38ce5966e19094fb499ce7d647961c0594c5f811
Author: Victor Oliveira <rhapsodyv@gmail.com>
Date:   Wed Jul 29 23:25:07 2020 -0300

    SPI Emulated DOGM (like FSMC_GRAPHICAL_TFT, but SPI) (#18817)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 992a788eb5..1605ced3c8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -254,21 +254,25 @@
   #define DOGLCD
   #define IS_ULTIPANEL
 #endif
 
 // LVGL UI, SPI or FSMC
 #if EITHER(TFT_LVGL_UI_SPI, TFT_LVGL_UI_FSMC)
   #define HAS_TFT_LVGL_UI 1
 #endif
 
 // FSMC/SPI TFT Panels
-#if ENABLED(FSMC_GRAPHICAL_TFT)
+#if EITHER(FSMC_GRAPHICAL_TFT, SPI_GRAPHICAL_TFT)
+  #define TFT_SCALED_DOGLCD 1
+#endif
+
+#if TFT_SCALED_DOGLCD
   #define DOGLCD
   #define IS_ULTIPANEL
   #define DELAYED_BACKLIGHT_INIT
 #elif ENABLED(TFT_LVGL_UI_SPI)
   #define DELAYED_BACKLIGHT_INIT
 #endif
 
 /**
  * I2C Panels
  */

commit 159dcd8e8a6e829fa8caaa90ecf1a5140ea87989
Author: MoellerDi <MoellerDi@users.noreply.github.com>
Date:   Wed Jul 29 03:19:12 2020 +0200

    Fix NEOPIXEL_LED compile w/out PRINTER_EVENT_LEDS (#18824)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 66e83c5299..992a788eb5 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -745,13 +745,13 @@
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
 
 /**
  * To check if we need the folder src/features/leds
  */
-#if ANY(TEMP_STAT_LEDS, HAS_COLOR_LEDS, HAS_CASE_LIGHT, PRINTER_EVENT_LEDS, LED_BACKLIGHT_TIMEOUT, PCA9632_BUZZER, LED_CONTROL_MENU)
+#if ANY(TEMP_STAT_LEDS, HAS_COLOR_LEDS, HAS_CASE_LIGHT, PRINTER_EVENT_LEDS, LED_BACKLIGHT_TIMEOUT, PCA9632_BUZZER, LED_CONTROL_MENU, NEOPIXEL_LED)
   #define HAS_LED_FEATURE 1
 #endif

commit e02817b07798b92aa31091c78c16581f0c867923
Author: Victor Oliveira <rhapsodyv@gmail.com>
Date:   Sat Jul 25 23:40:44 2020 -0300

    More folders only compiled when their feature is Enabled (#18780)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3472cdc7ba..66e83c5299 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -741,10 +741,17 @@
   #define HAS_USB_SERIAL 1
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif
+
+/**
+ * To check if we need the folder src/features/leds
+ */
+#if ANY(TEMP_STAT_LEDS, HAS_COLOR_LEDS, HAS_CASE_LIGHT, PRINTER_EVENT_LEDS, LED_BACKLIGHT_TIMEOUT, PCA9632_BUZZER, LED_CONTROL_MENU)
+  #define HAS_LED_FEATURE 1
+#endif

commit d20d4591321aa467c062f0050355d2aca84e03ad
Author: MKS-Sean <56996910+MKS-Sean@users.noreply.github.com>
Date:   Sat Jul 25 13:52:07 2020 +0800

    Robin nano V2, TFT LVGL UI parameters, and more (#18500)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a552e5b9ce..3472cdc7ba 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -248,26 +248,31 @@
 #if ANY(ULTIMAKERCONTROLLER, REPRAP_DISCOUNT_SMART_CONTROLLER, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
   #define IS_ULTIPANEL
 #endif
 
 // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
 #if ENABLED(U8GLIB_SH1106_EINSTART)
   #define DOGLCD
   #define IS_ULTIPANEL
 #endif
 
+// LVGL UI, SPI or FSMC
+#if EITHER(TFT_LVGL_UI_SPI, TFT_LVGL_UI_FSMC)
+  #define HAS_TFT_LVGL_UI 1
+#endif
+
 // FSMC/SPI TFT Panels
 #if ENABLED(FSMC_GRAPHICAL_TFT)
   #define DOGLCD
   #define IS_ULTIPANEL
   #define DELAYED_BACKLIGHT_INIT
-#elif ENABLED(SPI_GRAPHICAL_TFT)
+#elif ENABLED(TFT_LVGL_UI_SPI)
   #define DELAYED_BACKLIGHT_INIT
 #endif
 
 /**
  * I2C Panels
  */
 
 #if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575

commit 42fbd527f3bcc317ae6851aca5a45bdbf979de55
Author: Diego von Deschwanden <68632259+Diegovd@users.noreply.github.com>
Date:   Thu Jul 23 05:20:14 2020 +0200

    Fix links to secure sites (#18745)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 972d1042ee..a552e5b9ce 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -9,21 +9,21 @@
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation, either version 3 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
- * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ * along with this program.  If not, see <https://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
 #if ENABLED(MORGAN_SCARA)

commit 6027055695f6fa49b857bec0552bf362e0b2bb56
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Jul 21 04:00:39 2020 -0500

    Optimize LCD, Wifi, etc. libraries (#18730)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 10755c180e..972d1042ee 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -392,20 +392,28 @@
   #if ENABLED(ULTRA_LCD)
     #define HAS_SPI_LCD 1
     #if ENABLED(DOGLCD)
       #define HAS_GRAPHICAL_LCD 1
     #else
       #define HAS_CHARACTER_LCD 1
     #endif
   #endif
 #endif
 
+#if ENABLED(SR_LCD_3W_NL)
+  // Feature checks for SR_LCD_3W_NL
+#elif EITHER(LCD_I2C_TYPE_MCP23017, LCD_I2C_TYPE_MCP23008)
+  #define USES_LIQUIDTWI2
+#elif ANY(HAS_CHARACTER_LCD, LCD_I2C_TYPE_PCF8575, LCD_I2C_TYPE_PCA8574, SR_LCD_2W_NL, LCM1602)
+  #define USES_LIQUIDCRYSTAL
+#endif
+
 #if ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS)
   #define HAS_LCD_MENU 1
 #endif
 #if ENABLED(ADC_KEYPAD)
   #define HAS_ADC_BUTTONS 1
 #endif
 
 #if HAS_GRAPHICAL_LCD
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128

commit b0c6cfb0511b8d71fec26ab91cd945f3d623b3c0
Author: Giuliano Zaro <3684609+GMagician@users.noreply.github.com>
Date:   Thu Jul 9 10:11:57 2020 +0200

    MarlinUI support for up to 5 Material Presets (#18488)
    
    - Add `I` preset parameter to `G26`, `M106`, `M140`, and `M190`.
    - Extend menu items to permit a string interpolation.
    - Keep material names in a list and interpolate in menu items.
    - Extend material presets to support up to 5 predefined materials.
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 877518c897..10755c180e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -582,28 +582,20 @@
   #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #undef Z_MIN_ENDSTOP_INVERTING
     #define Z_MIN_ENDSTOP_INVERTING false
   #endif
 #endif
 
 #ifndef NUM_SERVOS
   #define NUM_SERVOS 0
 #endif
 
-#ifndef PREHEAT_1_LABEL
-  #define PREHEAT_1_LABEL "PLA"
-#endif
-
-#ifndef PREHEAT_2_LABEL
-  #define PREHEAT_2_LABEL "ABS"
-#endif
-
 /**
  * Set a flag for a servo probe (or BLTouch)
  */
 #if defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0
   #define HAS_Z_SERVO_PROBE 1
 #endif
 #if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
   #define HAS_SERVO_ANGLES 1
 #endif
 #if !HAS_SERVO_ANGLES

commit d6682c860924ca96ee51c15906beffc8e4b4f37b
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Jul 7 01:57:05 2020 -0500

    Whitespace cleanup

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b1b2cf9b82..877518c897 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -114,36 +114,36 @@
 
   #define IS_RRD_SC
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(FYSETC_242_OLED_12864)
-      
+
   #define IS_RRD_SC
   #define U8GLIB_SH1106
-    
+
   #define LED_CONTROL_MENU
   #define NEOPIXEL_LED
   #undef NEOPIXEL_TYPE
   #define NEOPIXEL_TYPE       NEO_RGB
   #if NEOPIXEL_PIXELS < 3
     #undef NEOPIXELS_PIXELS
     #define NEOPIXEL_PIXELS     3
   #endif
   #ifndef NEOPIXEL_BRIGHTNESS
     #define NEOPIXEL_BRIGHTNESS 127
   #endif
-    
+
   #if ENABLED(PSU_CONTROL)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1, FYSETC_GENERIC_12864_1_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define IS_ULTIPANEL
   #define LED_COLORS_REDUCE_GREEN

commit 097347b5756dbbe54a4463d07e0c8cf3db792123
Author: George Fu <nailao_5918@163.com>
Date:   Fri Jul 3 09:33:52 2020 +0800

    Add FYSETC 2.42 inch OLED support (#18485)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 639c5765af..b1b2cf9b82 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -113,20 +113,41 @@
 #elif ENABLED(MKS_12864OLED)
 
   #define IS_RRD_SC
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC
   #define IS_U8GLIB_SSD1306
 
+#elif ENABLED(FYSETC_242_OLED_12864)
+      
+  #define IS_RRD_SC
+  #define U8GLIB_SH1106
+    
+  #define LED_CONTROL_MENU
+  #define NEOPIXEL_LED
+  #undef NEOPIXEL_TYPE
+  #define NEOPIXEL_TYPE       NEO_RGB
+  #if NEOPIXEL_PIXELS < 3
+    #undef NEOPIXELS_PIXELS
+    #define NEOPIXEL_PIXELS     3
+  #endif
+  #ifndef NEOPIXEL_BRIGHTNESS
+    #define NEOPIXEL_BRIGHTNESS 127
+  #endif
+    
+  #if ENABLED(PSU_CONTROL)
+    #define LED_BACKLIGHT_TIMEOUT 10000
+  #endif
+
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1, FYSETC_GENERIC_12864_1_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define IS_ULTIPANEL
   #define LED_COLORS_REDUCE_GREEN
   #if ENABLED(PSU_CONTROL) && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 

commit 70fa4c9323543dfb65d10969838899575406cae6
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Jul 1 16:18:20 2020 -0500

    Per-Hotend Default PIDs (#18483)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 71b5d7a89a..639c5765af 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -470,20 +470,22 @@
 
 #if HOTENDS
   #define HAS_HOTEND 1
   #ifndef HOTEND_OVERSHOOT
     #define HOTEND_OVERSHOOT 15
   #endif
   #if HOTENDS > 1
     #define HAS_MULTI_HOTEND 1
     #define HAS_HOTEND_OFFSET 1
   #endif
+#else
+  #undef PID_PARAMS_PER_HOTEND
 #endif
 
 // Helper macros for extruder and hotend arrays
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_BY_EXTRUDERS(v1, v1, v1, v1, v1, v1, v1, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
 #define ARRAY_BY_HOTENDS1(v1) ARRAY_BY_HOTENDS(v1, v1, v1, v1, v1, v1, v1, v1)
 
 #if ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)

commit 819e48972d9cb321275a37fcfccaf2a990f4f222
Author: Jason Smith <jason.inet@gmail.com>
Date:   Mon Jun 22 13:27:01 2020 -0700

    Improve U8G+SPI delay override (#18386)
    
    Co-authored-by: Scott Lahteine <github@thinkyhead.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c54687a2d5..71b5d7a89a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -99,29 +99,23 @@
 
 #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
   #define DOGLCD
   #define U8GLIB_ST7920
   #define IS_ULTIPANEL
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define IS_RRD_FG_SC
-  #ifndef ST7920_DELAY_1
-    #define ST7920_DELAY_1 DELAY_NS(125)
-  #endif
-  #ifndef ST7920_DELAY_2
-    #define ST7920_DELAY_2 DELAY_NS(125)
-  #endif
-  #ifndef ST7920_DELAY_3
-    #define ST7920_DELAY_3 DELAY_NS(125)
-  #endif
+  #define BOARD_ST7920_DELAY_1 DELAY_NS(125)
+  #define BOARD_ST7920_DELAY_2 DELAY_NS(125)
+  #define BOARD_ST7920_DELAY_3 DELAY_NS(125)
 
 #elif ENABLED(MKS_12864OLED)
 
   #define IS_RRD_SC
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC
   #define IS_U8GLIB_SSD1306

commit 2603a237f9553fe55262e4612a7a78fb98f030a4
Author: thisiskeithb <13375512+thisiskeithb@users.noreply.github.com>
Date:   Tue Jun 16 00:43:09 2020 -0700

    Add MKS LCD12864 A/B Controller Support (#18120)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index df4c5aade0..c54687a2d5 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -28,21 +28,29 @@
 
 #if ENABLED(MORGAN_SCARA)
   #define IS_SCARA 1
   #define IS_KINEMATIC 1
 #elif ENABLED(DELTA)
   #define IS_KINEMATIC 1
 #else
   #define IS_CARTESIAN 1
 #endif
 
-#if ENABLED(CARTESIO_UI)
+#if ENABLED(MKS_LCD12864)
+  #define MKS_MINI_12864
+#endif
+
+#if EITHER(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
+
+  #define MINIPANEL
+
+#elif ENABLED(CARTESIO_UI)
 
   #define DOGLCD
   #define IS_ULTIPANEL
 
 #elif ENABLED(ZONESTAR_LCD)
 
   #define ADC_KEYPAD
   #define IS_RRW_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
@@ -111,24 +119,20 @@
 #elif ENABLED(MKS_12864OLED)
 
   #define IS_RRD_SC
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC
   #define IS_U8GLIB_SSD1306
 
-#elif EITHER(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
-
-  #define MINIPANEL
-
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1, FYSETC_GENERIC_12864_1_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define IS_ULTIPANEL
   #define LED_COLORS_REDUCE_GREEN
   #if ENABLED(PSU_CONTROL) && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 

commit f4c258dc2355fee871bec6e11095c7c4777b160d
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Jun 16 01:45:27 2020 -0500

    Creality Ender 3 v2 (#17719)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b2addd6561..df4c5aade0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -522,20 +522,29 @@
   #define UNUSED_E(E) NOOP
 #else
   #undef DISTINCT_E_FACTORS
   #define DISTINCT_E 1
   #define XYZE_N XYZE
   #define E_INDEX_N(E) 0
   #define E_AXIS_N(E) E_AXIS
   #define UNUSED_E(E) UNUSED(E)
 #endif
 
+#if ENABLED(DWIN_CREALITY_LCD)
+  #define SERIAL_CATCHALL 0
+#endif
+
+// Pressure sensor with a BLTouch-like interface
+#if ENABLED(CREALITY_TOUCH)
+  #define BLTOUCH
+#endif
+
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif
   #ifndef NUM_SERVOS
     #define NUM_SERVOS (Z_PROBE_SERVO_NR + 1)

commit 642112d3eb7c1af9a52feec8134c85ed3e34891c
Author: makerbase <4164049@qq.com>
Date:   Tue Jun 16 10:05:33 2020 +0800

    Add MKS UI (TFT_LITTLE_VGL_UI) (#18071)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 11cf582637..b2addd6561 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -234,20 +234,22 @@
 #if ENABLED(U8GLIB_SH1106_EINSTART)
   #define DOGLCD
   #define IS_ULTIPANEL
 #endif
 
 // FSMC/SPI TFT Panels
 #if ENABLED(FSMC_GRAPHICAL_TFT)
   #define DOGLCD
   #define IS_ULTIPANEL
   #define DELAYED_BACKLIGHT_INIT
+#elif ENABLED(SPI_GRAPHICAL_TFT)
+  #define DELAYED_BACKLIGHT_INIT
 #endif
 
 /**
  * I2C Panels
  */
 
 #if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander

commit 213d4b890ea4997db63b0946cde766581d7f96e5
Author: Italo Soares <italocjs@live.com>
Date:   Mon May 18 02:50:35 2020 -0300

    Hotend Idle Timeout (#16362)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 47a94d0074..11cf582637 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -407,20 +407,21 @@
 
 #if EXTRUDERS == 0
   #undef EXTRUDERS
   #define EXTRUDERS 0
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef MK2_MULTIPLEXER
   #undef PRUSA_MMU2
+  #undef HOTEND_IDLE_TIMEOUT
 #endif
 
 #if ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif

commit 798dc688473fe1d8c3faaec47b171ff8778d03c7
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon May 11 23:25:39 2020 -0500

    Combine some conditions

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2ab3f426e2..47a94d0074 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -563,35 +563,35 @@
 #ifndef PREHEAT_2_LABEL
   #define PREHEAT_2_LABEL "ABS"
 #endif
 
 /**
  * Set a flag for a servo probe (or BLTouch)
  */
 #if defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0
   #define HAS_Z_SERVO_PROBE 1
 #endif
-#if HAS_Z_SERVO_PROBE || EITHER(SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
+#if ANY(HAS_Z_SERVO_PROBE, SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
   #define HAS_SERVO_ANGLES 1
 #endif
 #if !HAS_SERVO_ANGLES
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
  * Set flags for enabled probes
  */
 #if ANY(HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE)
   #define HAS_BED_PROBE 1
 #endif
 
-#if HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING)
+#if ANY(HAS_BED_PROBE, PROBE_MANUALLY, MESH_BED_LEVELING)
   #define PROBE_SELECTED 1
 #endif
 
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #define HAS_CUSTOM_PROBE_PIN 1
   #endif
@@ -675,21 +675,21 @@
 #endif
 #ifndef INVERT_E_DIR
   #define INVERT_E_DIR false
 #endif
 
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 // This flag indicates some kind of jerk storage is needed
-#if ENABLED(CLASSIC_JERK) || IS_KINEMATIC
+#if EITHER(CLASSIC_JERK, IS_KINEMATIC)
   #define HAS_CLASSIC_JERK 1
 #endif
 
 #if DISABLED(CLASSIC_JERK)
   #define HAS_JUNCTION_DEVIATION 1
 #endif
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
 #if ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE))
   #define HAS_CLASSIC_E_JERK 1

commit e5b0892f08f605a99dc15d68a6fef4b8f85cbe72
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sun May 10 04:40:19 2020 -0500

    Fix TERN typo, EXTRA_PROBING
    
    Co-Authored-By: Matthew Kennedy <mattkenn4545@gmail.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3ea27be420..2ab3f426e2 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -598,21 +598,21 @@
   #if Z_HOME_DIR < 0 && (!HAS_CUSTOM_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
-    #if EXTRA_PROBING
+    #if EXTRA_PROBING > 0
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 

commit eeabe66fc49501222fc458f5c298893e4d88ee17
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue May 5 00:28:39 2020 -0500

    Some distinct E helpers

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e6c671f713..3ea27be420 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -401,21 +401,20 @@
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */
 
 #if EXTRUDERS == 0
   #undef EXTRUDERS
   #define EXTRUDERS 0
-  #undef DISTINCT_E_FACTORS
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef MK2_MULTIPLEXER
   #undef PRUSA_MMU2
 #endif
 
 #if ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
@@ -506,26 +505,30 @@
   #endif
   #ifndef HOTEND_OFFSET_Z
     #define HOTEND_OFFSET_Z { 0 } // Z offsets for each extruder
   #endif
 #endif
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
+  #define DISTINCT_E E_STEPPERS
   #define XYZE_N (XYZ + E_STEPPERS)
+  #define E_INDEX_N(E) (E)
   #define E_AXIS_N(E) AxisEnum(E_AXIS + E)
   #define UNUSED_E(E) NOOP
 #else
   #undef DISTINCT_E_FACTORS
+  #define DISTINCT_E 1
   #define XYZE_N XYZE
+  #define E_INDEX_N(E) 0
   #define E_AXIS_N(E) E_AXIS
   #define UNUSED_E(E) UNUSED(E)
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR

commit 2efe28ca598f8d6fb6b17a2c5d29daac79d89dcb
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat May 2 23:26:12 2020 -0500

    Minor conditional clean

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ab8b812f55..e6c671f713 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -328,23 +328,21 @@
 #elif ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define IS_ULTIPANEL
 #endif
 
 #if ENABLED(IS_ULTIPANEL)
   #define ULTIPANEL
 #endif
 #if ENABLED(ULTIPANEL)
   #define IS_ULTRA_LCD
-  #ifndef NEWPANEL
-    #define NEWPANEL
-  #endif
+  #define NEWPANEL
 #endif
 
 #if ENABLED(IS_ULTRA_LCD)
   #define ULTRA_LCD
 #endif
 
 #if ENABLED(IS_RRW_KEYPAD)
   #define REPRAPWORLD_KEYPAD
 #endif
 

commit c4d57462dc96f7da5c9e46600a9c6c2da41f537e
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Apr 27 04:49:31 2020 -0500

    Apply HAS_MULTI_HOTEND

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c47899b34c..ab8b812f55 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -468,21 +468,21 @@
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
 #if HOTENDS
   #define HAS_HOTEND 1
   #ifndef HOTEND_OVERSHOOT
     #define HOTEND_OVERSHOOT 15
   #endif
-  #if HOTENDS_ > 1
+  #if HOTENDS > 1
     #define HAS_MULTI_HOTEND 1
     #define HAS_HOTEND_OFFSET 1
   #endif
 #endif
 
 // Helper macros for extruder and hotend arrays
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_BY_EXTRUDERS(v1, v1, v1, v1, v1, v1, v1, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)

commit 33217b0dd0e2117905813e3a45632fdc9c66d04f
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Apr 27 04:48:11 2020 -0500

    Add HOTEND_OVERSHOOT

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9558c314d1..c47899b34c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -465,21 +465,24 @@
 #endif
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
 #if HOTENDS
   #define HAS_HOTEND 1
-  #if HOTENDS > 1
+  #ifndef HOTEND_OVERSHOOT
+    #define HOTEND_OVERSHOOT 15
+  #endif
+  #if HOTENDS_ > 1
     #define HAS_MULTI_HOTEND 1
     #define HAS_HOTEND_OFFSET 1
   #endif
 #endif
 
 // Helper macros for extruder and hotend arrays
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_BY_EXTRUDERS(v1, v1, v1, v1, v1, v1, v1, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)

commit 8b3c7dda755ebce5bd57a7ce52891a137ea12b35
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Apr 27 04:41:18 2020 -0500

    Add HAS_FAN and others

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 14aa031ac6..9558c314d1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -401,20 +401,22 @@
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */
 
 #if EXTRUDERS == 0
+  #undef EXTRUDERS
+  #define EXTRUDERS 0
   #undef DISTINCT_E_FACTORS
   #undef SINGLENOZZLE
   #undef SWITCHING_EXTRUDER
   #undef SWITCHING_NOZZLE
   #undef MIXING_EXTRUDER
   #undef MK2_MULTIPLEXER
   #undef PRUSA_MMU2
 #endif
 
 #if ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS

commit 3a27933ae7c874c6a33c5300ebee517756883c76
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Apr 24 22:35:46 2020 -0500

    Fixes for FYSETC Touch EVE 5" on AVR (#17659)
    
    Co-Authored-By: RudolphRiedel <rudolphriedel@users.noreply.github.com>
    Co-authored-by: sL1pKn07 <sl1pkn07@gmail.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 92c264a66f..14aa031ac6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -354,21 +354,21 @@
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Aliases for LCD features
 #if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY)
   #define HAS_DGUS_LCD 1
 #endif
 
-// Extensible UI serial touch screens. (See src/lcd/extensible_ui)
+// Extensible UI serial touch screens. (See src/lcd/extui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE)
   #define IS_EXTUI
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(ULTRA_LCD, EXTENSIBLE_UI)
   #define HAS_DISPLAY 1
   #if ENABLED(ULTRA_LCD)
     #define HAS_SPI_LCD 1

commit 55d66fb8971d9e5dbfb15e7ae5c952839b488f59
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Apr 23 20:49:11 2020 -0500

    Add HAS_JUNCTION_DEVIATION

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 626d353e38..92c264a66f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -673,20 +673,24 @@
 
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 // This flag indicates some kind of jerk storage is needed
 #if ENABLED(CLASSIC_JERK) || IS_KINEMATIC
   #define HAS_CLASSIC_JERK 1
 #endif
 
+#if DISABLED(CLASSIC_JERK)
+  #define HAS_JUNCTION_DEVIATION 1
+#endif
+
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
 #if ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE))
   #define HAS_CLASSIC_E_JERK 1
 #endif
 
 #ifndef SPI_SPEED
   #define SPI_SPEED SPI_FULL_SPEED
 #endif
 
 #if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1

commit 6d90d1e1f552dca5e21bc61b676b8e8ce731b280
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Apr 22 16:35:03 2020 -0500

    Apply TERN to compact code (#17619)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ac44e832d6..626d353e38 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -424,21 +424,23 @@
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
   #if DISABLED(SWITCHING_NOZZLE)
     #define HOTENDS       E_STEPPERS
   #endif
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
-  #define DUAL_MIXING_EXTRUDER (MIXING_STEPPERS == 2)
+  #if MIXING_STEPPERS == 2
+    #define HAS_DUAL_MIXING 1
+  #endif
 #elif ENABLED(SWITCHING_TOOLHEAD)
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 #elif ENABLED(PRUSA_MMU2)
   #define E_STEPPERS 1
 #endif
 
 // No inactive extruders with MK2_MULTIPLEXER or SWITCHING_NOZZLE
 #if EITHER(MK2_MULTIPLEXER, SWITCHING_NOZZLE)
   #undef DISABLE_INACTIVE_EXTRUDER

commit 15f6f53638a6778d22a17e1900fb3a9fdc92dade
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sun Apr 19 23:56:55 2020 -0500

    Add HAS_HOTEND, etc.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7adb08a4e6..ac44e832d6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -459,39 +459,43 @@
 #ifndef HOTENDS
   #define HOTENDS EXTRUDERS
 #endif
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
+#if HOTENDS
+  #define HAS_HOTEND 1
+  #if HOTENDS > 1
+    #define HAS_MULTI_HOTEND 1
+    #define HAS_HOTEND_OFFSET 1
+  #endif
+#endif
+
 // Helper macros for extruder and hotend arrays
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_BY_EXTRUDERS(v1, v1, v1, v1, v1, v1, v1, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
 #define ARRAY_BY_HOTENDS1(v1) ARRAY_BY_HOTENDS(v1, v1, v1, v1, v1, v1, v1, v1)
 
 #if ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
   #define DO_SWITCH_EXTRUDER 1
 #endif
 
 #ifdef SWITCHING_NOZZLE_E1_SERVO_NR
   #define SWITCHING_NOZZLE_TWO_SERVOS 1
 #endif
 
-#if HOTENDS > 1
-  #define HAS_HOTEND_OFFSET 1
-#endif
-
 /**
  * Default hotend offsets, if not defined
  */
 #if HAS_HOTEND_OFFSET
   #ifndef HOTEND_OFFSET_X
     #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
   #endif
   #ifndef HOTEND_OFFSET_Y
     #define HOTEND_OFFSET_Y { 0 } // Y offsets for each extruder
   #endif

commit 360e07c90f8149cc4ff6d91082d9080ea8f3f474
Author: djessup <djessup@users.noreply.github.com>
Date:   Sat Apr 18 00:02:21 2020 +1000

    Add USE_PROBE_FOR_Z_HOMING option (#17359)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index dd1f13fae0..7adb08a4e6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -576,21 +576,21 @@
   #define PROBE_SELECTED 1
 #endif
 
 #if HAS_BED_PROBE
   #if DISABLED(NOZZLE_AS_PROBE)
     #define HAS_PROBE_XY_OFFSET 1
   #endif
   #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #define HAS_CUSTOM_PROBE_PIN 1
   #endif
-  #if Z_HOME_DIR < 0 && !HAS_CUSTOM_PROBE_PIN
+  #if Z_HOME_DIR < 0 && (!HAS_CUSTOM_PROBE_PIN || ENABLED(USE_PROBE_FOR_Z_HOMING))
     #define HOMING_Z_WITH_PROBE 1
   #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
   #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING

commit cd4060a99cb11b8cb0915294bb91ea427f89ff33
Author: ellensp <ellensp@hotmail.com>
Date:   Tue Mar 24 11:55:21 2020 +1300

    Add USB serial support to SERIAL_PORT_2 on DUE (#17245)
    
    Co-authored-by: Scott Lahteine <thinkyhead@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2907694fb4..dd1f13fae0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -676,17 +676,21 @@
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
 #if ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE))
   #define HAS_CLASSIC_E_JERK 1
 #endif
 
 #ifndef SPI_SPEED
   #define SPI_SPEED SPI_FULL_SPEED
 #endif
 
+#if SERIAL_PORT == -1 || SERIAL_PORT_2 == -1
+  #define HAS_USB_SERIAL 1
+#endif
+
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP
   #define EXTRUDE_MINTEMP 170
 #endif

commit 118bd2f8b2a1f81884cb55a8fc00b708a51aa15b
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Mar 13 23:18:16 2020 -0500

    Apply loop shorthand macros (#17159)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 71f422ffd9..2907694fb4 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -597,22 +597,66 @@
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 
+/**
+ * Set granular options based on the specific type of leveling
+ */
+#if ENABLED(AUTO_BED_LEVELING_UBL)
+  #undef LCD_BED_LEVELING
+  #if ENABLED(DELTA)
+    #define UBL_SEGMENTED 1
+  #endif
+#endif
+#if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_3POINT)
+  #define ABL_PLANAR 1
+#endif
+#if EITHER(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR)
+  #define ABL_GRID 1
+#endif
+#if ANY(AUTO_BED_LEVELING_LINEAR, AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_3POINT)
+  #define HAS_ABL_NOT_UBL 1
+#endif
+#if ANY(AUTO_BED_LEVELING_BILINEAR, AUTO_BED_LEVELING_UBL, MESH_BED_LEVELING)
+  #define HAS_MESH 1
+#endif
+#if EITHER(AUTO_BED_LEVELING_UBL, AUTO_BED_LEVELING_3POINT)
+  #define NEEDS_THREE_PROBE_POINTS 1
+#endif
+#if EITHER(HAS_ABL_NOT_UBL, AUTO_BED_LEVELING_UBL)
+  #define HAS_ABL_OR_UBL 1
+  #if DISABLED(PROBE_MANUALLY)
+    #define HAS_AUTOLEVEL 1
+  #endif
+#endif
+#if EITHER(HAS_ABL_OR_UBL, MESH_BED_LEVELING)
+  #define HAS_LEVELING 1
+  #if DISABLED(AUTO_BED_LEVELING_UBL)
+    #define PLANNER_LEVELING 1
+  #endif
+#endif
+#if EITHER(HAS_ABL_OR_UBL, Z_MIN_PROBE_REPEATABILITY_TEST)
+  #define HAS_PROBING_PROCEDURE 1
+#endif
+#if !HAS_LEVELING
+  #undef RESTORE_LEVELING_AFTER_G28
+#endif
+
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
+  #define GRID_LOOP(A,B) LOOP_L_N(A, GRID_MAX_POINTS_X) LOOP_L_N(B, GRID_MAX_POINTS_Y)
 #endif
 
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif
 #ifndef INVERT_Y_DIR
   #define INVERT_Y_DIR false
 #endif
 #ifndef INVERT_Z_DIR
   #define INVERT_Z_DIR false

commit 201c991cfa13006553486b47a9925e3fd11ec784
Author: George Fu <nailao_5918@163.com>
Date:   Wed Mar 11 16:40:30 2020 +0800

    Fix and update DGUS displays (#17072)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9725acffc1..71f422ffd9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -349,25 +349,26 @@
 #endif
 
 // Keypad needs a move step
 #if ENABLED(REPRAPWORLD_KEYPAD)
   #define NEWPANEL
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
-// Extensible UI serial touch screens. (See src/lcd/extensible_ui)
+// Aliases for LCD features
 #if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY)
   #define HAS_DGUS_LCD 1
 #endif
 
+// Extensible UI serial touch screens. (See src/lcd/extensible_ui)
 #if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE)
   #define IS_EXTUI
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #if EITHER(ULTRA_LCD, EXTENSIBLE_UI)
   #define HAS_DISPLAY 1
   #if ENABLED(ULTRA_LCD)
     #define HAS_SPI_LCD 1

commit 8f66dbfcd51aeae4f6168cfce971964bb46c9454
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Mar 10 15:43:06 2020 -0500

    SD_DETECT_INVERTED => SD_DETECT_STATE (#17112)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7011e02ca6..9725acffc1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -67,21 +67,20 @@
   #define IS_ULTRA_LCD
   #define DOGLCD
   #define IS_ULTIPANEL
 
   #if ENABLED(miniVIKI)
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(VIKI2)
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
     #define U8GLIB_LM6059_AF
-    #define SD_DETECT_INVERTED
   #elif ENABLED(AZSMZ_12864)
     #define U8GLIB_ST7565_64128N
   #endif
 
 #elif ENABLED(OLED_PANEL_TINYBOY2)
 
   #define IS_U8GLIB_SSD1306
   #define IS_ULTIPANEL
 
 #elif ENABLED(RA_CONTROL_PANEL)

commit 64d092935b27ff89955f0430eef5815b15e5a92d
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Mar 7 22:20:41 2020 -0600

    More useful ENABLED / DISABLED macros (#17054)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b4da3439bb..7011e02ca6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -19,20 +19,29 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
+#if ENABLED(MORGAN_SCARA)
+  #define IS_SCARA 1
+  #define IS_KINEMATIC 1
+#elif ENABLED(DELTA)
+  #define IS_KINEMATIC 1
+#else
+  #define IS_CARTESIAN 1
+#endif
+
 #if ENABLED(CARTESIO_UI)
 
   #define DOGLCD
   #define IS_ULTIPANEL
 
 #elif ENABLED(ZONESTAR_LCD)
 
   #define ADC_KEYPAD
   #define IS_RRW_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
@@ -186,21 +195,23 @@
   #define PCA9632_GRN         0x00
   #define PCA9632_RED         0x02
   #define PCA9632_BUZZER
   #define PCA9632_BUZZER_DATA { 0x09, 0x02 }
 
   #define ENCODER_PULSES_PER_STEP     1 // Overlord uses buttons
   #define ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 
 // 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
-#define HAS_SSD1306_OLED_I2C ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
+#if ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
+  #define HAS_SSD1306_OLED_I2C 1
+#endif
 #if HAS_SSD1306_OLED_I2C
   #define IS_ULTRA_LCD
   #define DOGLCD
 #endif
 
 // ST7920-based graphical displays
 #if ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
   #define U8GLIB_ST7920
   #define IS_RRD_SC
@@ -340,33 +351,48 @@
 
 // Keypad needs a move step
 #if ENABLED(REPRAPWORLD_KEYPAD)
   #define NEWPANEL
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extensible_ui)
-#if ANY(MALYAN_LCD, DGUS_LCD, TOUCH_UI_FTDI_EVE)
+#if ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY)
+  #define HAS_DGUS_LCD 1
+#endif
+
+#if ANY(HAS_DGUS_LCD, MALYAN_LCD, TOUCH_UI_FTDI_EVE)
   #define IS_EXTUI
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
-#define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
-#define HAS_DISPLAY         (HAS_SPI_LCD || ENABLED(EXTENSIBLE_UI))
-#define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
-#define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
-#define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
-#define HAS_ADC_BUTTONS      ENABLED(ADC_KEYPAD)
-#define HAS_DGUS_LCD         ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY)
+#if EITHER(ULTRA_LCD, EXTENSIBLE_UI)
+  #define HAS_DISPLAY 1
+  #if ENABLED(ULTRA_LCD)
+    #define HAS_SPI_LCD 1
+    #if ENABLED(DOGLCD)
+      #define HAS_GRAPHICAL_LCD 1
+    #else
+      #define HAS_CHARACTER_LCD 1
+    #endif
+  #endif
+#endif
+
+#if ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS)
+  #define HAS_LCD_MENU 1
+#endif
+#if ENABLED(ADC_KEYPAD)
+  #define HAS_ADC_BUTTONS 1
+#endif
 
 #if HAS_GRAPHICAL_LCD
   #ifndef LCD_PIXEL_WIDTH
     #define LCD_PIXEL_WIDTH 128
   #endif
   #ifndef LCD_PIXEL_HEIGHT
     #define LCD_PIXEL_HEIGHT 64
   #endif
 #endif
 
@@ -440,26 +466,31 @@
   #define E_MANUAL EXTRUDERS
 #endif
 
 // Helper macros for extruder and hotend arrays
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
 #define ARRAY_BY_EXTRUDERS1(v1) ARRAY_BY_EXTRUDERS(v1, v1, v1, v1, v1, v1, v1, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
 #define ARRAY_BY_HOTENDS1(v1) ARRAY_BY_HOTENDS(v1, v1, v1, v1, v1, v1, v1, v1)
 
-#define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
-#define SWITCHING_NOZZLE_TWO_SERVOS defined(SWITCHING_NOZZLE_E1_SERVO_NR)
+#if ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR)
+  #define DO_SWITCH_EXTRUDER 1
+#endif
 
-#define HAS_DUPLICATION_MODE EITHER(DUAL_X_CARRIAGE, MULTI_NOZZLE_DUPLICATION)
+#ifdef SWITCHING_NOZZLE_E1_SERVO_NR
+  #define SWITCHING_NOZZLE_TWO_SERVOS 1
+#endif
 
-#define HAS_HOTEND_OFFSET (HOTENDS > 1)
+#if HOTENDS > 1
+  #define HAS_HOTEND_OFFSET 1
+#endif
 
 /**
  * Default hotend offsets, if not defined
  */
 #if HAS_HOTEND_OFFSET
   #ifndef HOTEND_OFFSET_X
     #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
   #endif
   #ifndef HOTEND_OFFSET_Y
     #define HOTEND_OFFSET_Y { 0 } // Y offsets for each extruder
@@ -502,113 +533,114 @@
 
   // Always disable probe pin inverting for BLTouch
   #undef Z_MIN_PROBE_ENDSTOP_INVERTING
   #define Z_MIN_PROBE_ENDSTOP_INVERTING false
   #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #undef Z_MIN_ENDSTOP_INVERTING
     #define Z_MIN_ENDSTOP_INVERTING false
   #endif
 #endif
 
+#ifndef NUM_SERVOS
+  #define NUM_SERVOS 0
+#endif
+
 #ifndef PREHEAT_1_LABEL
   #define PREHEAT_1_LABEL "PLA"
 #endif
 
 #ifndef PREHEAT_2_LABEL
   #define PREHEAT_2_LABEL "ABS"
 #endif
 
 /**
  * Set a flag for a servo probe (or BLTouch)
  */
-#define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
-#define HAS_SERVO_ANGLES (HAS_Z_SERVO_PROBE || EITHER(SWITCHING_EXTRUDER, SWITCHING_NOZZLE))
+#if defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0
+  #define HAS_Z_SERVO_PROBE 1
+#endif
+#if HAS_Z_SERVO_PROBE || EITHER(SWITCHING_EXTRUDER, SWITCHING_NOZZLE)
+  #define HAS_SERVO_ANGLES 1
+#endif
 #if !HAS_SERVO_ANGLES
   #undef EDITABLE_SERVO_ANGLES
 #endif
 
 /**
  * Set flags for enabled probes
  */
-#define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
-#define PROBE_SELECTED (HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING))
+#if ANY(HAS_Z_SERVO_PROBE, FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE)
+  #define HAS_BED_PROBE 1
+#endif
+
+#if HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING)
+  #define PROBE_SELECTED 1
+#endif
 
 #if HAS_BED_PROBE
-  #define HAS_PROBE_XY_OFFSET   DISABLED(NOZZLE_AS_PROBE)
-  #define HAS_CUSTOM_PROBE_PIN  DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
-  #define HOMING_Z_WITH_PROBE   (Z_HOME_DIR < 0 && !HAS_CUSTOM_PROBE_PIN)
+  #if DISABLED(NOZZLE_AS_PROBE)
+    #define HAS_PROBE_XY_OFFSET 1
+  #endif
+  #if DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
+    #define HAS_CUSTOM_PROBE_PIN 1
+  #endif
+  #if Z_HOME_DIR < 0 && !HAS_CUSTOM_PROBE_PIN
+    #define HOMING_Z_WITH_PROBE 1
+  #endif
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
-    #define PROBE_TRIGGERED_WHEN_STOWED_TEST // Extra test for Allen Key Probe
+    #define PROBE_TRIGGERED_WHEN_STOWED_TEST 1 // Extra test for Allen Key Probe
   #endif
-  #ifdef MULTIPLE_PROBING
+  #if MULTIPLE_PROBING > 1
     #if EXTRA_PROBING
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else
       #define TOTAL_PROBING MULTIPLE_PROBING
     #endif
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
-#define HAS_EXTRA_ENDSTOPS           ANY(X_DUAL_ENDSTOPS, Y_DUAL_ENDSTOPS, Z_MULTI_ENDSTOPS)
-#define HAS_SOFTWARE_ENDSTOPS        EITHER(MIN_SOFTWARE_ENDSTOPS, MAX_SOFTWARE_ENDSTOPS)
-#define HAS_RESUME_CONTINUE          ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
-#define HAS_COLOR_LEDS               ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
-#define HAS_LEDS_OFF_FLAG            (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
-#define HAS_PRINT_PROGRESS           EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
-#define HAS_PRINT_PROGRESS_PERMYRIAD (HAS_PRINT_PROGRESS && EITHER(PRINT_PROGRESS_SHOW_DECIMALS, SHOW_REMAINING_TIME))
-#define HAS_SERVICE_INTERVALS        (ENABLED(PRINTCOUNTER) && (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0))
-#define HAS_FILAMENT_SENSOR          ENABLED(FILAMENT_RUNOUT_SENSOR)
-
-#define HAS_GAMES     ANY(MARLIN_BRICKOUT, MARLIN_INVADERS, MARLIN_SNAKE, MARLIN_MAZE)
-#define HAS_GAME_MENU (1 < ENABLED(MARLIN_BRICKOUT) + ENABLED(MARLIN_INVADERS) + ENABLED(MARLIN_SNAKE) + ENABLED(MARLIN_MAZE))
-
-#define IS_SCARA     ENABLED(MORGAN_SCARA)
-#define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
-#define IS_CARTESIAN !IS_KINEMATIC
-
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif
 #ifndef INVERT_Y_DIR
   #define INVERT_Y_DIR false
 #endif
 #ifndef INVERT_Z_DIR
   #define INVERT_Z_DIR false
 #endif
 #ifndef INVERT_E_DIR
   #define INVERT_E_DIR false
 #endif
 
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
-#define IS_RE_ARM_BOARD MB(RAMPS_14_RE_ARM_EFB, RAMPS_14_RE_ARM_EEB, RAMPS_14_RE_ARM_EFF, RAMPS_14_RE_ARM_EEF, RAMPS_14_RE_ARM_SF)
-
-// Linear advance uses Jerk since E is an isolated axis
-#define HAS_LINEAR_E_JERK  (DISABLED(CLASSIC_JERK) && ENABLED(LIN_ADVANCE))
-
 // This flag indicates some kind of jerk storage is needed
-#define HAS_CLASSIC_JERK   (ENABLED(CLASSIC_JERK) || IS_KINEMATIC)
+#if ENABLED(CLASSIC_JERK) || IS_KINEMATIC
+  #define HAS_CLASSIC_JERK 1
+#endif
 
 // E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
-#define HAS_CLASSIC_E_JERK (ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE)))
+#if ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE))
+  #define HAS_CLASSIC_E_JERK 1
+#endif
 
 #ifndef SPI_SPEED
   #define SPI_SPEED SPI_FULL_SPEED
 #endif
 
 /**
  * This setting is also used by M109 when trying to calculate
  * a ballpark safe margin to prevent wait-forever situation.
  */
 #ifndef EXTRUDE_MINTEMP

commit cc822bf70fd4683a00fcf5c3ea5b5e6a62a0d10b
Author: Jason Smith <jason.inet@gmail.com>
Date:   Sun Mar 1 19:19:02 2020 -0800

    Fix some 8 extruders issues, GTR build (#17043)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 640bae93a8..b4da3439bb 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -436,23 +436,23 @@
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS
 #endif
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
 // Helper macros for extruder and hotend arrays
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 #define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
-#define ARRAY_BY_EXTRUDERS1(v1) ARRAY_BY_EXTRUDERS(v1, v1, v1, v1, v1, v1)
+#define ARRAY_BY_EXTRUDERS1(v1) ARRAY_BY_EXTRUDERS(v1, v1, v1, v1, v1, v1, v1, v1)
 #define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
-#define ARRAY_BY_HOTENDS1(v1) ARRAY_BY_HOTENDS(v1, v1, v1, v1, v1, v1)
+#define ARRAY_BY_HOTENDS1(v1) ARRAY_BY_HOTENDS(v1, v1, v1, v1, v1, v1, v1, v1)
 
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 #define SWITCHING_NOZZLE_TWO_SERVOS defined(SWITCHING_NOZZLE_E1_SERVO_NR)
 
 #define HAS_DUPLICATION_MODE EITHER(DUAL_X_CARRIAGE, MULTI_NOZZLE_DUPLICATION)
 
 #define HAS_HOTEND_OFFSET (HOTENDS > 1)
 
 /**
  * Default hotend offsets, if not defined

commit 730804289c3134102aa0c1db4f5845b088531f85
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Feb 29 04:14:40 2020 -0600

    Catch more LPC1768 pin conflicts (#17019)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9227f2c81a..640bae93a8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -426,37 +426,56 @@
 #if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
   #define HOTENDS       1
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #endif
 
 #ifndef HOTENDS
   #define HOTENDS EXTRUDERS
 #endif
-
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS
 #endif
-
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
+// Helper macros for extruder and hotend arrays
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
+#define ARRAY_BY_EXTRUDERS(V...) ARRAY_N(EXTRUDERS, V)
+#define ARRAY_BY_EXTRUDERS1(v1) ARRAY_BY_EXTRUDERS(v1, v1, v1, v1, v1, v1)
+#define ARRAY_BY_HOTENDS(V...) ARRAY_N(HOTENDS, V)
+#define ARRAY_BY_HOTENDS1(v1) ARRAY_BY_HOTENDS(v1, v1, v1, v1, v1, v1)
 
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 #define SWITCHING_NOZZLE_TWO_SERVOS defined(SWITCHING_NOZZLE_E1_SERVO_NR)
 
-#define HAS_HOTEND_OFFSET (HOTENDS > 1)
 #define HAS_DUPLICATION_MODE EITHER(DUAL_X_CARRIAGE, MULTI_NOZZLE_DUPLICATION)
 
+#define HAS_HOTEND_OFFSET (HOTENDS > 1)
+
+/**
+ * Default hotend offsets, if not defined
+ */
+#if HAS_HOTEND_OFFSET
+  #ifndef HOTEND_OFFSET_X
+    #define HOTEND_OFFSET_X { 0 } // X offsets for each extruder
+  #endif
+  #ifndef HOTEND_OFFSET_Y
+    #define HOTEND_OFFSET_Y { 0 } // Y offsets for each extruder
+  #endif
+  #ifndef HOTEND_OFFSET_Z
+    #define HOTEND_OFFSET_Z { 0 } // Z offsets for each extruder
+  #endif
+#endif
+
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N(E) AxisEnum(E_AXIS + E)
   #define UNUSED_E(E) NOOP
 #else
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE
@@ -568,15 +587,30 @@
 #ifndef INVERT_E_DIR
   #define INVERT_E_DIR false
 #endif
 
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 #define IS_RE_ARM_BOARD MB(RAMPS_14_RE_ARM_EFB, RAMPS_14_RE_ARM_EEB, RAMPS_14_RE_ARM_EFF, RAMPS_14_RE_ARM_EEF, RAMPS_14_RE_ARM_SF)
 
-#define HAS_LINEAR_E_JERK (DISABLED(CLASSIC_JERK) && ENABLED(LIN_ADVANCE))
+// Linear advance uses Jerk since E is an isolated axis
+#define HAS_LINEAR_E_JERK  (DISABLED(CLASSIC_JERK) && ENABLED(LIN_ADVANCE))
+
+// This flag indicates some kind of jerk storage is needed
+#define HAS_CLASSIC_JERK   (ENABLED(CLASSIC_JERK) || IS_KINEMATIC)
+
+// E jerk exists with JD disabled (of course) but also when Linear Advance is disabled on Delta/SCARA
+#define HAS_CLASSIC_E_JERK (ENABLED(CLASSIC_JERK) || (IS_KINEMATIC && DISABLED(LIN_ADVANCE)))
 
 #ifndef SPI_SPEED
   #define SPI_SPEED SPI_FULL_SPEED
 #endif
+
+/**
+ * This setting is also used by M109 when trying to calculate
+ * a ballpark safe margin to prevent wait-forever situation.
+ */
+#ifndef EXTRUDE_MINTEMP
+  #define EXTRUDE_MINTEMP 170
+#endif

commit 0a7e7a6fa59172f61d3d6ed94d9ccf055c85bf27
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Feb 26 06:26:54 2020 -0600

    Allow servo features in combination (#16960)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7373e65d67..9227f2c81a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -495,20 +495,24 @@
 #endif
 
 #ifndef PREHEAT_2_LABEL
   #define PREHEAT_2_LABEL "ABS"
 #endif
 
 /**
  * Set a flag for a servo probe (or BLTouch)
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
+#define HAS_SERVO_ANGLES (HAS_Z_SERVO_PROBE || EITHER(SWITCHING_EXTRUDER, SWITCHING_NOZZLE))
+#if !HAS_SERVO_ANGLES
+  #undef EDITABLE_SERVO_ANGLES
+#endif
 
 /**
  * Set flags for enabled probes
  */
 #define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING))
 
 #if HAS_BED_PROBE
   #define HAS_PROBE_XY_OFFSET   DISABLED(NOZZLE_AS_PROBE)
   #define HAS_CUSTOM_PROBE_PIN  DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)

commit 5b438fb20d8b96860d307253fb0f3a728bcbf223
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Feb 25 22:30:16 2020 -0600

    HAS_SDCARD_CONNECTION is more obsolete

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5cbdafd6e0..7373e65d67 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -564,17 +564,15 @@
 #ifndef INVERT_E_DIR
   #define INVERT_E_DIR false
 #endif
 
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 #define IS_RE_ARM_BOARD MB(RAMPS_14_RE_ARM_EFB, RAMPS_14_RE_ARM_EEB, RAMPS_14_RE_ARM_EFF, RAMPS_14_RE_ARM_EEF, RAMPS_14_RE_ARM_SF)
 
-#define HAS_SDCARD_CONNECTION EITHER(TARGET_LPC1768, ADAFRUIT_GRAND_CENTRAL_M4)
-
 #define HAS_LINEAR_E_JERK (DISABLED(CLASSIC_JERK) && ENABLED(LIN_ADVANCE))
 
 #ifndef SPI_SPEED
   #define SPI_SPEED SPI_FULL_SPEED
 #endif

commit b2328d089a1c3c375de729c0af623c638d631078
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat Feb 22 21:36:12 2020 -0600

    Allow LCD_PIXEL_WIDTH/HEIGHT override

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 67130d21e4..5cbdafd6e0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -354,20 +354,29 @@
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_DISPLAY         (HAS_SPI_LCD || ENABLED(EXTENSIBLE_UI))
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 #define HAS_ADC_BUTTONS      ENABLED(ADC_KEYPAD)
 #define HAS_DGUS_LCD         ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY)
 
+#if HAS_GRAPHICAL_LCD
+  #ifndef LCD_PIXEL_WIDTH
+    #define LCD_PIXEL_WIDTH 128
+  #endif
+  #ifndef LCD_PIXEL_HEIGHT
+    #define LCD_PIXEL_HEIGHT 64
+  #endif
+#endif
+
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */

commit 7b02a62da82034e9c1e2a6098f1bca39e06811a5
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Feb 11 09:05:45 2020 -0600

    Fix up tests

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7f387914d3..67130d21e4 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -483,21 +483,21 @@
 
 #ifndef PREHEAT_1_LABEL
   #define PREHEAT_1_LABEL "PLA"
 #endif
 
 #ifndef PREHEAT_2_LABEL
   #define PREHEAT_2_LABEL "ABS"
 #endif
 
 /**
- * Set a flag for a servo probe
+ * Set a flag for a servo probe (or BLTouch)
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
 #define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING))
 
 #if HAS_BED_PROBE

commit bfad23d3e2e590b257ebe4317d7b14cc2dd3435c
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Feb 3 08:00:57 2020 -0600

    (c) 2020

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c372960b2f..7f387914d3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1,13 +1,13 @@
 /**
  * Marlin 3D Printer Firmware
- * Copyright (c) 2019 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
+ * Copyright (c) 2020 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
  *
  * Based on Sprinter and grbl.
  * Copyright (c) 2011 Camiel Gubbels / Erik van der Zalm
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation, either version 3 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,

commit 0fcf2b1110d9f0d362e5aab9cc73d963710e9865
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Mon Jan 20 00:35:07 2020 -0500

    Quad Z stepper support (#16277)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0e87b79c2d..c372960b2f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -519,33 +519,30 @@
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
+#define HAS_EXTRA_ENDSTOPS           ANY(X_DUAL_ENDSTOPS, Y_DUAL_ENDSTOPS, Z_MULTI_ENDSTOPS)
 #define HAS_SOFTWARE_ENDSTOPS        EITHER(MIN_SOFTWARE_ENDSTOPS, MAX_SOFTWARE_ENDSTOPS)
 #define HAS_RESUME_CONTINUE          ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
 #define HAS_COLOR_LEDS               ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
 #define HAS_LEDS_OFF_FLAG            (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS           EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
 #define HAS_PRINT_PROGRESS_PERMYRIAD (HAS_PRINT_PROGRESS && EITHER(PRINT_PROGRESS_SHOW_DECIMALS, SHOW_REMAINING_TIME))
 #define HAS_SERVICE_INTERVALS        (ENABLED(PRINTCOUNTER) && (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0))
 #define HAS_FILAMENT_SENSOR          ENABLED(FILAMENT_RUNOUT_SENSOR)
 
-#define Z_MULTI_STEPPER_DRIVERS EITHER(Z_DUAL_STEPPER_DRIVERS, Z_TRIPLE_STEPPER_DRIVERS)
-#define Z_MULTI_ENDSTOPS        EITHER(Z_DUAL_ENDSTOPS, Z_TRIPLE_ENDSTOPS)
-#define HAS_EXTRA_ENDSTOPS     (EITHER(X_DUAL_ENDSTOPS, Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
-
 #define HAS_GAMES     ANY(MARLIN_BRICKOUT, MARLIN_INVADERS, MARLIN_SNAKE, MARLIN_MAZE)
 #define HAS_GAME_MENU (1 < ENABLED(MARLIN_BRICKOUT) + ENABLED(MARLIN_INVADERS) + ENABLED(MARLIN_SNAKE) + ENABLED(MARLIN_MAZE))
 
 #define IS_SCARA     ENABLED(MORGAN_SCARA)
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
 
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif

commit 4108c5d01fe56c4cb06bffdd926cbaf879e34f11
Author: George Fu <nailao_5918@163.com>
Date:   Sat Jan 18 03:16:05 2020 +0800

    Update FYSETC S6 pins (#16559)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 296662082f..0e87b79c2d 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -107,21 +107,21 @@
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC
   #define IS_U8GLIB_SSD1306
 
 #elif EITHER(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
 
   #define MINIPANEL
 
-#elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
+#elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1, FYSETC_GENERIC_12864_1_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define IS_ULTIPANEL
   #define LED_COLORS_REDUCE_GREEN
   #if ENABLED(PSU_CONTROL) && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
   // Require LED backlighting enabled

commit e593da1c23a4759f6591826f815a504f0272e21a
Author: George Fu <nailao_5918@163.com>
Date:   Sat Jan 4 11:00:44 2020 +0800

    Update and fix DGUS (#16317)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 1fbf222bfc..296662082f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -352,20 +352,21 @@
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_DISPLAY         (HAS_SPI_LCD || ENABLED(EXTENSIBLE_UI))
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 #define HAS_ADC_BUTTONS      ENABLED(ADC_KEYPAD)
+#define HAS_DGUS_LCD         ANY(DGUS_LCD_UI_ORIGIN, DGUS_LCD_UI_FYSETC, DGUS_LCD_UI_HIPRECY)
 
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *

commit 7f87a044cdb7c4ca3fca81d4d175987484710a1f
Author: greppp <gregory.perrin87@gmail.com>
Date:   Fri Jan 3 21:44:16 2020 -0500

    Fix Ender-2 display pins, add BTN_ENC (#16349)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a3cc222308..1fbf222bfc 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -103,21 +103,21 @@
 #elif ENABLED(MKS_12864OLED)
 
   #define IS_RRD_SC
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC
   #define IS_U8GLIB_SSD1306
 
-#elif ENABLED(MKS_MINI_12864)
+#elif EITHER(MKS_MINI_12864, ENDER2_STOCKDISPLAY)
 
   #define MINIPANEL
 
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define IS_ULTIPANEL
   #define LED_COLORS_REDUCE_GREEN
   #if ENABLED(PSU_CONTROL) && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)

commit 3cade6245e851af9a33d1f395758b898c4a06a30
Author: Jason Smith <jason.inet@gmail.com>
Date:   Fri Jan 3 17:46:26 2020 -0600

    Fix MIN_PROBE_EDGE bug in default ABL G29 (#16367)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a471e3d8b1..a3cc222308 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -493,20 +493,21 @@
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
 #define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING))
 
 #if HAS_BED_PROBE
+  #define HAS_PROBE_XY_OFFSET   DISABLED(NOZZLE_AS_PROBE)
   #define HAS_CUSTOM_PROBE_PIN  DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
   #define HOMING_Z_WITH_PROBE   (Z_HOME_DIR < 0 && !HAS_CUSTOM_PROBE_PIN)
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST // Extra test for Allen Key Probe
   #endif
   #ifdef MULTIPLE_PROBING
     #if EXTRA_PROBING

commit 1c9ccce5209cd1727bf80e632f4f781c651e0c35
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Tue Dec 24 01:03:08 2019 -0500

    Add NOZZLE_AS_PROBE (no probe offsets) (#15929)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 713de59c62..a471e3d8b1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -489,21 +489,21 @@
 #endif
 
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
-#define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
+#define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, NOZZLE_AS_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING))
 
 #if HAS_BED_PROBE
   #define HAS_CUSTOM_PROBE_PIN  DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
   #define HOMING_Z_WITH_PROBE   (Z_HOME_DIR < 0 && !HAS_CUSTOM_PROBE_PIN)
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST // Extra test for Allen Key Probe

commit ab61c09bffd8d9fa0bf696e9fbd057a85185dcad
Author: Tanguy Pruvot <tpruvot@users.noreply.github.com>
Date:   Fri Dec 6 07:47:50 2019 +0100

    Improve touch buttons behavior (#16109)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 543aa7122c..713de59c62 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -283,21 +283,21 @@
 
 #elif ANY(REPRAP_DISCOUNT_SMART_CONTROLLER, miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, OLED_PANEL_TINYBOY2, BQ_LCD_SMART_CONTROLLER, LCD_I2C_PANELOLU2)
 
   #define STD_ENCODER_PULSES_PER_STEP 4
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #endif
 
 #ifndef STD_ENCODER_PULSES_PER_STEP
   #if ENABLED(TOUCH_BUTTONS)
-    #define STD_ENCODER_PULSES_PER_STEP 1
+    #define STD_ENCODER_PULSES_PER_STEP 2
   #else
     #define STD_ENCODER_PULSES_PER_STEP 5
   #endif
 #endif
 #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 #ifndef ENCODER_PULSES_PER_STEP
   #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
 #endif

commit 441e822fb351d273477785af84d7d040c1a92cc0
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat Nov 23 16:53:44 2019 -0600

    LULZBOT_TOUCH_UI => TOUCH_UI_FTDI_EVE

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 81d7cec30e..543aa7122c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -340,21 +340,21 @@
 
 // Keypad needs a move step
 #if ENABLED(REPRAPWORLD_KEYPAD)
   #define NEWPANEL
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extensible_ui)
-#if ANY(MALYAN_LCD, DGUS_LCD, LULZBOT_TOUCH_UI)
+#if ANY(MALYAN_LCD, DGUS_LCD, TOUCH_UI_FTDI_EVE)
   #define IS_EXTUI
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_DISPLAY         (HAS_SPI_LCD || ENABLED(EXTENSIBLE_UI))
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))

commit 0f5d45725252294d5a6aad8ca30ab2f7d64741d7
Author: Giuliano Zaro <3684609+GMagician@users.noreply.github.com>
Date:   Thu Oct 24 19:23:06 2019 +0200

    Allow redundant temp sensor with SINGLENOZZLE (#15650)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2987a1e0a6..81d7cec30e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -409,21 +409,20 @@
 #endif
 
 // Prusa MK2 Multiplexer and MMU 2.0 force SINGLENOZZLE
 #if EITHER(MK2_MULTIPLEXER, PRUSA_MMU2)
   #define SINGLENOZZLE
 #endif
 
 #if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
   #define HOTENDS       1
-  #undef TEMP_SENSOR_1_AS_REDUNDANT
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #endif
 
 #ifndef HOTENDS
   #define HOTENDS EXTRUDERS
 #endif
 
 #ifndef E_STEPPERS
   #define E_STEPPERS EXTRUDERS

commit af214ff121dd977b002c9a9065f84b7ae1a66247
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Oct 22 15:43:37 2019 -0500

    Fix up PSU_CONTROL checks

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 42965a14f2..2987a1e0a6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -113,21 +113,21 @@
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
 
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define IS_ULTIPANEL
   #define LED_COLORS_REDUCE_GREEN
-  #if HAS_POWER_SWITCH && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
+  #if ENABLED(PSU_CONTROL) && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
     #define LED_CONTROL_MENU
     #define NEOPIXEL_LED
     #undef NEOPIXEL_TYPE

commit 53abfdc2c35fa7076515cef2ba3ce2403bef8a0f
Author: Jason Smith <jason.inet@gmail.com>
Date:   Tue Oct 15 12:18:46 2019 -0700

    Fix BLTOUCH and FAN PWM conflicts on SKR E3 boards (#15547)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ec74131592..42965a14f2 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -555,19 +555,19 @@
   #define INVERT_Z_DIR false
 #endif
 #ifndef INVERT_E_DIR
   #define INVERT_E_DIR false
 #endif
 
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
-#define IS_RE_ARM_BOARD (MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF))
+#define IS_RE_ARM_BOARD MB(RAMPS_14_RE_ARM_EFB, RAMPS_14_RE_ARM_EEB, RAMPS_14_RE_ARM_EFF, RAMPS_14_RE_ARM_EEF, RAMPS_14_RE_ARM_SF)
 
 #define HAS_SDCARD_CONNECTION EITHER(TARGET_LPC1768, ADAFRUIT_GRAND_CENTRAL_M4)
 
 #define HAS_LINEAR_E_JERK (DISABLED(CLASSIC_JERK) && ENABLED(LIN_ADVANCE))
 
 #ifndef SPI_SPEED
   #define SPI_SPEED SPI_FULL_SPEED
 #endif

commit fe4c69b64abc74bc1ee1eb16d3d3771e3afbf25d
Author: Piotr <peter_k@tut.by>
Date:   Tue Oct 15 21:28:04 2019 +0300

    Poll *all* enabled endstop pins (#15525)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a86f1c1b41..ec74131592 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -494,22 +494,22 @@
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
 #define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING))
 
 #if HAS_BED_PROBE
-  #define USES_Z_MIN_PROBE_ENDSTOP DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
-  #define HOMING_Z_WITH_PROBE      (Z_HOME_DIR < 0 && !USES_Z_MIN_PROBE_ENDSTOP)
+  #define HAS_CUSTOM_PROBE_PIN  DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
+  #define HOMING_Z_WITH_PROBE   (Z_HOME_DIR < 0 && !HAS_CUSTOM_PROBE_PIN)
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST // Extra test for Allen Key Probe
   #endif
   #ifdef MULTIPLE_PROBING
     #if EXTRA_PROBING
       #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
     #else

commit b20d5a7cc627164877c95859baaa614f8afc7b99
Author: LinFor <linfor@gmail.com>
Date:   Fri Oct 11 05:03:33 2019 +0300

    Estimate Remaining Time (graphical display) (#15497)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index cd994e2293..a86f1c1b41 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -518,27 +518,28 @@
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
-#define HAS_SOFTWARE_ENDSTOPS EITHER(MIN_SOFTWARE_ENDSTOPS, MAX_SOFTWARE_ENDSTOPS)
-#define HAS_RESUME_CONTINUE   ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
-#define HAS_COLOR_LEDS        ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
-#define HAS_LEDS_OFF_FLAG     (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
-#define HAS_PRINT_PROGRESS    EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
-#define HAS_SERVICE_INTERVALS (ENABLED(PRINTCOUNTER) && (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0))
-#define HAS_FILAMENT_SENSOR   ENABLED(FILAMENT_RUNOUT_SENSOR)
+#define HAS_SOFTWARE_ENDSTOPS        EITHER(MIN_SOFTWARE_ENDSTOPS, MAX_SOFTWARE_ENDSTOPS)
+#define HAS_RESUME_CONTINUE          ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
+#define HAS_COLOR_LEDS               ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
+#define HAS_LEDS_OFF_FLAG            (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
+#define HAS_PRINT_PROGRESS           EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
+#define HAS_PRINT_PROGRESS_PERMYRIAD (HAS_PRINT_PROGRESS && EITHER(PRINT_PROGRESS_SHOW_DECIMALS, SHOW_REMAINING_TIME))
+#define HAS_SERVICE_INTERVALS        (ENABLED(PRINTCOUNTER) && (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0))
+#define HAS_FILAMENT_SENSOR          ENABLED(FILAMENT_RUNOUT_SENSOR)
 
 #define Z_MULTI_STEPPER_DRIVERS EITHER(Z_DUAL_STEPPER_DRIVERS, Z_TRIPLE_STEPPER_DRIVERS)
 #define Z_MULTI_ENDSTOPS        EITHER(Z_DUAL_ENDSTOPS, Z_TRIPLE_ENDSTOPS)
 #define HAS_EXTRA_ENDSTOPS     (EITHER(X_DUAL_ENDSTOPS, Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
 
 #define HAS_GAMES     ANY(MARLIN_BRICKOUT, MARLIN_INVADERS, MARLIN_SNAKE, MARLIN_MAZE)
 #define HAS_GAME_MENU (1 < ENABLED(MARLIN_BRICKOUT) + ENABLED(MARLIN_INVADERS) + ENABLED(MARLIN_SNAKE) + ENABLED(MARLIN_MAZE))
 
 #define IS_SCARA     ENABLED(MORGAN_SCARA)
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)

commit dc14d4a13c1eb80a76237ebcab6d8a512d960391
Author: Marcio Teixeira <marcio@alephobjects.com>
Date:   Wed Oct 9 18:44:49 2019 -0600

    Improvements and fixes to Lulzbot UI (#15490)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 70526de342..cd994e2293 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -559,10 +559,14 @@
 
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 #define IS_RE_ARM_BOARD (MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF))
 
 #define HAS_SDCARD_CONNECTION EITHER(TARGET_LPC1768, ADAFRUIT_GRAND_CENTRAL_M4)
 
 #define HAS_LINEAR_E_JERK (DISABLED(CLASSIC_JERK) && ENABLED(LIN_ADVANCE))
+
+#ifndef SPI_SPEED
+  #define SPI_SPEED SPI_FULL_SPEED
+#endif

commit c0005e939cf9c1d9db16f20e605c3228bc41a758
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Oct 8 19:42:18 2019 -0500

    Enable junction deviation by default (#15481)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 101e085724..70526de342 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -557,10 +557,12 @@
   #define INVERT_E_DIR false
 #endif
 
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 #define IS_RE_ARM_BOARD (MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF))
 
 #define HAS_SDCARD_CONNECTION EITHER(TARGET_LPC1768, ADAFRUIT_GRAND_CENTRAL_M4)
+
+#define HAS_LINEAR_E_JERK (DISABLED(CLASSIC_JERK) && ENABLED(LIN_ADVANCE))

commit 55b8547f04119652ab0cac2a186702abaeaa001f
Author: DrDitto <DrDitto@users.noreply.github.com>
Date:   Mon Sep 30 01:11:58 2019 -0600

    Simplify MKS_MINI_12864 init (move 5ms to u8g seq.) (#15428)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0e1e65c87f..101e085724 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -121,20 +121,21 @@
   #define IS_ULTIPANEL
   #define LED_COLORS_REDUCE_GREEN
   #if HAS_POWER_SWITCH && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
+    #define LED_CONTROL_MENU
     #define NEOPIXEL_LED
     #undef NEOPIXEL_TYPE
     #define NEOPIXEL_TYPE       NEO_RGB
     #if NEOPIXEL_PIXELS < 3
       #undef NEOPIXELS_PIXELS
       #define NEOPIXEL_PIXELS     3
     #endif
     #ifndef NEOPIXEL_BRIGHTNESS
       #define NEOPIXEL_BRIGHTNESS 127
     #endif

commit 6b05d5d65d0b4f557021c0ed5c47ec4e5e97b43c
Author: Robby Candra <robbycandra.mail@gmail.com>
Date:   Thu Sep 5 01:13:05 2019 +0700

    Allow TOUCH_BUTTONS to be swapped (#15100)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2d088ed30b..0e1e65c87f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -281,21 +281,25 @@
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #elif ANY(REPRAP_DISCOUNT_SMART_CONTROLLER, miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, OLED_PANEL_TINYBOY2, BQ_LCD_SMART_CONTROLLER, LCD_I2C_PANELOLU2)
 
   #define STD_ENCODER_PULSES_PER_STEP 4
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #endif
 
 #ifndef STD_ENCODER_PULSES_PER_STEP
-  #define STD_ENCODER_PULSES_PER_STEP 5
+  #if ENABLED(TOUCH_BUTTONS)
+    #define STD_ENCODER_PULSES_PER_STEP 1
+  #else
+    #define STD_ENCODER_PULSES_PER_STEP 5
+  #endif
 #endif
 #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 #ifndef ENCODER_PULSES_PER_STEP
   #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
 #endif
 #ifndef ENCODER_STEPS_PER_MENU_ITEM
   #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
 #endif

commit 04a9962cb5e7e14759ae8189d3f082060b5b8961
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat Aug 24 00:57:50 2019 -0500

    Fix: Contrast override in pins files
    
    Move contrast handling to `Conditionals_post.h` so pins files can override the LCD defaults.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7b9ee0ab3a..2d088ed30b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -23,23 +23,20 @@
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
 #if ENABLED(CARTESIO_UI)
 
   #define DOGLCD
   #define IS_ULTIPANEL
-  #define LCD_CONTRAST_MIN  60
-  #define LCD_CONTRAST_MAX 140
-  #define LCD_CONTRAST_INIT 90
 
 #elif ENABLED(ZONESTAR_LCD)
 
   #define ADC_KEYPAD
   #define IS_RRW_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
   #define IS_ULTIPANEL
 
   // This helps to implement ADC_KEYPAD menus
@@ -56,39 +53,27 @@
 
   #define IS_RRD_FG_SC
 
 #elif ANY(miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
 
   #define IS_ULTRA_LCD
   #define DOGLCD
   #define IS_ULTIPANEL
 
   #if ENABLED(miniVIKI)
-    #define LCD_CONTRAST_MIN      75
-    #define LCD_CONTRAST_MAX     115
-    #define LCD_CONTRAST_INIT     95
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(VIKI2)
-    #define LCD_CONTRAST_MIN       0
-    #define LCD_CONTRAST_MAX     255
-    #define LCD_CONTRAST_INIT    140
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
-    #define LCD_CONTRAST_MIN      90
-    #define LCD_CONTRAST_MAX     130
-    #define LCD_CONTRAST_INIT    110
     #define U8GLIB_LM6059_AF
     #define SD_DETECT_INVERTED
   #elif ENABLED(AZSMZ_12864)
-    #define LCD_CONTRAST_MIN     120
-    #define LCD_CONTRAST_MAX     255
-    #define LCD_CONTRAST_INIT    190
     #define U8GLIB_ST7565_64128N
   #endif
 
 #elif ENABLED(OLED_PANEL_TINYBOY2)
 
   #define IS_U8GLIB_SSD1306
   #define IS_ULTIPANEL
 
 #elif ENABLED(RA_CONTROL_PANEL)
 
@@ -121,31 +106,26 @@
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
-  #define LCD_CONTRAST_MAX  255
-  #define LCD_CONTRAST_INIT 150
 
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define IS_ULTIPANEL
-  #define LCD_CONTRAST_MIN    0
-  #define LCD_CONTRAST_MAX  255
-  #define LCD_CONTRAST_INIT 220
   #define LED_COLORS_REDUCE_GREEN
   #if HAS_POWER_SWITCH && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
     #define NEOPIXEL_LED
@@ -159,23 +139,20 @@
       #define NEOPIXEL_BRIGHTNESS 127
     #endif
     //#define NEOPIXEL_STARTUP_TEST
   #endif
 
 #elif ENABLED(ULTI_CONTROLLER)
 
   #define IS_ULTIPANEL
   #define U8GLIB_SSD1309
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
-  #define LCD_CONTRAST_MIN    0
-  #define LCD_CONTRAST_MAX  254
-  #define LCD_CONTRAST_INIT 127
   #define ENCODER_PULSES_PER_STEP 2
   #define ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
   #define IS_RRD_SC
   #define LCD_WIDTH 16
   #define LCD_HEIGHT 2
 
 #endif
@@ -183,23 +160,20 @@
 #if ENABLED(IS_RRD_FG_SC)
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 #endif
 
 #if EITHER(MAKRPANEL, MINIPANEL)
   #define IS_ULTIPANEL
   #define DOGLCD
   #if ENABLED(MAKRPANEL)
     #define U8GLIB_ST7565_64128N
   #endif
-  #ifndef LCD_CONTRAST_INIT
-    #define LCD_CONTRAST_INIT    17
-  #endif
 #endif
 
 #if ENABLED(IS_U8GLIB_SSD1306)
   #define U8GLIB_SSD1306
 #endif
 
 #if ENABLED(OVERLORD_OLED)
   #define IS_ULTIPANEL
   #define U8GLIB_SH1106
   /**

commit e604f76703165027a22dc33c7875f4858e9f1c80
Author: Tanguy Pruvot <tpruvot@users.noreply.github.com>
Date:   Thu Aug 22 01:56:39 2019 +0200

    Enable contrast via LCD_CONTRAST_INIT (#15006)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0d719e844b..7b9ee0ab3a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -23,23 +23,23 @@
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
 #if ENABLED(CARTESIO_UI)
 
   #define DOGLCD
   #define IS_ULTIPANEL
-  #define DEFAULT_LCD_CONTRAST 90
-  #define LCD_CONTRAST_MIN 60
+  #define LCD_CONTRAST_MIN  60
   #define LCD_CONTRAST_MAX 140
+  #define LCD_CONTRAST_INIT 90
 
 #elif ENABLED(ZONESTAR_LCD)
 
   #define ADC_KEYPAD
   #define IS_RRW_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
   #define IS_ULTIPANEL
 
   // This helps to implement ADC_KEYPAD menus
@@ -58,37 +58,37 @@
 
 #elif ANY(miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
 
   #define IS_ULTRA_LCD
   #define DOGLCD
   #define IS_ULTIPANEL
 
   #if ENABLED(miniVIKI)
     #define LCD_CONTRAST_MIN      75
     #define LCD_CONTRAST_MAX     115
-    #define DEFAULT_LCD_CONTRAST  95
+    #define LCD_CONTRAST_INIT     95
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(VIKI2)
     #define LCD_CONTRAST_MIN       0
     #define LCD_CONTRAST_MAX     255
-    #define DEFAULT_LCD_CONTRAST 140
+    #define LCD_CONTRAST_INIT    140
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
     #define LCD_CONTRAST_MIN      90
     #define LCD_CONTRAST_MAX     130
-    #define DEFAULT_LCD_CONTRAST 110
+    #define LCD_CONTRAST_INIT    110
     #define U8GLIB_LM6059_AF
     #define SD_DETECT_INVERTED
   #elif ENABLED(AZSMZ_12864)
     #define LCD_CONTRAST_MIN     120
     #define LCD_CONTRAST_MAX     255
-    #define DEFAULT_LCD_CONTRAST 190
+    #define LCD_CONTRAST_INIT    190
     #define U8GLIB_ST7565_64128N
   #endif
 
 #elif ENABLED(OLED_PANEL_TINYBOY2)
 
   #define IS_U8GLIB_SSD1306
   #define IS_ULTIPANEL
 
 #elif ENABLED(RA_CONTROL_PANEL)
 
@@ -121,31 +121,31 @@
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define IS_RRD_SC
   #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
-  #define DEFAULT_LCD_CONTRAST 150
-  #define LCD_CONTRAST_MAX 255
+  #define LCD_CONTRAST_MAX  255
+  #define LCD_CONTRAST_INIT 150
 
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define IS_ULTIPANEL
-  #define LCD_CONTRAST_MIN 0
-  #define LCD_CONTRAST_MAX 255
-  #define DEFAULT_LCD_CONTRAST 220
+  #define LCD_CONTRAST_MIN    0
+  #define LCD_CONTRAST_MAX  255
+  #define LCD_CONTRAST_INIT 220
   #define LED_COLORS_REDUCE_GREEN
   #if HAS_POWER_SWITCH && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
     #define NEOPIXEL_LED
@@ -159,23 +159,23 @@
       #define NEOPIXEL_BRIGHTNESS 127
     #endif
     //#define NEOPIXEL_STARTUP_TEST
   #endif
 
 #elif ENABLED(ULTI_CONTROLLER)
 
   #define IS_ULTIPANEL
   #define U8GLIB_SSD1309
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
-  #define LCD_CONTRAST_MIN 0
-  #define LCD_CONTRAST_MAX 254
-  #define DEFAULT_LCD_CONTRAST 127
+  #define LCD_CONTRAST_MIN    0
+  #define LCD_CONTRAST_MAX  254
+  #define LCD_CONTRAST_INIT 127
   #define ENCODER_PULSES_PER_STEP 2
   #define ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
   #define IS_RRD_SC
   #define LCD_WIDTH 16
   #define LCD_HEIGHT 2
 
 #endif
@@ -183,22 +183,22 @@
 #if ENABLED(IS_RRD_FG_SC)
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 #endif
 
 #if EITHER(MAKRPANEL, MINIPANEL)
   #define IS_ULTIPANEL
   #define DOGLCD
   #if ENABLED(MAKRPANEL)
     #define U8GLIB_ST7565_64128N
   #endif
-  #ifndef DEFAULT_LCD_CONTRAST
-    #define DEFAULT_LCD_CONTRAST 17
+  #ifndef LCD_CONTRAST_INIT
+    #define LCD_CONTRAST_INIT    17
   #endif
 #endif
 
 #if ENABLED(IS_U8GLIB_SSD1306)
   #define U8GLIB_SSD1306
 #endif
 
 #if ENABLED(OVERLORD_OLED)
   #define IS_ULTIPANEL
   #define U8GLIB_SH1106
@@ -374,43 +374,20 @@
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_DISPLAY         (HAS_SPI_LCD || ENABLED(EXTENSIBLE_UI))
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 #define HAS_ADC_BUTTONS      ENABLED(ADC_KEYPAD)
 
-/**
- * Default LCD contrast for Graphical LCD displays
- */
-#define HAS_LCD_CONTRAST (                \
-     ENABLED(MAKRPANEL)                   \
-  || ENABLED(CARTESIO_UI)                 \
-  || ENABLED(VIKI2)                       \
-  || ENABLED(AZSMZ_12864)                 \
-  || ENABLED(miniVIKI)                    \
-  || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
-)
-#if HAS_LCD_CONTRAST
-  #ifndef LCD_CONTRAST_MIN
-    #define LCD_CONTRAST_MIN 0
-  #endif
-  #ifndef LCD_CONTRAST_MAX
-    #define LCD_CONTRAST_MAX 63
-  #endif
-  #ifndef DEFAULT_LCD_CONTRAST
-    #define DEFAULT_LCD_CONTRAST 32
-  #endif
-#endif
-
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */

commit dfcd43748649295cf1cc6da5ba68eb5a1cf2aa42
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Aug 14 00:00:46 2019 -0500

    Base HAS_LCD_CONTRAST on display type

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 411e2fe834..0d719e844b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -377,21 +377,28 @@
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_DISPLAY         (HAS_SPI_LCD || ENABLED(EXTENSIBLE_UI))
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 #define HAS_ADC_BUTTONS      ENABLED(ADC_KEYPAD)
 
 /**
  * Default LCD contrast for Graphical LCD displays
  */
-#define HAS_LCD_CONTRAST (HAS_GRAPHICAL_LCD && defined(DEFAULT_LCD_CONTRAST))
+#define HAS_LCD_CONTRAST (                \
+     ENABLED(MAKRPANEL)                   \
+  || ENABLED(CARTESIO_UI)                 \
+  || ENABLED(VIKI2)                       \
+  || ENABLED(AZSMZ_12864)                 \
+  || ENABLED(miniVIKI)                    \
+  || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
+)
 #if HAS_LCD_CONTRAST
   #ifndef LCD_CONTRAST_MIN
     #define LCD_CONTRAST_MIN 0
   #endif
   #ifndef LCD_CONTRAST_MAX
     #define LCD_CONTRAST_MAX 63
   #endif
   #ifndef DEFAULT_LCD_CONTRAST
     #define DEFAULT_LCD_CONTRAST 32
   #endif

commit 274934ad81ee6cd9b4f686e55107966cc4e23bd7
Author: Marcio Teixeira <marcio@alephobjects.com>
Date:   Fri Aug 16 17:34:13 2019 -0600

    Add LULZBOT_TOUCH_UI (#14967)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b9d1123211..411e2fe834 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -361,21 +361,21 @@
 
 // Keypad needs a move step
 #if ENABLED(REPRAPWORLD_KEYPAD)
   #define NEWPANEL
   #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extensible_ui)
-#if EITHER(MALYAN_LCD, DGUS_LCD)
+#if ANY(MALYAN_LCD, DGUS_LCD, LULZBOT_TOUCH_UI)
   #define IS_EXTUI
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_DISPLAY         (HAS_SPI_LCD || ENABLED(EXTENSIBLE_UI))
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))

commit d7172a45588b61264e8bee0f0cd6ddfd485e8702
Author: Ludy <Ludy87@users.noreply.github.com>
Date:   Sun Aug 11 02:22:18 2019 +0200

    Cleanup and conditions (#14886)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9d6706b994..b9d1123211 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -587,43 +587,17 @@
 #ifndef INVERT_Y_DIR
   #define INVERT_Y_DIR false
 #endif
 #ifndef INVERT_Z_DIR
   #define INVERT_Z_DIR false
 #endif
 #ifndef INVERT_E_DIR
   #define INVERT_E_DIR false
 #endif
 
-#if ENABLED(HOST_ACTION_COMMANDS)
-  #ifndef ACTION_ON_PAUSE
-    #define ACTION_ON_PAUSE   "pause"
-  #endif
-  #ifndef ACTION_ON_RESUME
-    #define ACTION_ON_RESUME  "resume"
-  #endif
-  #ifndef ACTION_ON_PAUSED
-    #define ACTION_ON_PAUSED  "paused"
-  #endif
-  #ifndef ACTION_ON_RESUMED
-    #define ACTION_ON_RESUMED "resumed"
-  #endif
-  #ifndef ACTION_ON_CANCEL
-    #define ACTION_ON_CANCEL  "cancel"
-  #endif
-  #if ENABLED(G29_RETRY_AND_RECOVER)
-    #ifndef ACTION_ON_G29_RECOVER
-      #define ACTION_ON_G29_RECOVER "probe_rewipe"
-    #endif
-    #ifndef ACTION_ON_G29_FAILURE
-      #define ACTION_ON_G29_FAILURE "probe_failed"
-    #endif
-  #endif
-#endif
-
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 #define IS_RE_ARM_BOARD (MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF))
 
 #define HAS_SDCARD_CONNECTION EITHER(TARGET_LPC1768, ADAFRUIT_GRAND_CENTRAL_M4)

commit 9479ec32f7e7a811c1946a142fcb00e538bf87e2
Author: Ludy <Ludy87@users.noreply.github.com>
Date:   Sat Aug 10 07:53:26 2019 +0200

    Fix Service Menu compile error (#14903)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index da099fffaf..9d6706b994 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -560,21 +560,21 @@
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS EITHER(MIN_SOFTWARE_ENDSTOPS, MAX_SOFTWARE_ENDSTOPS)
 #define HAS_RESUME_CONTINUE   ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
 #define HAS_COLOR_LEDS        ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
 #define HAS_LEDS_OFF_FLAG     (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS    EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
-#define HAS_SERVICE_INTERVALS (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0)
+#define HAS_SERVICE_INTERVALS (ENABLED(PRINTCOUNTER) && (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0))
 #define HAS_FILAMENT_SENSOR   ENABLED(FILAMENT_RUNOUT_SENSOR)
 
 #define Z_MULTI_STEPPER_DRIVERS EITHER(Z_DUAL_STEPPER_DRIVERS, Z_TRIPLE_STEPPER_DRIVERS)
 #define Z_MULTI_ENDSTOPS        EITHER(Z_DUAL_ENDSTOPS, Z_TRIPLE_ENDSTOPS)
 #define HAS_EXTRA_ENDSTOPS     (EITHER(X_DUAL_ENDSTOPS, Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
 
 #define HAS_GAMES     ANY(MARLIN_BRICKOUT, MARLIN_INVADERS, MARLIN_SNAKE, MARLIN_MAZE)
 #define HAS_GAME_MENU (1 < ENABLED(MARLIN_BRICKOUT) + ENABLED(MARLIN_INVADERS) + ENABLED(MARLIN_SNAKE) + ENABLED(MARLIN_MAZE))
 
 #define IS_SCARA     ENABLED(MORGAN_SCARA)

commit 940c59d9dad5af071052f5c0cd1ec98c48c2778c
Author: Tim Moore <tim@youngmoores.com>
Date:   Fri Aug 2 04:19:45 2019 -0700

    Overlord i2c LCD with LEDs and buzzer (#14801)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 50d6e27ac7..da099fffaf 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -156,20 +156,21 @@
       #define NEOPIXEL_PIXELS     3
     #endif
     #ifndef NEOPIXEL_BRIGHTNESS
       #define NEOPIXEL_BRIGHTNESS 127
     #endif
     //#define NEOPIXEL_STARTUP_TEST
   #endif
 
 #elif ENABLED(ULTI_CONTROLLER)
 
+  #define IS_ULTIPANEL
   #define U8GLIB_SSD1309
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 254
   #define DEFAULT_LCD_CONTRAST 127
   #define ENCODER_PULSES_PER_STEP 2
   #define ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
@@ -191,62 +192,81 @@
   #endif
   #ifndef DEFAULT_LCD_CONTRAST
     #define DEFAULT_LCD_CONTRAST 17
   #endif
 #endif
 
 #if ENABLED(IS_U8GLIB_SSD1306)
   #define U8GLIB_SSD1306
 #endif
 
+#if ENABLED(OVERLORD_OLED)
+  #define IS_ULTIPANEL
+  #define U8GLIB_SH1106
+  /**
+   * PCA9632 for buzzer and LEDs via i2c
+   * No auto-inc, red and green leds switched, buzzer
+   */
+  #define PCA9632
+  #define PCA9632_NO_AUTO_INC
+  #define PCA9632_GRN         0x00
+  #define PCA9632_RED         0x02
+  #define PCA9632_BUZZER
+  #define PCA9632_BUZZER_DATA { 0x09, 0x02 }
+
+  #define ENCODER_PULSES_PER_STEP     1 // Overlord uses buttons
+  #define ENCODER_STEPS_PER_MENU_ITEM 1
+#endif
+
 // 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
 #define HAS_SSD1306_OLED_I2C ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
 #if HAS_SSD1306_OLED_I2C
   #define IS_ULTRA_LCD
   #define DOGLCD
 #endif
 
+// ST7920-based graphical displays
 #if ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
   #define U8GLIB_ST7920
   #define IS_RRD_SC
 #endif
 
+// RepRapDiscount LCD or Graphical LCD with rotary click encoder
 #if ENABLED(IS_RRD_SC)
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
 #endif
 
-#if ANY(ULTIMAKERCONTROLLER, REPRAP_DISCOUNT_SMART_CONTROLLER, G3D_PANEL, RIGIDBOT_PANEL, ULTI_CONTROLLER, PANEL_ONE, U8GLIB_SH1106)
+/**
+ * SPI Ultipanels
+ */
+
+// Basic Ultipanel-like displays
+#if ANY(ULTIMAKERCONTROLLER, REPRAP_DISCOUNT_SMART_CONTROLLER, G3D_PANEL, RIGIDBOT_PANEL, PANEL_ONE, U8GLIB_SH1106)
   #define IS_ULTIPANEL
 #endif
 
-/**
- * SPI PANELS
- */
+// Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
+#if ENABLED(U8GLIB_SH1106_EINSTART)
+  #define DOGLCD
+  #define IS_ULTIPANEL
+#endif
 
- // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
- #if ENABLED(U8GLIB_SH1106_EINSTART)
-   #define DOGLCD
-   #define IS_ULTIPANEL
- #endif
-
- /**
-  * FSMC/SPI TFT PANELS
-  */
- #if ENABLED(FSMC_GRAPHICAL_TFT)
-   #define DOGLCD
-   #define IS_ULTIPANEL
-   #define DELAYED_BACKLIGHT_INIT
- #endif
+// FSMC/SPI TFT Panels
+#if ENABLED(FSMC_GRAPHICAL_TFT)
+  #define DOGLCD
+  #define IS_ULTIPANEL
+  #define DELAYED_BACKLIGHT_INIT
+#endif
 
 /**
- * I2C PANELS
+ * I2C Panels
  */
 
 #if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
 
   #if ENABLED(LCD_SAINSMART_I2C_2004)
     #define LCD_WIDTH 20
     #define LCD_HEIGHT 4

commit bc58e678bde3399b6852ce5cd19e0031bb76eccb
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Jul 30 04:00:51 2019 -0500

    More general FSMC display option

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d0285a3fe9..50d6e27ac7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -225,21 +225,21 @@
 
  // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
  #if ENABLED(U8GLIB_SH1106_EINSTART)
    #define DOGLCD
    #define IS_ULTIPANEL
  #endif
 
  /**
   * FSMC/SPI TFT PANELS
   */
- #if ENABLED(MKS_ROBIN_TFT)
+ #if ENABLED(FSMC_GRAPHICAL_TFT)
    #define DOGLCD
    #define IS_ULTIPANEL
    #define DELAYED_BACKLIGHT_INIT
  #endif
 
 /**
  * I2C PANELS
  */
 
 #if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)

commit 290466578f8bb6ba0cd61e1dd3dc0839ae53d4f3
Author: Giuliano Zaro <3684609+GMagician@users.noreply.github.com>
Date:   Sun Jul 28 21:48:29 2019 +0200

    Adafruit Grand Central M4 (#14749)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 21c3c4e23c..d0285a3fe9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -598,10 +598,12 @@
       #define ACTION_ON_G29_FAILURE "probe_failed"
     #endif
   #endif
 #endif
 
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
 
 #define IS_RE_ARM_BOARD (MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF))
+
+#define HAS_SDCARD_CONNECTION EITHER(TARGET_LPC1768, ADAFRUIT_GRAND_CENTRAL_M4)

commit e5aa45329305be8ac5e277305d52a449a41bfc98
Author: Tim Moore <tim@youngmoores.com>
Date:   Sat Jul 20 21:14:09 2019 -0700

    Add support for 2 Neopixel strips (#14667)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index aa2ff7d41b..21c3c4e23c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -144,26 +144,28 @@
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
     #define NEOPIXEL_LED
     #undef NEOPIXEL_TYPE
     #define NEOPIXEL_TYPE       NEO_RGB
-    #undef NEOPIXEL_PIXELS
-    #define NEOPIXEL_PIXELS     3
+    #if NEOPIXEL_PIXELS < 3
+      #undef NEOPIXELS_PIXELS
+      #define NEOPIXEL_PIXELS     3
+    #endif
     #ifndef NEOPIXEL_BRIGHTNESS
       #define NEOPIXEL_BRIGHTNESS 127
     #endif
-    #define NEOPIXEL_STARTUP_TEST
+    //#define NEOPIXEL_STARTUP_TEST
   #endif
 
 #elif ENABLED(ULTI_CONTROLLER)
 
   #define U8GLIB_SSD1309
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 254
   #define DEFAULT_LCD_CONTRAST 127
   #define ENCODER_PULSES_PER_STEP 2

commit bae8d0a4bd0c0a80ed779442213cfec25fe71419
Author: Tanguy Pruvot <tpruvot@users.noreply.github.com>
Date:   Tue Jul 16 00:36:16 2019 +0200

    DOGM: Avoid white flash on TFT (re)init (#14631)
    
    - Avoid white flash on TFT (re)init. Unlike Graphical LCD, the TFT init color may be full white if the backlight is on during init.
    
    - Add a conditional for delayed backlight init which can be applied to any backlit display.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 17cd6cfbc1..aa2ff7d41b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -226,20 +226,21 @@
    #define DOGLCD
    #define IS_ULTIPANEL
  #endif
 
  /**
   * FSMC/SPI TFT PANELS
   */
  #if ENABLED(MKS_ROBIN_TFT)
    #define DOGLCD
    #define IS_ULTIPANEL
+   #define DELAYED_BACKLIGHT_INIT
  #endif
 
 /**
  * I2C PANELS
  */
 
 #if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander

commit 2d84bcb4cd2338e296b5cccb37eb491c6553ca25
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sun Jul 14 09:19:29 2019 -0500

    Simplify, update LCD sanity-check

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f43ea40d5f..17cd6cfbc1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -22,60 +22,52 @@
 #pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
 #if ENABLED(CARTESIO_UI)
 
   #define DOGLCD
-  #define ULTIPANEL
+  #define IS_ULTIPANEL
   #define DEFAULT_LCD_CONTRAST 90
   #define LCD_CONTRAST_MIN 60
   #define LCD_CONTRAST_MAX 140
 
-#elif ENABLED(MAKRPANEL)
-
-  #define U8GLIB_ST7565_64128N
-
 #elif ENABLED(ZONESTAR_LCD)
 
   #define ADC_KEYPAD
-  #define REPRAPWORLD_KEYPAD
+  #define IS_RRW_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
-  #define ULTIPANEL
+  #define IS_ULTIPANEL
 
   // This helps to implement ADC_KEYPAD menus
   #define REVERSE_MENU_DIRECTION
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
 
 #elif ENABLED(RADDS_DISPLAY)
-  #define ULTIPANEL
+  #define IS_ULTIPANEL
   #define ENCODER_PULSES_PER_STEP 2
 
-#elif ENABLED(ANET_FULL_GRAPHICS_LCD)
+#elif EITHER(ANET_FULL_GRAPHICS_LCD, BQ_LCD_SMART_CONTROLLER)
 
-  #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
-
-#elif ENABLED(BQ_LCD_SMART_CONTROLLER)
-
-  #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+  #define IS_RRD_FG_SC
 
 #elif ANY(miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
 
-  #define ULTRA_LCD
+  #define IS_ULTRA_LCD
   #define DOGLCD
-  #define ULTIMAKERCONTROLLER
+  #define IS_ULTIPANEL
 
   #if ENABLED(miniVIKI)
     #define LCD_CONTRAST_MIN      75
     #define LCD_CONTRAST_MAX     115
     #define DEFAULT_LCD_CONTRAST  95
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(VIKI2)
     #define LCD_CONTRAST_MIN       0
     #define LCD_CONTRAST_MAX     255
     #define DEFAULT_LCD_CONTRAST 140
@@ -88,164 +80,166 @@
     #define SD_DETECT_INVERTED
   #elif ENABLED(AZSMZ_12864)
     #define LCD_CONTRAST_MIN     120
     #define LCD_CONTRAST_MAX     255
     #define DEFAULT_LCD_CONTRAST 190
     #define U8GLIB_ST7565_64128N
   #endif
 
 #elif ENABLED(OLED_PANEL_TINYBOY2)
 
-  #define U8GLIB_SSD1306
-  #define ULTIPANEL
+  #define IS_U8GLIB_SSD1306
+  #define IS_ULTIPANEL
 
 #elif ENABLED(RA_CONTROL_PANEL)
 
   #define LCD_I2C_TYPE_PCA8574
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
-  #define ULTIPANEL
+  #define IS_ULTIPANEL
 
 #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
   #define DOGLCD
   #define U8GLIB_ST7920
-  #define ULTIPANEL
+  #define IS_ULTIPANEL
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
-  #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+  #define IS_RRD_FG_SC
   #ifndef ST7920_DELAY_1
     #define ST7920_DELAY_1 DELAY_NS(125)
   #endif
   #ifndef ST7920_DELAY_2
     #define ST7920_DELAY_2 DELAY_NS(125)
   #endif
   #ifndef ST7920_DELAY_3
     #define ST7920_DELAY_3 DELAY_NS(125)
   #endif
 
 #elif ENABLED(MKS_12864OLED)
 
-  #define REPRAP_DISCOUNT_SMART_CONTROLLER
+  #define IS_RRD_SC
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
-  #define REPRAP_DISCOUNT_SMART_CONTROLLER
-  #define U8GLIB_SSD1306
+  #define IS_RRD_SC
+  #define IS_U8GLIB_SSD1306
 
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
   #define DEFAULT_LCD_CONTRAST 150
   #define LCD_CONTRAST_MAX 255
 
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
-  #define ULTIPANEL
+  #define IS_ULTIPANEL
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 255
   #define DEFAULT_LCD_CONTRAST 220
   #define LED_COLORS_REDUCE_GREEN
-  #if (HAS_POWER_SWITCH && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1))
+  #if HAS_POWER_SWITCH && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
     #define NEOPIXEL_LED
     #undef NEOPIXEL_TYPE
     #define NEOPIXEL_TYPE       NEO_RGB
     #undef NEOPIXEL_PIXELS
     #define NEOPIXEL_PIXELS     3
     #ifndef NEOPIXEL_BRIGHTNESS
       #define NEOPIXEL_BRIGHTNESS 127
     #endif
     #define NEOPIXEL_STARTUP_TEST
   #endif
 
+#elif ENABLED(ULTI_CONTROLLER)
+
+  #define U8GLIB_SSD1309
+  #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
+  #define LCD_CONTRAST_MIN 0
+  #define LCD_CONTRAST_MAX 254
+  #define DEFAULT_LCD_CONTRAST 127
+  #define ENCODER_PULSES_PER_STEP 2
+  #define ENCODER_STEPS_PER_MENU_ITEM 2
+
+#elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
+
+  #define IS_RRD_SC
+  #define LCD_WIDTH 16
+  #define LCD_HEIGHT 2
+
+#endif
+
+#if ENABLED(IS_RRD_FG_SC)
+  #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 #endif
 
 #if EITHER(MAKRPANEL, MINIPANEL)
+  #define IS_ULTIPANEL
   #define DOGLCD
-  #define ULTIPANEL
+  #if ENABLED(MAKRPANEL)
+    #define U8GLIB_ST7565_64128N
+  #endif
   #ifndef DEFAULT_LCD_CONTRAST
     #define DEFAULT_LCD_CONTRAST 17
   #endif
 #endif
 
-#if ENABLED(ULTI_CONTROLLER)
-  #define U8GLIB_SSD1309
-  #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
-  #define LCD_CONTRAST_MIN 0
-  #define LCD_CONTRAST_MAX 254
-  #define DEFAULT_LCD_CONTRAST 127
-  #define ENCODER_PULSES_PER_STEP 2
-  #define ENCODER_STEPS_PER_MENU_ITEM 2
+#if ENABLED(IS_U8GLIB_SSD1306)
+  #define U8GLIB_SSD1306
 #endif
 
 // 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
 #define HAS_SSD1306_OLED_I2C ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
 #if HAS_SSD1306_OLED_I2C
-  #define ULTRA_LCD
+  #define IS_ULTRA_LCD
   #define DOGLCD
 #endif
 
-#if EITHER(PANEL_ONE, U8GLIB_SH1106)
-
-  #define ULTIMAKERCONTROLLER
-
-#elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
-
-  #define REPRAP_DISCOUNT_SMART_CONTROLLER
-  #define LCD_WIDTH 16
-  #define LCD_HEIGHT 2
-
-#endif
-
 #if ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
   #define U8GLIB_ST7920
-  #define REPRAP_DISCOUNT_SMART_CONTROLLER
+  #define IS_RRD_SC
 #endif
 
-#if ANY(ULTIMAKERCONTROLLER, REPRAP_DISCOUNT_SMART_CONTROLLER, G3D_PANEL, RIGIDBOT_PANEL, ULTI_CONTROLLER)
-  #define ULTIPANEL
+#if ENABLED(IS_RRD_SC)
+  #define REPRAP_DISCOUNT_SMART_CONTROLLER
 #endif
 
-#if ENABLED(REPRAPWORLD_KEYPAD)
-  #define NEWPANEL
-  #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
-    #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
-  #endif
+#if ANY(ULTIMAKERCONTROLLER, REPRAP_DISCOUNT_SMART_CONTROLLER, G3D_PANEL, RIGIDBOT_PANEL, ULTI_CONTROLLER, PANEL_ONE, U8GLIB_SH1106)
+  #define IS_ULTIPANEL
 #endif
 
 /**
  * SPI PANELS
  */
 
  // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
  #if ENABLED(U8GLIB_SH1106_EINSTART)
    #define DOGLCD
-   #define ULTIPANEL
+   #define IS_ULTIPANEL
  #endif
 
  /**
   * FSMC/SPI TFT PANELS
   */
  #if ENABLED(MKS_ROBIN_TFT)
    #define DOGLCD
-   #define ULTIPANEL
+   #define IS_ULTIPANEL
  #endif
 
 /**
  * I2C PANELS
  */
 
 #if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
@@ -255,48 +249,48 @@
     #define LCD_HEIGHT 4
   #endif
 
 #elif ENABLED(LCD_I2C_PANELOLU2)
 
   // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
 
   #define LCD_I2C_TYPE_MCP23017
   #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
   #define LCD_USE_I2C_BUZZER   // Enable buzzer on LCD (optional)
-  #define ULTIPANEL
+  #define IS_ULTIPANEL
 
 #elif ENABLED(LCD_I2C_VIKI)
 
   /**
    * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
    *
    * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
    * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
    * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
    *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
    */
   #define LCD_I2C_TYPE_MCP23017
   #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
   #define LCD_USE_I2C_BUZZER   // Enable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
-  #define ULTIPANEL
+  #define IS_ULTIPANEL
 
   #define ENCODER_FEEDRATE_DEADZONE 4
 
   #define STD_ENCODER_PULSES_PER_STEP 1
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(G3D_PANEL)
 
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
-#elif ANY(miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, OLED_PANEL_TINYBOY2, BQ_LCD_SMART_CONTROLLER, LCD_I2C_PANELOLU2, REPRAP_DISCOUNT_SMART_CONTROLLER)
+#elif ANY(REPRAP_DISCOUNT_SMART_CONTROLLER, miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, OLED_PANEL_TINYBOY2, BQ_LCD_SMART_CONTROLLER, LCD_I2C_PANELOLU2)
 
   #define STD_ENCODER_PULSES_PER_STEP 4
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
 #endif
 
 #ifndef STD_ENCODER_PULSES_PER_STEP
   #define STD_ENCODER_PULSES_PER_STEP 5
 #endif
 #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
@@ -311,46 +305,65 @@
 #ifndef ENCODER_FEEDRATE_DEADZONE
   #define ENCODER_FEEDRATE_DEADZONE 6
 #endif
 
 // Shift register panels
 // ---------------------
 // 2 wire Non-latching LCD SR from:
 // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
 #if ENABLED(FF_INTERFACEBOARD)
   #define SR_LCD_3W_NL    // Non latching 3 wire shift register
-  #define ULTIPANEL
+  #define IS_ULTIPANEL
+#elif ENABLED(SAV_3DLCD)
+  #define SR_LCD_2W_NL    // Non latching 2 wire shift register
+  #define IS_ULTIPANEL
 #endif
 
-#if ENABLED(SAV_3DLCD)
-  #define SR_LCD_2W_NL    // Non latching 2 wire shift register
+#if ENABLED(IS_ULTIPANEL)
   #define ULTIPANEL
 #endif
-
 #if ENABLED(ULTIPANEL)
-  #define NEWPANEL        // Disable if there's actually no click-encoder panel
+  #define IS_ULTRA_LCD
+  #ifndef NEWPANEL
+    #define NEWPANEL
+  #endif
+#endif
+
+#if ENABLED(IS_ULTRA_LCD)
   #define ULTRA_LCD
 #endif
 
+#if ENABLED(IS_RRW_KEYPAD)
+  #define REPRAPWORLD_KEYPAD
+#endif
+
+// Keypad needs a move step
+#if ENABLED(REPRAPWORLD_KEYPAD)
+  #define NEWPANEL
+  #ifndef REPRAPWORLD_KEYPAD_MOVE_STEP
+    #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
+  #endif
+#endif
+
 // Extensible UI serial touch screens. (See src/lcd/extensible_ui)
-#if EITHER(DGUS_LCD, MALYAN_LCD)
+#if EITHER(MALYAN_LCD, DGUS_LCD)
+  #define IS_EXTUI
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_DISPLAY         (HAS_SPI_LCD || ENABLED(EXTENSIBLE_UI))
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
-
-#define HAS_ADC_BUTTONS     ENABLED(ADC_KEYPAD)
+#define HAS_ADC_BUTTONS      ENABLED(ADC_KEYPAD)
 
 /**
  * Default LCD contrast for Graphical LCD displays
  */
 #define HAS_LCD_CONTRAST (HAS_GRAPHICAL_LCD && defined(DEFAULT_LCD_CONTRAST))
 #if HAS_LCD_CONTRAST
   #ifndef LCD_CONTRAST_MIN
     #define LCD_CONTRAST_MIN 0
   #endif
   #ifndef LCD_CONTRAST_MAX

commit 948c3f580b16c53f1f75f480fe7d9c028f94dd23
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Jul 11 06:11:07 2019 -0500

    Clean up some LCD conditions

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b55c658024..f43ea40d5f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -222,31 +222,28 @@
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 /**
  * SPI PANELS
  */
 
  // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
  #if ENABLED(U8GLIB_SH1106_EINSTART)
-   #define ULTRA_LCD
    #define DOGLCD
    #define ULTIPANEL
-   #define NEWPANEL
  #endif
 
  /**
   * FSMC/SPI TFT PANELS
   */
  #if ENABLED(MKS_ROBIN_TFT)
-   #define ULTRA_LCD
    #define DOGLCD
    #define ULTIPANEL
  #endif
 
 /**
  * I2C PANELS
  */
 
 #if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
@@ -323,21 +320,21 @@
   #define SR_LCD_3W_NL    // Non latching 3 wire shift register
   #define ULTIPANEL
 #endif
 
 #if ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define ULTIPANEL
 #endif
 
 #if ENABLED(ULTIPANEL)
-  #define NEWPANEL  // Disable this if you actually have no click-encoder panel
+  #define NEWPANEL        // Disable if there's actually no click-encoder panel
   #define ULTRA_LCD
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extensible_ui)
 #if EITHER(DGUS_LCD, MALYAN_LCD)
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)

commit eb6dec03bd8d5f6a99b594c933f0934c348f5034
Author: Tim Moore <tim@youngmoores.com>
Date:   Thu Jul 4 23:58:34 2019 -0700

    Simplify power supply naming logic (#14488)
    
    Co-Authored-By: Tim Moore <tim.moore@lightbend.com>
    Co-Authored-By: AnHardt <github@kitelab.de>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 18713e462b..b55c658024 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -141,21 +141,21 @@
 
 #elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define ULTIPANEL
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 255
   #define DEFAULT_LCD_CONTRAST 220
   #define LED_COLORS_REDUCE_GREEN
-  #if POWER_SUPPLY > 0 && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
+  #if (HAS_POWER_SWITCH && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1))
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
     #define NEOPIXEL_LED
     #undef NEOPIXEL_TYPE
     #define NEOPIXEL_TYPE       NEO_RGB

commit 371969b531f9ab26d40496623f520d6d724e9c21
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Jul 3 02:43:33 2019 -0500

    Remove deprecated SCARA option

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 21a1c53ae7..18713e462b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -537,21 +537,21 @@
 #define HAS_SERVICE_INTERVALS (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0)
 #define HAS_FILAMENT_SENSOR   ENABLED(FILAMENT_RUNOUT_SENSOR)
 
 #define Z_MULTI_STEPPER_DRIVERS EITHER(Z_DUAL_STEPPER_DRIVERS, Z_TRIPLE_STEPPER_DRIVERS)
 #define Z_MULTI_ENDSTOPS        EITHER(Z_DUAL_ENDSTOPS, Z_TRIPLE_ENDSTOPS)
 #define HAS_EXTRA_ENDSTOPS     (EITHER(X_DUAL_ENDSTOPS, Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
 
 #define HAS_GAMES     ANY(MARLIN_BRICKOUT, MARLIN_INVADERS, MARLIN_SNAKE, MARLIN_MAZE)
 #define HAS_GAME_MENU (1 < ENABLED(MARLIN_BRICKOUT) + ENABLED(MARLIN_INVADERS) + ENABLED(MARLIN_SNAKE) + ENABLED(MARLIN_MAZE))
 
-#define IS_SCARA     EITHER(MORGAN_SCARA, MAKERARM_SCARA)
+#define IS_SCARA     ENABLED(MORGAN_SCARA)
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
 
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif
 #ifndef INVERT_Y_DIR
   #define INVERT_Y_DIR false
 #endif
 #ifndef INVERT_Z_DIR

commit e6cf7860e8fafb5c2bdb95ff36ad7d598fa5636a
Author: Marcio Teixeira <marcio@alephobjects.com>
Date:   Fri Jun 28 23:23:57 2019 -0600

    Improve ExtUI, fix compiler errors, warnings (#14441)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7a71a6175b..21a1c53ae7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -444,24 +444,26 @@
 
 #define HAS_HOTEND_OFFSET (HOTENDS > 1)
 #define HAS_DUPLICATION_MODE EITHER(DUAL_X_CARRIAGE, MULTI_NOZZLE_DUPLICATION)
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N(E) AxisEnum(E_AXIS + E)
+  #define UNUSED_E(E) NOOP
 #else
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE
   #define E_AXIS_N(E) E_AXIS
+  #define UNUSED_E(E) UNUSED(E)
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif

commit 93cd66ac1146603e8a9911fceb3c63f4351f4d8e
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Jun 27 23:57:50 2019 -0500

    Tweaky change from (C) to (c)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index dc36febad3..7a71a6175b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1,16 +1,16 @@
 /**
  * Marlin 3D Printer Firmware
- * Copyright (C) 2019 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
+ * Copyright (c) 2019 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
  *
  * Based on Sprinter and grbl.
- * Copyright (C) 2011 Camiel Gubbels / Erik van der Zalm
+ * Copyright (c) 2011 Camiel Gubbels / Erik van der Zalm
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation, either version 3 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.

commit c41b005f33ce14a3ee0de4af5c6004a0d52137b6
Author: MrMabulous <matthias.buehlmann@mabulous.com>
Date:   Sat Jun 22 02:02:26 2019 +0200

    Add Extra Probing option, discarding outliers (#14338)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7d92bb7809..dc36febad3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -497,33 +497,39 @@
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
 #define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING))
 
 #if HAS_BED_PROBE
   #define USES_Z_MIN_PROBE_ENDSTOP DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
+  #define HOMING_Z_WITH_PROBE      (Z_HOME_DIR < 0 && !USES_Z_MIN_PROBE_ENDSTOP)
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST // Extra test for Allen Key Probe
   #endif
+  #ifdef MULTIPLE_PROBING
+    #if EXTRA_PROBING
+      #define TOTAL_PROBING (MULTIPLE_PROBING + EXTRA_PROBING)
+    #else
+      #define TOTAL_PROBING MULTIPLE_PROBING
+    #endif
+  #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 
-#define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
-
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS EITHER(MIN_SOFTWARE_ENDSTOPS, MAX_SOFTWARE_ENDSTOPS)
 #define HAS_RESUME_CONTINUE   ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
 #define HAS_COLOR_LEDS        ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
 #define HAS_LEDS_OFF_FLAG     (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS    EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
 #define HAS_SERVICE_INTERVALS (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0)

commit eeaef2410ac80b7bfa21fbec98abd00003ff83f8
Author: Tobias Frost <coldtobi@users.noreply.github.com>
Date:   Fri Jun 21 11:47:23 2019 +0200

    Support DGUS Display with DWIN OS (#13253)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 54cbcacf6a..7d92bb7809 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -328,21 +328,21 @@
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define ULTIPANEL
 #endif
 
 #if ENABLED(ULTIPANEL)
   #define NEWPANEL  // Disable this if you actually have no click-encoder panel
   #define ULTRA_LCD
 #endif
 
 // Extensible UI serial touch screens. (See src/lcd/extensible_ui)
-#if ENABLED(MALYAN_LCD)
+#if EITHER(DGUS_LCD, MALYAN_LCD)
   #define EXTENSIBLE_UI
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_DISPLAY         (HAS_SPI_LCD || ENABLED(EXTENSIBLE_UI))
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 

commit 75aeb41ab75e691f4841614d16f92164cff8742b
Author: Tanguy Pruvot <tpruvot@users.noreply.github.com>
Date:   Wed Jun 19 02:34:16 2019 +0200

    SKRmini support for Fysetc Mini Panel (#14319)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c876ea4656..54cbcacf6a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -39,21 +39,21 @@
   #define U8GLIB_ST7565_64128N
 
 #elif ENABLED(ZONESTAR_LCD)
 
   #define ADC_KEYPAD
   #define REPRAPWORLD_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
   #define ULTIPANEL
 
-  // this helps to implement ADC_KEYPAD menus
+  // This helps to implement ADC_KEYPAD menus
   #define REVERSE_MENU_DIRECTION
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
 
 #elif ENABLED(RADDS_DISPLAY)
   #define ULTIPANEL
   #define ENCODER_PULSES_PER_STEP 2
 
 #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
@@ -90,22 +90,20 @@
     #define LCD_CONTRAST_MIN     120
     #define LCD_CONTRAST_MAX     255
     #define DEFAULT_LCD_CONTRAST 190
     #define U8GLIB_ST7565_64128N
   #endif
 
 #elif ENABLED(OLED_PANEL_TINYBOY2)
 
   #define U8GLIB_SSD1306
   #define ULTIPANEL
-  #define REVERSE_ENCODER_DIRECTION
-  #define REVERSE_MENU_DIRECTION
 
 #elif ENABLED(RA_CONTROL_PANEL)
 
   #define LCD_I2C_TYPE_PCA8574
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
   #define ULTIPANEL
 
 #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
   #define DOGLCD
@@ -134,28 +132,28 @@
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define U8GLIB_SSD1306
 
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
   #define DEFAULT_LCD_CONTRAST 150
   #define LCD_CONTRAST_MAX 255
 
-#elif ANY(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
+#elif ANY(FYSETC_MINI_12864_X_X, FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define ULTIPANEL
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 255
-  #define DEFAULT_LCD_CONTRAST 255
+  #define DEFAULT_LCD_CONTRAST 220
   #define LED_COLORS_REDUCE_GREEN
   #if POWER_SUPPLY > 0 && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
     #define LED_BACKLIGHT_TIMEOUT 10000
   #endif
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
     #define NEOPIXEL_LED
@@ -174,21 +172,20 @@
 #if EITHER(MAKRPANEL, MINIPANEL)
   #define DOGLCD
   #define ULTIPANEL
   #ifndef DEFAULT_LCD_CONTRAST
     #define DEFAULT_LCD_CONTRAST 17
   #endif
 #endif
 
 #if ENABLED(ULTI_CONTROLLER)
   #define U8GLIB_SSD1309
-  #define REVERSE_ENCODER_DIRECTION
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 254
   #define DEFAULT_LCD_CONTRAST 127
   #define ENCODER_PULSES_PER_STEP 2
   #define ENCODER_STEPS_PER_MENU_ITEM 2
 #endif
 
 // 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
 #define HAS_SSD1306_OLED_I2C ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)

commit f2cfa408b74ad6d2d885c72e5fee9cde7973aa55
Author: Tanguy Pruvot <tpruvot@users.noreply.github.com>
Date:   Sat Jun 15 05:19:48 2019 +0200

    Touch-MI probe by hotends.fr (#14101)
    
    A simple Z probe using a magnet to deploy a probe. See https://youtu.be/E7Ik9PbKPl0 for the sensor description...

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 69b73a9194..c876ea4656 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -495,21 +495,21 @@
 #endif
 
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
-#define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
+#define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, TOUCH_MI_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING))
 
 #if HAS_BED_PROBE
   #define USES_Z_MIN_PROBE_ENDSTOP DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST // Extra test for Allen Key Probe
   #endif

commit 18904c42f6081391c5ffc096c8acf2ce54dc4a34
Author: MastS <51464853+MastS@users.noreply.github.com>
Date:   Thu Jun 13 04:59:39 2019 +0200

    Fysetc LCD backlight timeout (#14265)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e458ee6481..69b73a9194 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -143,20 +143,23 @@
 
 #elif ANY(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
 
   #define FYSETC_MINI_12864
   #define DOGLCD
   #define ULTIPANEL
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 255
   #define DEFAULT_LCD_CONTRAST 255
   #define LED_COLORS_REDUCE_GREEN
+  #if POWER_SUPPLY > 0 && EITHER(FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
+    #define LED_BACKLIGHT_TIMEOUT 10000
+  #endif
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
     #define NEOPIXEL_LED
     #undef NEOPIXEL_TYPE
     #define NEOPIXEL_TYPE       NEO_RGB
     #undef NEOPIXEL_PIXELS
     #define NEOPIXEL_PIXELS     3

commit 32afe1d1021d14300b90c4eb1e212625a0df15f7
Author: Minims <github@minims.fr>
Date:   Tue May 28 02:51:29 2019 +0200

    Fix TOOLCHANGE_ZRAISE warning (#14156)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a1b922bed6..e458ee6481 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -398,23 +398,20 @@
   #endif
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
   #define DUAL_MIXING_EXTRUDER (MIXING_STEPPERS == 2)
 #elif ENABLED(SWITCHING_TOOLHEAD)
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 #elif ENABLED(PRUSA_MMU2)
   #define E_STEPPERS 1
-  #ifndef TOOLCHANGE_ZRAISE
-    #define TOOLCHANGE_ZRAISE 0
-  #endif
 #endif
 
 // No inactive extruders with MK2_MULTIPLEXER or SWITCHING_NOZZLE
 #if EITHER(MK2_MULTIPLEXER, SWITCHING_NOZZLE)
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
 // Prusa MK2 Multiplexer and MMU 2.0 force SINGLENOZZLE
 #if EITHER(MK2_MULTIPLEXER, PRUSA_MMU2)
   #define SINGLENOZZLE

commit 456a0ee76b95ba428c8210a245d71f682b782909
Author: Bob Kuhn <bob.kuhn@att.net>
Date:   Sat May 11 16:51:39 2019 -0500

    Improve Due SW SPI, Fysetc sanity checks, &c. (#13939)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e447e06a51..a1b922bed6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -149,23 +149,28 @@
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 255
   #define DEFAULT_LCD_CONTRAST 255
   #define LED_COLORS_REDUCE_GREEN
 
   // Require LED backlighting enabled
   #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
     #define RGB_LED
   #elif ENABLED(FYSETC_MINI_12864_2_1)
     #define NEOPIXEL_LED
-    #define NEOPIXEL_TYPE       NEO_GRB
+    #undef NEOPIXEL_TYPE
+    #define NEOPIXEL_TYPE       NEO_RGB
+    #undef NEOPIXEL_PIXELS
     #define NEOPIXEL_PIXELS     3
-    #define NEOPIXEL_BRIGHTNESS 127
+    #ifndef NEOPIXEL_BRIGHTNESS
+      #define NEOPIXEL_BRIGHTNESS 127
+    #endif
+    #define NEOPIXEL_STARTUP_TEST
   #endif
 
 #endif
 
 #if EITHER(MAKRPANEL, MINIPANEL)
   #define DOGLCD
   #define ULTIPANEL
   #ifndef DEFAULT_LCD_CONTRAST
     #define DEFAULT_LCD_CONTRAST 17
   #endif

commit 23ec6504103a99a0d769346e2a503a1d1764cf7b
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue May 7 20:32:50 2019 -0500

    Consolidate Malyan LCD and ExtUI

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 752e399d7f..e447e06a51 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -322,22 +322,28 @@
 #if ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define ULTIPANEL
 #endif
 
 #if ENABLED(ULTIPANEL)
   #define NEWPANEL  // Disable this if you actually have no click-encoder panel
   #define ULTRA_LCD
 #endif
 
+// Extensible UI serial touch screens. (See src/lcd/extensible_ui)
+#if ENABLED(MALYAN_LCD)
+  #define EXTENSIBLE_UI
+#endif
+
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
+#define HAS_DISPLAY         (HAS_SPI_LCD || ENABLED(EXTENSIBLE_UI))
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 
 #define HAS_ADC_BUTTONS     ENABLED(ADC_KEYPAD)
 
 /**
  * Default LCD contrast for Graphical LCD displays
  */
 #define HAS_LCD_CONTRAST (HAS_GRAPHICAL_LCD && defined(DEFAULT_LCD_CONTRAST))
@@ -506,23 +512,20 @@
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
-#if ENABLED(MALYAN_LCD)
-  #define EXTENSIBLE_UI
-#endif
 #define HAS_SOFTWARE_ENDSTOPS EITHER(MIN_SOFTWARE_ENDSTOPS, MAX_SOFTWARE_ENDSTOPS)
 #define HAS_RESUME_CONTINUE   ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
 #define HAS_COLOR_LEDS        ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
 #define HAS_LEDS_OFF_FLAG     (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS    EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
 #define HAS_SERVICE_INTERVALS (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0)
 #define HAS_FILAMENT_SENSOR   ENABLED(FILAMENT_RUNOUT_SENSOR)
 
 #define Z_MULTI_STEPPER_DRIVERS EITHER(Z_DUAL_STEPPER_DRIVERS, Z_TRIPLE_STEPPER_DRIVERS)
 #define Z_MULTI_ENDSTOPS        EITHER(Z_DUAL_ENDSTOPS, Z_TRIPLE_ENDSTOPS)

commit 6811e2921bcd272e7487e4f379b42a5a403a07c2
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Tue May 7 22:25:54 2019 -0400

    BLTouch v3 / 3DTouch Interoperability & performance (#13814)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 764ccb5abc..752e399d7f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -458,23 +458,20 @@
     #define Z_PROBE_SERVO_NR 0
   #endif
   #ifndef NUM_SERVOS
     #define NUM_SERVOS (Z_PROBE_SERVO_NR + 1)
   #endif
   #undef DEACTIVATE_SERVOS_AFTER_MOVE
   #if NUM_SERVOS == 1
     #undef SERVO_DELAY
     #define SERVO_DELAY { 50 }
   #endif
-  #ifndef BLTOUCH_DELAY
-    #define BLTOUCH_DELAY 375
-  #endif
 
   // Always disable probe pin inverting for BLTouch
   #undef Z_MIN_PROBE_ENDSTOP_INVERTING
   #define Z_MIN_PROBE_ENDSTOP_INVERTING false
   #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #undef Z_MIN_ENDSTOP_INVERTING
     #define Z_MIN_ENDSTOP_INVERTING false
   #endif
 #endif
 

commit 15357af67ceb74b14606eba9fbb75d20914f8909
Author: Marcio Teixeira <marcio@alephobjects.com>
Date:   Fri May 3 22:53:15 2019 -0600

    Backlash cleanup (#13659)
    
    ‚Ä¶And save backlash, fil. sensor, ExtUI userdata to EEPROM.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 45051e3a82..764ccb5abc 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -509,20 +509,23 @@
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
+#if ENABLED(MALYAN_LCD)
+  #define EXTENSIBLE_UI
+#endif
 #define HAS_SOFTWARE_ENDSTOPS EITHER(MIN_SOFTWARE_ENDSTOPS, MAX_SOFTWARE_ENDSTOPS)
 #define HAS_RESUME_CONTINUE   ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
 #define HAS_COLOR_LEDS        ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
 #define HAS_LEDS_OFF_FLAG     (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS    EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
 #define HAS_SERVICE_INTERVALS (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0)
 #define HAS_FILAMENT_SENSOR   ENABLED(FILAMENT_RUNOUT_SENSOR)
 
 #define Z_MULTI_STEPPER_DRIVERS EITHER(Z_DUAL_STEPPER_DRIVERS, Z_TRIPLE_STEPPER_DRIVERS)
 #define Z_MULTI_ENDSTOPS        EITHER(Z_DUAL_ENDSTOPS, Z_TRIPLE_ENDSTOPS)

commit bf54251a10d94fde34dc41149af2d7e26c630f4b
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed May 1 20:05:29 2019 -0500

    Finish, improve, clean up FYSETC_MINI_12864 revisions (#13871)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 81c0678e3f..45051e3a82 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -134,29 +134,40 @@
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define U8GLIB_SSD1306
 
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
   #define DEFAULT_LCD_CONTRAST 150
   #define LCD_CONTRAST_MAX 255
 
-#elif ENABLED(FYSETC_MINI_12864)
+#elif ANY(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0, FYSETC_MINI_12864_2_1)
 
+  #define FYSETC_MINI_12864
   #define DOGLCD
   #define ULTIPANEL
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 255
   #define DEFAULT_LCD_CONTRAST 255
   #define LED_COLORS_REDUCE_GREEN
 
+  // Require LED backlighting enabled
+  #if EITHER(FYSETC_MINI_12864_1_2, FYSETC_MINI_12864_2_0)
+    #define RGB_LED
+  #elif ENABLED(FYSETC_MINI_12864_2_1)
+    #define NEOPIXEL_LED
+    #define NEOPIXEL_TYPE       NEO_GRB
+    #define NEOPIXEL_PIXELS     3
+    #define NEOPIXEL_BRIGHTNESS 127
+  #endif
+
 #endif
 
 #if EITHER(MAKRPANEL, MINIPANEL)
   #define DOGLCD
   #define ULTIPANEL
   #ifndef DEFAULT_LCD_CONTRAST
     #define DEFAULT_LCD_CONTRAST 17
   #endif
 #endif
 

commit 81ca5a4cd43944bd7e9fffd740ce3abfb89a8687
Author: Bob Kuhn <bob.kuhn@att.net>
Date:   Sun Apr 21 20:48:53 2019 -0500

    Fix and improve FYSETC LCD support (#13767)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3013dae7a9..81c0678e3f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -131,36 +131,40 @@
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define U8GLIB_SSD1306
 
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
+  #define DEFAULT_LCD_CONTRAST 150
+  #define LCD_CONTRAST_MAX 255
 
 #elif ENABLED(FYSETC_MINI_12864)
 
   #define DOGLCD
   #define ULTIPANEL
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 255
   #define DEFAULT_LCD_CONTRAST 255
   #define LED_COLORS_REDUCE_GREEN
 
 #endif
 
 #if EITHER(MAKRPANEL, MINIPANEL)
   #define DOGLCD
   #define ULTIPANEL
-  #define DEFAULT_LCD_CONTRAST 17
+  #ifndef DEFAULT_LCD_CONTRAST
+    #define DEFAULT_LCD_CONTRAST 17
+  #endif
 #endif
 
 #if ENABLED(ULTI_CONTROLLER)
   #define U8GLIB_SSD1309
   #define REVERSE_ENCODER_DIRECTION
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 254
   #define DEFAULT_LCD_CONTRAST 127
   #define ENCODER_PULSES_PER_STEP 2

commit b65cb5704d17437767f4e4958ae218907684066f
Author: jmdearras <jmdearras@gmail.com>
Date:   Fri Apr 19 21:11:51 2019 -0400

    Fix, improve FYSETC_MINI_12864 support (#13730)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3e9db30856..3013dae7a9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -555,10 +555,12 @@
     #endif
     #ifndef ACTION_ON_G29_FAILURE
       #define ACTION_ON_G29_FAILURE "probe_failed"
     #endif
   #endif
 #endif
 
 #if ENABLED(SLIM_LCD_MENUS)
   #define BOOT_MARLIN_LOGO_SMALL
 #endif
+
+#define IS_RE_ARM_BOARD (MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF))

commit 0a6835fbeaaf21fbb4c94b74ac9ead1ced17b72b
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Apr 18 20:59:56 2019 -0500

    More robust HAS_LCD_CONTRAST

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 320dc00ec3..3e9db30856 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -318,21 +318,21 @@
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 
 #define HAS_ADC_BUTTONS     ENABLED(ADC_KEYPAD)
 
 /**
  * Default LCD contrast for Graphical LCD displays
  */
-#define HAS_LCD_CONTRAST HAS_GRAPHICAL_LCD && defined(DEFAULT_LCD_CONTRAST)
+#define HAS_LCD_CONTRAST (HAS_GRAPHICAL_LCD && defined(DEFAULT_LCD_CONTRAST))
 #if HAS_LCD_CONTRAST
   #ifndef LCD_CONTRAST_MIN
     #define LCD_CONTRAST_MIN 0
   #endif
   #ifndef LCD_CONTRAST_MAX
     #define LCD_CONTRAST_MAX 63
   #endif
   #ifndef DEFAULT_LCD_CONTRAST
     #define DEFAULT_LCD_CONTRAST 32
   #endif

commit 9b578ca343077db5410221bd59c520db8140314a
Author: Bob Kuhn <bob.kuhn@att.net>
Date:   Mon Apr 15 22:54:11 2019 -0500

    Support FYSETC_MINI_12864 on Re-ARM, RAMPS_FD, MKS SBASE (#13717)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 8581f2dd19..320dc00ec3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -136,20 +136,22 @@
   #define U8GLIB_SSD1306
 
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
 
 #elif ENABLED(FYSETC_MINI_12864)
 
   #define DOGLCD
   #define ULTIPANEL
+  #define LCD_CONTRAST_MIN 0
+  #define LCD_CONTRAST_MAX 255
   #define DEFAULT_LCD_CONTRAST 255
   #define LED_COLORS_REDUCE_GREEN
 
 #endif
 
 #if EITHER(MAKRPANEL, MINIPANEL)
   #define DOGLCD
   #define ULTIPANEL
   #define DEFAULT_LCD_CONTRAST 17
 #endif

commit 9fd3e64ba82790f9389f6f1d2b58455802f4a303
Author: Ludy <Ludy87@users.noreply.github.com>
Date:   Thu Apr 11 20:58:50 2019 +0200

    Fix compile error with EXTRUDER>1 (#13651)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5457d894d9..8581f2dd19 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -418,21 +418,21 @@
 #define SWITCHING_NOZZLE_TWO_SERVOS defined(SWITCHING_NOZZLE_E1_SERVO_NR)
 
 #define HAS_HOTEND_OFFSET (HOTENDS > 1)
 #define HAS_DUPLICATION_MODE EITHER(DUAL_X_CARRIAGE, MULTI_NOZZLE_DUPLICATION)
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
-  #define E_AXIS_N(E) (E_AXIS + E)
+  #define E_AXIS_N(E) AxisEnum(E_AXIS + E)
 #else
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE
   #define E_AXIS_N(E) E_AXIS
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */

commit cee3b172b9eccce668fb12d9fd37991ee42857d2
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Apr 10 17:14:57 2019 -0500

    Fix Marlin splash screen logic (#13646)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a77a343768..5457d894d9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -549,10 +549,14 @@
   #endif
   #if ENABLED(G29_RETRY_AND_RECOVER)
     #ifndef ACTION_ON_G29_RECOVER
       #define ACTION_ON_G29_RECOVER "probe_rewipe"
     #endif
     #ifndef ACTION_ON_G29_FAILURE
       #define ACTION_ON_G29_FAILURE "probe_failed"
     #endif
   #endif
 #endif
+
+#if ENABLED(SLIM_LCD_MENUS)
+  #define BOOT_MARLIN_LOGO_SMALL
+#endif

commit 5018fdacbeb0807fc255f83049044b89323eea55
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Apr 9 18:34:29 2019 -0500

    Support FYSETC_MINI_12864_PANEL (#13365)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5054b622dc..a77a343768 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -80,22 +80,22 @@
     #define LCD_CONTRAST_MAX     255
     #define DEFAULT_LCD_CONTRAST 140
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
     #define LCD_CONTRAST_MIN      90
     #define LCD_CONTRAST_MAX     130
     #define DEFAULT_LCD_CONTRAST 110
     #define U8GLIB_LM6059_AF
     #define SD_DETECT_INVERTED
   #elif ENABLED(AZSMZ_12864)
-    #define LCD_CONTRAST_MIN  120
-    #define LCD_CONTRAST_MAX 255
+    #define LCD_CONTRAST_MIN     120
+    #define LCD_CONTRAST_MAX     255
     #define DEFAULT_LCD_CONTRAST 190
     #define U8GLIB_ST7565_64128N
   #endif
 
 #elif ENABLED(OLED_PANEL_TINYBOY2)
 
   #define U8GLIB_SSD1306
   #define ULTIPANEL
   #define REVERSE_ENCODER_DIRECTION
   #define REVERSE_MENU_DIRECTION
@@ -132,20 +132,27 @@
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define U8GLIB_SSD1306
 
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
 
+#elif ENABLED(FYSETC_MINI_12864)
+
+  #define DOGLCD
+  #define ULTIPANEL
+  #define DEFAULT_LCD_CONTRAST 255
+  #define LED_COLORS_REDUCE_GREEN
+
 #endif
 
 #if EITHER(MAKRPANEL, MINIPANEL)
   #define DOGLCD
   #define ULTIPANEL
   #define DEFAULT_LCD_CONTRAST 17
 #endif
 
 #if ENABLED(ULTI_CONTROLLER)
   #define U8GLIB_SSD1309
@@ -306,42 +313,33 @@
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 
 #define HAS_ADC_BUTTONS     ENABLED(ADC_KEYPAD)
 
-#if HAS_GRAPHICAL_LCD
-  /**
-   * Default LCD contrast for Graphical LCD displays
-   */
-  #define HAS_LCD_CONTRAST (                \
-       ENABLED(MAKRPANEL)                   \
-    || ENABLED(CARTESIO_UI)                 \
-    || ENABLED(VIKI2)                       \
-    || ENABLED(AZSMZ_12864)                 \
-    || ENABLED(miniVIKI)                    \
-    || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
-  )
-  #if HAS_LCD_CONTRAST
-    #ifndef LCD_CONTRAST_MIN
-      #define LCD_CONTRAST_MIN 0
-    #endif
-    #ifndef LCD_CONTRAST_MAX
-      #define LCD_CONTRAST_MAX 63
-    #endif
-    #ifndef DEFAULT_LCD_CONTRAST
-      #define DEFAULT_LCD_CONTRAST 32
-    #endif
+/**
+ * Default LCD contrast for Graphical LCD displays
+ */
+#define HAS_LCD_CONTRAST HAS_GRAPHICAL_LCD && defined(DEFAULT_LCD_CONTRAST)
+#if HAS_LCD_CONTRAST
+  #ifndef LCD_CONTRAST_MIN
+    #define LCD_CONTRAST_MIN 0
+  #endif
+  #ifndef LCD_CONTRAST_MAX
+    #define LCD_CONTRAST_MAX 63
+  #endif
+  #ifndef DEFAULT_LCD_CONTRAST
+    #define DEFAULT_LCD_CONTRAST 32
   #endif
 #endif
 
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors

commit 240ea1bbb330744a4cd67d39b7c3d50a689cc0a3
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Apr 4 03:06:19 2019 -0500

    Split up games into separate files

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d816b9124a..5054b622dc 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -503,23 +503,25 @@
 
 #define HAS_SOFTWARE_ENDSTOPS EITHER(MIN_SOFTWARE_ENDSTOPS, MAX_SOFTWARE_ENDSTOPS)
 #define HAS_RESUME_CONTINUE   ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
 #define HAS_COLOR_LEDS        ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
 #define HAS_LEDS_OFF_FLAG     (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS    EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
 #define HAS_SERVICE_INTERVALS (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0)
 #define HAS_FILAMENT_SENSOR   ENABLED(FILAMENT_RUNOUT_SENSOR)
 
 #define Z_MULTI_STEPPER_DRIVERS EITHER(Z_DUAL_STEPPER_DRIVERS, Z_TRIPLE_STEPPER_DRIVERS)
-#define Z_MULTI_ENDSTOPS EITHER(Z_DUAL_ENDSTOPS, Z_TRIPLE_ENDSTOPS)
-#define HAS_EXTRA_ENDSTOPS (EITHER(X_DUAL_ENDSTOPS, Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
-#define HAS_GAME_MENU (1 < ENABLED(MARLIN_BRICKOUT) + ENABLED(MARLIN_INVADERS) + ENABLED(MARLIN_SNAKE))
+#define Z_MULTI_ENDSTOPS        EITHER(Z_DUAL_ENDSTOPS, Z_TRIPLE_ENDSTOPS)
+#define HAS_EXTRA_ENDSTOPS     (EITHER(X_DUAL_ENDSTOPS, Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
+
+#define HAS_GAMES     ANY(MARLIN_BRICKOUT, MARLIN_INVADERS, MARLIN_SNAKE, MARLIN_MAZE)
+#define HAS_GAME_MENU (1 < ENABLED(MARLIN_BRICKOUT) + ENABLED(MARLIN_INVADERS) + ENABLED(MARLIN_SNAKE) + ENABLED(MARLIN_MAZE))
 
 #define IS_SCARA     EITHER(MORGAN_SCARA, MAKERARM_SCARA)
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
 
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif
 #ifndef INVERT_Y_DIR
   #define INVERT_Y_DIR false

commit 5d2c5877f7e772119e3faab3d412e9139881d21b
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Mar 7 18:35:06 2019 -0600

    DOGM bootscreen cleanup

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 4e1621eac3..d816b9124a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -331,27 +331,20 @@
     #endif
     #ifndef LCD_CONTRAST_MAX
       #define LCD_CONTRAST_MAX 63
     #endif
     #ifndef DEFAULT_LCD_CONTRAST
       #define DEFAULT_LCD_CONTRAST 32
     #endif
   #endif
 #endif
 
-// Boot screens
-#if !HAS_SPI_LCD
-  #undef SHOW_BOOTSCREEN
-#elif !defined(BOOTSCREEN_TIMEOUT)
-  #define BOOTSCREEN_TIMEOUT 2500
-#endif
-
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */

commit 8b7c3eec833058debf6959e3cae2d7e5a2c94529
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Mon Apr 1 15:43:48 2019 -0500

    Games, for fun (and stress-testing) (#13464)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 8a440d1563..4e1621eac3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -512,20 +512,21 @@
 #define HAS_RESUME_CONTINUE   ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
 #define HAS_COLOR_LEDS        ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
 #define HAS_LEDS_OFF_FLAG     (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS    EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
 #define HAS_SERVICE_INTERVALS (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0)
 #define HAS_FILAMENT_SENSOR   ENABLED(FILAMENT_RUNOUT_SENSOR)
 
 #define Z_MULTI_STEPPER_DRIVERS EITHER(Z_DUAL_STEPPER_DRIVERS, Z_TRIPLE_STEPPER_DRIVERS)
 #define Z_MULTI_ENDSTOPS EITHER(Z_DUAL_ENDSTOPS, Z_TRIPLE_ENDSTOPS)
 #define HAS_EXTRA_ENDSTOPS (EITHER(X_DUAL_ENDSTOPS, Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
+#define HAS_GAME_MENU (1 < ENABLED(MARLIN_BRICKOUT) + ENABLED(MARLIN_INVADERS) + ENABLED(MARLIN_SNAKE))
 
 #define IS_SCARA     EITHER(MORGAN_SCARA, MAKERARM_SCARA)
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
 
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif
 #ifndef INVERT_Y_DIR
   #define INVERT_Y_DIR false

commit 691e5c3bb8d04b0b6690424034d73ade19e91586
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Sun Mar 17 06:57:25 2019 -0400

    BLTouch V3.0 support (#13406)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7b173cd487..8a440d1563 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -453,39 +453,27 @@
     #define NUM_SERVOS (Z_PROBE_SERVO_NR + 1)
   #endif
   #undef DEACTIVATE_SERVOS_AFTER_MOVE
   #if NUM_SERVOS == 1
     #undef SERVO_DELAY
     #define SERVO_DELAY { 50 }
   #endif
   #ifndef BLTOUCH_DELAY
     #define BLTOUCH_DELAY 375
   #endif
-  #undef Z_SERVO_ANGLES
-  #define Z_SERVO_ANGLES { BLTOUCH_DEPLOY, BLTOUCH_STOW }
-
-  #define BLTOUCH_DEPLOY    10
-  #define BLTOUCH_STOW      90
-  #define BLTOUCH_SELFTEST 120
-  #define BLTOUCH_RESET    160
-  #define _TEST_BLTOUCH(P) (READ(P##_PIN) != P##_ENDSTOP_INVERTING)
 
   // Always disable probe pin inverting for BLTouch
   #undef Z_MIN_PROBE_ENDSTOP_INVERTING
   #define Z_MIN_PROBE_ENDSTOP_INVERTING false
-
   #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #undef Z_MIN_ENDSTOP_INVERTING
-    #define Z_MIN_ENDSTOP_INVERTING Z_MIN_PROBE_ENDSTOP_INVERTING
-    #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN)
-  #else
-    #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
+    #define Z_MIN_ENDSTOP_INVERTING false
   #endif
 #endif
 
 #ifndef PREHEAT_1_LABEL
   #define PREHEAT_1_LABEL "PLA"
 #endif
 
 #ifndef PREHEAT_2_LABEL
   #define PREHEAT_2_LABEL "ABS"
 #endif

commit 49cf92dc36424cf828436f32e72263eca39a1cc3
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Mar 16 23:43:06 2019 -0500

    Extended condition macros (#13419)
    
    Allow `ENABLED`, `DISABLED`, `PIN_EXISTS`, and `BUTTON_EXISTS` to take multiple arguments. Also add:
    - Alias `ANY(...)` for `!DISABLED(...)`
    - Alias `ANY_PIN(...)` for `PIN_EXISTS(a) || PIN_EXISTS(b) ...`
    - Alias `EITHER(A,B)` for `ANY(...)`
    - Alias `ALL(...)` and `BOTH(A,B)` for `ENABLED(...)`
    - `NONE(...)` for `DISABLED(...)`

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 070e06be3a..7b173cd487 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -57,21 +57,21 @@
   #define ENCODER_PULSES_PER_STEP 2
 
 #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
 #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
-#elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(AZSMZ_12864)
+#elif ANY(miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864)
 
   #define ULTRA_LCD
   #define DOGLCD
   #define ULTIMAKERCONTROLLER
 
   #if ENABLED(miniVIKI)
     #define LCD_CONTRAST_MIN      75
     #define LCD_CONTRAST_MAX     115
     #define DEFAULT_LCD_CONTRAST  95
     #define U8GLIB_ST7565_64128N
@@ -134,67 +134,63 @@
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define U8GLIB_SSD1306
 
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
 
 #endif
 
-#if ENABLED(MAKRPANEL) || ENABLED(MINIPANEL)
+#if EITHER(MAKRPANEL, MINIPANEL)
   #define DOGLCD
   #define ULTIPANEL
   #define DEFAULT_LCD_CONTRAST 17
 #endif
 
 #if ENABLED(ULTI_CONTROLLER)
   #define U8GLIB_SSD1309
   #define REVERSE_ENCODER_DIRECTION
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 254
   #define DEFAULT_LCD_CONTRAST 127
   #define ENCODER_PULSES_PER_STEP 2
   #define ENCODER_STEPS_PER_MENU_ITEM 2
 #endif
 
 // 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
-#define HAS_SSD1306_OLED_I2C (ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SSD1309) || ENABLED(U8GLIB_SH1106))
+#define HAS_SSD1306_OLED_I2C ANY(U8GLIB_SSD1306, U8GLIB_SSD1309, U8GLIB_SH1106)
 #if HAS_SSD1306_OLED_I2C
   #define ULTRA_LCD
   #define DOGLCD
 #endif
 
-#if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
+#if EITHER(PANEL_ONE, U8GLIB_SH1106)
 
   #define ULTIMAKERCONTROLLER
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define LCD_WIDTH 16
   #define LCD_HEIGHT 2
 
 #endif
 
-#if ENABLED(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER) || ENABLED(LCD_FOR_MELZI) || ENABLED(SILVER_GATE_GLCD_CONTROLLER)
+#if ANY(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER, LCD_FOR_MELZI, SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
   #define U8GLIB_ST7920
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
 #endif
 
-#if ENABLED(ULTIMAKERCONTROLLER)              \
- || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
- || ENABLED(G3D_PANEL)                        \
- || ENABLED(RIGIDBOT_PANEL)                   \
- || ENABLED(ULTI_CONTROLLER)
+#if ANY(ULTIMAKERCONTROLLER, REPRAP_DISCOUNT_SMART_CONTROLLER, G3D_PANEL, RIGIDBOT_PANEL, ULTI_CONTROLLER)
   #define ULTIPANEL
 #endif
 
 #if ENABLED(REPRAPWORLD_KEYPAD)
   #define NEWPANEL
   #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
@@ -216,21 +212,21 @@
  #if ENABLED(MKS_ROBIN_TFT)
    #define ULTRA_LCD
    #define DOGLCD
    #define ULTIPANEL
  #endif
 
 /**
  * I2C PANELS
  */
 
-#if ENABLED(LCD_SAINSMART_I2C_1602) || ENABLED(LCD_SAINSMART_I2C_2004)
+#if EITHER(LCD_SAINSMART_I2C_1602, LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
 
   #if ENABLED(LCD_SAINSMART_I2C_2004)
     #define LCD_WIDTH 20
     #define LCD_HEIGHT 4
   #endif
 
 #elif ENABLED(LCD_I2C_PANELOLU2)
@@ -260,29 +256,25 @@
   #define ENCODER_FEEDRATE_DEADZONE 4
 
   #define STD_ENCODER_PULSES_PER_STEP 1
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(G3D_PANEL)
 
   #define STD_ENCODER_PULSES_PER_STEP 2
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
-#elif ENABLED(miniVIKI) || ENABLED(VIKI2) \
-   || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
-   || ENABLED(AZSMZ_12864) \
-   || ENABLED(OLED_PANEL_TINYBOY2) \
-   || ENABLED(BQ_LCD_SMART_CONTROLLER) \
-   || ENABLED(LCD_I2C_PANELOLU2) \
-   || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
+#elif ANY(miniVIKI, VIKI2, ELB_FULL_GRAPHIC_CONTROLLER, AZSMZ_12864, OLED_PANEL_TINYBOY2, BQ_LCD_SMART_CONTROLLER, LCD_I2C_PANELOLU2, REPRAP_DISCOUNT_SMART_CONTROLLER)
+
   #define STD_ENCODER_PULSES_PER_STEP 4
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+
 #endif
 
 #ifndef STD_ENCODER_PULSES_PER_STEP
   #define STD_ENCODER_PULSES_PER_STEP 5
 #endif
 #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 #endif
 #ifndef ENCODER_PULSES_PER_STEP
   #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
@@ -393,30 +385,30 @@
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 #elif ENABLED(PRUSA_MMU2)
   #define E_STEPPERS 1
   #ifndef TOOLCHANGE_ZRAISE
     #define TOOLCHANGE_ZRAISE 0
   #endif
 #endif
 
 // No inactive extruders with MK2_MULTIPLEXER or SWITCHING_NOZZLE
-#if ENABLED(MK2_MULTIPLEXER) || ENABLED(SWITCHING_NOZZLE)
+#if EITHER(MK2_MULTIPLEXER, SWITCHING_NOZZLE)
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
 // Prusa MK2 Multiplexer and MMU 2.0 force SINGLENOZZLE
-#if ENABLED(MK2_MULTIPLEXER) || ENABLED(PRUSA_MMU2)
+#if EITHER(MK2_MULTIPLEXER, PRUSA_MMU2)
   #define SINGLENOZZLE
 #endif
 
-#if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
+#if EITHER(SINGLENOZZLE, MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
   #define HOTENDS       1
   #undef TEMP_SENSOR_1_AS_REDUNDANT
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #endif
 
 #ifndef HOTENDS
   #define HOTENDS EXTRUDERS
 #endif
@@ -428,21 +420,21 @@
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 #define SWITCHING_NOZZLE_TWO_SERVOS defined(SWITCHING_NOZZLE_E1_SERVO_NR)
 
 #define HAS_HOTEND_OFFSET (HOTENDS > 1)
-#define HAS_DUPLICATION_MODE (ENABLED(DUAL_X_CARRIAGE) || ENABLED(MULTI_NOZZLE_DUPLICATION))
+#define HAS_DUPLICATION_MODE EITHER(DUAL_X_CARRIAGE, MULTI_NOZZLE_DUPLICATION)
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N(E) (E_AXIS + E)
 #else
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE
@@ -499,55 +491,55 @@
 #endif
 
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
-#define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE) || ENABLED(SENSORLESS_PROBING) || ENABLED(RACK_AND_PINION_PROBE))
-#define PROBE_SELECTED (HAS_BED_PROBE || ENABLED(PROBE_MANUALLY) || ENABLED(MESH_BED_LEVELING))
+#define HAS_BED_PROBE (HAS_Z_SERVO_PROBE || ANY(FIX_MOUNTED_PROBE, Z_PROBE_ALLEN_KEY, Z_PROBE_SLED, SOLENOID_PROBE, SENSORLESS_PROBING, RACK_AND_PINION_PROBE))
+#define PROBE_SELECTED (HAS_BED_PROBE || EITHER(PROBE_MANUALLY, MESH_BED_LEVELING))
 
 #if HAS_BED_PROBE
   #define USES_Z_MIN_PROBE_ENDSTOP DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST // Extra test for Allen Key Probe
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
-#define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
-#define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
-#define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(PCA9533) || ENABLED(NEOPIXEL_LED))
-#define HAS_LEDS_OFF_FLAG (ENABLED(PRINTER_EVENT_LEDS) && ENABLED(SDSUPPORT) && HAS_RESUME_CONTINUE)
-#define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
+#define HAS_SOFTWARE_ENDSTOPS EITHER(MIN_SOFTWARE_ENDSTOPS, MAX_SOFTWARE_ENDSTOPS)
+#define HAS_RESUME_CONTINUE   ANY(EXTENSIBLE_UI, NEWPANEL, EMERGENCY_PARSER)
+#define HAS_COLOR_LEDS        ANY(BLINKM, RGB_LED, RGBW_LED, PCA9632, PCA9533, NEOPIXEL_LED)
+#define HAS_LEDS_OFF_FLAG     (BOTH(PRINTER_EVENT_LEDS, SDSUPPORT) && HAS_RESUME_CONTINUE)
+#define HAS_PRINT_PROGRESS    EITHER(SDSUPPORT, LCD_SET_PROGRESS_MANUALLY)
 #define HAS_SERVICE_INTERVALS (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0)
-#define HAS_FILAMENT_SENSOR ENABLED(FILAMENT_RUNOUT_SENSOR)
+#define HAS_FILAMENT_SENSOR   ENABLED(FILAMENT_RUNOUT_SENSOR)
 
-#define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
-#define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
-#define HAS_EXTRA_ENDSTOPS (ENABLED(X_DUAL_ENDSTOPS) || ENABLED(Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
+#define Z_MULTI_STEPPER_DRIVERS EITHER(Z_DUAL_STEPPER_DRIVERS, Z_TRIPLE_STEPPER_DRIVERS)
+#define Z_MULTI_ENDSTOPS EITHER(Z_DUAL_ENDSTOPS, Z_TRIPLE_ENDSTOPS)
+#define HAS_EXTRA_ENDSTOPS (EITHER(X_DUAL_ENDSTOPS, Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
 
-#define IS_SCARA     (ENABLED(MORGAN_SCARA) || ENABLED(MAKERARM_SCARA))
+#define IS_SCARA     EITHER(MORGAN_SCARA, MAKERARM_SCARA)
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
 
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif
 #ifndef INVERT_Y_DIR
   #define INVERT_Y_DIR false
 #endif
 #ifndef INVERT_Z_DIR

commit 050eac03afb67743131b5537bf7464e3dafbce23
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Wed Mar 13 01:42:50 2019 -0400

    Single X Duplication Extension (#13373)
    
    * Multi-nozzle selective duplication
    * Use a bit-mask, reduce stepper_indirection.h size
    * Tweak the multi-nozzle duplication description
    * Use 'S' as a bool in M605
    * Add HAS_DUPLICATION_MODE conditional
    * Remove '_MODE' from the option name
    * M605 in the style of Stacker M280
    * Also include direct mask style (P)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 1eb610b3d7..070e06be3a 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -428,20 +428,21 @@
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 #define SWITCHING_NOZZLE_TWO_SERVOS defined(SWITCHING_NOZZLE_E1_SERVO_NR)
 
 #define HAS_HOTEND_OFFSET (HOTENDS > 1)
+#define HAS_DUPLICATION_MODE (ENABLED(DUAL_X_CARRIAGE) || ENABLED(MULTI_NOZZLE_DUPLICATION))
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N(E) (E_AXIS + E)
 #else
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE

commit 10c8c034bdc529ced1d0b70b5f8a1079cccc5f66
Author: 7eggert <7eggert@gmx.de>
Date:   Tue Mar 12 00:10:56 2019 +0100

    Allow both encoder and ADC keypad (#13355)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index efc91ea673..1eb610b3d7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -313,26 +313,20 @@
   #define ULTRA_LCD
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 
 #define HAS_ADC_BUTTONS     ENABLED(ADC_KEYPAD)
-#define HAS_DIGITAL_BUTTONS (!HAS_ADC_BUTTONS && ENABLED(NEWPANEL))
-#define HAS_SHIFT_ENCODER   (!HAS_ADC_BUTTONS && (ENABLED(REPRAPWORLD_KEYPAD) || (HAS_SPI_LCD && DISABLED(NEWPANEL))))
-#define HAS_ENCODER_WHEEL   (!HAS_ADC_BUTTONS && ENABLED(NEWPANEL))
-
-// I2C buttons must be read in the main thread
-#define HAS_SLOW_BUTTONS (ENABLED(LCD_I2C_VIKI) || ENABLED(LCD_I2C_PANELOLU2))
 
 #if HAS_GRAPHICAL_LCD
   /**
    * Default LCD contrast for Graphical LCD displays
    */
   #define HAS_LCD_CONTRAST (                \
        ENABLED(MAKRPANEL)                   \
     || ENABLED(CARTESIO_UI)                 \
     || ENABLED(VIKI2)                       \
     || ENABLED(AZSMZ_12864)                 \

commit aa1d587128e1bfbf09e9c27dc19ac5ebaf496713
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Mar 11 05:07:14 2019 -0500

    Some LCD code cleanup

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f30f5a9277..efc91ea673 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -59,23 +59,23 @@
 #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
 #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
 #elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(AZSMZ_12864)
 
-  #define ULTRA_LCD  //general LCD support, also 16x2
-  #define DOGLCD  // Support for SPI LCD 128x64 (Controller ST7565R graphic Display Family)
-  #define ULTIMAKERCONTROLLER //as available from the Ultimaker online store.
+  #define ULTRA_LCD
+  #define DOGLCD
+  #define ULTIMAKERCONTROLLER
 
   #if ENABLED(miniVIKI)
     #define LCD_CONTRAST_MIN      75
     #define LCD_CONTRAST_MAX     115
     #define DEFAULT_LCD_CONTRAST  95
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(VIKI2)
     #define LCD_CONTRAST_MIN       0
     #define LCD_CONTRAST_MAX     255
     #define DEFAULT_LCD_CONTRAST 140

commit 2f1e1dcb42e01165e800a5d00c769efecc5a9933
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Fri Mar 1 01:51:24 2019 -0600

    Gradual step towards EXTRUDERS 0 support

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f4b4571548..f30f5a9277 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -363,20 +363,30 @@
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */
 
+#if EXTRUDERS == 0
+  #undef DISTINCT_E_FACTORS
+  #undef SINGLENOZZLE
+  #undef SWITCHING_EXTRUDER
+  #undef SWITCHING_NOZZLE
+  #undef MIXING_EXTRUDER
+  #undef MK2_MULTIPLEXER
+  #undef PRUSA_MMU2
+#endif
+
 #if ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
   #if DISABLED(SWITCHING_NOZZLE)
     #define HOTENDS       E_STEPPERS

commit 99d0022fae0efd9164946062bf641f7294597675
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Mar 1 00:27:45 2019 -0600

    Drop the Z_MIN_PROBE_ENDSTOP option (#13276)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 049935050e..f4b4571548 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -498,30 +498,30 @@
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
 #define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE) || ENABLED(SENSORLESS_PROBING) || ENABLED(RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || ENABLED(PROBE_MANUALLY) || ENABLED(MESH_BED_LEVELING))
 
 #if HAS_BED_PROBE
+  #define USES_Z_MIN_PROBE_ENDSTOP DISABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
   #ifndef Z_PROBE_LOW_POINT
     #define Z_PROBE_LOW_POINT -5
   #endif
   #if ENABLED(Z_PROBE_ALLEN_KEY)
     #define PROBE_TRIGGERED_WHEN_STOWED_TEST // Extra test for Allen Key Probe
   #endif
 #else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
-  #undef Z_MIN_PROBE_ENDSTOP
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))

commit 5eb82ca6a84066107c97c4e16f387a09c82a0ec9
Author: kwalters3 <45312237+kwalters3@users.noreply.github.com>
Date:   Fri Feb 22 20:08:36 2019 -0500

    Change SSD1306_OLED_I2C_CONTROLLER to HAS_SSD1306_OLED_I2C (#13223)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index fdfecadbab..049935050e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -151,24 +151,25 @@
   #define U8GLIB_SSD1309
   #define REVERSE_ENCODER_DIRECTION
   #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
   #define LCD_CONTRAST_MIN 0
   #define LCD_CONTRAST_MAX 254
   #define DEFAULT_LCD_CONTRAST 127
   #define ENCODER_PULSES_PER_STEP 2
   #define ENCODER_STEPS_PER_MENU_ITEM 2
 #endif
 
-// Generic support for SSD1306 / SSD1309 / SH1106 OLED based LCDs.
-#if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SSD1309) || ENABLED(U8GLIB_SH1106)
-  #define ULTRA_LCD  //general LCD support, also 16x2
-  #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SSD1309 / SH1106 graphic Display Family)
+// 128x64 I2C OLED LCDs - SSD1306/SSD1309/SH1106
+#define HAS_SSD1306_OLED_I2C (ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SSD1309) || ENABLED(U8GLIB_SH1106))
+#if HAS_SSD1306_OLED_I2C
+  #define ULTRA_LCD
+  #define DOGLCD
 #endif
 
 #if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
 
   #define ULTIMAKERCONTROLLER
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define LCD_WIDTH 16

commit 7cf9b93f26f728f0104dc9b930f6b23096639d98
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Feb 12 20:08:34 2019 -0600

    Add HAS_FILAMENT_SENSOR ahead of 12962

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0909e649e3..fdfecadbab 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -521,20 +521,21 @@
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(PCA9533) || ENABLED(NEOPIXEL_LED))
 #define HAS_LEDS_OFF_FLAG (ENABLED(PRINTER_EVENT_LEDS) && ENABLED(SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
 #define HAS_SERVICE_INTERVALS (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0)
+#define HAS_FILAMENT_SENSOR ENABLED(FILAMENT_RUNOUT_SENSOR)
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
 #define HAS_EXTRA_ENDSTOPS (ENABLED(X_DUAL_ENDSTOPS) || ENABLED(Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
 
 #define IS_SCARA     (ENABLED(MORGAN_SCARA) || ENABLED(MAKERARM_SCARA))
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
 
 #ifndef INVERT_X_DIR

commit e56c13670d4ae40339c3a7af61aef3ca08b4128d
Author: revilor <oliver.rossmueller@web.de>
Date:   Tue Feb 12 22:58:56 2019 +0100

    Service interval watchdog (#13105)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f3932ff8eb..0909e649e3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -520,20 +520,21 @@
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(PCA9533) || ENABLED(NEOPIXEL_LED))
 #define HAS_LEDS_OFF_FLAG (ENABLED(PRINTER_EVENT_LEDS) && ENABLED(SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
+#define HAS_SERVICE_INTERVALS (SERVICE_INTERVAL_1 > 0 || SERVICE_INTERVAL_2 > 0 || SERVICE_INTERVAL_3 > 0)
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
 #define HAS_EXTRA_ENDSTOPS (ENABLED(X_DUAL_ENDSTOPS) || ENABLED(Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
 
 #define IS_SCARA     (ENABLED(MORGAN_SCARA) || ENABLED(MAKERARM_SCARA))
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
 
 #ifndef INVERT_X_DIR

commit 7f1b69b0c83ae914ed9ae35fdad9f79814069652
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Tue Feb 12 16:55:47 2019 -0500

    Add HOST_PROMPT_SUPPORT (#13039)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 1ca316dda3..f3932ff8eb 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -529,24 +529,48 @@
 #define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
 #define HAS_EXTRA_ENDSTOPS (ENABLED(X_DUAL_ENDSTOPS) || ENABLED(Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
 
 #define IS_SCARA     (ENABLED(MORGAN_SCARA) || ENABLED(MAKERARM_SCARA))
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
 
-#define HAS_ACTION_COMMANDS (defined(ACTION_ON_KILL) || defined(ACTION_ON_PAUSE) || defined(ACTION_ON_PAUSED) || defined(ACTION_ON_RESUME) || defined(ACTION_ON_RESUMED) || defined(ACTION_ON_CANCEL) || defined(G29_ACTION_ON_RECOVER) || defined(G29_ACTION_ON_FAILURE) || defined(ACTION_ON_FILAMENT_RUNOUT))
-
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif
 #ifndef INVERT_Y_DIR
   #define INVERT_Y_DIR false
 #endif
 #ifndef INVERT_Z_DIR
   #define INVERT_Z_DIR false
 #endif
 #ifndef INVERT_E_DIR
   #define INVERT_E_DIR false
 #endif
+
+#if ENABLED(HOST_ACTION_COMMANDS)
+  #ifndef ACTION_ON_PAUSE
+    #define ACTION_ON_PAUSE   "pause"
+  #endif
+  #ifndef ACTION_ON_RESUME
+    #define ACTION_ON_RESUME  "resume"
+  #endif
+  #ifndef ACTION_ON_PAUSED
+    #define ACTION_ON_PAUSED  "paused"
+  #endif
+  #ifndef ACTION_ON_RESUMED
+    #define ACTION_ON_RESUMED "resumed"
+  #endif
+  #ifndef ACTION_ON_CANCEL
+    #define ACTION_ON_CANCEL  "cancel"
+  #endif
+  #if ENABLED(G29_RETRY_AND_RECOVER)
+    #ifndef ACTION_ON_G29_RECOVER
+      #define ACTION_ON_G29_RECOVER "probe_rewipe"
+    #endif
+    #ifndef ACTION_ON_G29_FAILURE
+      #define ACTION_ON_G29_FAILURE "probe_failed"
+    #endif
+  #endif
+#endif

commit 0feeef26048883640b37ebe3994730f31ef6e922
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Feb 12 15:06:53 2019 -0600

    Update copyright in headers

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 02a6a23db6..1ca316dda3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -1,13 +1,13 @@
 /**
  * Marlin 3D Printer Firmware
- * Copyright (C) 2016 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
+ * Copyright (C) 2019 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
  *
  * Based on Sprinter and grbl.
  * Copyright (C) 2011 Camiel Gubbels / Erik van der Zalm
  *
  * This program is free software: you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
  * the Free Software Foundation, either version 3 of the License, or
  * (at your option) any later version.
  *
  * This program is distributed in the hope that it will be useful,

commit 6de3d3437849c0710881311bc9ad4069b0aee55d
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Feb 10 04:54:23 2019 -0600

    M166 Gradients, LCD Menu for 2-channel Mixer (Geeetech A10M/A20M) (#13022)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0ace41b0ed..02a6a23db6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -376,20 +376,21 @@
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
   #if DISABLED(SWITCHING_NOZZLE)
     #define HOTENDS       E_STEPPERS
   #endif
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
+  #define DUAL_MIXING_EXTRUDER (MIXING_STEPPERS == 2)
 #elif ENABLED(SWITCHING_TOOLHEAD)
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 #elif ENABLED(PRUSA_MMU2)
   #define E_STEPPERS 1
   #ifndef TOOLCHANGE_ZRAISE
     #define TOOLCHANGE_ZRAISE 0
   #endif
 #endif
 

commit 1bd9a630492e0b029c39e4c885c6a1f49dc0c6ee
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Feb 6 04:59:22 2019 -0600

    Add HAS_EXTRA_ENDSTOPS macro

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 6a1fa9c23e..0ace41b0ed 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -522,20 +522,21 @@
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(PCA9533) || ENABLED(NEOPIXEL_LED))
 #define HAS_LEDS_OFF_FLAG (ENABLED(PRINTER_EVENT_LEDS) && ENABLED(SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
+#define HAS_EXTRA_ENDSTOPS (ENABLED(X_DUAL_ENDSTOPS) || ENABLED(Y_DUAL_ENDSTOPS) || Z_MULTI_ENDSTOPS)
 
 #define IS_SCARA     (ENABLED(MORGAN_SCARA) || ENABLED(MAKERARM_SCARA))
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
 
 #define HAS_ACTION_COMMANDS (defined(ACTION_ON_KILL) || defined(ACTION_ON_PAUSE) || defined(ACTION_ON_PAUSED) || defined(ACTION_ON_RESUME) || defined(ACTION_ON_RESUMED) || defined(ACTION_ON_CANCEL) || defined(G29_ACTION_ON_RECOVER) || defined(G29_ACTION_ON_FAILURE) || defined(ACTION_ON_FILAMENT_RUNOUT))
 
 #ifndef INVERT_X_DIR
   #define INVERT_X_DIR false
 #endif

commit 5cfc1cdacc52ca9e09e40872ab2918d0d88ef0f2
Author: Marcio Teixeira <marcio@alephobjects.com>
Date:   Sun Feb 3 23:19:56 2019 -0700

    Support SWITCHING_NOZZLE with 2 servos (#13054)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7a657efae8..6a1fa9c23e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -419,20 +419,21 @@
   #define E_STEPPERS EXTRUDERS
 #endif
 
 #ifndef E_MANUAL
   #define E_MANUAL EXTRUDERS
 #endif
 
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
+#define SWITCHING_NOZZLE_TWO_SERVOS defined(SWITCHING_NOZZLE_E1_SERVO_NR)
 
 #define HAS_HOTEND_OFFSET (HOTENDS > 1)
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N(E) (E_AXIS + E)
 #else

commit 4d1093b3868a37ee0def13dbe2785f3ce98fcf6d
Author: Mark Zachmann <MZachmann@users.noreply.github.com>
Date:   Sun Feb 3 02:29:00 2019 -0500

    Fix init of last_direction_bits (#13067)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 654db63f05..7a657efae8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -527,10 +527,23 @@
 #define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
 
 #define IS_SCARA     (ENABLED(MORGAN_SCARA) || ENABLED(MAKERARM_SCARA))
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
 
 #define HAS_ACTION_COMMANDS (defined(ACTION_ON_KILL) || defined(ACTION_ON_PAUSE) || defined(ACTION_ON_PAUSED) || defined(ACTION_ON_RESUME) || defined(ACTION_ON_RESUMED) || defined(ACTION_ON_CANCEL) || defined(G29_ACTION_ON_RECOVER) || defined(G29_ACTION_ON_FAILURE) || defined(ACTION_ON_FILAMENT_RUNOUT))
+
+#ifndef INVERT_X_DIR
+  #define INVERT_X_DIR false
+#endif
+#ifndef INVERT_Y_DIR
+  #define INVERT_Y_DIR false
+#endif
+#ifndef INVERT_Z_DIR
+  #define INVERT_Z_DIR false
+#endif
+#ifndef INVERT_E_DIR
+  #define INVERT_E_DIR false
+#endif

commit 6a57d0b381db99d67cccd48135cbdd2d831588a7
Author: revilor <oliver.rossmueller@web.de>
Date:   Fri Feb 1 02:10:52 2019 +0100

    Prusa MMU2 (#12967)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index dd71d98d78..654db63f05 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -361,46 +361,52 @@
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */
-#if ENABLED(SWITCHING_EXTRUDER)                               // One stepper for every two EXTRUDERS
+
+#if ENABLED(SWITCHING_EXTRUDER)   // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
   #if DISABLED(SWITCHING_NOZZLE)
     #define HOTENDS       E_STEPPERS
   #endif
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
 #elif ENABLED(SWITCHING_TOOLHEAD)
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
+#elif ENABLED(PRUSA_MMU2)
+  #define E_STEPPERS 1
+  #ifndef TOOLCHANGE_ZRAISE
+    #define TOOLCHANGE_ZRAISE 0
+  #endif
 #endif
 
 // No inactive extruders with MK2_MULTIPLEXER or SWITCHING_NOZZLE
 #if ENABLED(MK2_MULTIPLEXER) || ENABLED(SWITCHING_NOZZLE)
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
-// MK2 Multiplexer forces SINGLENOZZLE
-#if ENABLED(MK2_MULTIPLEXER)
+// Prusa MK2 Multiplexer and MMU 2.0 force SINGLENOZZLE
+#if ENABLED(MK2_MULTIPLEXER) || ENABLED(PRUSA_MMU2)
   #define SINGLENOZZLE
 #endif
 
 #if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
   #define HOTENDS       1
   #undef TEMP_SENSOR_1_AS_REDUNDANT
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #endif

commit f0503372d90469112547f609f0a120108b6497fa
Author: teemuatlut <teemu.mantykallio@live.fi>
Date:   Thu Jan 31 04:55:05 2019 +0200

    Revert E_AXIS_N cast (#13055)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e60609ce1e..dd71d98d78 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -421,25 +421,25 @@
 
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 
 #define HAS_HOTEND_OFFSET (HOTENDS > 1)
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
-  #define E_AXIS_N(E) (uint8_t(E_AXIS) + E)
+  #define E_AXIS_N(E) (E_AXIS + E)
 #else
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE
-  #define E_AXIS_N(E) uint8_t(E_AXIS)
+  #define E_AXIS_N(E) E_AXIS
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif

commit 48a3502656b29439ae7172d24259353dc3183dd9
Author: InsanityAutomation <38436470+InsanityAutomation@users.noreply.github.com>
Date:   Sun Jan 27 23:43:13 2019 -0500

    Remote streamer improvements (#12982)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 84345a2f06..e60609ce1e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -519,10 +519,12 @@
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(PCA9533) || ENABLED(NEOPIXEL_LED))
 #define HAS_LEDS_OFF_FLAG (ENABLED(PRINTER_EVENT_LEDS) && ENABLED(SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
 
 #define IS_SCARA     (ENABLED(MORGAN_SCARA) || ENABLED(MAKERARM_SCARA))
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC
+
+#define HAS_ACTION_COMMANDS (defined(ACTION_ON_KILL) || defined(ACTION_ON_PAUSE) || defined(ACTION_ON_PAUSED) || defined(ACTION_ON_RESUME) || defined(ACTION_ON_RESUMED) || defined(ACTION_ON_CANCEL) || defined(G29_ACTION_ON_RECOVER) || defined(G29_ACTION_ON_FAILURE) || defined(ACTION_ON_FILAMENT_RUNOUT))

commit 7fde8d9d1e264c09246b0c7f64fc5c56b3752cd6
Author: mikeshub <mikesbaker@gmail.com>
Date:   Mon Jan 14 14:29:55 2019 -0600

    Add CreatorPro / Makerbot / QIDI / etc and Mightboard RevE support (#12855)
    
    - Fix a bug in MAXxxxx thermocouple temp reporting.
    - Add support for 3-wire HD44780.
    - Add support for PCA9533 RGB driver.
    - Add configuration examples for FlashForge CreatorPro.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 553f33a7d7..84345a2f06 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -290,20 +290,24 @@
   #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
 #endif
 #ifndef ENCODER_FEEDRATE_DEADZONE
   #define ENCODER_FEEDRATE_DEADZONE 6
 #endif
 
 // Shift register panels
 // ---------------------
 // 2 wire Non-latching LCD SR from:
 // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
+#if ENABLED(FF_INTERFACEBOARD)
+  #define SR_LCD_3W_NL    // Non latching 3 wire shift register
+  #define ULTIPANEL
+#endif
 
 #if ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define ULTIPANEL
 #endif
 
 #if ENABLED(ULTIPANEL)
   #define NEWPANEL  // Disable this if you actually have no click-encoder panel
   #define ULTRA_LCD
 #endif
@@ -505,20 +509,20 @@
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
-#define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
+#define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(PCA9533) || ENABLED(NEOPIXEL_LED))
 #define HAS_LEDS_OFF_FLAG (ENABLED(PRINTER_EVENT_LEDS) && ENABLED(SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
 
 #define IS_SCARA     (ENABLED(MORGAN_SCARA) || ENABLED(MAKERARM_SCARA))
 #define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
 #define IS_CARTESIAN !IS_KINEMATIC

commit 813a4ea107f3b09b85a29e4446755fe276eba6f4
Author: jmz52 <jmz52@users.noreply.github.com>
Date:   Thu Jan 3 19:38:39 2019 +0300

    Add support for Mks Robin TFT display (#12706)
    
    * Add support for MKS Robin TFT display
    
    - Add support for MKS Robin TFT display and encoder for MKS Robin board.
    - Generic 128x64 UI with x2 upscale is used (for now).
    - Tested on MKS Robin TFT V2.0 with ST7789V controller.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ad0a8d35d0..553f33a7d7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -202,20 +202,29 @@
  */
 
  // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
  #if ENABLED(U8GLIB_SH1106_EINSTART)
    #define ULTRA_LCD
    #define DOGLCD
    #define ULTIPANEL
    #define NEWPANEL
  #endif
 
+ /**
+  * FSMC/SPI TFT PANELS
+  */
+ #if ENABLED(MKS_ROBIN_TFT)
+   #define ULTRA_LCD
+   #define DOGLCD
+   #define ULTIPANEL
+ #endif
+
 /**
  * I2C PANELS
  */
 
 #if ENABLED(LCD_SAINSMART_I2C_1602) || ENABLED(LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
 
   #if ENABLED(LCD_SAINSMART_I2C_2004)

commit fd2998efd5fb888eb1deb432c6790c3d506060c0
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Nov 22 06:00:00 2018 -0600

    Revert ADC_KEYPAD direction behavior (#12508)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a030ae02f8..ad0a8d35d0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -40,20 +40,21 @@
 
 #elif ENABLED(ZONESTAR_LCD)
 
   #define ADC_KEYPAD
   #define REPRAPWORLD_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
   #define ULTIPANEL
 
   // this helps to implement ADC_KEYPAD menus
+  #define REVERSE_MENU_DIRECTION
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
 
 #elif ENABLED(RADDS_DISPLAY)
   #define ULTIPANEL
   #define ENCODER_PULSES_PER_STEP 2
 
 #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 

commit d29cb09b3ef4e3c384fc37e4e4c4e837e6f64e31
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Nov 22 05:34:58 2018 -0600

    Fix a minor compile warning

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 55e371870d..a030ae02f8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -407,25 +407,25 @@
 
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 
 #define HAS_HOTEND_OFFSET (HOTENDS > 1)
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
-  #define E_AXIS_N(E) (E_AXIS + E)
+  #define E_AXIS_N(E) (uint8_t(E_AXIS) + E)
 #else
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE
-  #define E_AXIS_N(E) E_AXIS
+  #define E_AXIS_N(E) uint8_t(E_AXIS)
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif

commit c5642a894fb3e9bb16433d40b9ae152bfe204a6f
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Nov 20 21:39:30 2018 -0600

    Fix ADC_KEYPAD middle button (#12493)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 04cadf8f2c..55e371870d 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -302,20 +302,23 @@
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 
 #define HAS_ADC_BUTTONS     ENABLED(ADC_KEYPAD)
 #define HAS_DIGITAL_BUTTONS (!HAS_ADC_BUTTONS && ENABLED(NEWPANEL))
 #define HAS_SHIFT_ENCODER   (!HAS_ADC_BUTTONS && (ENABLED(REPRAPWORLD_KEYPAD) || (HAS_SPI_LCD && DISABLED(NEWPANEL))))
 #define HAS_ENCODER_WHEEL   (!HAS_ADC_BUTTONS && ENABLED(NEWPANEL))
 
+// I2C buttons must be read in the main thread
+#define HAS_SLOW_BUTTONS (ENABLED(LCD_I2C_VIKI) || ENABLED(LCD_I2C_PANELOLU2))
+
 #if HAS_GRAPHICAL_LCD
   /**
    * Default LCD contrast for Graphical LCD displays
    */
   #define HAS_LCD_CONTRAST (                \
        ENABLED(MAKRPANEL)                   \
     || ENABLED(CARTESIO_UI)                 \
     || ENABLED(VIKI2)                       \
     || ENABLED(AZSMZ_12864)                 \
     || ENABLED(miniVIKI)                    \

commit 1f93d2bcf70f1cbe63ac9f21892543663723c8f3
Author: Ludy <Ludy87@users.noreply.github.com>
Date:   Mon Nov 19 03:39:49 2018 +0100

    Fix LCD compile error, etc. (#12472)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 4dc5f2f3b7..04cadf8f2c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -19,22 +19,20 @@
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
 #pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
-#define LCD_HAS_DIRECTIONAL_BUTTONS (BUTTON_EXISTS(UP) || BUTTON_EXISTS(DWN) || BUTTON_EXISTS(LFT) || BUTTON_EXISTS(RT))
-
 #if ENABLED(CARTESIO_UI)
 
   #define DOGLCD
   #define ULTIPANEL
   #define DEFAULT_LCD_CONTRAST 90
   #define LCD_CONTRAST_MIN 60
   #define LCD_CONTRAST_MAX 140
 
 #elif ENABLED(MAKRPANEL)
 
@@ -298,22 +296,25 @@
 #if ENABLED(ULTIPANEL)
   #define NEWPANEL  // Disable this if you actually have no click-encoder panel
   #define ULTRA_LCD
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
-#define HAS_DIGITAL_BUTTONS  ENABLED(NEWPANEL)
-#define HAS_ENCODER_WHEEL   (ENABLED(NEWPANEL) && DISABLED(ADC_KEYPAD))
+
+#define HAS_ADC_BUTTONS     ENABLED(ADC_KEYPAD)
+#define HAS_DIGITAL_BUTTONS (!HAS_ADC_BUTTONS && ENABLED(NEWPANEL))
+#define HAS_SHIFT_ENCODER   (!HAS_ADC_BUTTONS && (ENABLED(REPRAPWORLD_KEYPAD) || (HAS_SPI_LCD && DISABLED(NEWPANEL))))
+#define HAS_ENCODER_WHEEL   (!HAS_ADC_BUTTONS && ENABLED(NEWPANEL))
 
 #if HAS_GRAPHICAL_LCD
   /**
    * Default LCD contrast for Graphical LCD displays
    */
   #define HAS_LCD_CONTRAST (                \
        ENABLED(MAKRPANEL)                   \
     || ENABLED(CARTESIO_UI)                 \
     || ENABLED(VIKI2)                       \
     || ENABLED(AZSMZ_12864)                 \

commit 93e958f6958b85476eb60d9966f8299aea8464c4
Author: Ludy <Ludy87@users.noreply.github.com>
Date:   Sun Nov 18 04:21:30 2018 +0100

    Fix compile error with ZONESTAR_LCD+NO_LCD_MENUS (#12466)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 7cd2fe632f..4dc5f2f3b7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -45,21 +45,20 @@
   #define ADC_KEYPAD
   #define REPRAPWORLD_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEY_NUM 8
   #define ULTIPANEL
 
   // this helps to implement ADC_KEYPAD menus
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
-  #define REVERSE_MENU_DIRECTION
 
 #elif ENABLED(RADDS_DISPLAY)
   #define ULTIPANEL
   #define ENCODER_PULSES_PER_STEP 2
 
 #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
 #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
@@ -299,21 +298,22 @@
 #if ENABLED(ULTIPANEL)
   #define NEWPANEL  // Disable this if you actually have no click-encoder panel
   #define ULTRA_LCD
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
-#define HAS_DIGITAL_ENCODER  ENABLED(NEWPANEL)
+#define HAS_DIGITAL_BUTTONS  ENABLED(NEWPANEL)
+#define HAS_ENCODER_WHEEL   (ENABLED(NEWPANEL) && DISABLED(ADC_KEYPAD))
 
 #if HAS_GRAPHICAL_LCD
   /**
    * Default LCD contrast for Graphical LCD displays
    */
   #define HAS_LCD_CONTRAST (                \
        ENABLED(MAKRPANEL)                   \
     || ENABLED(CARTESIO_UI)                 \
     || ENABLED(VIKI2)                       \
     || ENABLED(AZSMZ_12864)                 \

commit d82c350de741b6f20a3d4860c9cdc30dae20f746
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Nov 14 13:13:51 2018 -0600

    Miscellaneous LCD code renaming, reordering (#12430)
    
    * Move special characters to language.h
    * Apply some naming standards
    * Clean up menu item draw functions
    * Rename some Temperature methods
    * UI => ExtUI

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b73370c787..7cd2fe632f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -302,78 +302,42 @@
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
 #define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 #define HAS_DIGITAL_ENCODER  ENABLED(NEWPANEL)
 
 #if HAS_GRAPHICAL_LCD
-  //
-  // Custom characters from Marlin_symbols.fon which was merged into ISO10646-0-3.bdf
-  // \x00 intentionally skipped to avoid problems in strings
-  //
-  #define LCD_STR_REFRESH     "\x01"
-  #define LCD_STR_FOLDER      "\x02"
-  #define LCD_STR_ARROW_RIGHT "\x03"
-  #define LCD_STR_UPLEVEL     "\x04"
-  #define LCD_STR_CLOCK       "\x05"
-  #define LCD_STR_FEEDRATE    "\x06"
-  #define LCD_STR_BEDTEMP     "\x07"
-  #define LCD_STR_THERMOMETER "\x08"
-  #define LCD_STR_DEGREE      "\x09"
-
-  #define LCD_STR_SPECIAL_MAX '\x09'
-  // Maximum here is 0x1F because 0x20 is ' ' (space) and the normal charsets begin.
-  // Better stay below 0x10 because DISPLAY_CHARSET_HD44780_WESTERN begins here.
-
-  // Symbol characters
-  #define LCD_STR_FILAM_DIA   "\xf8"
-  #define LCD_STR_FILAM_MUL   "\xa4"
-
   /**
-   * Default LCD contrast for dogm-like LCD displays
+   * Default LCD contrast for Graphical LCD displays
    */
   #define HAS_LCD_CONTRAST (                \
        ENABLED(MAKRPANEL)                   \
     || ENABLED(CARTESIO_UI)                 \
     || ENABLED(VIKI2)                       \
     || ENABLED(AZSMZ_12864)                 \
     || ENABLED(miniVIKI)                    \
     || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
   )
   #if HAS_LCD_CONTRAST
     #ifndef LCD_CONTRAST_MIN
       #define LCD_CONTRAST_MIN 0
     #endif
     #ifndef LCD_CONTRAST_MAX
       #define LCD_CONTRAST_MAX 63
     #endif
     #ifndef DEFAULT_LCD_CONTRAST
       #define DEFAULT_LCD_CONTRAST 32
     #endif
   #endif
-
-#else
-
-  // Custom characters defined in the first 8 characters of the LCD
-  #define LCD_BEDTEMP_CHAR     0x00  // Print only as a char. This will have 'unexpected' results when used in a string!
-  #define LCD_DEGREE_CHAR      0x01
-  #define LCD_STR_THERMOMETER "\x02" // Still used with string concatenation
-  #define LCD_UPLEVEL_CHAR     0x03
-  #define LCD_STR_REFRESH     "\x04"
-  #define LCD_STR_FOLDER      "\x05"
-  #define LCD_FEEDRATE_CHAR    0x06
-  #define LCD_CLOCK_CHAR       0x07
-  #define LCD_STR_ARROW_RIGHT ">"  /* from the default character set */
-
 #endif
 
 // Boot screens
 #if !HAS_SPI_LCD
   #undef SHOW_BOOTSCREEN
 #elif !defined(BOOTSCREEN_TIMEOUT)
   #define BOOTSCREEN_TIMEOUT 2500
 #endif
 
 /**

commit a0c795b097a30eff006c8dff178abf5f1f1907fa
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sun Nov 11 12:16:24 2018 -0600

    Encapsulate common display code in a singleton (#12395)
    
    * Encapsulate common LCD code in a singleton
    * Depend more UBL code on UBL_DEVEL_DEBUGGING
      - Since most users don't need the debugging on at all times, this helps reduce the default build size for UBL by over 2K, a little closer to fitting on 128K boards.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0de18de582..b73370c787 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -289,116 +289,91 @@
 // Shift register panels
 // ---------------------
 // 2 wire Non-latching LCD SR from:
 // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
 
 #if ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define ULTIPANEL
 #endif
 
-#define HAS_GRAPHICAL_LCD ENABLED(DOGLCD)
-
-#if HAS_GRAPHICAL_LCD
-  #ifndef LCD_WIDTH
-    #ifdef LCD_WIDTH_OVERRIDE
-      #define LCD_WIDTH LCD_WIDTH_OVERRIDE
-    #else
-      #define LCD_WIDTH 22
-    #endif
-  #endif
-  #ifndef LCD_HEIGHT
-    #define LCD_HEIGHT 5
-  #endif
-#endif
-
 #if ENABLED(ULTIPANEL)
   #define NEWPANEL  // Disable this if you actually have no click-encoder panel
   #define ULTRA_LCD
-  #ifndef LCD_WIDTH
-    #define LCD_WIDTH 20
-  #endif
-  #ifndef LCD_HEIGHT
-    #define LCD_HEIGHT 4
-  #endif
-#elif ENABLED(ULTRA_LCD)  // no panel but just LCD
-  #ifndef LCD_WIDTH
-    #define LCD_WIDTH 16
-  #endif
-  #ifndef LCD_HEIGHT
-    #define LCD_HEIGHT 2
-  #endif
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
-#define HAS_CHARACTER_LCD   (ENABLED(ULTRA_LCD) && DISABLED(DOGLCD))
+#define HAS_GRAPHICAL_LCD    ENABLED(DOGLCD)
+#define HAS_CHARACTER_LCD   (HAS_SPI_LCD && !HAS_GRAPHICAL_LCD)
 #define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
+#define HAS_DIGITAL_ENCODER  ENABLED(NEWPANEL)
 
 #if HAS_GRAPHICAL_LCD
-  /* Custom characters defined in font Marlin_symbols.fon which was merged to ISO10646-0-3.bdf */
+  //
+  // Custom characters from Marlin_symbols.fon which was merged into ISO10646-0-3.bdf
   // \x00 intentionally skipped to avoid problems in strings
+  //
   #define LCD_STR_REFRESH     "\x01"
   #define LCD_STR_FOLDER      "\x02"
   #define LCD_STR_ARROW_RIGHT "\x03"
   #define LCD_STR_UPLEVEL     "\x04"
   #define LCD_STR_CLOCK       "\x05"
   #define LCD_STR_FEEDRATE    "\x06"
   #define LCD_STR_BEDTEMP     "\x07"
   #define LCD_STR_THERMOMETER "\x08"
   #define LCD_STR_DEGREE      "\x09"
 
   #define LCD_STR_SPECIAL_MAX '\x09'
   // Maximum here is 0x1F because 0x20 is ' ' (space) and the normal charsets begin.
   // Better stay below 0x10 because DISPLAY_CHARSET_HD44780_WESTERN begins here.
 
   // Symbol characters
   #define LCD_STR_FILAM_DIA   "\xf8"
   #define LCD_STR_FILAM_MUL   "\xa4"
-#else
-  // Custom characters defined in the first 8 characters of the LCD
-  #define LCD_BEDTEMP_CHAR     0x00  // Print only as a char. This will have 'unexpected' results when used in a string!
-  #define LCD_DEGREE_CHAR      0x01
-  #define LCD_STR_THERMOMETER "\x02" // Still used with string concatenation
-  #define LCD_UPLEVEL_CHAR     0x03
-  #define LCD_STR_REFRESH     "\x04"
-  #define LCD_STR_FOLDER      "\x05"
-  #define LCD_FEEDRATE_CHAR    0x06
-  #define LCD_CLOCK_CHAR       0x07
-  #define LCD_STR_ARROW_RIGHT ">"  /* from the default character set */
-#endif
-
-/**
- * Default LCD contrast for dogm-like LCD displays
- */
-#if HAS_GRAPHICAL_LCD
 
-  #define HAS_LCD_CONTRAST ( \
-      ENABLED(MAKRPANEL) \
-   || ENABLED(CARTESIO_UI) \
-   || ENABLED(VIKI2) \
-   || ENABLED(AZSMZ_12864) \
-   || ENABLED(miniVIKI) \
-   || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
+  /**
+   * Default LCD contrast for dogm-like LCD displays
+   */
+  #define HAS_LCD_CONTRAST (                \
+       ENABLED(MAKRPANEL)                   \
+    || ENABLED(CARTESIO_UI)                 \
+    || ENABLED(VIKI2)                       \
+    || ENABLED(AZSMZ_12864)                 \
+    || ENABLED(miniVIKI)                    \
+    || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
   )
-
   #if HAS_LCD_CONTRAST
     #ifndef LCD_CONTRAST_MIN
       #define LCD_CONTRAST_MIN 0
     #endif
     #ifndef LCD_CONTRAST_MAX
       #define LCD_CONTRAST_MAX 63
     #endif
     #ifndef DEFAULT_LCD_CONTRAST
       #define DEFAULT_LCD_CONTRAST 32
     #endif
   #endif
+
+#else
+
+  // Custom characters defined in the first 8 characters of the LCD
+  #define LCD_BEDTEMP_CHAR     0x00  // Print only as a char. This will have 'unexpected' results when used in a string!
+  #define LCD_DEGREE_CHAR      0x01
+  #define LCD_STR_THERMOMETER "\x02" // Still used with string concatenation
+  #define LCD_UPLEVEL_CHAR     0x03
+  #define LCD_STR_REFRESH     "\x04"
+  #define LCD_STR_FOLDER      "\x05"
+  #define LCD_FEEDRATE_CHAR    0x06
+  #define LCD_CLOCK_CHAR       0x07
+  #define LCD_STR_ARROW_RIGHT ">"  /* from the default character set */
+
 #endif
 
 // Boot screens
 #if !HAS_SPI_LCD
   #undef SHOW_BOOTSCREEN
 #elif !defined(BOOTSCREEN_TIMEOUT)
   #define BOOTSCREEN_TIMEOUT 2500
 #endif
 
 /**

commit 4ed6397e5df428c1b6881fe0780e098362f40b0f
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Nov 9 00:07:16 2018 -0600

    More comprehensive NO_LCD_MENUS (#12367)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 8e45b1554e..0de18de582 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -289,24 +289,20 @@
 // Shift register panels
 // ---------------------
 // 2 wire Non-latching LCD SR from:
 // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
 
 #if ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define ULTIPANEL
 #endif
 
-#if ENABLED(NO_LCD_MENUS)
-  #undef ULTIPANEL
-#endif
-
 #define HAS_GRAPHICAL_LCD ENABLED(DOGLCD)
 
 #if HAS_GRAPHICAL_LCD
   #ifndef LCD_WIDTH
     #ifdef LCD_WIDTH_OVERRIDE
       #define LCD_WIDTH LCD_WIDTH_OVERRIDE
     #else
       #define LCD_WIDTH 22
     #endif
   #endif
@@ -329,23 +325,21 @@
     #define LCD_WIDTH 16
   #endif
   #ifndef LCD_HEIGHT
     #define LCD_HEIGHT 2
   #endif
 #endif
 
 // Aliases for LCD features
 #define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
 #define HAS_CHARACTER_LCD   (ENABLED(ULTRA_LCD) && DISABLED(DOGLCD))
-#define HAS_DIGITAL_ENCODER (HAS_SPI_LCD && ENABLED(NEWPANEL))
-#define HAS_LCD_MENU         ENABLED(ULTIPANEL)
-#define HAS_DEBUG_MENU      (HAS_LCD_MENU && ENABLED(LCD_PROGRESS_BAR_TEST))
+#define HAS_LCD_MENU        (ENABLED(ULTIPANEL) && DISABLED(NO_LCD_MENUS))
 
 #if HAS_GRAPHICAL_LCD
   /* Custom characters defined in font Marlin_symbols.fon which was merged to ISO10646-0-3.bdf */
   // \x00 intentionally skipped to avoid problems in strings
   #define LCD_STR_REFRESH     "\x01"
   #define LCD_STR_FOLDER      "\x02"
   #define LCD_STR_ARROW_RIGHT "\x03"
   #define LCD_STR_UPLEVEL     "\x04"
   #define LCD_STR_CLOCK       "\x05"
   #define LCD_STR_FEEDRATE    "\x06"

commit d5ab4cd22aaa6bb445b8bc2b7c8017d3d00b3dc8
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Nov 5 00:20:13 2018 -0600

    Provide a default for Z_PROBE_LOW_POINT

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9a8a508aa6..8e45b1554e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -537,27 +537,31 @@
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
 #define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE) || ENABLED(SENSORLESS_PROBING) || ENABLED(RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || ENABLED(PROBE_MANUALLY) || ENABLED(MESH_BED_LEVELING))
 
-#if !HAS_BED_PROBE
+#if HAS_BED_PROBE
+  #ifndef Z_PROBE_LOW_POINT
+    #define Z_PROBE_LOW_POINT -5
+  #endif
+  #if ENABLED(Z_PROBE_ALLEN_KEY)
+    #define PROBE_TRIGGERED_WHEN_STOWED_TEST // Extra test for Allen Key Probe
+  #endif
+#else
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
-#elif ENABLED(Z_PROBE_ALLEN_KEY)
-  // Extra test for Allen Key Probe
-  #define PROBE_TRIGGERED_WHEN_STOWED_TEST
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #ifdef GRID_MAX_POINTS_X
   #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))

commit 44fa7fb18cf1e72569215d6425ddc43063d9e37e
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat Nov 3 02:13:10 2018 -0500

    Cleanups for leveling-related code

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index af1832fd35..9a8a508aa6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -12,29 +12,27 @@
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  * GNU General Public License for more details.
  *
  * You should have received a copy of the GNU General Public License
  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  *
  */
+#pragma once
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
-#ifndef CONDITIONALS_LCD_H // Get the LCD defines which are needed first
-#define CONDITIONALS_LCD_H
-
 #define LCD_HAS_DIRECTIONAL_BUTTONS (BUTTON_EXISTS(UP) || BUTTON_EXISTS(DWN) || BUTTON_EXISTS(LFT) || BUTTON_EXISTS(RT))
 
 #if ENABLED(CARTESIO_UI)
 
   #define DOGLCD
   #define ULTIPANEL
   #define DEFAULT_LCD_CONTRAST 90
   #define LCD_CONTRAST_MIN 60
   #define LCD_CONTRAST_MAX 140
 
@@ -550,20 +548,26 @@
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
 #elif ENABLED(Z_PROBE_ALLEN_KEY)
   // Extra test for Allen Key Probe
   #define PROBE_TRIGGERED_WHEN_STOWED_TEST
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
+#ifdef GRID_MAX_POINTS_X
+  #define GRID_MAX_POINTS ((GRID_MAX_POINTS_X) * (GRID_MAX_POINTS_Y))
+#endif
+
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 #define HAS_LEDS_OFF_FLAG (ENABLED(PRINTER_EVENT_LEDS) && ENABLED(SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
 
-#endif // CONDITIONALS_LCD_H
+#define IS_SCARA     (ENABLED(MORGAN_SCARA) || ENABLED(MAKERARM_SCARA))
+#define IS_KINEMATIC (ENABLED(DELTA) || IS_SCARA)
+#define IS_CARTESIAN !IS_KINEMATIC

commit 5ba6607181470006c5903e414c678506ca81b22d
Author: Ludy <Ludy87@users.noreply.github.com>
Date:   Sat Nov 3 04:29:32 2018 +0100

    Fix keypad-related compile error (#12306)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index dd17605a1d..af1832fd35 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -37,23 +37,23 @@
   #define DEFAULT_LCD_CONTRAST 90
   #define LCD_CONTRAST_MIN 60
   #define LCD_CONTRAST_MAX 140
 
 #elif ENABLED(MAKRPANEL)
 
   #define U8GLIB_ST7565_64128N
 
 #elif ENABLED(ZONESTAR_LCD)
 
+  #define ADC_KEYPAD
   #define REPRAPWORLD_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
-  #define ADC_KEYPAD
   #define ADC_KEY_NUM 8
   #define ULTIPANEL
 
   // this helps to implement ADC_KEYPAD menus
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
   #define REVERSE_MENU_DIRECTION
 
 #elif ENABLED(RADDS_DISPLAY)

commit 2bf18950ab2070e842c91057d5812dcaa1bff9a2
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Oct 23 16:00:34 2018 -0500

    Refactor LCD menus

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index be95a1d0b7..dd17605a1d 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -291,56 +291,65 @@
 // Shift register panels
 // ---------------------
 // 2 wire Non-latching LCD SR from:
 // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
 
 #if ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define ULTIPANEL
 #endif
 
-#if ENABLED(DOGLCD) // Change number of lines to match the DOG graphic display
+#if ENABLED(NO_LCD_MENUS)
+  #undef ULTIPANEL
+#endif
+
+#define HAS_GRAPHICAL_LCD ENABLED(DOGLCD)
+
+#if HAS_GRAPHICAL_LCD
   #ifndef LCD_WIDTH
     #ifdef LCD_WIDTH_OVERRIDE
       #define LCD_WIDTH LCD_WIDTH_OVERRIDE
     #else
       #define LCD_WIDTH 22
     #endif
   #endif
   #ifndef LCD_HEIGHT
     #define LCD_HEIGHT 5
   #endif
 #endif
 
-#if ENABLED(NO_LCD_MENUS)
-  #undef ULTIPANEL
-#endif
-
 #if ENABLED(ULTIPANEL)
   #define NEWPANEL  // Disable this if you actually have no click-encoder panel
   #define ULTRA_LCD
   #ifndef LCD_WIDTH
     #define LCD_WIDTH 20
   #endif
   #ifndef LCD_HEIGHT
     #define LCD_HEIGHT 4
   #endif
 #elif ENABLED(ULTRA_LCD)  // no panel but just LCD
   #ifndef LCD_WIDTH
     #define LCD_WIDTH 16
   #endif
   #ifndef LCD_HEIGHT
     #define LCD_HEIGHT 2
   #endif
 #endif
 
-#if ENABLED(DOGLCD)
+// Aliases for LCD features
+#define HAS_SPI_LCD          ENABLED(ULTRA_LCD)
+#define HAS_CHARACTER_LCD   (ENABLED(ULTRA_LCD) && DISABLED(DOGLCD))
+#define HAS_DIGITAL_ENCODER (HAS_SPI_LCD && ENABLED(NEWPANEL))
+#define HAS_LCD_MENU         ENABLED(ULTIPANEL)
+#define HAS_DEBUG_MENU      (HAS_LCD_MENU && ENABLED(LCD_PROGRESS_BAR_TEST))
+
+#if HAS_GRAPHICAL_LCD
   /* Custom characters defined in font Marlin_symbols.fon which was merged to ISO10646-0-3.bdf */
   // \x00 intentionally skipped to avoid problems in strings
   #define LCD_STR_REFRESH     "\x01"
   #define LCD_STR_FOLDER      "\x02"
   #define LCD_STR_ARROW_RIGHT "\x03"
   #define LCD_STR_UPLEVEL     "\x04"
   #define LCD_STR_CLOCK       "\x05"
   #define LCD_STR_FEEDRATE    "\x06"
   #define LCD_STR_BEDTEMP     "\x07"
   #define LCD_STR_THERMOMETER "\x08"
@@ -362,21 +371,21 @@
   #define LCD_STR_REFRESH     "\x04"
   #define LCD_STR_FOLDER      "\x05"
   #define LCD_FEEDRATE_CHAR    0x06
   #define LCD_CLOCK_CHAR       0x07
   #define LCD_STR_ARROW_RIGHT ">"  /* from the default character set */
 #endif
 
 /**
  * Default LCD contrast for dogm-like LCD displays
  */
-#if ENABLED(DOGLCD)
+#if HAS_GRAPHICAL_LCD
 
   #define HAS_LCD_CONTRAST ( \
       ENABLED(MAKRPANEL) \
    || ENABLED(CARTESIO_UI) \
    || ENABLED(VIKI2) \
    || ENABLED(AZSMZ_12864) \
    || ENABLED(miniVIKI) \
    || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
   )
 
@@ -387,28 +396,26 @@
     #ifndef LCD_CONTRAST_MAX
       #define LCD_CONTRAST_MAX 63
     #endif
     #ifndef DEFAULT_LCD_CONTRAST
       #define DEFAULT_LCD_CONTRAST 32
     #endif
   #endif
 #endif
 
 // Boot screens
-#if DISABLED(ULTRA_LCD)
+#if !HAS_SPI_LCD
   #undef SHOW_BOOTSCREEN
 #elif !defined(BOOTSCREEN_TIMEOUT)
   #define BOOTSCREEN_TIMEOUT 2500
 #endif
 
-#define HAS_DEBUG_MENU (ENABLED(ULTIPANEL) && ENABLED(LCD_PROGRESS_BAR_TEST))
-
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */

commit ab8425f1b57eede22873ef91c504605da8d41037
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Oct 26 19:18:20 2018 -0500

    Clean up PROBE_TRIGGERED_WHEN_STOWED_TEST (#12232)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c771d624e4..be95a1d0b7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -538,21 +538,21 @@
  */
 #define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE) || ENABLED(SENSORLESS_PROBING) || ENABLED(RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || ENABLED(PROBE_MANUALLY) || ENABLED(MESH_BED_LEVELING))
 
 #if !HAS_BED_PROBE
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
 #elif ENABLED(Z_PROBE_ALLEN_KEY)
   // Extra test for Allen Key Probe
-  #define PROBE_IS_TRIGGERED_WHEN_STOWED_TEST
+  #define PROBE_TRIGGERED_WHEN_STOWED_TEST
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 #define HAS_LEDS_OFF_FLAG (ENABLED(PRINTER_EVENT_LEDS) && ENABLED(SDSUPPORT) && HAS_RESUME_CONTINUE)
 #define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
 

commit 3028a620af6d6e7bea05e1dee2cdd2eae47db3b0
Author: Chris Rigter <chris@rigter.com.au>
Date:   Sat Oct 27 08:47:38 2018 +1100

    Add RACK_AND_PINION_PROBE (#12218)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index da3c340235..c771d624e4 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -529,21 +529,21 @@
 #endif
 
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
-#define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE) || ENABLED(SENSORLESS_PROBING))
+#define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE) || ENABLED(SENSORLESS_PROBING) || ENABLED(RACK_AND_PINION_PROBE))
 #define PROBE_SELECTED (HAS_BED_PROBE || ENABLED(PROBE_MANUALLY) || ENABLED(MESH_BED_LEVELING))
 
 #if !HAS_BED_PROBE
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
 #elif ENABLED(Z_PROBE_ALLEN_KEY)
   // Extra test for Allen Key Probe
   #define PROBE_IS_TRIGGERED_WHEN_STOWED_TEST
 #endif

commit a93e9e6e9b96512e1dda6f9e1cfb836a4a4e0fde
Author: Ludy <Ludy87@users.noreply.github.com>
Date:   Tue Oct 23 22:38:17 2018 +0200

    Use preheat labels in place of PLA/ABS (#12194)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index abd2ec5557..da3c340235 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -518,21 +518,21 @@
   #else
     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
   #endif
 #endif
 
 #ifndef PREHEAT_1_LABEL
   #define PREHEAT_1_LABEL "PLA"
 #endif
 
 #ifndef PREHEAT_2_LABEL
-  #define PREHEAT_1_LABEL "ABS"
+  #define PREHEAT_2_LABEL "ABS"
 #endif
 
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */

commit e229b831fab7b3e789631ea004640b7c82555253
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Oct 23 00:57:19 2018 -0500

    Customizable preheat labels

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d44623e3c9..abd2ec5557 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -513,20 +513,28 @@
 
   #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #undef Z_MIN_ENDSTOP_INVERTING
     #define Z_MIN_ENDSTOP_INVERTING Z_MIN_PROBE_ENDSTOP_INVERTING
     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN)
   #else
     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
   #endif
 #endif
 
+#ifndef PREHEAT_1_LABEL
+  #define PREHEAT_1_LABEL "PLA"
+#endif
+
+#ifndef PREHEAT_2_LABEL
+  #define PREHEAT_1_LABEL "ABS"
+#endif
+
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
 #define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE) || ENABLED(SENSORLESS_PROBING))
 #define PROBE_SELECTED (HAS_BED_PROBE || ENABLED(PROBE_MANUALLY) || ENABLED(MESH_BED_LEVELING))

commit 67a3c5a16ad0c202352ef19b5993ac0c7f52862d
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Thu Oct 18 11:34:52 2018 -0500

    Alternative info screen (Prusa-style) (#12132)
    
    * Fix Z value display
    * Add HAS_PRINT_PROGRESS
    * Alternative Info Screen option
    * Add LCD_INFO_SCREEN_STYLE to example configs

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f5c086fed9..d44623e3c9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -539,15 +539,16 @@
   // Extra test for Allen Key Probe
   #define PROBE_IS_TRIGGERED_WHEN_STOWED_TEST
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 #define HAS_LEDS_OFF_FLAG (ENABLED(PRINTER_EVENT_LEDS) && ENABLED(SDSUPPORT) && HAS_RESUME_CONTINUE)
+#define HAS_PRINT_PROGRESS (ENABLED(SDSUPPORT) || ENABLED(LCD_SET_PROGRESS_MANUALLY))
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
 
 #endif // CONDITIONALS_LCD_H

commit d43d4e421977e333f1a7fbff8b939e0288b3616c
Author: Giuliano Zaro <3684609+GMagician@users.noreply.github.com>
Date:   Thu Oct 11 04:25:43 2018 +0200

    Refactor PRINTER_EVENT_LEDS, apply to M303 (#12038)
    
    Co-Authored-By: Giuliano Zaro <gmagician@users.noreply.github.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0680306fd3..f5c086fed9 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -538,15 +538,16 @@
 #elif ENABLED(Z_PROBE_ALLEN_KEY)
   // Extra test for Allen Key Probe
   #define PROBE_IS_TRIGGERED_WHEN_STOWED_TEST
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
+#define HAS_LEDS_OFF_FLAG (ENABLED(PRINTER_EVENT_LEDS) && ENABLED(SDSUPPORT) && HAS_RESUME_CONTINUE)
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
 
 #endif // CONDITIONALS_LCD_H

commit 906a24fa81586e3d9aeb60e7a3fb179a8b616b9b
Author: Marcio Teixeira <marcio@alephobjects.com>
Date:   Mon Oct 8 14:44:05 2018 -0600

    Extensible user interface API (#11193)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5b97809020..0680306fd3 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -536,17 +536,17 @@
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
 #elif ENABLED(Z_PROBE_ALLEN_KEY)
   // Extra test for Allen Key Probe
   #define PROBE_IS_TRIGGERED_WHEN_STOWED_TEST
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
-#define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
+#define HAS_RESUME_CONTINUE (ENABLED(EXTENSIBLE_UI) || ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 
 #define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
 #define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
 
 #endif // CONDITIONALS_LCD_H

commit 7db0113b53632946ad85836b309190ae2d98f9c4
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sun Oct 7 18:19:52 2018 -0500

    Improve E_AXIS_N macro

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 328410e60b..5b97809020 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -465,25 +465,25 @@
 
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 
 #define HAS_HOTEND_OFFSET (HOTENDS > 1)
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
-  #define E_AXIS_N (E_AXIS + extruder)
+  #define E_AXIS_N(E) (E_AXIS + E)
 #else
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE
-  #define E_AXIS_N E_AXIS
+  #define E_AXIS_N(E) E_AXIS
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
   #ifndef Z_PROBE_SERVO_NR
     #define Z_PROBE_SERVO_NR 0
   #endif

commit 3286325044a7788f12ceb3f3d6cef00dc8b32433
Author: Thomas Moore <tcm0116@gmail.com>
Date:   Sun Sep 9 15:59:12 2018 -0400

    Add TMC2130 sensorless probing

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index aaa6d5462d..328410e60b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -521,21 +521,21 @@
 #endif
 
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
-#define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
+#define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE) || ENABLED(SENSORLESS_PROBING))
 #define PROBE_SELECTED (HAS_BED_PROBE || ENABLED(PROBE_MANUALLY) || ENABLED(MESH_BED_LEVELING))
 
 #if !HAS_BED_PROBE
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
 #elif ENABLED(Z_PROBE_ALLEN_KEY)
   // Extra test for Allen Key Probe
   #define PROBE_IS_TRIGGERED_WHEN_STOWED_TEST
 #endif

commit 1a6f2b29b8dd3bc8e6ef56d4f376f49cacfc8785
Author: Holger MuÃàller <holger@mueller-gelff.de>
Date:   Tue Jun 19 18:55:49 2018 +0200

    Add support for Triple-Z steppers/endstops

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 11d4a3ce65..aaa6d5462d 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -539,11 +539,14 @@
   // Extra test for Allen Key Probe
   #define PROBE_IS_TRIGGERED_WHEN_STOWED_TEST
 #endif
 
 #define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 
+#define Z_MULTI_STEPPER_DRIVERS (ENABLED(Z_DUAL_STEPPER_DRIVERS) || ENABLED(Z_TRIPLE_STEPPER_DRIVERS))
+#define Z_MULTI_ENDSTOPS (ENABLED(Z_DUAL_ENDSTOPS) || ENABLED(Z_TRIPLE_ENDSTOPS))
+
 #endif // CONDITIONALS_LCD_H

commit e25d2ae4a2063d30330facf81c4b2b93cd63dda6
Author: Kevin <kevinbayer8@gmail.com>
Date:   Sat Sep 8 08:43:24 2018 +0200

    [2.0.x] SWITCHING_TOOLHEAD (#11623)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0869faa8e2..11d4a3ce65 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -416,25 +416,24 @@
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
   #if DISABLED(SWITCHING_NOZZLE)
     #define HOTENDS       E_STEPPERS
   #endif
-  #define E_MANUAL        EXTRUDERS
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
-#else
+#elif ENABLED(SWITCHING_TOOLHEAD)
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 #endif
 
 // No inactive extruders with MK2_MULTIPLEXER or SWITCHING_NOZZLE
 #if ENABLED(MK2_MULTIPLEXER) || ENABLED(SWITCHING_NOZZLE)
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
 // MK2 Multiplexer forces SINGLENOZZLE
@@ -447,20 +446,28 @@
   #define HOTENDS       1
   #undef TEMP_SENSOR_1_AS_REDUNDANT
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #endif
 
 #ifndef HOTENDS
   #define HOTENDS EXTRUDERS
 #endif
 
+#ifndef E_STEPPERS
+  #define E_STEPPERS EXTRUDERS
+#endif
+
+#ifndef E_MANUAL
+  #define E_MANUAL EXTRUDERS
+#endif
+
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 
 #define HAS_HOTEND_OFFSET (HOTENDS > 1)
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1

commit d1c9517903da3e7ab84e34ffb2c23d0772f2ce8c
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Fri Aug 24 21:26:29 2018 -0500

    Followup to hotend_offset[Z] patch

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 608225ca4f..0869faa8e2 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -451,20 +451,22 @@
 #endif
 
 #ifndef HOTENDS
   #define HOTENDS EXTRUDERS
 #endif
 
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 
+#define HAS_HOTEND_OFFSET (HOTENDS > 1)
+
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N (E_AXIS + extruder)
 #else
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE
   #define E_AXIS_N E_AXIS

commit 094e6d81a52fc24aba13b632bd4693263ffeed18
Author: Lee Olivares <lee@braains.net>
Date:   Thu Jul 26 03:52:22 2018 -0700

    Add Einstart-S support (#11219)
    
    Indeed the HAL does not need to be mucked around with to expose ATmega2560 pins not available as numbers on the MEGA board, I'll need to update the wiki with that tidbit and a reference to the pin-mapping comment in `fastio_1280.h`.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 2b05d65682..608225ca4f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -194,20 +194,32 @@
   #define ULTIPANEL
 #endif
 
 #if ENABLED(REPRAPWORLD_KEYPAD)
   #define NEWPANEL
   #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
+/**
+ * SPI PANELS
+ */
+
+ // Einstart OLED has Cardinal nav via pins defined in pins_EINSTART-S.h
+ #if ENABLED(U8GLIB_SH1106_EINSTART)
+   #define ULTRA_LCD
+   #define DOGLCD
+   #define ULTIPANEL
+   #define NEWPANEL
+ #endif
+
 /**
  * I2C PANELS
  */
 
 #if ENABLED(LCD_SAINSMART_I2C_1602) || ENABLED(LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
 
   #if ENABLED(LCD_SAINSMART_I2C_2004)

commit 25e2ca88964a0f8156ccc385393102feec5443d3
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Jul 12 21:36:24 2018 -0500

    Add Z_CLEARANCE_MULTI_PROBE
    
    Co-Authored-By: nightgryphon <ngryph@gmail.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index b52b87e522..2b05d65682 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -501,21 +501,21 @@
 
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set flags for enabled probes
  */
 #define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
-#define PROBE_SELECTED (HAS_BED_PROBE || ENABLED(PROBE_MANUALLY))
+#define PROBE_SELECTED (HAS_BED_PROBE || ENABLED(PROBE_MANUALLY) || ENABLED(MESH_BED_LEVELING))
 
 #if !HAS_BED_PROBE
   // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
 #elif ENABLED(Z_PROBE_ALLEN_KEY)
   // Extra test for Allen Key Probe
   #define PROBE_IS_TRIGGERED_WHEN_STOWED_TEST
 #endif
 

commit 1ea222e6fca4c5ae0fb0d3f0af72c2a5f01aa448
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Jul 2 16:54:52 2018 -0500

    Turn off DISABLE_INACTIVE_EXTRUDER with SWITCHING_NOZZLE
    
    Fix #11183

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0abd45135e..b52b87e522 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -383,70 +383,74 @@
 
 // Boot screens
 #if DISABLED(ULTRA_LCD)
   #undef SHOW_BOOTSCREEN
 #elif !defined(BOOTSCREEN_TIMEOUT)
   #define BOOTSCREEN_TIMEOUT 2500
 #endif
 
 #define HAS_DEBUG_MENU (ENABLED(ULTIPANEL) && ENABLED(LCD_PROGRESS_BAR_TEST))
 
-// MK2 Multiplexer forces SINGLENOZZLE and kills DISABLE_INACTIVE_EXTRUDER
-#if ENABLED(MK2_MULTIPLEXER)
-  #define SINGLENOZZLE
-  #undef DISABLE_INACTIVE_EXTRUDER
-#endif
-
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */
-#define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
-
 #if ENABLED(SWITCHING_EXTRUDER)                               // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
   #if DISABLED(SWITCHING_NOZZLE)
     #define HOTENDS       E_STEPPERS
   #endif
   #define E_MANUAL        EXTRUDERS
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
 #else
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 #endif
 
+// No inactive extruders with MK2_MULTIPLEXER or SWITCHING_NOZZLE
+#if ENABLED(MK2_MULTIPLEXER) || ENABLED(SWITCHING_NOZZLE)
+  #undef DISABLE_INACTIVE_EXTRUDER
+#endif
+
+// MK2 Multiplexer forces SINGLENOZZLE
+#if ENABLED(MK2_MULTIPLEXER)
+  #define SINGLENOZZLE
+#endif
+
 #if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #undef HOTENDS
   #define HOTENDS       1
   #undef TEMP_SENSOR_1_AS_REDUNDANT
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #endif
 
 #ifndef HOTENDS
   #define HOTENDS EXTRUDERS
 #endif
 
+#define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
+
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N (E_AXIS + extruder)
 #else
   #undef DISTINCT_E_FACTORS

commit 9713538427b21ae981794a3ecea77bff88319976
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue May 29 11:05:52 2018 -0500

    HOTENDS for Switching Nozzle with Switching Extruder

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 69e396b61e..0abd45135e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -409,21 +409,23 @@
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 
 #if ENABLED(SWITCHING_EXTRUDER)                               // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
-  #define HOTENDS         E_STEPPERS
+  #if DISABLED(SWITCHING_NOZZLE)
+    #define HOTENDS       E_STEPPERS
+  #endif
   #define E_MANUAL        EXTRUDERS
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
 #else
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 #endif
 
 #if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset

commit 0ca9db705191d0b36dea513437ec518b0c0211a6
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sun May 27 17:56:21 2018 -0500

    Correct HOTENDS for SWITCHING_EXTRUDER

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 80c53cfa9c..69e396b61e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -399,54 +399,52 @@
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */
-#if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
-  #define HOTENDS       1
-  #undef TEMP_SENSOR_1_AS_REDUNDANT
-  #undef HOTEND_OFFSET_X
-  #undef HOTEND_OFFSET_Y
-#else                                                         // Two hotends
-  #define HOTENDS       EXTRUDERS
-#endif
-
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 
-#if HOTENDS == 1
-  #define HOTEND_INDEX  0
-#else
-  #define HOTEND_INDEX  e
-#endif
-
 #if ENABLED(SWITCHING_EXTRUDER)                               // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
   #else
     #define E_STEPPERS    1
   #endif
+  #define HOTENDS         E_STEPPERS
   #define E_MANUAL        EXTRUDERS
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
 #else
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 #endif
 
+#if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
+  #undef HOTENDS
+  #define HOTENDS       1
+  #undef TEMP_SENSOR_1_AS_REDUNDANT
+  #undef HOTEND_OFFSET_X
+  #undef HOTEND_OFFSET_Y
+#endif
+
+#ifndef HOTENDS
+  #define HOTENDS EXTRUDERS
+#endif
+
 #define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N (E_AXIS + extruder)
 #else
   #undef DISTINCT_E_FACTORS

commit cf7d5a642aea61702823335c3c42d9432270802e
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat May 26 18:30:53 2018 -0500

    Fix manual moves for switching tools (#10868)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d11aeec5de..80c53cfa9c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -419,24 +419,22 @@
 
 #if HOTENDS == 1
   #define HOTEND_INDEX  0
 #else
   #define HOTEND_INDEX  e
 #endif
 
 #if ENABLED(SWITCHING_EXTRUDER)                               // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
-    #define E_MANUAL      3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
-    #define E_MANUAL      2
   #else
     #define E_STEPPERS    1
   #endif
   #define E_MANUAL        EXTRUDERS
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
 #else
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS

commit 83d42f33e140680a3328990cc3bf899b7dd84370
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat May 19 16:37:27 2018 -0500

    Add HAS_HOTEND_OFFSET_Z conditional

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 9d414ee41b..d11aeec5de 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -406,23 +406,20 @@
  *  E_MANUAL     - Number of E steppers for LCD move options
  *
  */
 #if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #define HOTENDS       1
   #undef TEMP_SENSOR_1_AS_REDUNDANT
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #else                                                         // Two hotends
   #define HOTENDS       EXTRUDERS
-  #if ENABLED(SWITCHING_NOZZLE) && !defined(HOTEND_OFFSET_Z)
-    #define HOTEND_OFFSET_Z { 0 }
-  #endif
 #endif
 
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 
 #if HOTENDS == 1
   #define HOTEND_INDEX  0
 #else
   #define HOTEND_INDEX  e
 #endif
 

commit 3c76bda2d8d1f198a9e6dcb94aca6e383c9d5392
Author: GMagician <GMagician@users.noreply.github.com>
Date:   Fri May 18 20:16:59 2018 +0200

    Fix switching extruder
    
    `DONT_SWITCH` got lost along the way. Replace it with `DO_SWITCH_EXTRUDER` and adjust the code.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a9e4fd7333..9d414ee41b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -438,20 +438,22 @@
   #endif
   #define E_MANUAL        EXTRUDERS
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
 #else
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 #endif
 
+#define DO_SWITCH_EXTRUDER (ENABLED(SWITCHING_EXTRUDER) && (DISABLED(SWITCHING_NOZZLE) || SWITCHING_EXTRUDER_SERVO_NR != SWITCHING_NOZZLE_SERVO_NR))
+
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N (E_AXIS + extruder)
 #else
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE
   #define E_AXIS_N E_AXIS

commit a1062eec5b6afe38d6769beea89bb14017c3f260
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat May 12 08:34:04 2018 -0500

    Better handling of DELAY_NS and DELAY_US (#10716)
    
    Co-Authored-By: ejtagle <ejtagle@hotmail.com>

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 67bb5a738f..a9e4fd7333 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -113,27 +113,27 @@
 #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
   #define DOGLCD
   #define U8GLIB_ST7920
   #define ULTIPANEL
 
 #elif ENABLED(CR10_STOCKDISPLAY)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
   #ifndef ST7920_DELAY_1
-    #define ST7920_DELAY_1 DELAY_2_NOP
+    #define ST7920_DELAY_1 DELAY_NS(125)
   #endif
   #ifndef ST7920_DELAY_2
-    #define ST7920_DELAY_2 DELAY_2_NOP
+    #define ST7920_DELAY_2 DELAY_NS(125)
   #endif
   #ifndef ST7920_DELAY_3
-    #define ST7920_DELAY_3 DELAY_2_NOP
+    #define ST7920_DELAY_3 DELAY_NS(125)
   #endif
 
 #elif ENABLED(MKS_12864OLED)
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define U8GLIB_SH1106
 
 #elif ENABLED(MKS_12864OLED_SSD1306)
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER

commit 05c33833e70c143b726fa32d0052618d178fa0ca
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Mon Apr 30 21:16:31 2018 -0500

    [2.0.x] Add NO_LCD_MENUS option (#10582)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c1467c24a6..67bb5a738f 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -292,20 +292,24 @@
       #define LCD_WIDTH LCD_WIDTH_OVERRIDE
     #else
       #define LCD_WIDTH 22
     #endif
   #endif
   #ifndef LCD_HEIGHT
     #define LCD_HEIGHT 5
   #endif
 #endif
 
+#if ENABLED(NO_LCD_MENUS)
+  #undef ULTIPANEL
+#endif
+
 #if ENABLED(ULTIPANEL)
   #define NEWPANEL  // Disable this if you actually have no click-encoder panel
   #define ULTRA_LCD
   #ifndef LCD_WIDTH
     #define LCD_WIDTH 20
   #endif
   #ifndef LCD_HEIGHT
     #define LCD_HEIGHT 4
   #endif
 #elif ENABLED(ULTRA_LCD)  // no panel but just LCD
@@ -377,21 +381,21 @@
   #endif
 #endif
 
 // Boot screens
 #if DISABLED(ULTRA_LCD)
   #undef SHOW_BOOTSCREEN
 #elif !defined(BOOTSCREEN_TIMEOUT)
   #define BOOTSCREEN_TIMEOUT 2500
 #endif
 
-#define HAS_DEBUG_MENU ENABLED(LCD_PROGRESS_BAR_TEST)
+#define HAS_DEBUG_MENU (ENABLED(ULTIPANEL) && ENABLED(LCD_PROGRESS_BAR_TEST))
 
 // MK2 Multiplexer forces SINGLENOZZLE and kills DISABLE_INACTIVE_EXTRUDER
 #if ENABLED(MK2_MULTIPLEXER)
   #define SINGLENOZZLE
   #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:

commit f790b4bc0a36fa36e77087cda46f5fb593500af2
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Fri Apr 27 00:44:47 2018 -0500

    Reorganize some conditionals

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index e00a12cd4c..c1467c24a6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -493,27 +493,31 @@
     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
   #endif
 #endif
 
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
- * Set a flag for any enabled probe
+ * Set flags for enabled probes
  */
-#define PROBE_SELECTED (ENABLED(PROBE_MANUALLY) || ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
+#define HAS_BED_PROBE (ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
+#define PROBE_SELECTED (HAS_BED_PROBE || ENABLED(PROBE_MANUALLY))
 
-/**
- * Clear probe pin settings when no probe is selected
- */
-#if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
+#if !HAS_BED_PROBE
+  // Clear probe pin settings when no probe is selected
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
+#elif ENABLED(Z_PROBE_ALLEN_KEY)
+  // Extra test for Allen Key Probe
+  #define PROBE_IS_TRIGGERED_WHEN_STOWED_TEST
 #endif
 
+#define HOMING_Z_WITH_PROBE (HAS_BED_PROBE && Z_HOME_DIR < 0 && ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN))
+
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 
 #endif // CONDITIONALS_LCD_H

commit c96412a78fbf7be0f1f4bca17edab49d8f1040bf
Author: Yunhui Fu <yhfudev@gmail.com>
Date:   Thu Apr 12 21:14:01 2018 -0400

    [2.0.x] UTF-8 language translation support (#10213)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 707be5fcfa..e00a12cd4c 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -311,21 +311,21 @@
 #elif ENABLED(ULTRA_LCD)  // no panel but just LCD
   #ifndef LCD_WIDTH
     #define LCD_WIDTH 16
   #endif
   #ifndef LCD_HEIGHT
     #define LCD_HEIGHT 2
   #endif
 #endif
 
 #if ENABLED(DOGLCD)
-  /* Custom characters defined in font dogm_font_data_Marlin_symbols.h / Marlin_symbols.fon */
+  /* Custom characters defined in font Marlin_symbols.fon which was merged to ISO10646-0-3.bdf */
   // \x00 intentionally skipped to avoid problems in strings
   #define LCD_STR_REFRESH     "\x01"
   #define LCD_STR_FOLDER      "\x02"
   #define LCD_STR_ARROW_RIGHT "\x03"
   #define LCD_STR_UPLEVEL     "\x04"
   #define LCD_STR_CLOCK       "\x05"
   #define LCD_STR_FEEDRATE    "\x06"
   #define LCD_STR_BEDTEMP     "\x07"
   #define LCD_STR_THERMOMETER "\x08"
   #define LCD_STR_DEGREE      "\x09"

commit adcb87f0db47672c28cfec9fda3354adac81fa99
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sun Apr 1 23:54:12 2018 -0500

    Z Endstop Servo => Z Probe Servo

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index c49cbbec90..707be5fcfa 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -451,25 +451,25 @@
   #undef DISTINCT_E_FACTORS
   #define XYZE_N XYZE
   #define E_AXIS_N E_AXIS
 #endif
 
 /**
  * The BLTouch Probe emulates a servo probe
  * and uses "special" angles for its state.
  */
 #if ENABLED(BLTOUCH)
-  #ifndef Z_ENDSTOP_SERVO_NR
-    #define Z_ENDSTOP_SERVO_NR 0
+  #ifndef Z_PROBE_SERVO_NR
+    #define Z_PROBE_SERVO_NR 0
   #endif
   #ifndef NUM_SERVOS
-    #define NUM_SERVOS (Z_ENDSTOP_SERVO_NR + 1)
+    #define NUM_SERVOS (Z_PROBE_SERVO_NR + 1)
   #endif
   #undef DEACTIVATE_SERVOS_AFTER_MOVE
   #if NUM_SERVOS == 1
     #undef SERVO_DELAY
     #define SERVO_DELAY { 50 }
   #endif
   #ifndef BLTOUCH_DELAY
     #define BLTOUCH_DELAY 375
   #endif
   #undef Z_SERVO_ANGLES
@@ -490,26 +490,26 @@
     #define Z_MIN_ENDSTOP_INVERTING Z_MIN_PROBE_ENDSTOP_INVERTING
     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN)
   #else
     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
   #endif
 #endif
 
 /**
  * Set a flag for a servo probe
  */
-#define HAS_Z_SERVO_ENDSTOP (defined(Z_ENDSTOP_SERVO_NR) && Z_ENDSTOP_SERVO_NR >= 0)
+#define HAS_Z_SERVO_PROBE (defined(Z_PROBE_SERVO_NR) && Z_PROBE_SERVO_NR >= 0)
 
 /**
  * Set a flag for any enabled probe
  */
-#define PROBE_SELECTED (ENABLED(PROBE_MANUALLY) || ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_ENDSTOP || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
+#define PROBE_SELECTED (ENABLED(PROBE_MANUALLY) || ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_PROBE || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
 
 /**
  * Clear probe pin settings when no probe is selected
  */
 #if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))

commit 987597532c8ea0b8426c4c9078acd85333bd2c66
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Mar 21 04:34:24 2018 -0500

    For MK2_MULTIPLEXER undef DISABLE_INACTIVE_EXTRUDER
    
    Fix #10098

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 872ae75420..c49cbbec90 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -379,23 +379,24 @@
 
 // Boot screens
 #if DISABLED(ULTRA_LCD)
   #undef SHOW_BOOTSCREEN
 #elif !defined(BOOTSCREEN_TIMEOUT)
   #define BOOTSCREEN_TIMEOUT 2500
 #endif
 
 #define HAS_DEBUG_MENU ENABLED(LCD_PROGRESS_BAR_TEST)
 
-// MK2 Multiplexer forces SINGLENOZZLE to be enabled
+// MK2 Multiplexer forces SINGLENOZZLE and kills DISABLE_INACTIVE_EXTRUDER
 #if ENABLED(MK2_MULTIPLEXER)
   #define SINGLENOZZLE
+  #undef DISABLE_INACTIVE_EXTRUDER
 #endif
 
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options

commit d603e655d35f12ab6740feb51498295d49f19f47
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Fri Mar 16 03:22:56 2018 -0500

    Fix SWITCHING_EXTRUDER manual movement

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 4eb55111da..872ae75420 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -424,21 +424,21 @@
 #if ENABLED(SWITCHING_EXTRUDER)                               // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
     #define E_MANUAL      3
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
     #define E_MANUAL      2
   #else
     #define E_STEPPERS    1
   #endif
-  #define E_MANUAL        E_STEPPERS
+  #define E_MANUAL        EXTRUDERS
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
 #else
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
 #endif
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed

commit 2bd252b50149c860cf37d488762abcf70a83f78d
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Fri Feb 23 00:53:29 2018 -0600

    [2.0.x] LIN_ADVANCE v1.5 (#9712)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 6daff521b0..4eb55111da 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -392,21 +392,20 @@
 #endif
 
 /**
  * Extruders have some combination of stepper motors and hotends
  * so we separate these concepts into the defines:
  *
  *  EXTRUDERS    - Number of Selectable Tools
  *  HOTENDS      - Number of hotends, whether connected or separate
  *  E_STEPPERS   - Number of actual E stepper motors
  *  E_MANUAL     - Number of E steppers for LCD move options
- *  TOOL_E_INDEX - Index to use when getting/setting the tool state
  *
  */
 #if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
   #define HOTENDS       1
   #undef TEMP_SENSOR_1_AS_REDUNDANT
   #undef HOTEND_OFFSET_X
   #undef HOTEND_OFFSET_Y
 #else                                                         // Two hotends
   #define HOTENDS       EXTRUDERS
   #if ENABLED(SWITCHING_NOZZLE) && !defined(HOTEND_OFFSET_Z)
@@ -419,38 +418,33 @@
 #if HOTENDS == 1
   #define HOTEND_INDEX  0
 #else
   #define HOTEND_INDEX  e
 #endif
 
 #if ENABLED(SWITCHING_EXTRUDER)                               // One stepper for every two EXTRUDERS
   #if EXTRUDERS > 4
     #define E_STEPPERS    3
     #define E_MANUAL      3
-    #define TOOL_E_INDEX  current_block->active_extruder
   #elif EXTRUDERS > 2
     #define E_STEPPERS    2
     #define E_MANUAL      2
-    #define TOOL_E_INDEX  current_block->active_extruder
   #else
     #define E_STEPPERS    1
-    #define TOOL_E_INDEX  0
   #endif
   #define E_MANUAL        E_STEPPERS
 #elif ENABLED(MIXING_EXTRUDER)
   #define E_STEPPERS      MIXING_STEPPERS
   #define E_MANUAL        1
-  #define TOOL_E_INDEX    0
 #else
   #define E_STEPPERS      EXTRUDERS
   #define E_MANUAL        EXTRUDERS
-  #define TOOL_E_INDEX    current_block->active_extruder
 #endif
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N (E_AXIS + extruder)
 #else
   #undef DISTINCT_E_FACTORS

commit 7d8c6b3f3c31e783eada6f2ac28da9f920233062
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Wed Feb 21 00:46:25 2018 -0600

    Add 20x4 option for Sainsmart LCD (#9740)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 5cec44b004..6daff521b0 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -198,51 +198,52 @@
   #define NEWPANEL
   #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 
 /**
  * I2C PANELS
  */
 
-#if ENABLED(LCD_I2C_SAINSMART_YWROBOT)
-
-  // Note: This controller requires F.Malpartida's LiquidCrystal_I2C library
-  // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/Home
+#if ENABLED(LCD_SAINSMART_I2C_1602) || ENABLED(LCD_SAINSMART_I2C_2004)
 
   #define LCD_I2C_TYPE_PCF8575
   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
-  #define ULTIPANEL
+
+  #if ENABLED(LCD_SAINSMART_I2C_2004)
+    #define LCD_WIDTH 20
+    #define LCD_HEIGHT 4
+  #endif
 
 #elif ENABLED(LCD_I2C_PANELOLU2)
 
   // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
 
   #define LCD_I2C_TYPE_MCP23017
   #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
-  #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD
+  #define LCD_USE_I2C_BUZZER   // Enable buzzer on LCD (optional)
   #define ULTIPANEL
 
 #elif ENABLED(LCD_I2C_VIKI)
 
   /**
    * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
    *
    * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
    * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
    * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
    *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
    */
   #define LCD_I2C_TYPE_MCP23017
   #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
-  #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
+  #define LCD_USE_I2C_BUZZER   // Enable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
   #define ULTIPANEL
 
   #define ENCODER_FEEDRATE_DEADZONE 4
 
   #define STD_ENCODER_PULSES_PER_STEP 1
   #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
 
 #elif ENABLED(G3D_PANEL)
 
   #define STD_ENCODER_PULSES_PER_STEP 2

commit c4ec01d59ba987a8de660a1c2b400012ad6cc885
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Feb 19 10:59:23 2018 -0600

    Conditionals for SWITCHING_EXTRUDER
    
    In reference to #5367. SWITCHING_EXTRUDER was not fully implemented for EXTRUDERS > 2.

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0524d202a1..5cec44b004 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -414,32 +414,42 @@
 #endif
 
 #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 
 #if HOTENDS == 1
   #define HOTEND_INDEX  0
 #else
   #define HOTEND_INDEX  e
 #endif
 
-#if ENABLED(SWITCHING_EXTRUDER) || ENABLED(MIXING_EXTRUDER)   // Unified E axis
-  #if ENABLED(MIXING_EXTRUDER)
-    #define E_STEPPERS  MIXING_STEPPERS
+#if ENABLED(SWITCHING_EXTRUDER)                               // One stepper for every two EXTRUDERS
+  #if EXTRUDERS > 4
+    #define E_STEPPERS    3
+    #define E_MANUAL      3
+    #define TOOL_E_INDEX  current_block->active_extruder
+  #elif EXTRUDERS > 2
+    #define E_STEPPERS    2
+    #define E_MANUAL      2
+    #define TOOL_E_INDEX  current_block->active_extruder
   #else
-    #define E_STEPPERS  1                                     // One E stepper
+    #define E_STEPPERS    1
+    #define TOOL_E_INDEX  0
   #endif
-  #define E_MANUAL      1
-  #define TOOL_E_INDEX  0
+  #define E_MANUAL        E_STEPPERS
+#elif ENABLED(MIXING_EXTRUDER)
+  #define E_STEPPERS      MIXING_STEPPERS
+  #define E_MANUAL        1
+  #define TOOL_E_INDEX    0
 #else
-  #define E_STEPPERS    EXTRUDERS
-  #define E_MANUAL      EXTRUDERS
-  #define TOOL_E_INDEX  current_block->active_extruder
+  #define E_STEPPERS      EXTRUDERS
+  #define E_MANUAL        EXTRUDERS
+  #define TOOL_E_INDEX    current_block->active_extruder
 #endif
 
 /**
  * DISTINCT_E_FACTORS affects how some E factors are accessed
  */
 #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
   #define XYZE_N (XYZ + E_STEPPERS)
   #define E_AXIS_N (E_AXIS + extruder)
 #else
   #undef DISTINCT_E_FACTORS

commit 704d33c374edf5da3edecf9fb88a617be2a008ac
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Feb 8 01:30:56 2018 -0600

    Special override of LCD_WIDTH

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index d4c43ecf17..0524d202a1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -280,21 +280,25 @@
 // 2 wire Non-latching LCD SR from:
 // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
 
 #if ENABLED(SAV_3DLCD)
   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
   #define ULTIPANEL
 #endif
 
 #if ENABLED(DOGLCD) // Change number of lines to match the DOG graphic display
   #ifndef LCD_WIDTH
-    #define LCD_WIDTH 22
+    #ifdef LCD_WIDTH_OVERRIDE
+      #define LCD_WIDTH LCD_WIDTH_OVERRIDE
+    #else
+      #define LCD_WIDTH 22
+    #endif
   #endif
   #ifndef LCD_HEIGHT
     #define LCD_HEIGHT 5
   #endif
 #endif
 
 #if ENABLED(ULTIPANEL)
   #define NEWPANEL  // Disable this if you actually have no click-encoder panel
   #define ULTRA_LCD
   #ifndef LCD_WIDTH

commit 16739264d3a3799b44396985c3a200ffde73823f
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Feb 5 22:25:49 2018 -0600

    Add UltiController v2.1 support
    
    Add compatibility with the original screen bord from Ultimaker 2 printer (UltiController v2.1 with the PG-2864ALBP I2C display)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0c6ca8f9af..d4c43ecf17 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -144,24 +144,35 @@
   #define MINIPANEL
 
 #endif
 
 #if ENABLED(MAKRPANEL) || ENABLED(MINIPANEL)
   #define DOGLCD
   #define ULTIPANEL
   #define DEFAULT_LCD_CONTRAST 17
 #endif
 
-// Generic support for SSD1306 / SH1106 OLED based LCDs.
-#if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SH1106)
+#if ENABLED(ULTI_CONTROLLER)
+  #define U8GLIB_SSD1309
+  #define REVERSE_ENCODER_DIRECTION
+  #define LCD_RESET_PIN LCD_PINS_D6 //  This controller need a reset pin
+  #define LCD_CONTRAST_MIN 0
+  #define LCD_CONTRAST_MAX 254
+  #define DEFAULT_LCD_CONTRAST 127
+  #define ENCODER_PULSES_PER_STEP 2
+  #define ENCODER_STEPS_PER_MENU_ITEM 2
+#endif
+
+// Generic support for SSD1306 / SSD1309 / SH1106 OLED based LCDs.
+#if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SSD1309) || ENABLED(U8GLIB_SH1106)
   #define ULTRA_LCD  //general LCD support, also 16x2
-  #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SH1106 graphic Display Family)
+  #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SSD1309 / SH1106 graphic Display Family)
 #endif
 
 #if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
 
   #define ULTIMAKERCONTROLLER
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define LCD_WIDTH 16
@@ -171,21 +182,22 @@
 
 #if ENABLED(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER) || ENABLED(LCD_FOR_MELZI) || ENABLED(SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
   #define U8GLIB_ST7920
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
 #endif
 
 #if ENABLED(ULTIMAKERCONTROLLER)              \
  || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
  || ENABLED(G3D_PANEL)                        \
- || ENABLED(RIGIDBOT_PANEL)
+ || ENABLED(RIGIDBOT_PANEL)                   \
+ || ENABLED(ULTI_CONTROLLER)
   #define ULTIPANEL
 #endif
 
 #if ENABLED(REPRAPWORLD_KEYPAD)
   #define NEWPANEL
   #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
   #endif
 #endif
 

commit f27c89980a1729e15dcab588a56ee078936b6be9
Author: GMagician <3684609+GMagician@users.noreply.github.com>
Date:   Mon Feb 5 21:38:09 2018 +0100

    [2.0.x] Simplify bltouch configuration (#9488)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index fa85e5c1f8..0c6ca8f9af 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -458,21 +458,21 @@
   #define BLTOUCH_SELFTEST 120
   #define BLTOUCH_RESET    160
   #define _TEST_BLTOUCH(P) (READ(P##_PIN) != P##_ENDSTOP_INVERTING)
 
   // Always disable probe pin inverting for BLTouch
   #undef Z_MIN_PROBE_ENDSTOP_INVERTING
   #define Z_MIN_PROBE_ENDSTOP_INVERTING false
 
   #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
     #undef Z_MIN_ENDSTOP_INVERTING
-    #define Z_MIN_ENDSTOP_INVERTING false
+    #define Z_MIN_ENDSTOP_INVERTING Z_MIN_PROBE_ENDSTOP_INVERTING
     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN)
   #else
     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
   #endif
 #endif
 
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_ENDSTOP (defined(Z_ENDSTOP_SERVO_NR) && Z_ENDSTOP_SERVO_NR >= 0)

commit f7efac57b7ac607405529a71b4e36a6545525c89
Author: Thomas Moore <tcm0116@gmail.com>
Date:   Sun Nov 5 08:49:38 2017 -0600

    Multi-host support

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ee7e1126f8..fa85e5c1f8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -487,17 +487,11 @@
  */
 #if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 
-// For Re-ARM boards, always use the USB Emulated Serial Port unless RE_ARM_FORCE_SERIAL_PORT is defined
-#if !defined(RE_ARM_FORCE_SERIAL_PORT) && (MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF))
-  #undef SERIAL_PORT
-  #define SERIAL_PORT -1
-#endif
-
 #endif // CONDITIONALS_LCD_H

commit 1c41de16d4a2e63bfb713041eeae1f3bc22882a5
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Fri Jan 5 10:10:55 2018 -0600

    Trailing whitespace clean

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 35c381b032..ee7e1126f8 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -49,21 +49,21 @@
   #define ADC_KEYPAD
   #define ADC_KEY_NUM 8
   #define ULTIPANEL
 
   // this helps to implement ADC_KEYPAD menus
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
   #define REVERSE_MENU_DIRECTION
 
-#elif ENABLED(RADDS_DISPLAY) 
+#elif ENABLED(RADDS_DISPLAY)
   #define ULTIPANEL
   #define ENCODER_PULSES_PER_STEP 2
 
 #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
 #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER

commit ea1a8d1223f0c66e73eb21e2e2b73884eecf51f0
Author: Even <10756851+subdancer@users.noreply.github.com>
Date:   Sat Dec 23 21:23:05 2017 +0100

    add original RADDS LCD + Controller
    
    adds setup for the original Radds Display+Controller+SD Card Reader PCB
    http://doku.radds.org/dokumentation/lcd-display/

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 93a908a8aa..35c381b032 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -49,20 +49,24 @@
   #define ADC_KEYPAD
   #define ADC_KEY_NUM 8
   #define ULTIPANEL
 
   // this helps to implement ADC_KEYPAD menus
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
   #define ENCODER_FEEDRATE_DEADZONE 2
   #define REVERSE_MENU_DIRECTION
 
+#elif ENABLED(RADDS_DISPLAY) 
+  #define ULTIPANEL
+  #define ENCODER_PULSES_PER_STEP 2
+
 #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
 #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
 #elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(AZSMZ_12864)
 

commit 957bbab57f2a985bfc95ec91fd707dea92674bd3
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat Dec 16 20:20:06 2017 -0600

    Update inc files for parity with 1.1.x

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a38beed22e..93a908a8aa 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -64,32 +64,32 @@
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
 #elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(AZSMZ_12864)
 
   #define ULTRA_LCD  //general LCD support, also 16x2
   #define DOGLCD  // Support for SPI LCD 128x64 (Controller ST7565R graphic Display Family)
   #define ULTIMAKERCONTROLLER //as available from the Ultimaker online store.
 
   #if ENABLED(miniVIKI)
-    #define LCD_CONTRAST_MIN  75
-    #define LCD_CONTRAST_MAX 115
-    #define DEFAULT_LCD_CONTRAST 95
+    #define LCD_CONTRAST_MIN      75
+    #define LCD_CONTRAST_MAX     115
+    #define DEFAULT_LCD_CONTRAST  95
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(VIKI2)
-    #define LCD_CONTRAST_MIN 0
-    #define LCD_CONTRAST_MAX 255
+    #define LCD_CONTRAST_MIN       0
+    #define LCD_CONTRAST_MAX     255
     #define DEFAULT_LCD_CONTRAST 140
     #define U8GLIB_ST7565_64128N
   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
-    #define LCD_CONTRAST_MIN  90
-    #define LCD_CONTRAST_MAX 130
+    #define LCD_CONTRAST_MIN      90
+    #define LCD_CONTRAST_MAX     130
     #define DEFAULT_LCD_CONTRAST 110
     #define U8GLIB_LM6059_AF
     #define SD_DETECT_INVERTED
   #elif ENABLED(AZSMZ_12864)
     #define LCD_CONTRAST_MIN  120
     #define LCD_CONTRAST_MAX 255
     #define DEFAULT_LCD_CONTRAST 190
     #define U8GLIB_ST7565_64128N
   #endif
 
@@ -310,21 +310,21 @@
   #define LCD_STR_DEGREE      "\x09"
 
   #define LCD_STR_SPECIAL_MAX '\x09'
   // Maximum here is 0x1F because 0x20 is ' ' (space) and the normal charsets begin.
   // Better stay below 0x10 because DISPLAY_CHARSET_HD44780_WESTERN begins here.
 
   // Symbol characters
   #define LCD_STR_FILAM_DIA   "\xf8"
   #define LCD_STR_FILAM_MUL   "\xa4"
 #else
-  /* Custom characters defined in the first 8 characters of the LCD */
+  // Custom characters defined in the first 8 characters of the LCD
   #define LCD_BEDTEMP_CHAR     0x00  // Print only as a char. This will have 'unexpected' results when used in a string!
   #define LCD_DEGREE_CHAR      0x01
   #define LCD_STR_THERMOMETER "\x02" // Still used with string concatenation
   #define LCD_UPLEVEL_CHAR     0x03
   #define LCD_STR_REFRESH     "\x04"
   #define LCD_STR_FOLDER      "\x05"
   #define LCD_FEEDRATE_CHAR    0x06
   #define LCD_CLOCK_CHAR       0x07
   #define LCD_STR_ARROW_RIGHT ">"  /* from the default character set */
 #endif

commit b055d8c39cf0a3bc946e13510ba407e60f07518f
Author: Dan Delaney <drdelaney@loclhst.com>
Date:   Sat Dec 16 18:47:04 2017 -0600

    [2.0.x] Adding support for using the MKS_12864OLED with the SSD1306 controller (#8814)
    
    * Adding support for using the MKS_12864OLED with the SSD1306 controller
    
    * Update comment for correct controller type

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 63d7e81948..a38beed22e 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -123,20 +123,25 @@
   #endif
   #ifndef ST7920_DELAY_3
     #define ST7920_DELAY_3 DELAY_2_NOP
   #endif
 
 #elif ENABLED(MKS_12864OLED)
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define U8GLIB_SH1106
 
+#elif ENABLED(MKS_12864OLED_SSD1306)
+
+  #define REPRAP_DISCOUNT_SMART_CONTROLLER
+  #define U8GLIB_SSD1306
+
 #elif ENABLED(MKS_MINI_12864)
 
   #define MINIPANEL
 
 #endif
 
 #if ENABLED(MAKRPANEL) || ENABLED(MINIPANEL)
   #define DOGLCD
   #define ULTIPANEL
   #define DEFAULT_LCD_CONTRAST 17

commit 15d05748dfeee7573bfad03048714d9d38f64b36
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Fri Dec 15 19:05:57 2017 -0600

    Adding support for the Tronxy and Zonestar LCD

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 6be8a1a6f2..63d7e81948 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -35,21 +35,21 @@
   #define DOGLCD
   #define ULTIPANEL
   #define DEFAULT_LCD_CONTRAST 90
   #define LCD_CONTRAST_MIN 60
   #define LCD_CONTRAST_MAX 140
 
 #elif ENABLED(MAKRPANEL)
 
   #define U8GLIB_ST7565_64128N
 
-#elif ENABLED(ANET_KEYPAD_LCD)
+#elif ENABLED(ZONESTAR_LCD)
 
   #define REPRAPWORLD_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEYPAD
   #define ADC_KEY_NUM 8
   #define ULTIPANEL
 
   // this helps to implement ADC_KEYPAD menus
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1

commit 82f45c3e6ad00a2f8cc60f0a1f7297958c98637f
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Nov 7 19:34:34 2017 -0600

    Patch G33 misuse of PROBE_MANUALLY

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index f5125fb6a1..6be8a1a6f2 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -461,27 +461,20 @@
   #else
     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
   #endif
 #endif
 
 /**
  * Set a flag for a servo probe
  */
 #define HAS_Z_SERVO_ENDSTOP (defined(Z_ENDSTOP_SERVO_NR) && Z_ENDSTOP_SERVO_NR >= 0)
 
-/**
- * UBL has its own manual probing, so this just causes trouble.
- */
-#if ENABLED(AUTO_BED_LEVELING_UBL)
-  #undef PROBE_MANUALLY
-#endif
-
 /**
  * Set a flag for any enabled probe
  */
 #define PROBE_SELECTED (ENABLED(PROBE_MANUALLY) || ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_ENDSTOP || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
 
 /**
  * Clear probe pin settings when no probe is selected
  */
 #if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN

commit ca7d36d9ed3667c91fa97a9b8ab53a4625ba66ee
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat Nov 4 21:22:53 2017 -0500

    RAMPS pins for ANET_KEYPAD_LCD

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index a25d45cecc..f5125fb6a1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -46,20 +46,21 @@
 
   #define REPRAPWORLD_KEYPAD
   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
   #define ADC_KEYPAD
   #define ADC_KEY_NUM 8
   #define ULTIPANEL
 
   // this helps to implement ADC_KEYPAD menus
   #define ENCODER_PULSES_PER_STEP 1
   #define ENCODER_STEPS_PER_MENU_ITEM 1
+  #define ENCODER_FEEDRATE_DEADZONE 2
   #define REVERSE_MENU_DIRECTION
 
 #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
 #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
 
   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 

commit 93ba72ea83654bc4a1c052067a92471638eec3ff
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Nov 2 13:39:05 2017 -0500

    Add SERIAL_PORT -1, set on SBASE, STM32F103RET6

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0eeabdd99b..a25d45cecc 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -484,19 +484,17 @@
  */
 #if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
   #undef Z_MIN_PROBE_ENDSTOP
 #endif
 
 #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
 #define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
 #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 
-  // For Re-ARM boards, always use the USB Emulated Serial Port unless RE_ARM_FORCE_SERIAL_PORT is defined
-  #if MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF)
-    #ifndef RE_ARM_FORCE_SERIAL_PORT
-      #undef SERIAL_PORT
-      #define SERIAL_PORT -1
-    #endif
-  #endif
+// For Re-ARM boards, always use the USB Emulated Serial Port unless RE_ARM_FORCE_SERIAL_PORT is defined
+#if !defined(RE_ARM_FORCE_SERIAL_PORT) && (MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF))
+  #undef SERIAL_PORT
+  #define SERIAL_PORT -1
+#endif
 
 #endif // CONDITIONALS_LCD_H

commit 9cc1d8e312438e6801f9860f52c76c0ea74c8a6d
Author: android444 <github@c64.com.pl>
Date:   Fri Oct 27 10:42:04 2017 +0200

    [2.0.x] Support for SilverGate Board

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 6f6e18d541..0eeabdd99b 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -152,21 +152,21 @@
   #define ULTIMAKERCONTROLLER
 
 #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #define LCD_WIDTH 16
   #define LCD_HEIGHT 2
 
 #endif
 
-#if ENABLED(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER) || ENABLED(LCD_FOR_MELZI)
+#if ENABLED(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER) || ENABLED(LCD_FOR_MELZI) || ENABLED(SILVER_GATE_GLCD_CONTROLLER)
   #define DOGLCD
   #define U8GLIB_ST7920
   #define REPRAP_DISCOUNT_SMART_CONTROLLER
 #endif
 
 #if ENABLED(ULTIMAKERCONTROLLER)              \
  || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
  || ENABLED(G3D_PANEL)                        \
  || ENABLED(RIGIDBOT_PANEL)
   #define ULTIPANEL

commit f65fc7ffab45dd1f1d7153da4d333ee0c89c2fa9
Merge: 070cd34fe8 7f55d82fd1
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Tue Oct 24 18:56:43 2017 -0500

    Merge pull request #8044 from thinkyhead/bf2_mesh_consolidate
    
    [2.0.x] Simplify mesh bounds config

diff --combined Marlin/src/inc/Conditionals_LCD.h
index f50d2f0075,d3d08dd144..6f6e18d541
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@@ -21,482 -21,474 +21,482 @@@
   */
  
  /**
   * Conditionals_LCD.h
   * Conditionals that need to be set before Configuration_adv.h or pins.h
   */
  
  #ifndef CONDITIONALS_LCD_H // Get the LCD defines which are needed first
  #define CONDITIONALS_LCD_H
  
-   #define LCD_HAS_DIRECTIONAL_BUTTONS (BUTTON_EXISTS(UP) || BUTTON_EXISTS(DWN) || BUTTON_EXISTS(LFT) || BUTTON_EXISTS(RT))
+ #define LCD_HAS_DIRECTIONAL_BUTTONS (BUTTON_EXISTS(UP) || BUTTON_EXISTS(DWN) || BUTTON_EXISTS(LFT) || BUTTON_EXISTS(RT))
  
-   #if ENABLED(CARTESIO_UI)
+ #if ENABLED(CARTESIO_UI)
  
-     #define DOGLCD
-     #define ULTIPANEL
-     #define DEFAULT_LCD_CONTRAST 90
-     #define LCD_CONTRAST_MIN 60
-     #define LCD_CONTRAST_MAX 140
+   #define DOGLCD
+   #define ULTIPANEL
+   #define DEFAULT_LCD_CONTRAST 90
+   #define LCD_CONTRAST_MIN 60
+   #define LCD_CONTRAST_MAX 140
  
-   #elif ENABLED(MAKRPANEL)
+ #elif ENABLED(MAKRPANEL)
  
-     #define U8GLIB_ST7565_64128N
- 
-   #elif ENABLED(ANET_KEYPAD_LCD)
- 
-     #define REPRAPWORLD_KEYPAD
-     #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
-     #define ADC_KEYPAD
-     #define ADC_KEY_NUM 8
-     #define ULTIPANEL
- 
-     // this helps to implement ADC_KEYPAD menus
-     #define ENCODER_PULSES_PER_STEP 1
-     #define ENCODER_STEPS_PER_MENU_ITEM 1
-     #define REVERSE_MENU_DIRECTION
+   #define U8GLIB_ST7565_64128N
  
-   #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
+ #elif ENABLED(ANET_KEYPAD_LCD)
  
-     #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+   #define REPRAPWORLD_KEYPAD
+   #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
+   #define ADC_KEYPAD
+   #define ADC_KEY_NUM 8
+   #define ULTIPANEL
  
-   #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
+   // this helps to implement ADC_KEYPAD menus
+   #define ENCODER_PULSES_PER_STEP 1
+   #define ENCODER_STEPS_PER_MENU_ITEM 1
+   #define REVERSE_MENU_DIRECTION
  
-     #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+ #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
  
-   #elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(AZSMZ_12864)
+   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
  
-     #define ULTRA_LCD  //general LCD support, also 16x2
-     #define DOGLCD  // Support for SPI LCD 128x64 (Controller ST7565R graphic Display Family)
-     #define ULTIMAKERCONTROLLER //as available from the Ultimaker online store.
- 
-     #if ENABLED(miniVIKI)
-       #define LCD_CONTRAST_MIN  75
-       #define LCD_CONTRAST_MAX 115
-       #define DEFAULT_LCD_CONTRAST 95
-       #define U8GLIB_ST7565_64128N
-     #elif ENABLED(VIKI2)
-       #define LCD_CONTRAST_MIN 0
-       #define LCD_CONTRAST_MAX 255
-       #define DEFAULT_LCD_CONTRAST 140
-       #define U8GLIB_ST7565_64128N
-     #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
-       #define LCD_CONTRAST_MIN  90
-       #define LCD_CONTRAST_MAX 130
-       #define DEFAULT_LCD_CONTRAST 110
-       #define U8GLIB_LM6059_AF
-       #define SD_DETECT_INVERTED
-     #elif ENABLED(AZSMZ_12864)
-       #define LCD_CONTRAST_MIN  120
-       #define LCD_CONTRAST_MAX 255
-       #define DEFAULT_LCD_CONTRAST 190
-       #define U8GLIB_ST7565_64128N
-     #endif
+ #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
  
-   #elif ENABLED(OLED_PANEL_TINYBOY2)
+   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
  
-     #define U8GLIB_SSD1306
-     #define ULTIPANEL
-     #define REVERSE_ENCODER_DIRECTION
-     #define REVERSE_MENU_DIRECTION
+ #elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(AZSMZ_12864)
  
-   #elif ENABLED(RA_CONTROL_PANEL)
+   #define ULTRA_LCD  //general LCD support, also 16x2
+   #define DOGLCD  // Support for SPI LCD 128x64 (Controller ST7565R graphic Display Family)
+   #define ULTIMAKERCONTROLLER //as available from the Ultimaker online store.
  
-     #define LCD_I2C_TYPE_PCA8574
-     #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
-     #define ULTIPANEL
+   #if ENABLED(miniVIKI)
+     #define LCD_CONTRAST_MIN  75
+     #define LCD_CONTRAST_MAX 115
+     #define DEFAULT_LCD_CONTRAST 95
+     #define U8GLIB_ST7565_64128N
+   #elif ENABLED(VIKI2)
+     #define LCD_CONTRAST_MIN 0
+     #define LCD_CONTRAST_MAX 255
+     #define DEFAULT_LCD_CONTRAST 140
+     #define U8GLIB_ST7565_64128N
+   #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
+     #define LCD_CONTRAST_MIN  90
+     #define LCD_CONTRAST_MAX 130
+     #define DEFAULT_LCD_CONTRAST 110
+     #define U8GLIB_LM6059_AF
+     #define SD_DETECT_INVERTED
+   #elif ENABLED(AZSMZ_12864)
+     #define LCD_CONTRAST_MIN  120
+     #define LCD_CONTRAST_MAX 255
+     #define DEFAULT_LCD_CONTRAST 190
+     #define U8GLIB_ST7565_64128N
+   #endif
  
-   #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
+ #elif ENABLED(OLED_PANEL_TINYBOY2)
  
-     #define DOGLCD
-     #define U8GLIB_ST7920
-     #define ULTIPANEL
+   #define U8GLIB_SSD1306
+   #define ULTIPANEL
+   #define REVERSE_ENCODER_DIRECTION
+   #define REVERSE_MENU_DIRECTION
  
-   #elif ENABLED(CR10_STOCKDISPLAY)
+ #elif ENABLED(RA_CONTROL_PANEL)
  
-     #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
-     #ifndef ST7920_DELAY_1
-       #define ST7920_DELAY_1 DELAY_2_NOP
-     #endif
-     #ifndef ST7920_DELAY_2
-       #define ST7920_DELAY_2 DELAY_2_NOP
-     #endif
-     #ifndef ST7920_DELAY_3
-       #define ST7920_DELAY_3 DELAY_2_NOP
-     #endif
+   #define LCD_I2C_TYPE_PCA8574
+   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
+   #define ULTIPANEL
  
-   #elif ENABLED(MKS_12864OLED)
+ #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
  
-     #define REPRAP_DISCOUNT_SMART_CONTROLLER
-     #define U8GLIB_SH1106
+   #define DOGLCD
+   #define U8GLIB_ST7920
+   #define ULTIPANEL
  
-   #elif ENABLED(MKS_MINI_12864)
- 
-     #define MINIPANEL
+ #elif ENABLED(CR10_STOCKDISPLAY)
  
+   #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+   #ifndef ST7920_DELAY_1
+     #define ST7920_DELAY_1 DELAY_2_NOP
    #endif
- 
-   #if ENABLED(MAKRPANEL) || ENABLED(MINIPANEL)
-     #define DOGLCD
-     #define ULTIPANEL
-     #define DEFAULT_LCD_CONTRAST 17
+   #ifndef ST7920_DELAY_2
+     #define ST7920_DELAY_2 DELAY_2_NOP
    #endif
- 
-   // Generic support for SSD1306 / SH1106 OLED based LCDs.
-   #if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SH1106)
-     #define ULTRA_LCD  //general LCD support, also 16x2
-     #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SH1106 graphic Display Family)
+   #ifndef ST7920_DELAY_3
+     #define ST7920_DELAY_3 DELAY_2_NOP
    #endif
  
-   #if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
+ #elif ENABLED(MKS_12864OLED)
  
-     #define ULTIMAKERCONTROLLER
+   #define REPRAP_DISCOUNT_SMART_CONTROLLER
+   #define U8GLIB_SH1106
  
-   #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
+ #elif ENABLED(MKS_MINI_12864)
  
-     #define REPRAP_DISCOUNT_SMART_CONTROLLER
-     #define LCD_WIDTH 16
-     #define LCD_HEIGHT 2
+   #define MINIPANEL
  
-   #endif
+ #endif
  
-   #if ENABLED(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER) || ENABLED(LCD_FOR_MELZI)
-     #define DOGLCD
-     #define U8GLIB_ST7920
-     #define REPRAP_DISCOUNT_SMART_CONTROLLER
-   #endif
+ #if ENABLED(MAKRPANEL) || ENABLED(MINIPANEL)
+   #define DOGLCD
+   #define ULTIPANEL
+   #define DEFAULT_LCD_CONTRAST 17
+ #endif
  
-   #if ENABLED(ULTIMAKERCONTROLLER)              \
-    || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
-    || ENABLED(G3D_PANEL)                        \
-    || ENABLED(RIGIDBOT_PANEL)
-     #define ULTIPANEL
-   #endif
+ // Generic support for SSD1306 / SH1106 OLED based LCDs.
+ #if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SH1106)
+   #define ULTRA_LCD  //general LCD support, also 16x2
+   #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SH1106 graphic Display Family)
+ #endif
  
-   #if ENABLED(REPRAPWORLD_KEYPAD)
-     #define NEWPANEL
-     #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
-       #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
-     #endif
-   #endif
+ #if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
  
-   /**
-    * I2C PANELS
-    */
+   #define ULTIMAKERCONTROLLER
  
-   #if ENABLED(LCD_I2C_SAINSMART_YWROBOT)
+ #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
  
-     // Note: This controller requires F.Malpartida's LiquidCrystal_I2C library
-     // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/Home
+   #define REPRAP_DISCOUNT_SMART_CONTROLLER
+   #define LCD_WIDTH 16
+   #define LCD_HEIGHT 2
  
-     #define LCD_I2C_TYPE_PCF8575
-     #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
-     #define ULTIPANEL
+ #endif
  
-   #elif ENABLED(LCD_I2C_PANELOLU2)
+ #if ENABLED(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER) || ENABLED(LCD_FOR_MELZI)
+   #define DOGLCD
+   #define U8GLIB_ST7920
+   #define REPRAP_DISCOUNT_SMART_CONTROLLER
+ #endif
  
-     // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
+ #if ENABLED(ULTIMAKERCONTROLLER)              \
+  || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
+  || ENABLED(G3D_PANEL)                        \
+  || ENABLED(RIGIDBOT_PANEL)
+   #define ULTIPANEL
+ #endif
  
-     #define LCD_I2C_TYPE_MCP23017
-     #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
-     #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD
-     #define ULTIPANEL
+ #if ENABLED(REPRAPWORLD_KEYPAD)
+   #define NEWPANEL
+   #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
+     #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
+   #endif
+ #endif
  
-   #elif ENABLED(LCD_I2C_VIKI)
+ /**
+  * I2C PANELS
+  */
  
-     /**
-      * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
-      *
-      * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
-      * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
-      * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
-      *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
-      */
-     #define LCD_I2C_TYPE_MCP23017
-     #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
-     #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
-     #define ULTIPANEL
+ #if ENABLED(LCD_I2C_SAINSMART_YWROBOT)
  
-     #define ENCODER_FEEDRATE_DEADZONE 4
+   // Note: This controller requires F.Malpartida's LiquidCrystal_I2C library
+   // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/Home
  
-     #define STD_ENCODER_PULSES_PER_STEP 1
-     #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
+   #define LCD_I2C_TYPE_PCF8575
+   #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
+   #define ULTIPANEL
  
-   #elif ENABLED(G3D_PANEL)
+ #elif ENABLED(LCD_I2C_PANELOLU2)
  
-     #define STD_ENCODER_PULSES_PER_STEP 2
-     #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+   // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
  
-   #elif ENABLED(miniVIKI) || ENABLED(VIKI2) \
-      || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
-      || ENABLED(AZSMZ_12864) \
-      || ENABLED(OLED_PANEL_TINYBOY2) \
-      || ENABLED(BQ_LCD_SMART_CONTROLLER) \
-      || ENABLED(LCD_I2C_PANELOLU2) \
-      || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
-     #define STD_ENCODER_PULSES_PER_STEP 4
-     #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
-   #endif
+   #define LCD_I2C_TYPE_MCP23017
+   #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
+   #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD
+   #define ULTIPANEL
  
-   #ifndef STD_ENCODER_PULSES_PER_STEP
-     #define STD_ENCODER_PULSES_PER_STEP 5
-   #endif
-   #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
-     #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+ #elif ENABLED(LCD_I2C_VIKI)
+ 
+   /**
+    * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
+    *
+    * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
+    * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
+    * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
+    *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
+    */
+   #define LCD_I2C_TYPE_MCP23017
+   #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
+   #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
+   #define ULTIPANEL
+ 
+   #define ENCODER_FEEDRATE_DEADZONE 4
+ 
+   #define STD_ENCODER_PULSES_PER_STEP 1
+   #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
+ 
+ #elif ENABLED(G3D_PANEL)
+ 
+   #define STD_ENCODER_PULSES_PER_STEP 2
+   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+ 
+ #elif ENABLED(miniVIKI) || ENABLED(VIKI2) \
+    || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
+    || ENABLED(AZSMZ_12864) \
+    || ENABLED(OLED_PANEL_TINYBOY2) \
+    || ENABLED(BQ_LCD_SMART_CONTROLLER) \
+    || ENABLED(LCD_I2C_PANELOLU2) \
+    || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
+   #define STD_ENCODER_PULSES_PER_STEP 4
+   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+ #endif
+ 
+ #ifndef STD_ENCODER_PULSES_PER_STEP
+   #define STD_ENCODER_PULSES_PER_STEP 5
+ #endif
+ #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
+   #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+ #endif
+ #ifndef ENCODER_PULSES_PER_STEP
+   #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
+ #endif
+ #ifndef ENCODER_STEPS_PER_MENU_ITEM
+   #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
+ #endif
+ #ifndef ENCODER_FEEDRATE_DEADZONE
+   #define ENCODER_FEEDRATE_DEADZONE 6
+ #endif
+ 
+ // Shift register panels
+ // ---------------------
+ // 2 wire Non-latching LCD SR from:
+ // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
+ 
+ #if ENABLED(SAV_3DLCD)
+   #define SR_LCD_2W_NL    // Non latching 2 wire shift register
+   #define ULTIPANEL
+ #endif
+ 
+ #if ENABLED(DOGLCD) // Change number of lines to match the DOG graphic display
+   #ifndef LCD_WIDTH
+     #define LCD_WIDTH 22
    #endif
-   #ifndef ENCODER_PULSES_PER_STEP
-     #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
+   #ifndef LCD_HEIGHT
+     #define LCD_HEIGHT 5
    #endif
-   #ifndef ENCODER_STEPS_PER_MENU_ITEM
-     #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
+ #endif
+ 
+ #if ENABLED(ULTIPANEL)
+   #define NEWPANEL  // Disable this if you actually have no click-encoder panel
+   #define ULTRA_LCD
+   #ifndef LCD_WIDTH
+     #define LCD_WIDTH 20
    #endif
-   #ifndef ENCODER_FEEDRATE_DEADZONE
-     #define ENCODER_FEEDRATE_DEADZONE 6
+   #ifndef LCD_HEIGHT
+     #define LCD_HEIGHT 4
    #endif
- 
-   // Shift register panels
-   // ---------------------
-   // 2 wire Non-latching LCD SR from:
-   // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
- 
-   #if ENABLED(SAV_3DLCD)
-     #define SR_LCD_2W_NL    // Non latching 2 wire shift register
-     #define ULTIPANEL
+ #elif ENABLED(ULTRA_LCD)  // no panel but just LCD
+   #ifndef LCD_WIDTH
+     #define LCD_WIDTH 16
    #endif
- 
-   #if ENABLED(DOGLCD) // Change number of lines to match the DOG graphic display
-     #ifndef LCD_WIDTH
-       #define LCD_WIDTH 22
-     #endif
-     #ifndef LCD_HEIGHT
-       #define LCD_HEIGHT 5
-     #endif
+   #ifndef LCD_HEIGHT
+     #define LCD_HEIGHT 2
    #endif
+ #endif
+ 
+ #if ENABLED(DOGLCD)
+   /* Custom characters defined in font dogm_font_data_Marlin_symbols.h / Marlin_symbols.fon */
+   // \x00 intentionally skipped to avoid problems in strings
+   #define LCD_STR_REFRESH     "\x01"
+   #define LCD_STR_FOLDER      "\x02"
+   #define LCD_STR_ARROW_RIGHT "\x03"
+   #define LCD_STR_UPLEVEL     "\x04"
+   #define LCD_STR_CLOCK       "\x05"
+   #define LCD_STR_FEEDRATE    "\x06"
+   #define LCD_STR_BEDTEMP     "\x07"
+   #define LCD_STR_THERMOMETER "\x08"
+   #define LCD_STR_DEGREE      "\x09"
+ 
+   #define LCD_STR_SPECIAL_MAX '\x09'
+   // Maximum here is 0x1F because 0x20 is ' ' (space) and the normal charsets begin.
+   // Better stay below 0x10 because DISPLAY_CHARSET_HD44780_WESTERN begins here.
+ 
+   // Symbol characters
+   #define LCD_STR_FILAM_DIA   "\xf8"
+   #define LCD_STR_FILAM_MUL   "\xa4"
+ #else
+   /* Custom characters defined in the first 8 characters of the LCD */
+   #define LCD_BEDTEMP_CHAR     0x00  // Print only as a char. This will have 'unexpected' results when used in a string!
+   #define LCD_DEGREE_CHAR      0x01
+   #define LCD_STR_THERMOMETER "\x02" // Still used with string concatenation
+   #define LCD_UPLEVEL_CHAR     0x03
+   #define LCD_STR_REFRESH     "\x04"
+   #define LCD_STR_FOLDER      "\x05"
+   #define LCD_FEEDRATE_CHAR    0x06
+   #define LCD_CLOCK_CHAR       0x07
+   #define LCD_STR_ARROW_RIGHT ">"  /* from the default character set */
+ #endif
  
-   #if ENABLED(ULTIPANEL)
-     #define NEWPANEL  // Disable this if you actually have no click-encoder panel
-     #define ULTRA_LCD
-     #ifndef LCD_WIDTH
-       #define LCD_WIDTH 20
-     #endif
-     #ifndef LCD_HEIGHT
-       #define LCD_HEIGHT 4
+ /**
+  * Default LCD contrast for dogm-like LCD displays
+  */
+ #if ENABLED(DOGLCD)
+ 
+   #define HAS_LCD_CONTRAST ( \
+       ENABLED(MAKRPANEL) \
+    || ENABLED(CARTESIO_UI) \
+    || ENABLED(VIKI2) \
+    || ENABLED(AZSMZ_12864) \
+    || ENABLED(miniVIKI) \
+    || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
+   )
+ 
+   #if HAS_LCD_CONTRAST
+     #ifndef LCD_CONTRAST_MIN
+       #define LCD_CONTRAST_MIN 0
      #endif
-   #elif ENABLED(ULTRA_LCD)  // no panel but just LCD
-     #ifndef LCD_WIDTH
-       #define LCD_WIDTH 16
+     #ifndef LCD_CONTRAST_MAX
+       #define LCD_CONTRAST_MAX 63
      #endif
-     #ifndef LCD_HEIGHT
-       #define LCD_HEIGHT 2
+     #ifndef DEFAULT_LCD_CONTRAST
+       #define DEFAULT_LCD_CONTRAST 32
      #endif
    #endif
+ #endif
  
-   #if ENABLED(DOGLCD)
-     /* Custom characters defined in font dogm_font_data_Marlin_symbols.h / Marlin_symbols.fon */
-     // \x00 intentionally skipped to avoid problems in strings
-     #define LCD_STR_REFRESH     "\x01"
-     #define LCD_STR_FOLDER      "\x02"
-     #define LCD_STR_ARROW_RIGHT "\x03"
-     #define LCD_STR_UPLEVEL     "\x04"
-     #define LCD_STR_CLOCK       "\x05"
-     #define LCD_STR_FEEDRATE    "\x06"
-     #define LCD_STR_BEDTEMP     "\x07"
-     #define LCD_STR_THERMOMETER "\x08"
-     #define LCD_STR_DEGREE      "\x09"
- 
-     #define LCD_STR_SPECIAL_MAX '\x09'
-     // Maximum here is 0x1F because 0x20 is ' ' (space) and the normal charsets begin.
-     // Better stay below 0x10 because DISPLAY_CHARSET_HD44780_WESTERN begins here.
- 
-     // Symbol characters
-     #define LCD_STR_FILAM_DIA   "\xf8"
-     #define LCD_STR_FILAM_MUL   "\xa4"
-   #else
-     /* Custom characters defined in the first 8 characters of the LCD */
-     #define LCD_BEDTEMP_CHAR     0x00  // Print only as a char. This will have 'unexpected' results when used in a string!
-     #define LCD_DEGREE_CHAR      0x01
-     #define LCD_STR_THERMOMETER "\x02" // Still used with string concatenation
-     #define LCD_UPLEVEL_CHAR     0x03
-     #define LCD_STR_REFRESH     "\x04"
-     #define LCD_STR_FOLDER      "\x05"
-     #define LCD_FEEDRATE_CHAR    0x06
-     #define LCD_CLOCK_CHAR       0x07
-     #define LCD_STR_ARROW_RIGHT ">"  /* from the default character set */
-   #endif
- 
-   /**
-    * Default LCD contrast for dogm-like LCD displays
-    */
-   #if ENABLED(DOGLCD)
- 
-     #define HAS_LCD_CONTRAST ( \
-         ENABLED(MAKRPANEL) \
-      || ENABLED(CARTESIO_UI) \
-      || ENABLED(VIKI2) \
-      || ENABLED(AZSMZ_12864) \
-      || ENABLED(miniVIKI) \
-      || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
-     )
- 
-     #if HAS_LCD_CONTRAST
-       #ifndef LCD_CONTRAST_MIN
-         #define LCD_CONTRAST_MIN 0
-       #endif
-       #ifndef LCD_CONTRAST_MAX
-         #define LCD_CONTRAST_MAX 63
-       #endif
-       #ifndef DEFAULT_LCD_CONTRAST
-         #define DEFAULT_LCD_CONTRAST 32
-       #endif
-     #endif
-   #endif
+ // Boot screens
+ #if DISABLED(ULTRA_LCD)
+   #undef SHOW_BOOTSCREEN
+ #elif !defined(BOOTSCREEN_TIMEOUT)
+   #define BOOTSCREEN_TIMEOUT 2500
+ #endif
  
-   // Boot screens
-   #if DISABLED(ULTRA_LCD)
-     #undef SHOW_BOOTSCREEN
-   #elif !defined(BOOTSCREEN_TIMEOUT)
-     #define BOOTSCREEN_TIMEOUT 2500
-   #endif
+ #define HAS_DEBUG_MENU ENABLED(LCD_PROGRESS_BAR_TEST)
  
-   #define HAS_DEBUG_MENU ENABLED(LCD_PROGRESS_BAR_TEST)
+ // MK2 Multiplexer forces SINGLENOZZLE to be enabled
+ #if ENABLED(MK2_MULTIPLEXER)
+   #define SINGLENOZZLE
+ #endif
  
-   // MK2 Multiplexer forces SINGLENOZZLE to be enabled
-   #if ENABLED(MK2_MULTIPLEXER)
-     #define SINGLENOZZLE
+ /**
+  * Extruders have some combination of stepper motors and hotends
+  * so we separate these concepts into the defines:
+  *
+  *  EXTRUDERS    - Number of Selectable Tools
+  *  HOTENDS      - Number of hotends, whether connected or separate
+  *  E_STEPPERS   - Number of actual E stepper motors
+  *  E_MANUAL     - Number of E steppers for LCD move options
+  *  TOOL_E_INDEX - Index to use when getting/setting the tool state
+  *
+  */
+ #if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
+   #define HOTENDS       1
+   #undef TEMP_SENSOR_1_AS_REDUNDANT
+   #undef HOTEND_OFFSET_X
+   #undef HOTEND_OFFSET_Y
+ #else                                                         // Two hotends
+   #define HOTENDS       EXTRUDERS
+   #if ENABLED(SWITCHING_NOZZLE) && !defined(HOTEND_OFFSET_Z)
+     #define HOTEND_OFFSET_Z { 0 }
    #endif
+ #endif
  
-   /**
-    * Extruders have some combination of stepper motors and hotends
-    * so we separate these concepts into the defines:
-    *
-    *  EXTRUDERS    - Number of Selectable Tools
-    *  HOTENDS      - Number of hotends, whether connected or separate
-    *  E_STEPPERS   - Number of actual E stepper motors
-    *  E_MANUAL     - Number of E steppers for LCD move options
-    *  TOOL_E_INDEX - Index to use when getting/setting the tool state
-    *
-    */
-   #if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
-     #define HOTENDS       1
-     #undef TEMP_SENSOR_1_AS_REDUNDANT
-     #undef HOTEND_OFFSET_X
-     #undef HOTEND_OFFSET_Y
-   #else                                                         // Two hotends
-     #define HOTENDS       EXTRUDERS
-     #if ENABLED(SWITCHING_NOZZLE) && !defined(HOTEND_OFFSET_Z)
-       #define HOTEND_OFFSET_Z { 0 }
-     #endif
-   #endif
+ #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
  
-   #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
+ #if HOTENDS == 1
+   #define HOTEND_INDEX  0
+ #else
+   #define HOTEND_INDEX  e
+ #endif
  
-   #if HOTENDS == 1
-     #define HOTEND_INDEX  0
+ #if ENABLED(SWITCHING_EXTRUDER) || ENABLED(MIXING_EXTRUDER)   // Unified E axis
+   #if ENABLED(MIXING_EXTRUDER)
+     #define E_STEPPERS  MIXING_STEPPERS
    #else
-     #define HOTEND_INDEX  e
+     #define E_STEPPERS  1                                     // One E stepper
    #endif
+   #define E_MANUAL      1
+   #define TOOL_E_INDEX  0
+ #else
+   #define E_STEPPERS    EXTRUDERS
+   #define E_MANUAL      EXTRUDERS
+   #define TOOL_E_INDEX  current_block->active_extruder
+ #endif
  
-   #if ENABLED(SWITCHING_EXTRUDER) || ENABLED(MIXING_EXTRUDER)   // Unified E axis
-     #if ENABLED(MIXING_EXTRUDER)
-       #define E_STEPPERS  MIXING_STEPPERS
-     #else
-       #define E_STEPPERS  1                                     // One E stepper
-     #endif
-     #define E_MANUAL      1
-     #define TOOL_E_INDEX  0
-   #else
-     #define E_STEPPERS    EXTRUDERS
-     #define E_MANUAL      EXTRUDERS
-     #define TOOL_E_INDEX  current_block->active_extruder
-   #endif
+ /**
+  * DISTINCT_E_FACTORS affects how some E factors are accessed
+  */
+ #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
+   #define XYZE_N (XYZ + E_STEPPERS)
+   #define E_AXIS_N (E_AXIS + extruder)
+ #else
+   #undef DISTINCT_E_FACTORS
+   #define XYZE_N XYZE
+   #define E_AXIS_N E_AXIS
+ #endif
  
-   /**
-    * DISTINCT_E_FACTORS affects how some E factors are accessed
-    */
-   #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
-     #define XYZE_N (XYZ + E_STEPPERS)
-     #define E_AXIS_N (E_AXIS + extruder)
-   #else
-     #undef DISTINCT_E_FACTORS
-     #define XYZE_N XYZE
-     #define E_AXIS_N E_AXIS
+ /**
+  * The BLTouch Probe emulates a servo probe
+  * and uses "special" angles for its state.
+  */
+ #if ENABLED(BLTOUCH)
+   #ifndef Z_ENDSTOP_SERVO_NR
+     #define Z_ENDSTOP_SERVO_NR 0
    #endif
- 
-   /**
-    * The BLTouch Probe emulates a servo probe
-    * and uses "special" angles for its state.
-    */
-   #if ENABLED(BLTOUCH)
-     #ifndef Z_ENDSTOP_SERVO_NR
-       #define Z_ENDSTOP_SERVO_NR 0
-     #endif
-     #ifndef NUM_SERVOS
-       #define NUM_SERVOS (Z_ENDSTOP_SERVO_NR + 1)
-     #endif
-     #undef DEACTIVATE_SERVOS_AFTER_MOVE
-     #if NUM_SERVOS == 1
-       #undef SERVO_DELAY
-       #define SERVO_DELAY { 50 }
-     #endif
-     #ifndef BLTOUCH_DELAY
-       #define BLTOUCH_DELAY 375
-     #endif
-     #undef Z_SERVO_ANGLES
-     #define Z_SERVO_ANGLES { BLTOUCH_DEPLOY, BLTOUCH_STOW }
- 
-     #define BLTOUCH_DEPLOY    10
-     #define BLTOUCH_STOW      90
-     #define BLTOUCH_SELFTEST 120
-     #define BLTOUCH_RESET    160
-     #define _TEST_BLTOUCH(P) (READ(P##_PIN) != P##_ENDSTOP_INVERTING)
- 
-     // Always disable probe pin inverting for BLTouch
-     #undef Z_MIN_PROBE_ENDSTOP_INVERTING
-     #define Z_MIN_PROBE_ENDSTOP_INVERTING false
- 
-     #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
-       #undef Z_MIN_ENDSTOP_INVERTING
-       #define Z_MIN_ENDSTOP_INVERTING false
-       #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN)
-     #else
-       #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
-     #endif
+   #ifndef NUM_SERVOS
+     #define NUM_SERVOS (Z_ENDSTOP_SERVO_NR + 1)
    #endif
- 
-   /**
-    * Set a flag for a servo probe
-    */
-   #define HAS_Z_SERVO_ENDSTOP (defined(Z_ENDSTOP_SERVO_NR) && Z_ENDSTOP_SERVO_NR >= 0)
- 
-   /**
-    * UBL has its own manual probing, so this just causes trouble.
-    */
-   #if ENABLED(AUTO_BED_LEVELING_UBL)
-     #undef PROBE_MANUALLY
+   #undef DEACTIVATE_SERVOS_AFTER_MOVE
+   #if NUM_SERVOS == 1
+     #undef SERVO_DELAY
+     #define SERVO_DELAY { 50 }
+   #endif
+   #ifndef BLTOUCH_DELAY
+     #define BLTOUCH_DELAY 375
    #endif
+   #undef Z_SERVO_ANGLES
+   #define Z_SERVO_ANGLES { BLTOUCH_DEPLOY, BLTOUCH_STOW }
+ 
+   #define BLTOUCH_DEPLOY    10
+   #define BLTOUCH_STOW      90
+   #define BLTOUCH_SELFTEST 120
+   #define BLTOUCH_RESET    160
+   #define _TEST_BLTOUCH(P) (READ(P##_PIN) != P##_ENDSTOP_INVERTING)
+ 
+   // Always disable probe pin inverting for BLTouch
+   #undef Z_MIN_PROBE_ENDSTOP_INVERTING
+   #define Z_MIN_PROBE_ENDSTOP_INVERTING false
+ 
+   #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
+     #undef Z_MIN_ENDSTOP_INVERTING
+     #define Z_MIN_ENDSTOP_INVERTING false
+     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN)
+   #else
+     #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
+   #endif
+ #endif
  
-   /**
-    * Set a flag for any enabled probe
-    */
-   #define PROBE_SELECTED (ENABLED(PROBE_MANUALLY) || ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_ENDSTOP || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
+ /**
+  * Set a flag for a servo probe
+  */
+ #define HAS_Z_SERVO_ENDSTOP (defined(Z_ENDSTOP_SERVO_NR) && Z_ENDSTOP_SERVO_NR >= 0)
  
-   /**
-    * Clear probe pin settings when no probe is selected
-    */
-   #if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
-     #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
-     #undef Z_MIN_PROBE_ENDSTOP
-   #endif
+ /**
+  * UBL has its own manual probing, so this just causes trouble.
+  */
+ #if ENABLED(AUTO_BED_LEVELING_UBL)
+   #undef PROBE_MANUALLY
+ #endif
+ 
+ /**
+  * Set a flag for any enabled probe
+  */
+ #define PROBE_SELECTED (ENABLED(PROBE_MANUALLY) || ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_ENDSTOP || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
  
-   #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
-   #define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
-   #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
+ /**
+  * Clear probe pin settings when no probe is selected
+  */
+ #if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
+   #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
+   #undef Z_MIN_PROBE_ENDSTOP
+ #endif
+ 
+ #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
+ #define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
+ #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
  
 +  // For Re-ARM boards, always use the USB Emulated Serial Port unless RE_ARM_FORCE_SERIAL_PORT is defined
 +  #if MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF)
 +    #ifndef RE_ARM_FORCE_SERIAL_PORT
 +      #undef SERIAL_PORT
 +      #define SERIAL_PORT -1
 +    #endif
 +  #endif
 +
  #endif // CONDITIONALS_LCD_H

commit 51fafccc16f4e58814b1e6e601a3e8f449f54f89
Author: Thomas Moore <tcm0116@users.noreply.github.com>
Date:   Tue Oct 24 17:28:33 2017 -0500

    [2.0.x] Enable hardware serial ports on LPC1768 (#8004)
    
    * Enable hardware serial ports on LPC1768
    
    * Fix compilation errors with other HALs
    
    * FIx order of includes in LPC1768 HAL main.cpp
    
    * Add support for RX_BUFFER_SIZE and TX_BUFFER_SIZE options in Configuration_adv.h

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3653396bb7..f50d2f0075 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -484,11 +484,19 @@
    */
   #if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
     #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
     #undef Z_MIN_PROBE_ENDSTOP
   #endif
 
   #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
   #define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
   #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 
+  // For Re-ARM boards, always use the USB Emulated Serial Port unless RE_ARM_FORCE_SERIAL_PORT is defined
+  #if MB(RAMPS_14_RE_ARM_EFB) || MB(RAMPS_14_RE_ARM_EEB) || MB(RAMPS_14_RE_ARM_EFF) || MB(RAMPS_14_RE_ARM_EEF) || MB(RAMPS_14_RE_ARM_SF)
+    #ifndef RE_ARM_FORCE_SERIAL_PORT
+      #undef SERIAL_PORT
+      #define SERIAL_PORT -1
+    #endif
+  #endif
+
 #endif // CONDITIONALS_LCD_H

commit 4e2baeb3e146d60e50367b829a055e7f4198c554
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Thu Oct 19 00:43:07 2017 -0500

    Update indentation, file-wrapping for Marlin 2.0.x

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3653396bb7..d3d08dd144 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -21,474 +21,474 @@
  */
 
 /**
  * Conditionals_LCD.h
  * Conditionals that need to be set before Configuration_adv.h or pins.h
  */
 
 #ifndef CONDITIONALS_LCD_H // Get the LCD defines which are needed first
 #define CONDITIONALS_LCD_H
 
-  #define LCD_HAS_DIRECTIONAL_BUTTONS (BUTTON_EXISTS(UP) || BUTTON_EXISTS(DWN) || BUTTON_EXISTS(LFT) || BUTTON_EXISTS(RT))
+#define LCD_HAS_DIRECTIONAL_BUTTONS (BUTTON_EXISTS(UP) || BUTTON_EXISTS(DWN) || BUTTON_EXISTS(LFT) || BUTTON_EXISTS(RT))
 
-  #if ENABLED(CARTESIO_UI)
+#if ENABLED(CARTESIO_UI)
 
-    #define DOGLCD
-    #define ULTIPANEL
-    #define DEFAULT_LCD_CONTRAST 90
-    #define LCD_CONTRAST_MIN 60
-    #define LCD_CONTRAST_MAX 140
+  #define DOGLCD
+  #define ULTIPANEL
+  #define DEFAULT_LCD_CONTRAST 90
+  #define LCD_CONTRAST_MIN 60
+  #define LCD_CONTRAST_MAX 140
 
-  #elif ENABLED(MAKRPANEL)
+#elif ENABLED(MAKRPANEL)
 
-    #define U8GLIB_ST7565_64128N
-
-  #elif ENABLED(ANET_KEYPAD_LCD)
-
-    #define REPRAPWORLD_KEYPAD
-    #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
-    #define ADC_KEYPAD
-    #define ADC_KEY_NUM 8
-    #define ULTIPANEL
-
-    // this helps to implement ADC_KEYPAD menus
-    #define ENCODER_PULSES_PER_STEP 1
-    #define ENCODER_STEPS_PER_MENU_ITEM 1
-    #define REVERSE_MENU_DIRECTION
+  #define U8GLIB_ST7565_64128N
 
-  #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
+#elif ENABLED(ANET_KEYPAD_LCD)
 
-    #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+  #define REPRAPWORLD_KEYPAD
+  #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
+  #define ADC_KEYPAD
+  #define ADC_KEY_NUM 8
+  #define ULTIPANEL
 
-  #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
+  // this helps to implement ADC_KEYPAD menus
+  #define ENCODER_PULSES_PER_STEP 1
+  #define ENCODER_STEPS_PER_MENU_ITEM 1
+  #define REVERSE_MENU_DIRECTION
 
-    #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+#elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 
-  #elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(AZSMZ_12864)
+  #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
-    #define ULTRA_LCD  //general LCD support, also 16x2
-    #define DOGLCD  // Support for SPI LCD 128x64 (Controller ST7565R graphic Display Family)
-    #define ULTIMAKERCONTROLLER //as available from the Ultimaker online store.
-
-    #if ENABLED(miniVIKI)
-      #define LCD_CONTRAST_MIN  75
-      #define LCD_CONTRAST_MAX 115
-      #define DEFAULT_LCD_CONTRAST 95
-      #define U8GLIB_ST7565_64128N
-    #elif ENABLED(VIKI2)
-      #define LCD_CONTRAST_MIN 0
-      #define LCD_CONTRAST_MAX 255
-      #define DEFAULT_LCD_CONTRAST 140
-      #define U8GLIB_ST7565_64128N
-    #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
-      #define LCD_CONTRAST_MIN  90
-      #define LCD_CONTRAST_MAX 130
-      #define DEFAULT_LCD_CONTRAST 110
-      #define U8GLIB_LM6059_AF
-      #define SD_DETECT_INVERTED
-    #elif ENABLED(AZSMZ_12864)
-      #define LCD_CONTRAST_MIN  120
-      #define LCD_CONTRAST_MAX 255
-      #define DEFAULT_LCD_CONTRAST 190
-      #define U8GLIB_ST7565_64128N
-    #endif
+#elif ENABLED(BQ_LCD_SMART_CONTROLLER)
 
-  #elif ENABLED(OLED_PANEL_TINYBOY2)
+  #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
-    #define U8GLIB_SSD1306
-    #define ULTIPANEL
-    #define REVERSE_ENCODER_DIRECTION
-    #define REVERSE_MENU_DIRECTION
+#elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(AZSMZ_12864)
 
-  #elif ENABLED(RA_CONTROL_PANEL)
+  #define ULTRA_LCD  //general LCD support, also 16x2
+  #define DOGLCD  // Support for SPI LCD 128x64 (Controller ST7565R graphic Display Family)
+  #define ULTIMAKERCONTROLLER //as available from the Ultimaker online store.
 
-    #define LCD_I2C_TYPE_PCA8574
-    #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
-    #define ULTIPANEL
+  #if ENABLED(miniVIKI)
+    #define LCD_CONTRAST_MIN  75
+    #define LCD_CONTRAST_MAX 115
+    #define DEFAULT_LCD_CONTRAST 95
+    #define U8GLIB_ST7565_64128N
+  #elif ENABLED(VIKI2)
+    #define LCD_CONTRAST_MIN 0
+    #define LCD_CONTRAST_MAX 255
+    #define DEFAULT_LCD_CONTRAST 140
+    #define U8GLIB_ST7565_64128N
+  #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
+    #define LCD_CONTRAST_MIN  90
+    #define LCD_CONTRAST_MAX 130
+    #define DEFAULT_LCD_CONTRAST 110
+    #define U8GLIB_LM6059_AF
+    #define SD_DETECT_INVERTED
+  #elif ENABLED(AZSMZ_12864)
+    #define LCD_CONTRAST_MIN  120
+    #define LCD_CONTRAST_MAX 255
+    #define DEFAULT_LCD_CONTRAST 190
+    #define U8GLIB_ST7565_64128N
+  #endif
 
-  #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
+#elif ENABLED(OLED_PANEL_TINYBOY2)
 
-    #define DOGLCD
-    #define U8GLIB_ST7920
-    #define ULTIPANEL
+  #define U8GLIB_SSD1306
+  #define ULTIPANEL
+  #define REVERSE_ENCODER_DIRECTION
+  #define REVERSE_MENU_DIRECTION
 
-  #elif ENABLED(CR10_STOCKDISPLAY)
+#elif ENABLED(RA_CONTROL_PANEL)
 
-    #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
-    #ifndef ST7920_DELAY_1
-      #define ST7920_DELAY_1 DELAY_2_NOP
-    #endif
-    #ifndef ST7920_DELAY_2
-      #define ST7920_DELAY_2 DELAY_2_NOP
-    #endif
-    #ifndef ST7920_DELAY_3
-      #define ST7920_DELAY_3 DELAY_2_NOP
-    #endif
+  #define LCD_I2C_TYPE_PCA8574
+  #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
+  #define ULTIPANEL
 
-  #elif ENABLED(MKS_12864OLED)
+#elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
-    #define REPRAP_DISCOUNT_SMART_CONTROLLER
-    #define U8GLIB_SH1106
+  #define DOGLCD
+  #define U8GLIB_ST7920
+  #define ULTIPANEL
 
-  #elif ENABLED(MKS_MINI_12864)
-
-    #define MINIPANEL
+#elif ENABLED(CR10_STOCKDISPLAY)
 
+  #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+  #ifndef ST7920_DELAY_1
+    #define ST7920_DELAY_1 DELAY_2_NOP
   #endif
-
-  #if ENABLED(MAKRPANEL) || ENABLED(MINIPANEL)
-    #define DOGLCD
-    #define ULTIPANEL
-    #define DEFAULT_LCD_CONTRAST 17
+  #ifndef ST7920_DELAY_2
+    #define ST7920_DELAY_2 DELAY_2_NOP
   #endif
-
-  // Generic support for SSD1306 / SH1106 OLED based LCDs.
-  #if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SH1106)
-    #define ULTRA_LCD  //general LCD support, also 16x2
-    #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SH1106 graphic Display Family)
+  #ifndef ST7920_DELAY_3
+    #define ST7920_DELAY_3 DELAY_2_NOP
   #endif
 
-  #if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
+#elif ENABLED(MKS_12864OLED)
 
-    #define ULTIMAKERCONTROLLER
+  #define REPRAP_DISCOUNT_SMART_CONTROLLER
+  #define U8GLIB_SH1106
 
-  #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
+#elif ENABLED(MKS_MINI_12864)
 
-    #define REPRAP_DISCOUNT_SMART_CONTROLLER
-    #define LCD_WIDTH 16
-    #define LCD_HEIGHT 2
+  #define MINIPANEL
 
-  #endif
+#endif
 
-  #if ENABLED(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER) || ENABLED(LCD_FOR_MELZI)
-    #define DOGLCD
-    #define U8GLIB_ST7920
-    #define REPRAP_DISCOUNT_SMART_CONTROLLER
-  #endif
+#if ENABLED(MAKRPANEL) || ENABLED(MINIPANEL)
+  #define DOGLCD
+  #define ULTIPANEL
+  #define DEFAULT_LCD_CONTRAST 17
+#endif
 
-  #if ENABLED(ULTIMAKERCONTROLLER)              \
-   || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
-   || ENABLED(G3D_PANEL)                        \
-   || ENABLED(RIGIDBOT_PANEL)
-    #define ULTIPANEL
-  #endif
+// Generic support for SSD1306 / SH1106 OLED based LCDs.
+#if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SH1106)
+  #define ULTRA_LCD  //general LCD support, also 16x2
+  #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SH1106 graphic Display Family)
+#endif
 
-  #if ENABLED(REPRAPWORLD_KEYPAD)
-    #define NEWPANEL
-    #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
-      #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
-    #endif
-  #endif
+#if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
 
-  /**
-   * I2C PANELS
-   */
+  #define ULTIMAKERCONTROLLER
 
-  #if ENABLED(LCD_I2C_SAINSMART_YWROBOT)
+#elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
 
-    // Note: This controller requires F.Malpartida's LiquidCrystal_I2C library
-    // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/Home
+  #define REPRAP_DISCOUNT_SMART_CONTROLLER
+  #define LCD_WIDTH 16
+  #define LCD_HEIGHT 2
 
-    #define LCD_I2C_TYPE_PCF8575
-    #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
-    #define ULTIPANEL
+#endif
 
-  #elif ENABLED(LCD_I2C_PANELOLU2)
+#if ENABLED(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER) || ENABLED(LCD_FOR_MELZI)
+  #define DOGLCD
+  #define U8GLIB_ST7920
+  #define REPRAP_DISCOUNT_SMART_CONTROLLER
+#endif
 
-    // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
+#if ENABLED(ULTIMAKERCONTROLLER)              \
+ || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
+ || ENABLED(G3D_PANEL)                        \
+ || ENABLED(RIGIDBOT_PANEL)
+  #define ULTIPANEL
+#endif
 
-    #define LCD_I2C_TYPE_MCP23017
-    #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
-    #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD
-    #define ULTIPANEL
+#if ENABLED(REPRAPWORLD_KEYPAD)
+  #define NEWPANEL
+  #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
+    #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
+  #endif
+#endif
 
-  #elif ENABLED(LCD_I2C_VIKI)
+/**
+ * I2C PANELS
+ */
 
-    /**
-     * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
-     *
-     * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
-     * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
-     * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
-     *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
-     */
-    #define LCD_I2C_TYPE_MCP23017
-    #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
-    #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
-    #define ULTIPANEL
+#if ENABLED(LCD_I2C_SAINSMART_YWROBOT)
 
-    #define ENCODER_FEEDRATE_DEADZONE 4
+  // Note: This controller requires F.Malpartida's LiquidCrystal_I2C library
+  // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/Home
 
-    #define STD_ENCODER_PULSES_PER_STEP 1
-    #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
+  #define LCD_I2C_TYPE_PCF8575
+  #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
+  #define ULTIPANEL
 
-  #elif ENABLED(G3D_PANEL)
+#elif ENABLED(LCD_I2C_PANELOLU2)
 
-    #define STD_ENCODER_PULSES_PER_STEP 2
-    #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+  // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
 
-  #elif ENABLED(miniVIKI) || ENABLED(VIKI2) \
-     || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
-     || ENABLED(AZSMZ_12864) \
-     || ENABLED(OLED_PANEL_TINYBOY2) \
-     || ENABLED(BQ_LCD_SMART_CONTROLLER) \
-     || ENABLED(LCD_I2C_PANELOLU2) \
-     || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
-    #define STD_ENCODER_PULSES_PER_STEP 4
-    #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
-  #endif
+  #define LCD_I2C_TYPE_MCP23017
+  #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
+  #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD
+  #define ULTIPANEL
 
-  #ifndef STD_ENCODER_PULSES_PER_STEP
-    #define STD_ENCODER_PULSES_PER_STEP 5
-  #endif
-  #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
-    #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+#elif ENABLED(LCD_I2C_VIKI)
+
+  /**
+   * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
+   *
+   * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
+   * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
+   * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
+   *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
+   */
+  #define LCD_I2C_TYPE_MCP23017
+  #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
+  #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
+  #define ULTIPANEL
+
+  #define ENCODER_FEEDRATE_DEADZONE 4
+
+  #define STD_ENCODER_PULSES_PER_STEP 1
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
+
+#elif ENABLED(G3D_PANEL)
+
+  #define STD_ENCODER_PULSES_PER_STEP 2
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+
+#elif ENABLED(miniVIKI) || ENABLED(VIKI2) \
+   || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
+   || ENABLED(AZSMZ_12864) \
+   || ENABLED(OLED_PANEL_TINYBOY2) \
+   || ENABLED(BQ_LCD_SMART_CONTROLLER) \
+   || ENABLED(LCD_I2C_PANELOLU2) \
+   || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
+  #define STD_ENCODER_PULSES_PER_STEP 4
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+#endif
+
+#ifndef STD_ENCODER_PULSES_PER_STEP
+  #define STD_ENCODER_PULSES_PER_STEP 5
+#endif
+#ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
+  #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+#endif
+#ifndef ENCODER_PULSES_PER_STEP
+  #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
+#endif
+#ifndef ENCODER_STEPS_PER_MENU_ITEM
+  #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
+#endif
+#ifndef ENCODER_FEEDRATE_DEADZONE
+  #define ENCODER_FEEDRATE_DEADZONE 6
+#endif
+
+// Shift register panels
+// ---------------------
+// 2 wire Non-latching LCD SR from:
+// https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
+
+#if ENABLED(SAV_3DLCD)
+  #define SR_LCD_2W_NL    // Non latching 2 wire shift register
+  #define ULTIPANEL
+#endif
+
+#if ENABLED(DOGLCD) // Change number of lines to match the DOG graphic display
+  #ifndef LCD_WIDTH
+    #define LCD_WIDTH 22
   #endif
-  #ifndef ENCODER_PULSES_PER_STEP
-    #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
+  #ifndef LCD_HEIGHT
+    #define LCD_HEIGHT 5
   #endif
-  #ifndef ENCODER_STEPS_PER_MENU_ITEM
-    #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
+#endif
+
+#if ENABLED(ULTIPANEL)
+  #define NEWPANEL  // Disable this if you actually have no click-encoder panel
+  #define ULTRA_LCD
+  #ifndef LCD_WIDTH
+    #define LCD_WIDTH 20
   #endif
-  #ifndef ENCODER_FEEDRATE_DEADZONE
-    #define ENCODER_FEEDRATE_DEADZONE 6
+  #ifndef LCD_HEIGHT
+    #define LCD_HEIGHT 4
   #endif
-
-  // Shift register panels
-  // ---------------------
-  // 2 wire Non-latching LCD SR from:
-  // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
-
-  #if ENABLED(SAV_3DLCD)
-    #define SR_LCD_2W_NL    // Non latching 2 wire shift register
-    #define ULTIPANEL
+#elif ENABLED(ULTRA_LCD)  // no panel but just LCD
+  #ifndef LCD_WIDTH
+    #define LCD_WIDTH 16
   #endif
-
-  #if ENABLED(DOGLCD) // Change number of lines to match the DOG graphic display
-    #ifndef LCD_WIDTH
-      #define LCD_WIDTH 22
-    #endif
-    #ifndef LCD_HEIGHT
-      #define LCD_HEIGHT 5
-    #endif
+  #ifndef LCD_HEIGHT
+    #define LCD_HEIGHT 2
   #endif
+#endif
+
+#if ENABLED(DOGLCD)
+  /* Custom characters defined in font dogm_font_data_Marlin_symbols.h / Marlin_symbols.fon */
+  // \x00 intentionally skipped to avoid problems in strings
+  #define LCD_STR_REFRESH     "\x01"
+  #define LCD_STR_FOLDER      "\x02"
+  #define LCD_STR_ARROW_RIGHT "\x03"
+  #define LCD_STR_UPLEVEL     "\x04"
+  #define LCD_STR_CLOCK       "\x05"
+  #define LCD_STR_FEEDRATE    "\x06"
+  #define LCD_STR_BEDTEMP     "\x07"
+  #define LCD_STR_THERMOMETER "\x08"
+  #define LCD_STR_DEGREE      "\x09"
+
+  #define LCD_STR_SPECIAL_MAX '\x09'
+  // Maximum here is 0x1F because 0x20 is ' ' (space) and the normal charsets begin.
+  // Better stay below 0x10 because DISPLAY_CHARSET_HD44780_WESTERN begins here.
+
+  // Symbol characters
+  #define LCD_STR_FILAM_DIA   "\xf8"
+  #define LCD_STR_FILAM_MUL   "\xa4"
+#else
+  /* Custom characters defined in the first 8 characters of the LCD */
+  #define LCD_BEDTEMP_CHAR     0x00  // Print only as a char. This will have 'unexpected' results when used in a string!
+  #define LCD_DEGREE_CHAR      0x01
+  #define LCD_STR_THERMOMETER "\x02" // Still used with string concatenation
+  #define LCD_UPLEVEL_CHAR     0x03
+  #define LCD_STR_REFRESH     "\x04"
+  #define LCD_STR_FOLDER      "\x05"
+  #define LCD_FEEDRATE_CHAR    0x06
+  #define LCD_CLOCK_CHAR       0x07
+  #define LCD_STR_ARROW_RIGHT ">"  /* from the default character set */
+#endif
 
-  #if ENABLED(ULTIPANEL)
-    #define NEWPANEL  // Disable this if you actually have no click-encoder panel
-    #define ULTRA_LCD
-    #ifndef LCD_WIDTH
-      #define LCD_WIDTH 20
-    #endif
-    #ifndef LCD_HEIGHT
-      #define LCD_HEIGHT 4
+/**
+ * Default LCD contrast for dogm-like LCD displays
+ */
+#if ENABLED(DOGLCD)
+
+  #define HAS_LCD_CONTRAST ( \
+      ENABLED(MAKRPANEL) \
+   || ENABLED(CARTESIO_UI) \
+   || ENABLED(VIKI2) \
+   || ENABLED(AZSMZ_12864) \
+   || ENABLED(miniVIKI) \
+   || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
+  )
+
+  #if HAS_LCD_CONTRAST
+    #ifndef LCD_CONTRAST_MIN
+      #define LCD_CONTRAST_MIN 0
     #endif
-  #elif ENABLED(ULTRA_LCD)  // no panel but just LCD
-    #ifndef LCD_WIDTH
-      #define LCD_WIDTH 16
+    #ifndef LCD_CONTRAST_MAX
+      #define LCD_CONTRAST_MAX 63
     #endif
-    #ifndef LCD_HEIGHT
-      #define LCD_HEIGHT 2
+    #ifndef DEFAULT_LCD_CONTRAST
+      #define DEFAULT_LCD_CONTRAST 32
     #endif
   #endif
+#endif
 
-  #if ENABLED(DOGLCD)
-    /* Custom characters defined in font dogm_font_data_Marlin_symbols.h / Marlin_symbols.fon */
-    // \x00 intentionally skipped to avoid problems in strings
-    #define LCD_STR_REFRESH     "\x01"
-    #define LCD_STR_FOLDER      "\x02"
-    #define LCD_STR_ARROW_RIGHT "\x03"
-    #define LCD_STR_UPLEVEL     "\x04"
-    #define LCD_STR_CLOCK       "\x05"
-    #define LCD_STR_FEEDRATE    "\x06"
-    #define LCD_STR_BEDTEMP     "\x07"
-    #define LCD_STR_THERMOMETER "\x08"
-    #define LCD_STR_DEGREE      "\x09"
-
-    #define LCD_STR_SPECIAL_MAX '\x09'
-    // Maximum here is 0x1F because 0x20 is ' ' (space) and the normal charsets begin.
-    // Better stay below 0x10 because DISPLAY_CHARSET_HD44780_WESTERN begins here.
-
-    // Symbol characters
-    #define LCD_STR_FILAM_DIA   "\xf8"
-    #define LCD_STR_FILAM_MUL   "\xa4"
-  #else
-    /* Custom characters defined in the first 8 characters of the LCD */
-    #define LCD_BEDTEMP_CHAR     0x00  // Print only as a char. This will have 'unexpected' results when used in a string!
-    #define LCD_DEGREE_CHAR      0x01
-    #define LCD_STR_THERMOMETER "\x02" // Still used with string concatenation
-    #define LCD_UPLEVEL_CHAR     0x03
-    #define LCD_STR_REFRESH     "\x04"
-    #define LCD_STR_FOLDER      "\x05"
-    #define LCD_FEEDRATE_CHAR    0x06
-    #define LCD_CLOCK_CHAR       0x07
-    #define LCD_STR_ARROW_RIGHT ">"  /* from the default character set */
-  #endif
-
-  /**
-   * Default LCD contrast for dogm-like LCD displays
-   */
-  #if ENABLED(DOGLCD)
-
-    #define HAS_LCD_CONTRAST ( \
-        ENABLED(MAKRPANEL) \
-     || ENABLED(CARTESIO_UI) \
-     || ENABLED(VIKI2) \
-     || ENABLED(AZSMZ_12864) \
-     || ENABLED(miniVIKI) \
-     || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
-    )
-
-    #if HAS_LCD_CONTRAST
-      #ifndef LCD_CONTRAST_MIN
-        #define LCD_CONTRAST_MIN 0
-      #endif
-      #ifndef LCD_CONTRAST_MAX
-        #define LCD_CONTRAST_MAX 63
-      #endif
-      #ifndef DEFAULT_LCD_CONTRAST
-        #define DEFAULT_LCD_CONTRAST 32
-      #endif
-    #endif
-  #endif
+// Boot screens
+#if DISABLED(ULTRA_LCD)
+  #undef SHOW_BOOTSCREEN
+#elif !defined(BOOTSCREEN_TIMEOUT)
+  #define BOOTSCREEN_TIMEOUT 2500
+#endif
 
-  // Boot screens
-  #if DISABLED(ULTRA_LCD)
-    #undef SHOW_BOOTSCREEN
-  #elif !defined(BOOTSCREEN_TIMEOUT)
-    #define BOOTSCREEN_TIMEOUT 2500
-  #endif
+#define HAS_DEBUG_MENU ENABLED(LCD_PROGRESS_BAR_TEST)
 
-  #define HAS_DEBUG_MENU ENABLED(LCD_PROGRESS_BAR_TEST)
+// MK2 Multiplexer forces SINGLENOZZLE to be enabled
+#if ENABLED(MK2_MULTIPLEXER)
+  #define SINGLENOZZLE
+#endif
 
-  // MK2 Multiplexer forces SINGLENOZZLE to be enabled
-  #if ENABLED(MK2_MULTIPLEXER)
-    #define SINGLENOZZLE
+/**
+ * Extruders have some combination of stepper motors and hotends
+ * so we separate these concepts into the defines:
+ *
+ *  EXTRUDERS    - Number of Selectable Tools
+ *  HOTENDS      - Number of hotends, whether connected or separate
+ *  E_STEPPERS   - Number of actual E stepper motors
+ *  E_MANUAL     - Number of E steppers for LCD move options
+ *  TOOL_E_INDEX - Index to use when getting/setting the tool state
+ *
+ */
+#if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
+  #define HOTENDS       1
+  #undef TEMP_SENSOR_1_AS_REDUNDANT
+  #undef HOTEND_OFFSET_X
+  #undef HOTEND_OFFSET_Y
+#else                                                         // Two hotends
+  #define HOTENDS       EXTRUDERS
+  #if ENABLED(SWITCHING_NOZZLE) && !defined(HOTEND_OFFSET_Z)
+    #define HOTEND_OFFSET_Z { 0 }
   #endif
+#endif
 
-  /**
-   * Extruders have some combination of stepper motors and hotends
-   * so we separate these concepts into the defines:
-   *
-   *  EXTRUDERS    - Number of Selectable Tools
-   *  HOTENDS      - Number of hotends, whether connected or separate
-   *  E_STEPPERS   - Number of actual E stepper motors
-   *  E_MANUAL     - Number of E steppers for LCD move options
-   *  TOOL_E_INDEX - Index to use when getting/setting the tool state
-   *
-   */
-  #if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
-    #define HOTENDS       1
-    #undef TEMP_SENSOR_1_AS_REDUNDANT
-    #undef HOTEND_OFFSET_X
-    #undef HOTEND_OFFSET_Y
-  #else                                                         // Two hotends
-    #define HOTENDS       EXTRUDERS
-    #if ENABLED(SWITCHING_NOZZLE) && !defined(HOTEND_OFFSET_Z)
-      #define HOTEND_OFFSET_Z { 0 }
-    #endif
-  #endif
+#define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
 
-  #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
+#if HOTENDS == 1
+  #define HOTEND_INDEX  0
+#else
+  #define HOTEND_INDEX  e
+#endif
 
-  #if HOTENDS == 1
-    #define HOTEND_INDEX  0
+#if ENABLED(SWITCHING_EXTRUDER) || ENABLED(MIXING_EXTRUDER)   // Unified E axis
+  #if ENABLED(MIXING_EXTRUDER)
+    #define E_STEPPERS  MIXING_STEPPERS
   #else
-    #define HOTEND_INDEX  e
+    #define E_STEPPERS  1                                     // One E stepper
   #endif
+  #define E_MANUAL      1
+  #define TOOL_E_INDEX  0
+#else
+  #define E_STEPPERS    EXTRUDERS
+  #define E_MANUAL      EXTRUDERS
+  #define TOOL_E_INDEX  current_block->active_extruder
+#endif
 
-  #if ENABLED(SWITCHING_EXTRUDER) || ENABLED(MIXING_EXTRUDER)   // Unified E axis
-    #if ENABLED(MIXING_EXTRUDER)
-      #define E_STEPPERS  MIXING_STEPPERS
-    #else
-      #define E_STEPPERS  1                                     // One E stepper
-    #endif
-    #define E_MANUAL      1
-    #define TOOL_E_INDEX  0
-  #else
-    #define E_STEPPERS    EXTRUDERS
-    #define E_MANUAL      EXTRUDERS
-    #define TOOL_E_INDEX  current_block->active_extruder
-  #endif
+/**
+ * DISTINCT_E_FACTORS affects how some E factors are accessed
+ */
+#if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
+  #define XYZE_N (XYZ + E_STEPPERS)
+  #define E_AXIS_N (E_AXIS + extruder)
+#else
+  #undef DISTINCT_E_FACTORS
+  #define XYZE_N XYZE
+  #define E_AXIS_N E_AXIS
+#endif
 
-  /**
-   * DISTINCT_E_FACTORS affects how some E factors are accessed
-   */
-  #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
-    #define XYZE_N (XYZ + E_STEPPERS)
-    #define E_AXIS_N (E_AXIS + extruder)
-  #else
-    #undef DISTINCT_E_FACTORS
-    #define XYZE_N XYZE
-    #define E_AXIS_N E_AXIS
+/**
+ * The BLTouch Probe emulates a servo probe
+ * and uses "special" angles for its state.
+ */
+#if ENABLED(BLTOUCH)
+  #ifndef Z_ENDSTOP_SERVO_NR
+    #define Z_ENDSTOP_SERVO_NR 0
   #endif
-
-  /**
-   * The BLTouch Probe emulates a servo probe
-   * and uses "special" angles for its state.
-   */
-  #if ENABLED(BLTOUCH)
-    #ifndef Z_ENDSTOP_SERVO_NR
-      #define Z_ENDSTOP_SERVO_NR 0
-    #endif
-    #ifndef NUM_SERVOS
-      #define NUM_SERVOS (Z_ENDSTOP_SERVO_NR + 1)
-    #endif
-    #undef DEACTIVATE_SERVOS_AFTER_MOVE
-    #if NUM_SERVOS == 1
-      #undef SERVO_DELAY
-      #define SERVO_DELAY { 50 }
-    #endif
-    #ifndef BLTOUCH_DELAY
-      #define BLTOUCH_DELAY 375
-    #endif
-    #undef Z_SERVO_ANGLES
-    #define Z_SERVO_ANGLES { BLTOUCH_DEPLOY, BLTOUCH_STOW }
-
-    #define BLTOUCH_DEPLOY    10
-    #define BLTOUCH_STOW      90
-    #define BLTOUCH_SELFTEST 120
-    #define BLTOUCH_RESET    160
-    #define _TEST_BLTOUCH(P) (READ(P##_PIN) != P##_ENDSTOP_INVERTING)
-
-    // Always disable probe pin inverting for BLTouch
-    #undef Z_MIN_PROBE_ENDSTOP_INVERTING
-    #define Z_MIN_PROBE_ENDSTOP_INVERTING false
-
-    #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
-      #undef Z_MIN_ENDSTOP_INVERTING
-      #define Z_MIN_ENDSTOP_INVERTING false
-      #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN)
-    #else
-      #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
-    #endif
+  #ifndef NUM_SERVOS
+    #define NUM_SERVOS (Z_ENDSTOP_SERVO_NR + 1)
   #endif
-
-  /**
-   * Set a flag for a servo probe
-   */
-  #define HAS_Z_SERVO_ENDSTOP (defined(Z_ENDSTOP_SERVO_NR) && Z_ENDSTOP_SERVO_NR >= 0)
-
-  /**
-   * UBL has its own manual probing, so this just causes trouble.
-   */
-  #if ENABLED(AUTO_BED_LEVELING_UBL)
-    #undef PROBE_MANUALLY
+  #undef DEACTIVATE_SERVOS_AFTER_MOVE
+  #if NUM_SERVOS == 1
+    #undef SERVO_DELAY
+    #define SERVO_DELAY { 50 }
+  #endif
+  #ifndef BLTOUCH_DELAY
+    #define BLTOUCH_DELAY 375
   #endif
+  #undef Z_SERVO_ANGLES
+  #define Z_SERVO_ANGLES { BLTOUCH_DEPLOY, BLTOUCH_STOW }
+
+  #define BLTOUCH_DEPLOY    10
+  #define BLTOUCH_STOW      90
+  #define BLTOUCH_SELFTEST 120
+  #define BLTOUCH_RESET    160
+  #define _TEST_BLTOUCH(P) (READ(P##_PIN) != P##_ENDSTOP_INVERTING)
+
+  // Always disable probe pin inverting for BLTouch
+  #undef Z_MIN_PROBE_ENDSTOP_INVERTING
+  #define Z_MIN_PROBE_ENDSTOP_INVERTING false
+
+  #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
+    #undef Z_MIN_ENDSTOP_INVERTING
+    #define Z_MIN_ENDSTOP_INVERTING false
+    #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN)
+  #else
+    #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
+  #endif
+#endif
 
-  /**
-   * Set a flag for any enabled probe
-   */
-  #define PROBE_SELECTED (ENABLED(PROBE_MANUALLY) || ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_ENDSTOP || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
+/**
+ * Set a flag for a servo probe
+ */
+#define HAS_Z_SERVO_ENDSTOP (defined(Z_ENDSTOP_SERVO_NR) && Z_ENDSTOP_SERVO_NR >= 0)
 
-  /**
-   * Clear probe pin settings when no probe is selected
-   */
-  #if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
-    #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
-    #undef Z_MIN_PROBE_ENDSTOP
-  #endif
+/**
+ * UBL has its own manual probing, so this just causes trouble.
+ */
+#if ENABLED(AUTO_BED_LEVELING_UBL)
+  #undef PROBE_MANUALLY
+#endif
+
+/**
+ * Set a flag for any enabled probe
+ */
+#define PROBE_SELECTED (ENABLED(PROBE_MANUALLY) || ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_ENDSTOP || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
 
-  #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
-  #define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
-  #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
+/**
+ * Clear probe pin settings when no probe is selected
+ */
+#if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
+  #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
+  #undef Z_MIN_PROBE_ENDSTOP
+#endif
+
+#define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
+#define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
+#define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 
 #endif // CONDITIONALS_LCD_H

commit 9e5cbf019856e76f29bed8dd2a4e193f94e2c177
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Oct 18 22:16:08 2017 -0500

    BQ should set this in its config, and does

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 099b80e601..3653396bb7 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -55,21 +55,20 @@
     #define ENCODER_STEPS_PER_MENU_ITEM 1
     #define REVERSE_MENU_DIRECTION
 
   #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 
     #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
   #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
 
     #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
-    #define LONG_FILENAME_HOST_SUPPORT
 
   #elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(AZSMZ_12864)
 
     #define ULTRA_LCD  //general LCD support, also 16x2
     #define DOGLCD  // Support for SPI LCD 128x64 (Controller ST7565R graphic Display Family)
     #define ULTIMAKERCONTROLLER //as available from the Ultimaker online store.
 
     #if ENABLED(miniVIKI)
       #define LCD_CONTRAST_MIN  75
       #define LCD_CONTRAST_MAX 115

commit eeb4611606625a7330b2d2adbf0fc51ae70af2a9
Author: Jeffrey Li <Jeffreyli@jeffyl.com>
Date:   Mon Oct 16 00:33:07 2017 -0700

    Add proper support for the AZSMZ 12864 LCD on a SMART RAMPS

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index ab7a47b4a6..099b80e601 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -57,21 +57,21 @@
 
   #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 
     #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
   #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
 
     #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
     #define LONG_FILENAME_HOST_SUPPORT
 
-  #elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
+  #elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(AZSMZ_12864)
 
     #define ULTRA_LCD  //general LCD support, also 16x2
     #define DOGLCD  // Support for SPI LCD 128x64 (Controller ST7565R graphic Display Family)
     #define ULTIMAKERCONTROLLER //as available from the Ultimaker online store.
 
     #if ENABLED(miniVIKI)
       #define LCD_CONTRAST_MIN  75
       #define LCD_CONTRAST_MAX 115
       #define DEFAULT_LCD_CONTRAST 95
       #define U8GLIB_ST7565_64128N
@@ -79,20 +79,25 @@
       #define LCD_CONTRAST_MIN 0
       #define LCD_CONTRAST_MAX 255
       #define DEFAULT_LCD_CONTRAST 140
       #define U8GLIB_ST7565_64128N
     #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
       #define LCD_CONTRAST_MIN  90
       #define LCD_CONTRAST_MAX 130
       #define DEFAULT_LCD_CONTRAST 110
       #define U8GLIB_LM6059_AF
       #define SD_DETECT_INVERTED
+    #elif ENABLED(AZSMZ_12864)
+      #define LCD_CONTRAST_MIN  120
+      #define LCD_CONTRAST_MAX 255
+      #define DEFAULT_LCD_CONTRAST 190
+      #define U8GLIB_ST7565_64128N
     #endif
 
   #elif ENABLED(OLED_PANEL_TINYBOY2)
 
     #define U8GLIB_SSD1306
     #define ULTIPANEL
     #define REVERSE_ENCODER_DIRECTION
     #define REVERSE_MENU_DIRECTION
 
   #elif ENABLED(RA_CONTROL_PANEL)
@@ -217,20 +222,21 @@
     #define STD_ENCODER_PULSES_PER_STEP 1
     #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
 
   #elif ENABLED(G3D_PANEL)
 
     #define STD_ENCODER_PULSES_PER_STEP 2
     #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
 
   #elif ENABLED(miniVIKI) || ENABLED(VIKI2) \
      || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
+     || ENABLED(AZSMZ_12864) \
      || ENABLED(OLED_PANEL_TINYBOY2) \
      || ENABLED(BQ_LCD_SMART_CONTROLLER) \
      || ENABLED(LCD_I2C_PANELOLU2) \
      || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
     #define STD_ENCODER_PULSES_PER_STEP 4
     #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #endif
 
   #ifndef STD_ENCODER_PULSES_PER_STEP
     #define STD_ENCODER_PULSES_PER_STEP 5
@@ -320,20 +326,21 @@
 
   /**
    * Default LCD contrast for dogm-like LCD displays
    */
   #if ENABLED(DOGLCD)
 
     #define HAS_LCD_CONTRAST ( \
         ENABLED(MAKRPANEL) \
      || ENABLED(CARTESIO_UI) \
      || ENABLED(VIKI2) \
+     || ENABLED(AZSMZ_12864) \
      || ENABLED(miniVIKI) \
      || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
     )
 
     #if HAS_LCD_CONTRAST
       #ifndef LCD_CONTRAST_MIN
         #define LCD_CONTRAST_MIN 0
       #endif
       #ifndef LCD_CONTRAST_MAX
         #define LCD_CONTRAST_MAX 63

commit a11e6a1022b8f70be237fad82a9b6ba22b2db7b1
Author: Slawomir Ciunczyk <s.ciunczyk@moye.eu>
Date:   Thu Oct 5 13:45:36 2017 +0200

    Different NEOPIXEL types
    
    Same as #7728 but for 2.0.x,
    Lot of cleanup and remove references in whole code to other "LED files" than leds.h. Now will be much easier to add next drivers/libraries. e.g. FastLED. But bad news, currently FastLED is suporting only RGB devices (no RGBW)

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 69ca4363bc..ab7a47b4a6 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -476,13 +476,13 @@
   /**
    * Clear probe pin settings when no probe is selected
    */
   #if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
     #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
     #undef Z_MIN_PROBE_ENDSTOP
   #endif
 
   #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
   #define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
-  #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_RGBW_LED))
+  #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_LED))
 
 #endif // CONDITIONALS_LCD_H

commit e9bcb9d048c03fe8e6b0b79e938f419648073d50
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Mon Oct 9 15:58:02 2017 -0500

    Add 4 new LCD displays

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 0f79edbbc2..69ca4363bc 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -33,31 +33,22 @@
   #if ENABLED(CARTESIO_UI)
 
     #define DOGLCD
     #define ULTIPANEL
     #define DEFAULT_LCD_CONTRAST 90
     #define LCD_CONTRAST_MIN 60
     #define LCD_CONTRAST_MAX 140
 
   #elif ENABLED(MAKRPANEL)
 
-    #define DOGLCD
-    #define ULTIPANEL
-    #define DEFAULT_LCD_CONTRAST 17
     #define U8GLIB_ST7565_64128N
 
-  #elif ENABLED(MINIPANEL)
-
-    #define DOGLCD
-    #define ULTIPANEL
-    #define DEFAULT_LCD_CONTRAST 17
-
   #elif ENABLED(ANET_KEYPAD_LCD)
 
     #define REPRAPWORLD_KEYPAD
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
     #define ADC_KEYPAD
     #define ADC_KEY_NUM 8
     #define ULTIPANEL
 
     // this helps to implement ADC_KEYPAD menus
     #define ENCODER_PULSES_PER_STEP 1
@@ -109,30 +100,66 @@
     #define LCD_I2C_TYPE_PCA8574
     #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
     #define ULTIPANEL
 
   #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
     #define DOGLCD
     #define U8GLIB_ST7920
     #define ULTIPANEL
 
+  #elif ENABLED(CR10_STOCKDISPLAY)
+
+    #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+    #ifndef ST7920_DELAY_1
+      #define ST7920_DELAY_1 DELAY_2_NOP
+    #endif
+    #ifndef ST7920_DELAY_2
+      #define ST7920_DELAY_2 DELAY_2_NOP
+    #endif
+    #ifndef ST7920_DELAY_3
+      #define ST7920_DELAY_3 DELAY_2_NOP
+    #endif
+
+  #elif ENABLED(MKS_12864OLED)
+
+    #define REPRAP_DISCOUNT_SMART_CONTROLLER
+    #define U8GLIB_SH1106
+
+  #elif ENABLED(MKS_MINI_12864)
+
+    #define MINIPANEL
+
+  #endif
+
+  #if ENABLED(MAKRPANEL) || ENABLED(MINIPANEL)
+    #define DOGLCD
+    #define ULTIPANEL
+    #define DEFAULT_LCD_CONTRAST 17
   #endif
 
   // Generic support for SSD1306 / SH1106 OLED based LCDs.
   #if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SH1106)
     #define ULTRA_LCD  //general LCD support, also 16x2
     #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SH1106 graphic Display Family)
   #endif
 
   #if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
+
     #define ULTIMAKERCONTROLLER
+
+  #elif ENABLED(MAKEBOARD_MINI_2_LINE_DISPLAY_1602)
+
+    #define REPRAP_DISCOUNT_SMART_CONTROLLER
+    #define LCD_WIDTH 16
+    #define LCD_HEIGHT 2
+
   #endif
 
   #if ENABLED(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER) || ENABLED(LCD_FOR_MELZI)
     #define DOGLCD
     #define U8GLIB_ST7920
     #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #endif
 
   #if ENABLED(ULTIMAKERCONTROLLER)              \
    || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
@@ -242,28 +269,26 @@
 
   #if ENABLED(ULTIPANEL)
     #define NEWPANEL  // Disable this if you actually have no click-encoder panel
     #define ULTRA_LCD
     #ifndef LCD_WIDTH
       #define LCD_WIDTH 20
     #endif
     #ifndef LCD_HEIGHT
       #define LCD_HEIGHT 4
     #endif
-  #else // no panel but just LCD
-    #if ENABLED(ULTRA_LCD)
-      #ifndef LCD_WIDTH
-        #define LCD_WIDTH 16
-      #endif
-      #ifndef LCD_HEIGHT
-        #define LCD_HEIGHT 2
-      #endif
+  #elif ENABLED(ULTRA_LCD)  // no panel but just LCD
+    #ifndef LCD_WIDTH
+      #define LCD_WIDTH 16
+    #endif
+    #ifndef LCD_HEIGHT
+      #define LCD_HEIGHT 2
     #endif
   #endif
 
   #if ENABLED(DOGLCD)
     /* Custom characters defined in font dogm_font_data_Marlin_symbols.h / Marlin_symbols.fon */
     // \x00 intentionally skipped to avoid problems in strings
     #define LCD_STR_REFRESH     "\x01"
     #define LCD_STR_FOLDER      "\x02"
     #define LCD_STR_ARROW_RIGHT "\x03"
     #define LCD_STR_UPLEVEL     "\x04"

commit 2aa22c5a5e858c0931438c337349aa4ea209cc20
Merge: db8ded90c2 f99d1dedae
Author: Scott Lahteine <thinkyhead@users.noreply.github.com>
Date:   Sat Oct 7 01:21:23 2017 -0500

    Merge pull request #7874 from thinkyhead/bf2_anet_encoder_pulses
    
    [2.0.x] Fixing ANET encoder pulses

diff --combined Marlin/src/inc/Conditionals_LCD.h
index 57dcca8076,ad8ba373c1..0f79edbbc2
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@@ -27,45 -27,50 +27,47 @@@
  
  #ifndef CONDITIONALS_LCD_H // Get the LCD defines which are needed first
  #define CONDITIONALS_LCD_H
  
    #define LCD_HAS_DIRECTIONAL_BUTTONS (BUTTON_EXISTS(UP) || BUTTON_EXISTS(DWN) || BUTTON_EXISTS(LFT) || BUTTON_EXISTS(RT))
  
    #if ENABLED(CARTESIO_UI)
  
      #define DOGLCD
      #define ULTIPANEL
 -    #define NEWPANEL
      #define DEFAULT_LCD_CONTRAST 90
      #define LCD_CONTRAST_MIN 60
      #define LCD_CONTRAST_MAX 140
  
    #elif ENABLED(MAKRPANEL)
  
      #define DOGLCD
      #define ULTIPANEL
 -    #define NEWPANEL
      #define DEFAULT_LCD_CONTRAST 17
      #define U8GLIB_ST7565_64128N
  
    #elif ENABLED(MINIPANEL)
  
      #define DOGLCD
      #define ULTIPANEL
 -    #define NEWPANEL
      #define DEFAULT_LCD_CONTRAST 17
  
    #elif ENABLED(ANET_KEYPAD_LCD)
  
      #define REPRAPWORLD_KEYPAD
      #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
      #define ADC_KEYPAD
      #define ADC_KEY_NUM 8
      #define ULTIPANEL
+ 
      // this helps to implement ADC_KEYPAD menus
+     #define ENCODER_PULSES_PER_STEP 1
      #define ENCODER_STEPS_PER_MENU_ITEM 1
      #define REVERSE_MENU_DIRECTION
  
    #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
  
      #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
  
    #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
  
      #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
@@@ -92,34 -97,37 +94,34 @@@
        #define LCD_CONTRAST_MAX 130
        #define DEFAULT_LCD_CONTRAST 110
        #define U8GLIB_LM6059_AF
        #define SD_DETECT_INVERTED
      #endif
  
    #elif ENABLED(OLED_PANEL_TINYBOY2)
  
      #define U8GLIB_SSD1306
      #define ULTIPANEL
 -    #define NEWPANEL
      #define REVERSE_ENCODER_DIRECTION
      #define REVERSE_MENU_DIRECTION
  
    #elif ENABLED(RA_CONTROL_PANEL)
  
      #define LCD_I2C_TYPE_PCA8574
      #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
      #define ULTIPANEL
 -    #define NEWPANEL
  
    #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
  
      #define DOGLCD
      #define U8GLIB_ST7920
      #define ULTIPANEL
 -    #define NEWPANEL
  
    #endif
  
    // Generic support for SSD1306 / SH1106 OLED based LCDs.
    #if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SH1106)
      #define ULTRA_LCD  //general LCD support, also 16x2
      #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SH1106 graphic Display Family)
    #endif
  
    #if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
@@@ -130,20 -138,21 +132,20 @@@
      #define DOGLCD
      #define U8GLIB_ST7920
      #define REPRAP_DISCOUNT_SMART_CONTROLLER
    #endif
  
    #if ENABLED(ULTIMAKERCONTROLLER)              \
     || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
     || ENABLED(G3D_PANEL)                        \
     || ENABLED(RIGIDBOT_PANEL)
      #define ULTIPANEL
 -    #define NEWPANEL
    #endif
  
    #if ENABLED(REPRAPWORLD_KEYPAD)
      #define NEWPANEL
      #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
        #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
      #endif
    #endif
  
    /**
@@@ -151,44 -160,47 +153,44 @@@
     */
  
    #if ENABLED(LCD_I2C_SAINSMART_YWROBOT)
  
      // Note: This controller requires F.Malpartida's LiquidCrystal_I2C library
      // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/Home
  
      #define LCD_I2C_TYPE_PCF8575
      #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
      #define ULTIPANEL
 -    #define NEWPANEL
  
    #elif ENABLED(LCD_I2C_PANELOLU2)
  
      // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
  
      #define LCD_I2C_TYPE_MCP23017
      #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
      #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD
      #define ULTIPANEL
 -    #define NEWPANEL
  
    #elif ENABLED(LCD_I2C_VIKI)
  
      /**
       * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
       *
       * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
       * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
       * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
       *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
       */
      #define LCD_I2C_TYPE_MCP23017
      #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
      #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
      #define ULTIPANEL
 -    #define NEWPANEL
  
      #define ENCODER_FEEDRATE_DEADZONE 4
  
      #define STD_ENCODER_PULSES_PER_STEP 1
      #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
  
    #elif ENABLED(G3D_PANEL)
  
      #define STD_ENCODER_PULSES_PER_STEP 2
      #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
@@@ -220,33 -232,34 +222,33 @@@
    #endif
  
    // Shift register panels
    // ---------------------
    // 2 wire Non-latching LCD SR from:
    // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
  
    #if ENABLED(SAV_3DLCD)
      #define SR_LCD_2W_NL    // Non latching 2 wire shift register
      #define ULTIPANEL
 -    #define NEWPANEL
    #endif
  
    #if ENABLED(DOGLCD) // Change number of lines to match the DOG graphic display
      #ifndef LCD_WIDTH
        #define LCD_WIDTH 22
      #endif
      #ifndef LCD_HEIGHT
        #define LCD_HEIGHT 5
      #endif
    #endif
  
    #if ENABLED(ULTIPANEL)
 -    #define NEWPANEL  //enable this if you have a click-encoder panel
 +    #define NEWPANEL  // Disable this if you actually have no click-encoder panel
      #define ULTRA_LCD
      #ifndef LCD_WIDTH
        #define LCD_WIDTH 20
      #endif
      #ifndef LCD_HEIGHT
        #define LCD_HEIGHT 4
      #endif
    #else // no panel but just LCD
      #if ENABLED(ULTRA_LCD)
        #ifndef LCD_WIDTH

commit f99d1dedae18008426dae938c89f64a59bad579e
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Sat Oct 7 00:10:05 2017 -0500

    Fixing #7833
    
    Derived from #7873

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3f8092d233..ad8ba373c1 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -54,21 +54,23 @@
     #define NEWPANEL
     #define DEFAULT_LCD_CONTRAST 17
 
   #elif ENABLED(ANET_KEYPAD_LCD)
 
     #define REPRAPWORLD_KEYPAD
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
     #define ADC_KEYPAD
     #define ADC_KEY_NUM 8
     #define ULTIPANEL
+
     // this helps to implement ADC_KEYPAD menus
+    #define ENCODER_PULSES_PER_STEP 1
     #define ENCODER_STEPS_PER_MENU_ITEM 1
     #define REVERSE_MENU_DIRECTION
 
   #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
 
     #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
 
   #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
 
     #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER

commit ef90b49fffa540746e66b15c463233e2efb0ef81
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Fri Oct 6 23:56:58 2017 -0500

    Remove extra NEWPANEL settings in Conditionals_LCD.h

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 3f8092d233..57dcca8076 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -27,38 +27,35 @@
 
 #ifndef CONDITIONALS_LCD_H // Get the LCD defines which are needed first
 #define CONDITIONALS_LCD_H
 
   #define LCD_HAS_DIRECTIONAL_BUTTONS (BUTTON_EXISTS(UP) || BUTTON_EXISTS(DWN) || BUTTON_EXISTS(LFT) || BUTTON_EXISTS(RT))
 
   #if ENABLED(CARTESIO_UI)
 
     #define DOGLCD
     #define ULTIPANEL
-    #define NEWPANEL
     #define DEFAULT_LCD_CONTRAST 90
     #define LCD_CONTRAST_MIN 60
     #define LCD_CONTRAST_MAX 140
 
   #elif ENABLED(MAKRPANEL)
 
     #define DOGLCD
     #define ULTIPANEL
-    #define NEWPANEL
     #define DEFAULT_LCD_CONTRAST 17
     #define U8GLIB_ST7565_64128N
 
   #elif ENABLED(MINIPANEL)
 
     #define DOGLCD
     #define ULTIPANEL
-    #define NEWPANEL
     #define DEFAULT_LCD_CONTRAST 17
 
   #elif ENABLED(ANET_KEYPAD_LCD)
 
     #define REPRAPWORLD_KEYPAD
     #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
     #define ADC_KEYPAD
     #define ADC_KEY_NUM 8
     #define ULTIPANEL
     // this helps to implement ADC_KEYPAD menus
@@ -95,37 +92,34 @@
       #define LCD_CONTRAST_MAX 130
       #define DEFAULT_LCD_CONTRAST 110
       #define U8GLIB_LM6059_AF
       #define SD_DETECT_INVERTED
     #endif
 
   #elif ENABLED(OLED_PANEL_TINYBOY2)
 
     #define U8GLIB_SSD1306
     #define ULTIPANEL
-    #define NEWPANEL
     #define REVERSE_ENCODER_DIRECTION
     #define REVERSE_MENU_DIRECTION
 
   #elif ENABLED(RA_CONTROL_PANEL)
 
     #define LCD_I2C_TYPE_PCA8574
     #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
     #define ULTIPANEL
-    #define NEWPANEL
 
   #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
 
     #define DOGLCD
     #define U8GLIB_ST7920
     #define ULTIPANEL
-    #define NEWPANEL
 
   #endif
 
   // Generic support for SSD1306 / SH1106 OLED based LCDs.
   #if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SH1106)
     #define ULTRA_LCD  //general LCD support, also 16x2
     #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SH1106 graphic Display Family)
   #endif
 
   #if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
@@ -136,21 +130,20 @@
     #define DOGLCD
     #define U8GLIB_ST7920
     #define REPRAP_DISCOUNT_SMART_CONTROLLER
   #endif
 
   #if ENABLED(ULTIMAKERCONTROLLER)              \
    || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
    || ENABLED(G3D_PANEL)                        \
    || ENABLED(RIGIDBOT_PANEL)
     #define ULTIPANEL
-    #define NEWPANEL
   #endif
 
   #if ENABLED(REPRAPWORLD_KEYPAD)
     #define NEWPANEL
     #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
       #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
     #endif
   #endif
 
   /**
@@ -158,47 +151,44 @@
    */
 
   #if ENABLED(LCD_I2C_SAINSMART_YWROBOT)
 
     // Note: This controller requires F.Malpartida's LiquidCrystal_I2C library
     // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/Home
 
     #define LCD_I2C_TYPE_PCF8575
     #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
     #define ULTIPANEL
-    #define NEWPANEL
 
   #elif ENABLED(LCD_I2C_PANELOLU2)
 
     // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
 
     #define LCD_I2C_TYPE_MCP23017
     #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
     #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD
     #define ULTIPANEL
-    #define NEWPANEL
 
   #elif ENABLED(LCD_I2C_VIKI)
 
     /**
      * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
      *
      * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
      * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
      * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
      *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
      */
     #define LCD_I2C_TYPE_MCP23017
     #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
     #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
     #define ULTIPANEL
-    #define NEWPANEL
 
     #define ENCODER_FEEDRATE_DEADZONE 4
 
     #define STD_ENCODER_PULSES_PER_STEP 1
     #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
 
   #elif ENABLED(G3D_PANEL)
 
     #define STD_ENCODER_PULSES_PER_STEP 2
     #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
@@ -230,34 +220,33 @@
   #endif
 
   // Shift register panels
   // ---------------------
   // 2 wire Non-latching LCD SR from:
   // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
 
   #if ENABLED(SAV_3DLCD)
     #define SR_LCD_2W_NL    // Non latching 2 wire shift register
     #define ULTIPANEL
-    #define NEWPANEL
   #endif
 
   #if ENABLED(DOGLCD) // Change number of lines to match the DOG graphic display
     #ifndef LCD_WIDTH
       #define LCD_WIDTH 22
     #endif
     #ifndef LCD_HEIGHT
       #define LCD_HEIGHT 5
     #endif
   #endif
 
   #if ENABLED(ULTIPANEL)
-    #define NEWPANEL  //enable this if you have a click-encoder panel
+    #define NEWPANEL  // Disable this if you actually have no click-encoder panel
     #define ULTRA_LCD
     #ifndef LCD_WIDTH
       #define LCD_WIDTH 20
     #endif
     #ifndef LCD_HEIGHT
       #define LCD_HEIGHT 4
     #endif
   #else // no panel but just LCD
     #if ENABLED(ULTRA_LCD)
       #ifndef LCD_WIDTH

commit 7a29f802d024cfd2fdb76364e748e0249ba96445
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Tue Sep 26 23:34:09 2017 -0500

    Fix ENCODER_PULSES_PER_STEP for G3D_PANEL

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index af1f7e08be..3f8092d233 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -188,37 +188,52 @@
      *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
      */
     #define LCD_I2C_TYPE_MCP23017
     #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
     #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
     #define ULTIPANEL
     #define NEWPANEL
 
     #define ENCODER_FEEDRATE_DEADZONE 4
 
-    #ifndef ENCODER_PULSES_PER_STEP
-      #define ENCODER_PULSES_PER_STEP 1
-    #endif
-    #ifndef ENCODER_STEPS_PER_MENU_ITEM
-      #define ENCODER_STEPS_PER_MENU_ITEM 2
-    #endif
+    #define STD_ENCODER_PULSES_PER_STEP 1
+    #define STD_ENCODER_STEPS_PER_MENU_ITEM 2
+
+  #elif ENABLED(G3D_PANEL)
+
+    #define STD_ENCODER_PULSES_PER_STEP 2
+    #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+
+  #elif ENABLED(miniVIKI) || ENABLED(VIKI2) \
+     || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
+     || ENABLED(OLED_PANEL_TINYBOY2) \
+     || ENABLED(BQ_LCD_SMART_CONTROLLER) \
+     || ENABLED(LCD_I2C_PANELOLU2) \
+     || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
+    #define STD_ENCODER_PULSES_PER_STEP 4
+    #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
   #endif
 
-  // Set encoder detents for well-known controllers
-  #if ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(OLED_PANEL_TINYBOY2) \
-   || ENABLED(BQ_LCD_SMART_CONTROLLER) || ENABLED(LCD_I2C_PANELOLU2) || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
-    #ifndef ENCODER_PULSES_PER_STEP
-      #define ENCODER_PULSES_PER_STEP 4
-    #endif
-    #ifndef ENCODER_STEPS_PER_MENU_ITEM
-      #define ENCODER_STEPS_PER_MENU_ITEM 1
-    #endif
+  #ifndef STD_ENCODER_PULSES_PER_STEP
+    #define STD_ENCODER_PULSES_PER_STEP 5
+  #endif
+  #ifndef STD_ENCODER_STEPS_PER_MENU_ITEM
+    #define STD_ENCODER_STEPS_PER_MENU_ITEM 1
+  #endif
+  #ifndef ENCODER_PULSES_PER_STEP
+    #define ENCODER_PULSES_PER_STEP STD_ENCODER_PULSES_PER_STEP
+  #endif
+  #ifndef ENCODER_STEPS_PER_MENU_ITEM
+    #define ENCODER_STEPS_PER_MENU_ITEM STD_ENCODER_STEPS_PER_MENU_ITEM
+  #endif
+  #ifndef ENCODER_FEEDRATE_DEADZONE
+    #define ENCODER_FEEDRATE_DEADZONE 6
   #endif
 
   // Shift register panels
   // ---------------------
   // 2 wire Non-latching LCD SR from:
   // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
 
   #if ENABLED(SAV_3DLCD)
     #define SR_LCD_2W_NL    // Non latching 2 wire shift register
     #define ULTIPANEL

commit 3d8a0ab4b215a3869a0388e5c0ef35a6372ed7d5
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Sep 6 06:28:32 2017 -0500

    Module updates

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
index 351f33e680..af1f7e08be 100644
--- a/Marlin/src/inc/Conditionals_LCD.h
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -343,20 +343,28 @@
     #undef TEMP_SENSOR_1_AS_REDUNDANT
     #undef HOTEND_OFFSET_X
     #undef HOTEND_OFFSET_Y
   #else                                                         // Two hotends
     #define HOTENDS       EXTRUDERS
     #if ENABLED(SWITCHING_NOZZLE) && !defined(HOTEND_OFFSET_Z)
       #define HOTEND_OFFSET_Z { 0 }
     #endif
   #endif
 
+  #define HOTEND_LOOP() for (int8_t e = 0; e < HOTENDS; e++)
+
+  #if HOTENDS == 1
+    #define HOTEND_INDEX  0
+  #else
+    #define HOTEND_INDEX  e
+  #endif
+
   #if ENABLED(SWITCHING_EXTRUDER) || ENABLED(MIXING_EXTRUDER)   // Unified E axis
     #if ENABLED(MIXING_EXTRUDER)
       #define E_STEPPERS  MIXING_STEPPERS
     #else
       #define E_STEPPERS  1                                     // One E stepper
     #endif
     #define E_MANUAL      1
     #define TOOL_E_INDEX  0
   #else
     #define E_STEPPERS    EXTRUDERS

commit 5be07b5db24069097f6a08f6341c55bb3160062f
Author: Scott Lahteine <github@thinkyhead.com>
Date:   Wed Sep 6 06:28:30 2017 -0500

    Move 'inc' files

diff --git a/Marlin/src/inc/Conditionals_LCD.h b/Marlin/src/inc/Conditionals_LCD.h
new file mode 100644
index 0000000000..351f33e680
--- /dev/null
+++ b/Marlin/src/inc/Conditionals_LCD.h
@@ -0,0 +1,449 @@
+/**
+ * Marlin 3D Printer Firmware
+ * Copyright (C) 2016 MarlinFirmware [https://github.com/MarlinFirmware/Marlin]
+ *
+ * Based on Sprinter and grbl.
+ * Copyright (C) 2011 Camiel Gubbels / Erik van der Zalm
+ *
+ * This program is free software: you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation, either version 3 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ *
+ */
+
+/**
+ * Conditionals_LCD.h
+ * Conditionals that need to be set before Configuration_adv.h or pins.h
+ */
+
+#ifndef CONDITIONALS_LCD_H // Get the LCD defines which are needed first
+#define CONDITIONALS_LCD_H
+
+  #define LCD_HAS_DIRECTIONAL_BUTTONS (BUTTON_EXISTS(UP) || BUTTON_EXISTS(DWN) || BUTTON_EXISTS(LFT) || BUTTON_EXISTS(RT))
+
+  #if ENABLED(CARTESIO_UI)
+
+    #define DOGLCD
+    #define ULTIPANEL
+    #define NEWPANEL
+    #define DEFAULT_LCD_CONTRAST 90
+    #define LCD_CONTRAST_MIN 60
+    #define LCD_CONTRAST_MAX 140
+
+  #elif ENABLED(MAKRPANEL)
+
+    #define DOGLCD
+    #define ULTIPANEL
+    #define NEWPANEL
+    #define DEFAULT_LCD_CONTRAST 17
+    #define U8GLIB_ST7565_64128N
+
+  #elif ENABLED(MINIPANEL)
+
+    #define DOGLCD
+    #define ULTIPANEL
+    #define NEWPANEL
+    #define DEFAULT_LCD_CONTRAST 17
+
+  #elif ENABLED(ANET_KEYPAD_LCD)
+
+    #define REPRAPWORLD_KEYPAD
+    #define REPRAPWORLD_KEYPAD_MOVE_STEP 10.0
+    #define ADC_KEYPAD
+    #define ADC_KEY_NUM 8
+    #define ULTIPANEL
+    // this helps to implement ADC_KEYPAD menus
+    #define ENCODER_STEPS_PER_MENU_ITEM 1
+    #define REVERSE_MENU_DIRECTION
+
+  #elif ENABLED(ANET_FULL_GRAPHICS_LCD)
+
+    #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+
+  #elif ENABLED(BQ_LCD_SMART_CONTROLLER)
+
+    #define REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER
+    #define LONG_FILENAME_HOST_SUPPORT
+
+  #elif ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
+
+    #define ULTRA_LCD  //general LCD support, also 16x2
+    #define DOGLCD  // Support for SPI LCD 128x64 (Controller ST7565R graphic Display Family)
+    #define ULTIMAKERCONTROLLER //as available from the Ultimaker online store.
+
+    #if ENABLED(miniVIKI)
+      #define LCD_CONTRAST_MIN  75
+      #define LCD_CONTRAST_MAX 115
+      #define DEFAULT_LCD_CONTRAST 95
+      #define U8GLIB_ST7565_64128N
+    #elif ENABLED(VIKI2)
+      #define LCD_CONTRAST_MIN 0
+      #define LCD_CONTRAST_MAX 255
+      #define DEFAULT_LCD_CONTRAST 140
+      #define U8GLIB_ST7565_64128N
+    #elif ENABLED(ELB_FULL_GRAPHIC_CONTROLLER)
+      #define LCD_CONTRAST_MIN  90
+      #define LCD_CONTRAST_MAX 130
+      #define DEFAULT_LCD_CONTRAST 110
+      #define U8GLIB_LM6059_AF
+      #define SD_DETECT_INVERTED
+    #endif
+
+  #elif ENABLED(OLED_PANEL_TINYBOY2)
+
+    #define U8GLIB_SSD1306
+    #define ULTIPANEL
+    #define NEWPANEL
+    #define REVERSE_ENCODER_DIRECTION
+    #define REVERSE_MENU_DIRECTION
+
+  #elif ENABLED(RA_CONTROL_PANEL)
+
+    #define LCD_I2C_TYPE_PCA8574
+    #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
+    #define ULTIPANEL
+    #define NEWPANEL
+
+  #elif ENABLED(REPRAPWORLD_GRAPHICAL_LCD)
+
+    #define DOGLCD
+    #define U8GLIB_ST7920
+    #define ULTIPANEL
+    #define NEWPANEL
+
+  #endif
+
+  // Generic support for SSD1306 / SH1106 OLED based LCDs.
+  #if ENABLED(U8GLIB_SSD1306) || ENABLED(U8GLIB_SH1106)
+    #define ULTRA_LCD  //general LCD support, also 16x2
+    #define DOGLCD  // Support for I2C LCD 128x64 (Controller SSD1306 / SH1106 graphic Display Family)
+  #endif
+
+  #if ENABLED(PANEL_ONE) || ENABLED(U8GLIB_SH1106)
+    #define ULTIMAKERCONTROLLER
+  #endif
+
+  #if ENABLED(REPRAP_DISCOUNT_FULL_GRAPHIC_SMART_CONTROLLER) || ENABLED(LCD_FOR_MELZI)
+    #define DOGLCD
+    #define U8GLIB_ST7920
+    #define REPRAP_DISCOUNT_SMART_CONTROLLER
+  #endif
+
+  #if ENABLED(ULTIMAKERCONTROLLER)              \
+   || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER) \
+   || ENABLED(G3D_PANEL)                        \
+   || ENABLED(RIGIDBOT_PANEL)
+    #define ULTIPANEL
+    #define NEWPANEL
+  #endif
+
+  #if ENABLED(REPRAPWORLD_KEYPAD)
+    #define NEWPANEL
+    #if ENABLED(ULTIPANEL) && !defined(REPRAPWORLD_KEYPAD_MOVE_STEP)
+      #define REPRAPWORLD_KEYPAD_MOVE_STEP 1.0
+    #endif
+  #endif
+
+  /**
+   * I2C PANELS
+   */
+
+  #if ENABLED(LCD_I2C_SAINSMART_YWROBOT)
+
+    // Note: This controller requires F.Malpartida's LiquidCrystal_I2C library
+    // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/Home
+
+    #define LCD_I2C_TYPE_PCF8575
+    #define LCD_I2C_ADDRESS 0x27   // I2C Address of the port expander
+    #define ULTIPANEL
+    #define NEWPANEL
+
+  #elif ENABLED(LCD_I2C_PANELOLU2)
+
+    // PANELOLU2 LCD with status LEDs, separate encoder and click inputs
+
+    #define LCD_I2C_TYPE_MCP23017
+    #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
+    #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD
+    #define ULTIPANEL
+    #define NEWPANEL
+
+  #elif ENABLED(LCD_I2C_VIKI)
+
+    /**
+     * Panucatt VIKI LCD with status LEDs, integrated click & L/R/U/P buttons, separate encoder inputs
+     *
+     * This uses the LiquidTWI2 library v1.2.3 or later ( https://github.com/lincomatic/LiquidTWI2 )
+     * Make sure the LiquidTWI2 directory is placed in the Arduino or Sketchbook libraries subdirectory.
+     * Note: The pause/stop/resume LCD button pin should be connected to the Arduino
+     *       BTN_ENC pin (or set BTN_ENC to -1 if not used)
+     */
+    #define LCD_I2C_TYPE_MCP23017
+    #define LCD_I2C_ADDRESS 0x20 // I2C Address of the port expander
+    #define LCD_USE_I2C_BUZZER //comment out to disable buzzer on LCD (requires LiquidTWI2 v1.2.3 or later)
+    #define ULTIPANEL
+    #define NEWPANEL
+
+    #define ENCODER_FEEDRATE_DEADZONE 4
+
+    #ifndef ENCODER_PULSES_PER_STEP
+      #define ENCODER_PULSES_PER_STEP 1
+    #endif
+    #ifndef ENCODER_STEPS_PER_MENU_ITEM
+      #define ENCODER_STEPS_PER_MENU_ITEM 2
+    #endif
+  #endif
+
+  // Set encoder detents for well-known controllers
+  #if ENABLED(miniVIKI) || ENABLED(VIKI2) || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) || ENABLED(OLED_PANEL_TINYBOY2) \
+   || ENABLED(BQ_LCD_SMART_CONTROLLER) || ENABLED(LCD_I2C_PANELOLU2) || ENABLED(REPRAP_DISCOUNT_SMART_CONTROLLER)
+    #ifndef ENCODER_PULSES_PER_STEP
+      #define ENCODER_PULSES_PER_STEP 4
+    #endif
+    #ifndef ENCODER_STEPS_PER_MENU_ITEM
+      #define ENCODER_STEPS_PER_MENU_ITEM 1
+    #endif
+  #endif
+
+  // Shift register panels
+  // ---------------------
+  // 2 wire Non-latching LCD SR from:
+  // https://bitbucket.org/fmalpartida/new-liquidcrystal/wiki/schematics#!shiftregister-connection
+
+  #if ENABLED(SAV_3DLCD)
+    #define SR_LCD_2W_NL    // Non latching 2 wire shift register
+    #define ULTIPANEL
+    #define NEWPANEL
+  #endif
+
+  #if ENABLED(DOGLCD) // Change number of lines to match the DOG graphic display
+    #ifndef LCD_WIDTH
+      #define LCD_WIDTH 22
+    #endif
+    #ifndef LCD_HEIGHT
+      #define LCD_HEIGHT 5
+    #endif
+  #endif
+
+  #if ENABLED(ULTIPANEL)
+    #define NEWPANEL  //enable this if you have a click-encoder panel
+    #define ULTRA_LCD
+    #ifndef LCD_WIDTH
+      #define LCD_WIDTH 20
+    #endif
+    #ifndef LCD_HEIGHT
+      #define LCD_HEIGHT 4
+    #endif
+  #else // no panel but just LCD
+    #if ENABLED(ULTRA_LCD)
+      #ifndef LCD_WIDTH
+        #define LCD_WIDTH 16
+      #endif
+      #ifndef LCD_HEIGHT
+        #define LCD_HEIGHT 2
+      #endif
+    #endif
+  #endif
+
+  #if ENABLED(DOGLCD)
+    /* Custom characters defined in font dogm_font_data_Marlin_symbols.h / Marlin_symbols.fon */
+    // \x00 intentionally skipped to avoid problems in strings
+    #define LCD_STR_REFRESH     "\x01"
+    #define LCD_STR_FOLDER      "\x02"
+    #define LCD_STR_ARROW_RIGHT "\x03"
+    #define LCD_STR_UPLEVEL     "\x04"
+    #define LCD_STR_CLOCK       "\x05"
+    #define LCD_STR_FEEDRATE    "\x06"
+    #define LCD_STR_BEDTEMP     "\x07"
+    #define LCD_STR_THERMOMETER "\x08"
+    #define LCD_STR_DEGREE      "\x09"
+
+    #define LCD_STR_SPECIAL_MAX '\x09'
+    // Maximum here is 0x1F because 0x20 is ' ' (space) and the normal charsets begin.
+    // Better stay below 0x10 because DISPLAY_CHARSET_HD44780_WESTERN begins here.
+
+    // Symbol characters
+    #define LCD_STR_FILAM_DIA   "\xf8"
+    #define LCD_STR_FILAM_MUL   "\xa4"
+  #else
+    /* Custom characters defined in the first 8 characters of the LCD */
+    #define LCD_BEDTEMP_CHAR     0x00  // Print only as a char. This will have 'unexpected' results when used in a string!
+    #define LCD_DEGREE_CHAR      0x01
+    #define LCD_STR_THERMOMETER "\x02" // Still used with string concatenation
+    #define LCD_UPLEVEL_CHAR     0x03
+    #define LCD_STR_REFRESH     "\x04"
+    #define LCD_STR_FOLDER      "\x05"
+    #define LCD_FEEDRATE_CHAR    0x06
+    #define LCD_CLOCK_CHAR       0x07
+    #define LCD_STR_ARROW_RIGHT ">"  /* from the default character set */
+  #endif
+
+  /**
+   * Default LCD contrast for dogm-like LCD displays
+   */
+  #if ENABLED(DOGLCD)
+
+    #define HAS_LCD_CONTRAST ( \
+        ENABLED(MAKRPANEL) \
+     || ENABLED(CARTESIO_UI) \
+     || ENABLED(VIKI2) \
+     || ENABLED(miniVIKI) \
+     || ENABLED(ELB_FULL_GRAPHIC_CONTROLLER) \
+    )
+
+    #if HAS_LCD_CONTRAST
+      #ifndef LCD_CONTRAST_MIN
+        #define LCD_CONTRAST_MIN 0
+      #endif
+      #ifndef LCD_CONTRAST_MAX
+        #define LCD_CONTRAST_MAX 63
+      #endif
+      #ifndef DEFAULT_LCD_CONTRAST
+        #define DEFAULT_LCD_CONTRAST 32
+      #endif
+    #endif
+  #endif
+
+  // Boot screens
+  #if DISABLED(ULTRA_LCD)
+    #undef SHOW_BOOTSCREEN
+  #elif !defined(BOOTSCREEN_TIMEOUT)
+    #define BOOTSCREEN_TIMEOUT 2500
+  #endif
+
+  #define HAS_DEBUG_MENU ENABLED(LCD_PROGRESS_BAR_TEST)
+
+  // MK2 Multiplexer forces SINGLENOZZLE to be enabled
+  #if ENABLED(MK2_MULTIPLEXER)
+    #define SINGLENOZZLE
+  #endif
+
+  /**
+   * Extruders have some combination of stepper motors and hotends
+   * so we separate these concepts into the defines:
+   *
+   *  EXTRUDERS    - Number of Selectable Tools
+   *  HOTENDS      - Number of hotends, whether connected or separate
+   *  E_STEPPERS   - Number of actual E stepper motors
+   *  E_MANUAL     - Number of E steppers for LCD move options
+   *  TOOL_E_INDEX - Index to use when getting/setting the tool state
+   *
+   */
+  #if ENABLED(SINGLENOZZLE) || ENABLED(MIXING_EXTRUDER)         // One hotend, one thermistor, no XY offset
+    #define HOTENDS       1
+    #undef TEMP_SENSOR_1_AS_REDUNDANT
+    #undef HOTEND_OFFSET_X
+    #undef HOTEND_OFFSET_Y
+  #else                                                         // Two hotends
+    #define HOTENDS       EXTRUDERS
+    #if ENABLED(SWITCHING_NOZZLE) && !defined(HOTEND_OFFSET_Z)
+      #define HOTEND_OFFSET_Z { 0 }
+    #endif
+  #endif
+
+  #if ENABLED(SWITCHING_EXTRUDER) || ENABLED(MIXING_EXTRUDER)   // Unified E axis
+    #if ENABLED(MIXING_EXTRUDER)
+      #define E_STEPPERS  MIXING_STEPPERS
+    #else
+      #define E_STEPPERS  1                                     // One E stepper
+    #endif
+    #define E_MANUAL      1
+    #define TOOL_E_INDEX  0
+  #else
+    #define E_STEPPERS    EXTRUDERS
+    #define E_MANUAL      EXTRUDERS
+    #define TOOL_E_INDEX  current_block->active_extruder
+  #endif
+
+  /**
+   * DISTINCT_E_FACTORS affects how some E factors are accessed
+   */
+  #if ENABLED(DISTINCT_E_FACTORS) && E_STEPPERS > 1
+    #define XYZE_N (XYZ + E_STEPPERS)
+    #define E_AXIS_N (E_AXIS + extruder)
+  #else
+    #undef DISTINCT_E_FACTORS
+    #define XYZE_N XYZE
+    #define E_AXIS_N E_AXIS
+  #endif
+
+  /**
+   * The BLTouch Probe emulates a servo probe
+   * and uses "special" angles for its state.
+   */
+  #if ENABLED(BLTOUCH)
+    #ifndef Z_ENDSTOP_SERVO_NR
+      #define Z_ENDSTOP_SERVO_NR 0
+    #endif
+    #ifndef NUM_SERVOS
+      #define NUM_SERVOS (Z_ENDSTOP_SERVO_NR + 1)
+    #endif
+    #undef DEACTIVATE_SERVOS_AFTER_MOVE
+    #if NUM_SERVOS == 1
+      #undef SERVO_DELAY
+      #define SERVO_DELAY { 50 }
+    #endif
+    #ifndef BLTOUCH_DELAY
+      #define BLTOUCH_DELAY 375
+    #endif
+    #undef Z_SERVO_ANGLES
+    #define Z_SERVO_ANGLES { BLTOUCH_DEPLOY, BLTOUCH_STOW }
+
+    #define BLTOUCH_DEPLOY    10
+    #define BLTOUCH_STOW      90
+    #define BLTOUCH_SELFTEST 120
+    #define BLTOUCH_RESET    160
+    #define _TEST_BLTOUCH(P) (READ(P##_PIN) != P##_ENDSTOP_INVERTING)
+
+    // Always disable probe pin inverting for BLTouch
+    #undef Z_MIN_PROBE_ENDSTOP_INVERTING
+    #define Z_MIN_PROBE_ENDSTOP_INVERTING false
+
+    #if ENABLED(Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN)
+      #undef Z_MIN_ENDSTOP_INVERTING
+      #define Z_MIN_ENDSTOP_INVERTING false
+      #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN)
+    #else
+      #define TEST_BLTOUCH() _TEST_BLTOUCH(Z_MIN_PROBE)
+    #endif
+  #endif
+
+  /**
+   * Set a flag for a servo probe
+   */
+  #define HAS_Z_SERVO_ENDSTOP (defined(Z_ENDSTOP_SERVO_NR) && Z_ENDSTOP_SERVO_NR >= 0)
+
+  /**
+   * UBL has its own manual probing, so this just causes trouble.
+   */
+  #if ENABLED(AUTO_BED_LEVELING_UBL)
+    #undef PROBE_MANUALLY
+  #endif
+
+  /**
+   * Set a flag for any enabled probe
+   */
+  #define PROBE_SELECTED (ENABLED(PROBE_MANUALLY) || ENABLED(FIX_MOUNTED_PROBE) || ENABLED(Z_PROBE_ALLEN_KEY) || HAS_Z_SERVO_ENDSTOP || ENABLED(Z_PROBE_SLED) || ENABLED(SOLENOID_PROBE))
+
+  /**
+   * Clear probe pin settings when no probe is selected
+   */
+  #if !PROBE_SELECTED || ENABLED(PROBE_MANUALLY)
+    #undef Z_MIN_PROBE_USES_Z_MIN_ENDSTOP_PIN
+    #undef Z_MIN_PROBE_ENDSTOP
+  #endif
+
+  #define HAS_SOFTWARE_ENDSTOPS (ENABLED(MIN_SOFTWARE_ENDSTOPS) || ENABLED(MAX_SOFTWARE_ENDSTOPS))
+  #define HAS_RESUME_CONTINUE (ENABLED(NEWPANEL) || ENABLED(EMERGENCY_PARSER))
+  #define HAS_COLOR_LEDS (ENABLED(BLINKM) || ENABLED(RGB_LED) || ENABLED(RGBW_LED) || ENABLED(PCA9632) || ENABLED(NEOPIXEL_RGBW_LED))
+
+#endif // CONDITIONALS_LCD_H
